# ğŸ­ ä»æ•°æ®åº“ä¸­åŠ¨æ€åŠ è½½è§’è‰²

---


ä¹‹å‰çš„ç‰ˆæœ¬çš„ç”¨æˆ·è§’è‰² `Role` é€šè¿‡ `enum` çš„æ–¹å¼ç¡¬ç¼–ç äº†ï¼š

```java
public enum Role{
    admin, normal
}

......
    
@Enumerated(EnumType.STRING)
private Role role;
```

è€Œ**åœ¨å®é™…åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ªæ•°æ®åº“çš„è§’è‰²è¡¨è¿›è¡Œå‚¨å­˜è§’è‰²**ï¼Œå¦‚ä¸‹å›¾ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200812103047.png)

æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯ä»è¿™å¼ æ•°æ®åº“è¡¨ä¸­åŠ¨æ€çš„è·å–ç”¨æˆ·æ‰€æ‹¥æœ‰çš„æƒé™ ğŸ‘‡

## 1. åˆ›å»ºè§’è‰²å®ä½“ç±»

å®šä¹‰ä¸€ä¸ªè§’è‰²å®ä½“ç±» `Role`ï¼š

```java
@Entity
public class Role {

    @Id
    @GeneratedValue
    private Integer id;

    private String name; // è§’è‰²åç§°
    private String description; //è§’è‰²æè¿°

    public Role() {
    }

    public Role(String name, String description) {
        this.name = name;
        this.description = description;
    }

    // Getter And Setter
}
```

## 2. è§’è‰²æŒä¹…åŒ–

åˆ›å»º `RoleRepository` æŒä¹…åŒ–æ“ä½œï¼š

```java
public interface RoleRepository extends JpaRepository<Role,Long> {

}
```

## 3. ä¿®æ”¹ UserInfo çš„ç”¨æˆ·è§’è‰²

å°† `Role `åŠ è½½è¿› `UserInfo `ä¸­ï¼š

```java
@Entity
public class UserInfo {


    @Id // ä¸»é”®
    @GeneratedValue // è‡ªå¢
    private long uid;

    private String username;
    private String password;

    // ç”¨æˆ·-è§’è‰² å¤šå¯¹å¤šå…³ç³»
    @ManyToMany(fetch = FetchType.EAGER) // ç«‹å³ä»æ•°æ®åº“ä¸­åŠ è½½æ•°æ®
    // åˆ©ç”¨ä¸¤å¼ è¡¨çš„ä¸»é”®åˆ›å»ºä¸€ä¸ªç”¨æˆ·-è§’è‰²å…³è”è¡¨UserRole åˆ—å uid å’Œ role_id
    @JoinTable(name = "UserRole", joinColumns = {@JoinColumn(name = "uid")}, inverseJoinColumns = {@JoinColumn(name = "role_id")})
    private List<Role>  roles; // ä¸€ä¸ªç”¨æˆ·å¯æ‹¥æœ‰å¤šä¸ªæƒé™

    // Getter And Setter
}
```

ä¸Šè¿°ä»£ç **æœ€ç»ˆ**å¯ä»¥åˆ›å»ºå¦‚ä¸‹çš„å…³è”è¡¨ `user_info`ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200812103705.png)

## 4. ä¿®æ”¹ CustomUserDetailService

è°ƒæ•´è§’è‰² `Role `çš„æ·»åŠ æ–¹å¼ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200812103924.png)

## 5. ä¿®æ”¹ DataInit

æœ€åæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸‹åˆå§‹åŒ–æ•°æ®çš„æ–¹æ³•ï¼š

```java
@Service
public class DataInit {

    @Autowired
    private UserInfoRepository userInfoRepository;

    @Autowired
    private RoleRepository roleRepository;

    @Autowired
    private PasswordEncoder passwordEncoder;

    @PostConstruct
    public void dataInit(){

        // åˆ›å»º Role ä¿¡æ¯
        List<Role> roles = new ArrayList<>();
        Role adminRole = new Role("admin", "ç®¡ç†å‘˜");
        Role normalRole = new Role("normal", "æ™®é€šç”¨æˆ·");
        roleRepository.save(adminRole);
        roleRepository.save(normalRole);

        // ç”¨æˆ· admin
        UserInfo admin = new UserInfo();
        admin.setUsername("admin");
        admin.setPassword(passwordEncoder.encode("123"));
        // ä¸ºç”¨æˆ· admin æ·»åŠ  2 ä¸ªè§’è‰²
        roles.add(adminRole);
        roles.add(normalRole);
        admin.setRoles(roles);
        userInfoRepository.save(admin);

        // ç”¨æˆ· user
        UserInfo user = new UserInfo();
        user.setUsername("user");
        user.setPassword(passwordEncoder.encode("123"));
        // ä¸ºç”¨æˆ· user æ·»åŠ  1 ä¸ªè§’è‰²
        roles = new ArrayList<>(); 
        roles.add(normalRole);
        user.setRoles(roles);
        userInfoRepository.save(user);
    }
}
```

## 6. æµ‹è¯•

è¿è¡ŒæˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ°è‡ªåŠ¨æ„å»ºäº†å¦‚ä¸‹å››å¼ è¡¨ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200812104235.png)

`role` è§’è‰²è¡¨ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200812104337.png)

`user_info` ç”¨æˆ·è¡¨ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200812104351.png)

`user_role` ç”¨æˆ·-è§’è‰²å…³è”è¡¨ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200812104403.png)

## ğŸ“š References

- [æ—ç¥¥çº¤ - Spring Boot+Spring Security ç³»åˆ—](https://www.iteye.com/blog/412887952-qq-com-2441544)