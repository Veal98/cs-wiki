---
title: äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ
date: 2021-11-29 09:13:10
permalink: /pages/d75e7f/
---

## ğŸ“ƒ é¢˜ç›®æè¿°

é¢˜ç›®é“¾æ¥ï¼š[236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰ (leetcode-cn.com)](https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-tree/)

ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚

ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªèŠ‚ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªèŠ‚ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€

ç¤ºä¾‹ 1ï¼š

![img](https://assets.leetcode.com/uploads/2018/12/14/binarytree.png)

```
è¾“å…¥ï¼šroot = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 1
è¾“å‡ºï¼š3
è§£é‡Šï¼šèŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 1 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 3
```

ç¤ºä¾‹ 2ï¼š

![img](https://assets.leetcode.com/uploads/2018/12/14/binarytree.png)

```
è¾“å…¥ï¼šroot = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 4
è¾“å‡ºï¼š5
è§£é‡Šï¼šèŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 4 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 5 ã€‚å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«
```

## ğŸ”” è§£é¢˜æ€è·¯

### é€’å½’

A å’Œ B çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæœ‰ä¸‰ç§æƒ…å†µï¼š

1. A == rootï¼Œåˆ™ A æ˜¯ B çš„æœ€è¿‘ç¥–å…ˆï¼ˆåä¹‹ä¹Ÿä¸€æ ·ï¼‰
2. A å’Œ B éƒ½åœ¨å·¦å­æ ‘æˆ–è€…éƒ½åœ¨å³å­æ ‘ä¸Š
3. A å’Œ B åˆ†åˆ«ä½äº root çš„å·¦å­æ ‘å’Œå³å­æ ‘ï¼Œåˆ™ root å°±æ˜¯æœ€è¿‘å…¬å…±ç¥–å…ˆ

ç›´æ¥é€’å½’åšèµ·æ¥ï¼ˆååºéå†ï¼‰

```java
å·¦: leftAncestor = é€’å½’å‡½æ•°(root.left);
å³: rightAncestor = é€’å½’å‡½æ•°(root.right);
æ ¹: leftAncestor ä¸ rightAncestor çš„é€»è¾‘å¤„ç†(å¦‚æœ leftAncestor ä¸ºç©ºï¼ŒrightAncestor ä¸ä¸ºç©ºï¼Œå°±è¿”å› rightAncestorï¼Œè¯´æ˜ç›®æ ‡èŠ‚ç‚¹æ˜¯é€šè¿‡ rightAncestor è¿”å›çš„ï¼Œåä¹‹ä¾ç„¶)
```

è¿™é‡Œå¯èƒ½æœ‰ç‚¹ä¸å¥½ç†è§£ï¼Œä¸ºä»€ä¹ˆ left ä¸ºç©ºï¼Œright ä¸ä¸ºç©ºï¼Œç›®æ ‡èŠ‚ç‚¹é€šè¿‡ right è¿”å›å‘¢ï¼Ÿ

è¿™é‡Œæ”¾ä¸Š[ä»£ç éšæƒ³å½• (programmercarl.com)](https://www.programmercarl.com/0236.äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ.html#java)å¤§ä½¬çš„å›¾ç‰‡ï¼š

![](https://img-blog.csdnimg.cn/20210204151125844.png)

ç†è§£é€’å½’å‡½æ•°çš„è¿”å›å€¼å¾ˆé‡è¦ï¼šæœ¬é¢˜**å®šä¹‰ lowestCommonAncestor è¡¨ç¤º root èŠ‚ç‚¹çš„å­æ ‘ä¸­æ˜¯å¦åŒ…å« p èŠ‚ç‚¹æˆ– q èŠ‚ç‚¹**


```java
/**
 * Definition for a binary tree node.
 * public class TreeNode {
 *     int val;
 *     TreeNode left;
 *     TreeNode right;
 *     TreeNode(int x) { val = x; }
 * }
 */
class Solution {
    public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) {
        if (root == null) {
            return null;
        }

        // æƒ…å†µ 1ï¼šp æˆ–è€… q ä¸º root, é‚£ä¹ˆ root å°±æ˜¯æœ€è¿‘å…¬å…±ç¥–å…ˆ
        if (root == p || root == q) {
            return root;
        }
		
        // æƒ…å†µ 2ï¼šA å’Œ B éƒ½åœ¨å·¦å­æ ‘æˆ–è€…éƒ½åœ¨å³å­æ ‘ä¸Š
        
        // å·¦å­æ ‘ä¸Šæ‰¾å…¬å…±ç¥–å…ˆ
        TreeNode leftAncestor = lowestCommonAncestor(root.left, p, q);
        // å³å­æ ‘ä¸Šæ‰¾å…¬å…±ç¥–å…ˆ
        TreeNode rightAncestor = lowestCommonAncestor(root.right, p, q);

        // å·¦å­æ ‘ä¸­æ²¡æœ‰æ‰¾åˆ°å…¬å…±ç¥–å…ˆï¼Œé‚£ä¹ˆä¸€å®šåœ¨å³å­æ ‘ä¸­
        if (leftAncestor == null) {
            return rightAncestor;
        }
        // å³å­æ ‘ä¸­æ²¡æœ‰æ‰¾åˆ°å…¬å…±ç¥–å…ˆï¼Œé‚£ä¹ˆä¸€å®šåœ¨å·¦å­æ ‘ä¸­
        if (rightAncestor == null) {
            return leftAncestor;
        }

        // æƒ…å†µ 3ï¼šif(left != null and right != null) A å’Œ B åˆ†åˆ«ä½äº root çš„å·¦å­æ ‘å’Œå³å­æ ‘ï¼Œé‚£ä¹ˆ root å°±æ˜¯æœ€è¿‘å…¬å…±ç¥–å…ˆ
        return root;
    }
}
```

æ³¨æ„ä¸‹é¢è¿™ä¸ªç»“æŸæ¡ä»¶ä¸èƒ½å°‘ï¼š

![](https://cs-wiki.oss-cn-shanghai.aliyuncs.com/img/20220527120656.png)

å¤æ‚åº¦åˆ†æ

- ç©ºé—´å¤æ‚åº¦ï¼šO(LogN)ï¼Œé€’å½’è°ƒç”¨çš„æ ˆæ·±åº¦å–å†³äºäºŒå‰æ ‘çš„é«˜åº¦ã€‚äºŒå‰æ ‘æœ€åæƒ…å†µä¸‹ä¸ºä¸€æ¡é“¾ï¼Œæ­¤æ—¶ç©ºé—´å¤æ‚åº¦ä¸º O(N)
- æ—¶é—´å¤æ‚åº¦ï¼šO(N)ï¼Œå…¶ä¸­ N æ˜¯äºŒå‰æ ‘çš„èŠ‚ç‚¹æ•°ã€‚äºŒå‰æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹æœ‰ä¸”åªä¼šè¢«è®¿é—®ä¸€æ¬¡ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦ä¸º O(N)ã€‚

### DFS + å“ˆå¸Œè¡¨

**æˆ‘ä»¬å¯ä»¥ç”¨å“ˆå¸Œè¡¨å­˜å‚¨æ‰€æœ‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¿¡æ¯ä» p ç»“ç‚¹å¼€å§‹ä¸æ–­å¾€ä¸Šè·³ï¼Œå¹¶è®°å½•å·²ç»è®¿é—®è¿‡çš„èŠ‚ç‚¹ï¼Œå†ä» q èŠ‚ç‚¹å¼€å§‹ä¸æ–­å¾€ä¸Šè·³ï¼Œå¦‚æœç¢°åˆ°å·²ç»è®¿é—®è¿‡çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ**ã€‚

ç®—æ³•

- ä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†æ•´æ£µäºŒå‰æ ‘ï¼Œç”¨å“ˆå¸Œè¡¨è®°å½•æ¯ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æŒ‡é’ˆã€‚
- ä» p èŠ‚ç‚¹å¼€å§‹ä¸æ–­å¾€å®ƒçš„ç¥–å…ˆç§»åŠ¨ï¼Œå¹¶è®°å½•å·²ç»è®¿é—®è¿‡çš„ç¥–å…ˆèŠ‚ç‚¹ã€‚
- åŒæ ·ï¼Œæˆ‘ä»¬å†ä» q èŠ‚ç‚¹å¼€å§‹ä¸æ–­å¾€å®ƒçš„ç¥–å…ˆç§»åŠ¨ï¼Œå¦‚æœæœ‰ç¥–å…ˆå·²ç»è¢«è®¿é—®è¿‡ï¼Œå³æ„å‘³ç€è¿™æ˜¯ p å’Œ q çš„æ·±åº¦æœ€æ·±çš„å…¬å…±ç¥–å…ˆï¼Œå³ LCA èŠ‚ç‚¹ã€‚

> ç±»ä¼¼çš„é¢˜è¿˜æœ‰ [863. äºŒå‰æ ‘ä¸­æ‰€æœ‰è·ç¦»ä¸º K çš„ç»“ç‚¹](https://leetcode.cn/problems/all-nodes-distance-k-in-binary-tree/)

```java
class Solution {
    // value æ˜¯ key çš„çˆ¶èŠ‚ç‚¹
    private Map<TreeNode, TreeNode> parnetMap = new HashMap<>();

    public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) {
        if (root == null) {
            return null;
        }

        // æ„é€  parnet map:ä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†æ•´æ£µäºŒå‰æ ‘ï¼Œç”¨å“ˆå¸Œè¡¨è®°å½•æ¯ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æŒ‡é’ˆ
        findParents(root);

        // å­˜å‚¨å·²è®¿é—®è¿‡çš„èŠ‚ç‚¹
        Set<TreeNode> visited = new HashSet<>();

        // ä» p èŠ‚ç‚¹å¼€å§‹ä¸æ–­å¾€å®ƒçš„ç¥–å…ˆç§»åŠ¨ï¼Œå¹¶è®°å½•å·²ç»è®¿é—®è¿‡çš„ç¥–å…ˆèŠ‚ç‚¹
        while (p != null) {
            visited.add(p);
            p = parnetMap.get(p);
        }
        // å†ä» q èŠ‚ç‚¹å¼€å§‹ä¸æ–­å¾€å®ƒçš„ç¥–å…ˆç§»åŠ¨ï¼Œå¦‚æœæœ‰ç¥–å…ˆå·²ç»è¢«è®¿é—®è¿‡ï¼Œå³æ„å‘³ç€è¿™æ˜¯ p å’Œ q çš„æ·±åº¦æœ€æ·±çš„å…¬å…±ç¥–å…ˆ
        while (q != null) {
            if (visited.contains(q)) {
                return q;
            }

            q = parnetMap.get(q);
        }

        return root;
    }   
    
	// dfs
    private void findParents(TreeNode root) {
        if (root.left != null) {
            parnetMap.put(root.left, root);
            findParents(root.left);
        }

        if (root.right != null) {
            parnetMap.put(root.right, root);
            findParents(root.right);
        }
    }
}
```

- æ—¶é—´å¤æ‚åº¦ï¼šO(N)
- ç©ºé—´å¤æ‚åº¦ï¼šO(N)ï¼ŒäºŒå‰æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹æœ‰ä¸”åªä¼šè¢«è®¿é—®ä¸€æ¬¡ï¼Œä» p å’Œ q èŠ‚ç‚¹å¾€ä¸Šè·³ç»è¿‡çš„ç¥–å…ˆèŠ‚ç‚¹ä¸ªæ•°ä¸ä¼šè¶…è¿‡ Nï¼ˆç›¸æ¯”äºæ–¹æ³•ä¸€è¦å¥½ï¼‰ï¼Œå› æ­¤æ€»çš„æ—¶é—´å¤æ‚åº¦ä¸º O(N)
