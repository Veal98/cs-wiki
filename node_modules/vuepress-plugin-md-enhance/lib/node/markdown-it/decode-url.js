"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.decodeURL = void 0;
/***************************************************
 * Created by nanyuantingfeng on 2020/3/1 10:10. *
 ***************************************************/
const mdurl_1 = require("mdurl");
const needDecode = (url, config) => config === "./" || config === "."
    ? !/^(\w+?:\/)?\//u.test(url)
    : config instanceof RegExp
        ? config.test(url)
        : Array.isArray(config)
            ? config.some((a) => url.startsWith(a))
            : true;
const urlDecode = (url, config) => {
    const realURL = needDecode(url, config) ? (0, mdurl_1.decode)(url) : url;
    return /^(\w+?:\/)?\.?\//.test(realURL) ? realURL : `./${realURL}`;
};
const decodeURL = (md, config = "*") => {
    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
    const originalImageRender = md.renderer.rules.image;
    md.renderer.rules.image = (tokens, idx, options, env, self) => {
        const token = tokens[idx];
        token.attrSet("src", urlDecode(token.attrGet("src") || "", config));
        return originalImageRender(tokens, idx, options, env, self);
    };
};
exports.decodeURL = decodeURL;
//# sourceMappingURL=decode-url.js.map