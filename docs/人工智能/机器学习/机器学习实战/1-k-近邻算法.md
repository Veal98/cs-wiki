# ğŸ‘“ k - è¿‘é‚»ç®—æ³• kNN

---

> ğŸš¨ æ³¨æ„ **k - è¿‘é‚»ç®—æ³•** å’Œ **k - å‡å€¼ç®—æ³•** æ˜¯ä¸åŒçš„ï¼Œä¸€ä¸ªæ˜¯ç›‘ç£å­¦ä¹ ç®—æ³•ï¼Œä¸€ä¸ªæ˜¯éç›‘ç£å­¦ä¹ ç®—æ³•

ä¼—æ‰€å‘¨çŸ¥ï¼Œç”µå½±å¯ä»¥æŒ‰ç…§é¢˜æè¿›è¡Œåˆ†ç±»ï¼Œç„¶è€Œé¢˜ææœ¬èº«æ˜¯å¦‚ä½•å®šä¹‰çš„ï¼Ÿç”±è°æ¥åˆ¤å®šæŸéƒ¨ç”µå½±å±äºå“ªä¸ªé¢˜æï¼Ÿæ¯”å¦‚è¯´çˆ±æƒ…ç‰‡ä¸­çš„ kiss é•œå¤´æ›´å¤šï¼Œè€ŒåŠ¨ä½œç‰‡ä¸­çš„æ‰“æ–—åœºæ™¯æ›´åŠ é¢‘ç¹ï¼ŒåŸºäºæ­¤ç±»åœºæ™¯åœ¨æŸéƒ¨ç”µå½±ä¸­å‡ºç°çš„æ¬¡æ•°æ¥è¿›è¡Œç”µå½±åˆ†ç±»ã€‚æœ¬ç« æˆ‘ä»¬å°†åŸºäºæ­¤ä½¿ç”¨ k-è¿‘é‚»ç®—æ³•æ„é€ ç¨‹åºï¼Œè‡ªåŠ¨åˆ’åˆ†ç”µå½±çš„é¢˜æç±»å‹ã€‚ğŸƒ

## 1. k-è¿‘é‚»ç®—æ³•

### â‘  æ¦‚è¿°

ç®€å•æ¥è¯´ï¼Œk-è¿‘é‚»ç®—æ³•å°±æ˜¯**é‡‡ç”¨æµ‹é‡ä¸åŒç‰¹å¾å€¼ä¹‹é—´çš„è·ç¦»æ–¹æ³•è¿›è¡Œåˆ†ç±»ã€‚**

- ä¼˜ç‚¹ï¼šç²¾åº¦é«˜ã€å¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿã€æ— æ•°æ®è¾“å…¥å‡å®š
- ç¼ºç‚¹ï¼šè®¡ç®—å¤æ‚åº¦é«˜ã€ç©ºé—´å¤æ‚åº¦é«˜
- é€‚ç”¨æ•°æ®èŒƒå›´ï¼šæ•°å€¼å‹å’Œæ ‡ç§°å‹

â­ **kNN ç®—æ³•åŸç†**ï¼šå­˜åœ¨ä¸€ä¸ªå¸¦æ ‡ç­¾çš„è®­ç»ƒæ ·æœ¬é›†ï¼Œè¾“å…¥æ²¡æœ‰æ ‡ç­¾çš„æ–°æ•°æ®åï¼Œå°†æ–°æ•°æ®çš„æ¯ä¸ªç‰¹å¾å’Œæ ·æœ¬é›†ä¸­çš„æ•°æ®å¯¹åº”çš„ç‰¹å¾è¿›è¡Œæ¯”è¾ƒï¼Œç„¶åç®—æ³•**æå–æ ·æœ¬é›†ä¸­ k ä¸ªç‰¹å¾æœ€ç›¸ä¼¼ï¼ˆæœ€é‚»è¿‘ï¼‰çš„åˆ†ç±»æ ‡ç­¾ï¼ˆè¿™å°±æ˜¯ k-è¿‘é‚»ç®—æ³•ä¸­ k çš„ å‡ºå¤„ï¼Œä¸€èˆ¬ k ä¸å¤§äº 20ï¼‰ã€‚æœ€åï¼Œé€‰æ‹©è¿™ k ä¸ªæœ€ç›¸ä¼¼æ•°æ®ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„åˆ†ç±»ï¼Œä½œä¸ºæ–°æ•°æ®çš„åˆ†ç±»ã€‚**

å›åˆ°æˆ‘ä»¬å‰é¢ç”µå½±åˆ†ç±»çš„ä¾‹å­ï¼Œå‡å¦‚æœ‰ä¸€éƒ¨æœªçœ‹è¿‡çš„ç”µå½±ï¼Œå¦‚ä½•ç¡®å®šå®ƒæ˜¯çˆ±æƒ…ç‰‡è¿˜æ˜¯åŠ¨ä½œç‰‡å‘¢ï¼Ÿ

ä¸‹å›¾æ˜¾ç¤ºäº† 6 éƒ¨ç”µå½±çš„æ‰“æ–—å’Œæ¥å»é•œå¤´æ•°ï¼Œï¼Ÿå°±æ˜¯æˆ‘ä»¬è¦åˆ¤æ–­çš„ç”µå½±ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200702223258.png)

![](https://gitee.com/veal98/images/raw/master/img/20200702223211.png)

è®¡ç®—æœªçŸ¥ç”µå½±ä¸æ ·æœ¬é›†ä¸­å…¶ä»–ç”µå½±çš„è·ç¦»ï¼ˆæ­¤å¤„æš‚æ—¶ä¸è¦å…³å¿ƒå¦‚ä½•è®¡ç®—å¾—åˆ°è¿™äº›è·ç¦»ï¼Œä½¿ç”¨ Python å®ç°ç”µå½±åˆ†ç±»åº”ç”¨æ—¶ï¼Œä¼šæä¾›å…·ä½“çš„è®¡ç®—æ–¹æ³•ï¼‰

![](https://gitee.com/veal98/images/raw/master/img/20200702223505.png)

å‡å®š k = 3

åˆ™æœ€é è¿‘çš„ä¸‰ä¸ªç”µå½±åˆ†åˆ«æ˜¯  `He's Not Really into Dudes`ï¼Œ`Beautiful Woman`ï¼Œ`California Man`ï¼Œè¿™ä¸‰éƒ¨ç”µå½±éƒ½æ˜¯çˆ±æƒ…ç‰‡ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ¤æ–­æœªçŸ¥ç”µå½±æ˜¯çˆ±æƒ…ç‰‡ã€‚

![](https://gitee.com/veal98/images/raw/master/img/20200702223742.png)

âœ OKï¼Œä¸‹é¢ç”¨å…·ä½“çš„ Python ä»£ç å®ç°

### â‘¡ ä»£ç å®ç°  

#### â…  æ•°æ®å‡†å¤‡

æˆ‘ä»¬æ‰€æœ‰çš„ä»£ç éƒ½å†™åœ¨ `kNN.py` æ–‡ä»¶ä¸­

é¦–å…ˆ ï¼Œåˆ›å»ºæ•°æ®é›†å’Œæ ‡ç­¾ï¼š

```python
import numpy as np
import operator # è¿ç®—ç¬¦æ¨¡å—

def createDataSet():
    group = np.array([[1.0, 1.1],[1.0, 1.0],[0, 0],[0, 0.1]])
    labels = ['A', 'A', 'B' ,'B']
    return group,labels
```

![](https://gitee.com/veal98/images/raw/master/img/20200704094428.png)

è¿™é‡Œæœ‰ 4 ç»„æ•°æ®ï¼Œæ¯ç»„æ•°æ®æœ‰ 2 ä¸ªå±æ€§/ç‰¹å¾å€¼ï¼Œå‘é‡ labels åŒ…å«äº†æ¯ä¸ªæ•°æ®ç‚¹çš„æ ‡ç­¾ä¿¡æ¯ï¼Œæ•°æ®ç‚¹ `[1.0, 1.1]` å®šä¹‰ä¸ºç±» Aï¼Œæ•°æ®ç‚¹ `[0, 0]` å®šä¹‰ä¸ºç±» Bã€‚

ä¸ºäº†è¯´æ˜æ–¹ä¾¿ï¼Œä¾‹å­ä¸­çš„æ•°å€¼å¹¶æ²¡æœ‰ç»™å‡ºè½´æ ‡ç­¾ï¼š

<img src="https://gitee.com/veal98/images/raw/master/img/20200704094628.png" style="zoom:80%;" />

#### â…¡ kNN ç®—æ³•

æœ¬èŠ‚ä½¿ç”¨ kNN ç®—æ³•ä¸ºæ¯ç»„æ•°æ®åˆ†ç±»ã€‚è¿™é‡Œé¦–å…ˆç»™å‡º  kNN ç®—æ³•çš„ä¼ªä»£ç ï¼š

â­ å¯¹æœªçŸ¥ç±»åˆ«å±æ€§çš„æ•°æ®é›†ä¸­çš„æ¯ä¸ªç‚¹ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

- è®¡ç®—å·²çŸ¥ç±»åˆ«æ•°æ®é›†ä¸­çš„ç‚¹ä¸å½“å‰ç‚¹çš„è·ç¦»
- æŒ‰ç…§è·ç¦»é€’å¢æ’åº
- é€‰æ‹©ä¸å½“å‰ç‚¹è·ç¦»æœ€å°çš„ k ä¸ªç‚¹
- ç¡®å®šå‰ k ä¸ªç‚¹æ‰€åœ¨ç±»åˆ«çš„å‡ºç°é¢‘ç‡
- è¿”å›å‰ k ä¸ªç‚¹å‡ºç°é¢‘ç‡æœ€é«˜çš„ç±»åˆ«ä½œä¸ºå½“å‰ç‚¹çš„é¢„æµ‹åˆ†ç±»

Python ä»£ç å¦‚ä¸‹ï¼š

```python
# inx: è¾“å…¥å‘é‡ï¼ˆæœªçŸ¥æ•°æ®ï¼‰
# dataSetï¼šè®­ç»ƒæ ·æœ¬é›†
# labels: æ ‡ç­¾å‘é‡
# kï¼šé€‰æ‹©æœ€è¿‘é‚»å±…çš„æ•°ç›®
def classify0(inX, dataSet, labels, k):
    dataSetSize = dataSet.shape[0] # 4
    diffMat = np.tile(inX,(dataSetSize, 1)) - dataSet # è®¡ç®—æœªçŸ¥ç±»çš„æ•°æ®é›†ä¸å·²çŸ¥æ•°æ®é›†çš„å·®
    sqDiffMat = diffMat**2 # å·®å€¼å¹³æ–¹åŒ–
    sqDistances = sqDiffMat.sum(axis=1) # æŠŠï¼ˆæœªå¹³æ–¹æ ¹åŒ–ä¹‹å‰çš„ï¼‰æœªçŸ¥æ•°æ®é›†ä¸ä¸¤ä¸ªå·²çŸ¥æ•°æ®çš„è·ç¦»åˆ†åˆ«è®¡ç®—å‡ºæ¥
    distances = sqDistances**0.5 # è·ç¦»å¹³æ–¹æ ¹åŒ–
    sortedDistIndicies = distances.argsort() # æ’åº,è¿”å›ä¸‹æ ‡
    classCount = {} 
    for i in range(k):
        voteIlabel = labels[sortedDistIndicies[i]] # éå†æ’åºåçš„å‰ k ä¸ªæ ‡ç­¾
        classCount[voteIlabel] = classCount.get(voteIlabel,0) + 1 # è®°å½•è¿™ k ä¸ªæ ‡ç­¾å‡ºç°çš„æ¬¡æ•°
    sortedClassCount = sorted(classCount.items(),  key = operator.itemgetter(1), reverse = True) # æŒ‰ç…§å‡ºç°æ¬¡æ•°å¯¹æ ‡ç­¾è¿›è¡Œä»å¤§åˆ°å°æ’åº
    return sortedClassCount[0][0] # è¿”å›å‡ºç°æ¬¡æ•°æœ€å¤šçš„é‚£ä¸ªæ ‡ç­¾
```

è¯¦è§£å¦‚ä¸‹ï¼š

**ğŸ˜Š 1ï¼šè·å–æ•°æ®é›†è¡Œæ•°**

```python
dataSetSize = dataSet.shape[0]
```

è¿”å›æ•°æ®é›†çš„è¡Œæ•°ï¼Œæ•°æ®é›†æ˜¯ 4x2 çš„ï¼Œæ‰€ä»¥è¿”å› 4

**ğŸ˜Š 2ï¼šè®¡ç®—æ¬§å¼è·ç¦»**

æ¥ä¸‹æ¥å¼€å§‹è®¡ç®—è·ç¦»ï¼Œä½¿ç”¨æ¬§å¼è·ç¦»å…¬å¼ï¼Œè®¡ç®—ä¸¤ä¸ªå‘é‡ç‚¹ xA å’Œ xB ä¹‹é—´çš„è·ç¦»ï¼š

<img src="https://gitee.com/veal98/images/raw/master/img/20200704102718.png" style="zoom:80%;" />

<img src="https://gitee.com/veal98/images/raw/master/img/20200704102807.png" style="zoom:80%;" />

```python
# è®¡ç®—æœªçŸ¥ç±»çš„æ•°æ®é›†ä¸å·²çŸ¥æ•°æ®é›†çš„å·®,ä¸ºäº†æ–¹ä¾¿è¦æŠŠæœªçŸ¥ç±»çš„æ•°æ®é›†åŒ–æˆçŸ©é˜µè®¡ç®—
diffMat = np.tile(inX,(dataSetSize, 1)) - dataSet 
```

`np.tile(inX,(dataSetSize, 1))`  å°†æœªçŸ¥ç±»æ•°æ® inX æ²¿ç€ Y è½´æ–¹å‘æ‰©å…… dataSetSize å€ï¼ˆ4 å€ï¼‰ï¼Œæ²¿ç€ X è½´æ‰©å…… 1 å€ï¼Œå³ä¸æ‰©å……

ğŸ’¬ ä¸¾ä¸ªä¾‹å­ï¼šè®¾æœªçŸ¥ç±»æ•°æ® inX æ˜¯ ([[0,3]]) å³ $\begin{bmatrix} 0 & 3\end{bmatrix}$ï¼Œæ•°æ®é›† dataSetæ˜¯ ([[1,3],[3,4]]) å³ $\begin{bmatrix} 1 & 3 \\ 3 & 4 \end{bmatrix}$

å°† inx æ²¿ç€ Y è½´æ‰©å…… 2 å€åï¼š$\begin{bmatrix} 0 & 3 \\ 0 & 3 \end{bmatrix}$

è®¡ç®—æœªçŸ¥ç±»æ•°æ®é›†ä¸å·²çŸ¥æ•°æ®é›†çš„å·®ï¼š$\begin{bmatrix} 0 & 3 \\ 0 & 3 \end{bmatrix} - \begin{bmatrix} 1 & 3 \\ 3 & 4 \end{bmatrix}$ = $\begin{bmatrix} -1 & 0 \\ -3 & 1 \end{bmatrix}$

```python
sqDiffMat = diffMat**2 # å·®å€¼å¹³æ–¹åŒ–
```

 $sqDiffMat = \begin{bmatrix} -1 & 0 \\ -3 & 1 \end{bmatrix}^2$ =  $\begin{bmatrix} 1 & 0 \\ 9 & 1 \end{bmatrix}$

```python
# æŠŠï¼ˆæœªå¹³æ–¹æ ¹åŒ–ä¹‹å‰çš„ï¼‰æœªçŸ¥æ•°æ®é›†ä¸ä¸¤ä¸ªå·²çŸ¥æ•°æ®çš„è·ç¦»åˆ†åˆ«è®¡ç®—å‡ºæ¥
sqDistances = sqDiffMat.sum(axis=1) 
```

æŒ‰è¡Œå‘é‡è¿›è¡Œç›¸åŠ ï¼š

$sqDistances = [1, 10] $

1 æ˜¯æœªçŸ¥æ•°æ®ä¸ [1, 3] çš„è·ç¦»ï¼Œ10 æ˜¯æœªçŸ¥æ•°æ®ä¸ [3, 4] çš„è·ç¦»

```python
distances = sqDistances**0.5 # è·ç¦»å¹³æ–¹æ ¹åŒ–
```

å°†ä¸¤ä¸ªè·ç¦»åˆ†åˆ«è¿›è¡Œå¹³æ–¹æ ¹åŒ–ï¼Œåˆ†åˆ«å¾—åˆ°è¯¥æœªçŸ¥æ ‡ç­¾å‘é‡ä¸å·²çŸ¥ç‚¹çš„æ¬§å¼è·ç¦»

```python
sortedDistIndicies = distances.argsort() # æ’åº,è¿”å›ä¸‹æ ‡
```

æ¯”å¦‚è¯´ï¼š[3, 5, 1] ä»å°åˆ°å¤§æ’åºåˆ†åˆ«æ˜¯ï¼š1ï¼Œ3ï¼Œ5ï¼Œå¯¹åº”çš„ç´¢å¼•æ˜¯ 2ï¼Œ0ï¼Œ1

è¿™æ ·æˆ‘ä»¬åœ¨å¾ªç¯çš„æ—¶å€™, å¯ä»¥å°†æ¬§å¼è·ç¦»æŒ‰å€¼ä»å°åˆ°å¤§éå†å‡ºæ¥

**ğŸ˜Š 3ï¼šè·å–è·ç¦»æœ€è¿‘çš„å‰ k ä¸ªæ ‡ç­¾å‡ºç°çš„æ¬¡æ•°**

æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œç”¨æ¥è®°å½•å‰ k ä¸ªæ ‡ç­¾åˆ†åˆ«å‡ºç°çš„æ¬¡æ•°ï¼š

```python
classCount = {} 
for i in range(k):
    voteIlabel = labels[sortedDistIndicies[i]] # éå†æ’åºåçš„å‰ k ä¸ªæ ‡ç­¾
    classCount[voteIlabel] = classCount.get(voteIlabel,0) + 1 # è®°å½•è¿™ k ä¸ªæ ‡ç­¾å‡ºç°çš„æ¬¡æ•°
```

`classCount `æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œç”¨æ¥å­˜å‚¨æ ‡ç­¾å’Œæ ‡ç­¾å‡ºç°çš„æ¬¡æ•°

`classCount.get(voteIlabel,0)` è¿”å›å­—å…¸ `classCount `ä¸­ `voteIlabel` å…ƒç´ å¯¹åº”çš„å€¼ï¼Œè‹¥æ— ï¼Œåˆ™è¿›è¡Œåˆå§‹åŒ–ä¸º 0ï¼Œè‹¥æœ‰ï¼Œåˆ™è¿”å›è¯¥å€¼

```python
classCount[voteIlabel] = classCount.get(voteIlabel,0) + 1
```

åˆå§‹åŒ– `classCount = {}` æ—¶ï¼Œæ­¤æ—¶è¾“å…¥`classCount`ï¼Œè¾“å‡ºä¸ºï¼š
`classCount = {}`

**å½“ç¬¬ä¸€æ¬¡é‡åˆ°æ–°çš„ label æ—¶**ï¼Œå°†æ–°çš„ label æ·»åŠ åˆ°å­—å…¸ `classCount`ï¼Œå¹¶åˆå§‹åŒ–å…¶å¯¹åº”æ•°å€¼ä¸º 0
ç„¶å +1ï¼Œå³è¯¥ label å·²ç»å‡ºç°è¿‡ä¸€æ¬¡ï¼Œæ­¤æ—¶è¾“å…¥`classCount`ï¼Œè¾“å‡ºä¸ºï¼š

`classCount = {voteIlabel: 1}`

**å½“ç¬¬äºŒæ¬¡é‡åˆ°åŒä¸€ä¸ª label æ—¶**ï¼Œ`classCount.get(voteIlabel,0)` è¿”å›å¯¹åº”çš„æ•°å€¼ï¼ˆæ­¤æ—¶æ‹¬å·å†…çš„ 0 ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºå·²ç»åˆå§‹åŒ–è¿‡äº†ï¼‰ï¼Œç„¶å+1ï¼Œæ­¤æ—¶è¾“å…¥`classCount`ï¼Œè¾“å‡ºä¸ºï¼š

`classCount = {voteIlabel: 2}`

å¯ä»¥çœ‹å‡ºï¼Œ+1 æ˜¯æ¯ä¸€æ¬¡éƒ½ä¼šèµ·ä½œç”¨çš„, å› ä¸ºä¸ç®¡é‡åˆ°å­—å…¸å†…å·²ç»å­˜åœ¨çš„æˆ–è€…ä¸å­˜åœ¨çš„ï¼Œéƒ½éœ€è¦æŠŠè¿™ä¸ªå…ƒç´ è®°å½•ä¸‹æ¥

**ğŸ˜Š 4ï¼šæŒ‰ç…§æ ‡ç­¾å‡ºç°çš„æ¬¡æ•°å¯¹æ ‡ç­¾è¿›è¡Œæ’åº**

å¾ªç¯ç»“æŸåï¼ŒæŒ‰ç…§æ ‡ç­¾å‡ºç°çš„æ¬¡æ•°å¯¹æ ‡ç­¾è¿›è¡Œæ’åºï¼š

```python
sortedClassCount = sorted(classCount.items(),  key = operator.itemgetter(1), reverse = True) # æŒ‰ç…§å‡ºç°æ¬¡æ•°å¯¹æ ‡ç­¾è¿›è¡Œä»å¤§åˆ°å°æ’åº
```

`classCount.items()` è¿”å›çš„æ˜¯ä¸€ä¸ªå…ƒç»„ dict_itemsï¼Œå³å°† `classCount `è½¬åŒ–ä¸ºå…ƒç»„ã€‚ä¾‹å¦‚ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200704105401.png)

`operator.itemgetter(1)` æŒ‰ç…§ç¬¬äºŒä¸ªå…ƒç´ çš„æ¬¡åºå¯¹å…ƒç»„è¿›è¡Œæ’åºï¼ˆé»˜è®¤ä»å°åˆ°å¤§ï¼‰ï¼Œ`reverse=True` æ˜¯é€†åºï¼Œå³æŒ‰ç…§ä»å¤§åˆ°å°çš„é¡ºåºæ’åˆ—

**ğŸ˜Š 5ï¼šè¿”å›å‡ºç°æ¬¡æ•°æœ€å¤šçš„æ ‡ç­¾**

æ’åºå®Œæ¯•åï¼Œè¿”å›å…ƒç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å³å‡ºç°æ¬¡æ•°æœ€å¤šçš„æ ‡ç­¾ï¼š

```python
return sortedClassCount[0][0] # è¿”å›å‡ºç°æ¬¡æ•°æœ€å¤šçš„é‚£ä¸ªæ ‡ç­¾
```

#### â…¢ è¿è¡Œæ•ˆæœ

OKï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸Šè¿°ä»£ç çš„è¿è¡Œæ•ˆæœï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200704105838.png)



 ## 2. ç¤ºä¾‹ï¼šä½¿ç”¨ k-è¿‘é‚»ç®—æ³•æ”¹è¿›çº¦ä¼šç½‘ç«™çš„é…å¯¹æ•ˆæœ

æµ·ä¼¦ä½¿ç”¨çº¦ä¼šç½‘ç«™å¯»æ‰¾çº¦ä¼šå¯¹è±¡ã€‚ç»è¿‡ä¸€æ®µæ—¶é—´ä¹‹åï¼Œå¥¹å‘ç°æ›¾äº¤å¾€è¿‡ä¸‰ç§ç±»å‹çš„äºº:

- ä¸å–œæ¬¢çš„äºº
- é­…åŠ›ä¸€èˆ¬çš„äºº
- æå…·é­…åŠ›çš„äºº

å¥¹å¸Œæœ›:

1. å·¥ä½œæ—¥ä¸é­…åŠ›ä¸€èˆ¬çš„äººçº¦ä¼š
2. å‘¨æœ«ä¸æå…·é­…åŠ›çš„äººçº¦ä¼š
3. ä¸å–œæ¬¢çš„äººåˆ™ç›´æ¥æ’é™¤æ‰

ç°åœ¨å¥¹æ”¶é›†åˆ°äº†ä¸€äº›çº¦ä¼šç½‘ç«™æœªæ›¾è®°å½•çš„æ•°æ®ä¿¡æ¯ï¼Œè¿™æ›´æœ‰åŠ©äºåŒ¹é…å¯¹è±¡çš„å½’ç±»ã€‚

<img src="https://gitee.com/veal98/images/raw/master/img/20200704112623.png" style="zoom:80%;" />

### â‘  å‡†å¤‡æ•°æ®ï¼šä»æ–‡æœ¬æ–‡ä»¶ä¸­è§£ææ•°æ®

æ•°æ®å­˜æ”¾åœ¨ datingTestSet.txt ä¸­ï¼Œæ¯ä¸ªæ ·æœ¬æ•°æ®å ä¸€è¡Œï¼Œæ€»å…±æœ‰ 1000 è¡Œï¼Œæ¯è¡Œ 4 åˆ—ï¼š

<img src="https://gitee.com/veal98/images/raw/master/img/20200704112810.png" style="zoom:80%;" />

- ç¬¬ä¸€åˆ—ï¼šæ¯å¹´è·å¾—çš„é£è¡Œå¸¸å®¢é‡Œç¨‹æ•°
- ç¬¬äºŒåˆ—ï¼šç©è§†é¢‘æ¸¸æˆæ‰€æ¶ˆè€—æ—¶é—´ç™¾åˆ†æ¯”
- ç¬¬ä¸‰åˆ—ï¼šæ¯å‘¨æ¶ˆè´¹çš„å†°æ·‡æ·‹å…¬å‡æ•°
- ç¬¬å››åˆ—ï¼šå–œæ¬¢ç¨‹åº¦ï¼ˆæ ‡ç­¾ï¼‰éå¸¸å–œæ¬¢ largeDoses | ä¸€èˆ¬å–œæ¬¢ smallDoses | ä¸å–œæ¬¢ didntLike

åœ¨ä¸Šè¿°ç‰¹å¾æ•°æ®è¾“å…¥åˆ°åˆ†ç±»å™¨ä¹‹å‰ï¼Œå¿…é¡»å°†å¾…å¤„ç†æ•°æ®çš„æ ¼å¼æ”¹å˜ä¸ºåˆ†ç±»å™¨å¯ä»¥æ¥å—çš„æ ¼å¼ã€‚åœ¨ `kNN.py` æ–‡ä»¶ä¸­åˆ›å»º `file2matrix` çš„å‡½æ•°æ¥å¤„ç†è¾“å…¥æ ¼å¼é—®é¢˜ã€‚**è¯¥å‡½æ•°çš„è¾“å…¥ä¸ºæ–‡ä»¶åå­—ç¬¦ä¸²ï¼Œè¾“å‡ºä¸ºè®­ç»ƒæ ·æœ¬çŸ©é˜µå’Œç±»æ ‡ç­¾å‘é‡**ã€‚

```python
# å°†æ–‡æœ¬è®°å½•è½¬æ¢æˆ Numpy çŸ©é˜µ
def file2matrix(filename):
    love_dictionary = {'largeDoses':3, 'smallDoses':2, 'didntLike':1} # æ ‡ç­¾æ•°å­—åŒ–
    fr  = open(filename)
    arrayOLines = fr.readlines()
    numberOfLines = len(arrayOLines) # è·å–æ–‡ä»¶è¡Œæ•° 1000 
    returnMat = np.zeros((numberOfLines, 3)) # åˆå§‹åŒ–çŸ©é˜µ  1000 x 3 å­˜å‚¨æ‰€æœ‰æ•°æ®(é™¤æ ‡ç­¾å¤–)
    classLabelVecotr = [] # æ ‡ç­¾åˆ—è¡¨
    index = 0
    # å¾ªç¯å¤„ç†æ–‡ä»¶ä¸­çš„æ¯è¡Œæ•°æ®
    for line in arrayOLines: 
        line = line.strip() # è¿”å›å·²ç§»é™¤å­—ç¬¦ä¸²å¤´å°¾æŒ‡å®šå­—ç¬¦æ‰€ç”Ÿæˆçš„æ–°å­—ç¬¦ä¸²
        listFromLine = line.split('\t') # ä»¥ '\t' åˆ‡å‰²å­—ç¬¦ä¸²
        returnMat[index,:]  = listFromLine[0:3] # é€‰å–å‰ 3 ä¸ªå…ƒç´ ï¼Œå°†å…¶å­˜å‚¨åˆ°returnMatçŸ©é˜µä¸­
        # å°†listFromLineåˆ—è¡¨çš„æœ€åä¸€åˆ—å³æ ‡ç­¾ï¼Œå­˜å…¥classLabelVectoræ ‡ç­¾åˆ—è¡¨ä¸­
        if(listFromLine[-1].isdigit()): 
            classLabelVecotr.append(int(listFromLine[-1]))
        else:
            classLabelVecotr.append(love_dictionary.get(listFromLine[-1]))
        index += 1
    return returnMat, classLabelVecotr
```

> ğŸ’¡ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»æ˜ç¡®çš„é€šçŸ¥è§£é‡Šå™¨ï¼Œå‘Šè¯‰å®ƒåˆ—è¡¨ä¸­å­˜å‚¨çš„å…ƒç´ ä¸ºæ•´å‹ï¼Œå¦åˆ™Pythonä¼šå°†è¿™äº›å…ƒç´ å½“ä½œå­—ç¬¦ä¸²å¤„ç†ï¼š
>
> ```python
> if(listFromLine[-1].isdigit()): 
>     classLabelVecotr.append(int(listFromLine[-1]))
> else:
>     classLabelVecotr.append(love_dictionary.get(listFromLine[-1]))
> ```

Okï¼ŒæŸ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„æ•°æ®å¤„ç†ç»“æœï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200704115706.png)

### â‘¡ åˆ†ææ•°æ®ï¼šä½¿ç”¨ Matplotlib åˆ›å»ºæ•£ç‚¹å›¾

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ•°æ®è¿›è¡Œå¯è§†åŒ–ï¼Œç›´è§‚çš„å±•ç¤ºæ•°æ®ï¼Œä½¿ç”¨ Matplotlib ç”»äºŒç»´æ•£ç‚¹å›¾ï¼š

```python
import matplotlib
import matplotlib.pyplot as plt
fig = plt.figure()
ax = fig.add_subplot(1,1,1)
ax.scatter(datingDataMat[:,1],datingDataMat[:,2],15.0*array(datingLabels), 15.0*array(datingLabels))
plt.show()
```

![](https://gitee.com/veal98/images/raw/master/img/20200704120849.png)

ä¸‹å›¾ä¸­é‡‡ç”¨çŸ©é˜µçš„ç¬¬ä¸€å’Œç¬¬äºŒåˆ—å±æ€§å¾—åˆ°å¾ˆå¥½çš„å±•ç¤ºæ•ˆæœï¼Œæ¸…æ™°åœ°æ ‡è¯†äº†ä¸‰ä¸ªä¸åŒçš„æ ·æœ¬åˆ†ç±»åŒºåŸŸï¼Œå…·æœ‰ä¸åŒçˆ±å¥½çš„äººå…¶ç±»åˆ«åŒºåŸŸä¹Ÿä¸åŒã€‚

![](https://gitee.com/veal98/images/raw/master/img/20200704121039.png)

### â‘¢ å‡†å¤‡æ•°æ®ï¼šå½’ä¸€åŒ–æ•°å€¼

æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬è®¡ç®—æ ·æœ¬ 3 å’Œæ ·æœ¬ 4 ä¹‹é—´çš„è·ç¦»ï¼š

<img src="https://gitee.com/veal98/images/raw/master/img/20200704141226.png" style="zoom:80%;" />

æ˜¾ç„¶ï¼Œæ¯å¹´è·å¾—çš„é£è¡Œå¸¸å®¢é‡Œç¨‹æ•°å¯¹äºè®¡ç®—ç»“æœçš„å½±å“è¿œå¤§äºå…¶ä»–ä¸¤ä¸ªç‰¹å¾ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å½’ä¸€åŒ–ï¼Œå°†å–å€¼èŒƒå›´éƒ½å¤„ç†åˆ° -1 ~ 1 ä¹‹é—´ã€‚æ–¹æ³•æœ‰å¦‚ä¸‹ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200704141500.png)ã€€

Python å®ç°å¦‚ä¸‹ï¼š

```python
# å½’ä¸€åŒ–ç‰¹å¾å€¼
def autoNorm(dataSet):
    minVals = dataSet.min(0) # æ¯åˆ—çš„æœ€å°å€¼ 1 x 3
    maxVals = dataSet.max(0) # æ¯åˆ—çš„æœ€å¤§å€¼ 1 x 3
    ranges = maxVals - minVals # 1 x 3
    normDataSet = np.zeros(np.shape(dataSet)) # åˆå§‹åŒ–æ–°çš„çŸ©é˜µ 1000 x 3
    m = dataSet.shape[0]
    normDataSet = dataSet - np.tile(minVals, (m,1))
    normDataSet = normDataSet / np.tile(ranges, (m, 1))
    return normDataSet, ranges, minVals
```

> ğŸ“œ è¿™é‡Œå¯ä»¥åªè¿”å› `normDataSet`ï¼Œä½†æ˜¯åœ¨ä¸‹ä¸€èŠ‚æˆ‘ä»¬éœ€è¦å°†å–å€¼èŒƒå›´å’Œæœ€å°å€¼å½’ä¸€åŒ–æµ‹è¯•æ•°æ®ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç‰¹å¾å€¼çŸ©é˜µæœ‰ 1000 x  3  ä¸ªå€¼ï¼Œè€Œ `minVals `å’Œ `range `çš„å€¼éƒ½ä¸º 1 x 3ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨ Numpy åº“ä¸­ `tile()` å‡½æ•°å°†å˜é‡å†…å®¹å¤åˆ¶æˆè¾“å…¥çŸ©é˜µåŒæ ·å¤§å°çš„çŸ©é˜µã€‚**æ³¨æ„åœ¨ Numpy ä¸­ `/` æ˜¯å…·ä½“ç‰¹å¾å€¼ç›¸é™¤**ï¼Œè€Œåœ¨å…¶ä»–æŸäº›åŒ…ä¸­å¯èƒ½æ„å‘³ç€çŸ©é˜µé™¤æ³•ï¼Œä½†åœ¨ Numpy ä¸­ çŸ©é˜µé™¤æ³•éœ€è¦ä½¿ç”¨å‡½æ•° `linalg.solve(matA,matB)`

![](https://gitee.com/veal98/images/raw/master/img/20200704142832.png)

### â‘£ æµ‹è¯•ç®—æ³•ï¼š ä½œä¸ºå®Œæ•´ç¨‹åºéªŒè¯åˆ†ç±»å™¨

ä½¿ç”¨æµ·ä¼¦æä¾›çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºæµ‹è¯•æ ·æœ¬ã€‚å¦‚æœé¢„æµ‹åˆ†ç±»ä¸å®é™…ç±»åˆ«ä¸åŒï¼Œåˆ™æ ‡è®°ä¸ºä¸€ä¸ªé”™è¯¯ã€‚

é€šå¸¸æˆ‘ä»¬æä¾›å·²æœ‰æ•°æ®çš„ 90%  ä½œä¸ºè®­ç»ƒæ ·æœ¬æ¥è®­ç»ƒåˆ†ç±»å™¨ï¼Œè€Œä½¿ç”¨å‰©ä½™çš„ 10% æ•°æ®ï¼ˆéšæœºé€‰æ‹©ï¼‰å»æµ‹è¯•åˆ†ç±»å™¨ï¼Œæ£€æµ‹åˆ†ç±»å™¨çš„æ­£ç¡®ç‡ã€‚

ä»£ç é‡Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè®¡æ•°å™¨å˜é‡ï¼Œæ¯æ¬¡åˆ†ç±»å™¨é”™è¯¯åœ°åˆ†ç±»æ•°æ®ï¼Œè®¡æ•°å™¨å°±åŠ  1ï¼Œç¨‹åºæ‰§è¡Œå®Œæ¯•åè®¡æ•°å™¨é™¤ä»¥æ•°æ®æ€»æ•°å³æ˜¯é”™è¯¯ç‡ã€‚

```python
# åˆ†ç±»å™¨é’ˆå¯¹çº¦ä¼šç½‘ç«™åœ°æµ‹è¯•ä»£ç 
def datingClassTest():
    hoRatio = 0.10 # è®¾ç½®æµ‹è¯•æ•°æ®çš„çš„ä¸€ä¸ªæ¯”ä¾‹ï¼ˆè®­ç»ƒæ•°æ®é›†æ¯”ä¾‹=1-hoRatioï¼‰
    datingDataMat, datingLabels = file2matrix('datingTestSet2.txt') # åŠ è½½æ–‡ä»¶
    normMat, ranges, minVals = autoNorm(datingDataMat) # å½’ä¸€åŒ–æ•°æ®
    m = normMat.shape[0] # æ•°æ®çš„è¡Œæ•°
    numTestVecs = int(m * hoRatio)  # æµ‹è¯•æ ·æœ¬çš„è¡Œæ•°
    print('æµ‹è¯•æ ·æœ¬çš„è¡Œæ•° = ', numTestVecs)
    errorCount = 0.0 # è®¡æ•°å™¨
    
    # æµ‹è¯•æ•°æ®
    for i in range(numTestVecs):
        # normMat[i, :]: æµ‹è¯•æ ·æœ¬é›†ï¼ˆæœªçŸ¥æ•°æ®ï¼‰
        # numTestVecs:m è®­ç»ƒæ ·æœ¬é›† 
        # datingLabels[numTestVecs:m]: æ ‡ç­¾å‘é‡
        # 3ï¼šé€‰æ‹©æœ€è¿‘é‚»å±…çš„æ•°ç›®
        classifierResult = classify0(normMat[i, :], normMat[numTestVecs:m, :], datingLabels[numTestVecs:m], 3) # è¿”å›åˆ¤æ–­çš„æ•°æ®æ ‡ç­¾
        print("the classifier came back with: %d, the real answer is: %d" % (classifierResult, datingLabels[i]))
        if (classifierResult != datingLabels[i]): 
            errorCount += 1.0
            
    print("é”™è¯¯ç‡ = : %f" %(errorCount / float(numTestVecs)))
```

```python
datingClassTest()
```

è¿è¡Œç»“æœçš„éƒ¨åˆ†æˆªå›¾å¦‚ä¸‹ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200704150410.png)

é”™è¯¯ç‡æ˜¯ 5%ï¼Œè¿˜ä¸é”™ ğŸ‘

### â‘¤ ä½¿ç”¨ç®—æ³•ï¼šæ„å»ºå®Œæ•´å¯ç”¨ç³»ç»Ÿ

ä¸‹é¢æˆ‘ä»¬æ„é€ ä¸€ä¸ªå®Œæ•´å¯ç”¨çš„ç³»ç»Ÿï¼Œé€šè¿‡è¯¥ç¨‹åºæµ·ä¼¦å¯ä»¥åœ¨çº¦ä¼šç½‘ç«™ä¸Šæ‰¾åˆ°æŸä¸ªäººå¹¶è¾“å…¥ä»–çš„ä¿¡æ¯ï¼Œç¨‹åºä¼šç»™å‡ºå¥¹å¯¹å¯¹æ–¹çš„å–œæ¬¢ç¨‹åº¦çš„é¢„æµ‹å€¼ã€‚

```python
# çº¦ä¼šç½‘ç«™é¢„æµ‹å‡½æ•°
def classifyPerson():
    resultList = ['ä¸å–œæ¬¢', 'ä¸€èˆ¬å–œæ¬¢', 'éå¸¸å–œæ¬¢'] # å®šä¹‰æ ‡ç­¾
    percentTats = float(input("ç©è§†é¢‘æ¸¸æˆæ‰€æ¶ˆè€—æ—¶é—´ç™¾åˆ†æ¯”: "))
    ffMiles =float(input("æ¯å¹´è·å¾—çš„é£è¡Œå¸¸å®¢é‡Œç¨‹æ•°: "))
    iceCream = float(input("æ¯å‘¨æ¶ˆè´¹çš„å†°æ·‡æ·‹å…¬å‡æ•°: "))
    datingDataMat, datingLabels = file2matrix('datingTestSet2.txt') # æ•°æ®é›†å’Œæ ‡ç­¾
    normMat,ranges,minVals = autoNorm(datingDataMat) # æ•°æ®é›†å½’ä¸€åŒ–
    inArr = np.array([ffMiles, percentTats, iceCream,]) # è¾“å…¥å‘é‡ï¼ˆæœªçŸ¥æ•°æ®/æµ‹è¯•æ•°æ®ï¼‰
    classifierResult = classify0((inArr - minVals) / ranges, normMat,  datingLabels, 3) # æµ‹è¯•æ•°æ®åŒæ ·ä¹Ÿè¦å½’ä¸€åŒ–
    print("ä½ å¯èƒ½å–œæ¬¢è¿™ä¸ªäººçš„ç¨‹åº¦ï¼š%s" %resultList[classifierResult - 1])
```

![](https://gitee.com/veal98/images/raw/master/img/20200704152029.png)

## 3. ç¤ºä¾‹ï¼šæ‰‹å†™è¯†åˆ«ç³»ç»Ÿ

**é¡¹ç›®æ¦‚è¿°ï¼š**

æ„é€ ä¸€ä¸ªèƒ½è¯†åˆ«æ•°å­— 0 åˆ° 9 çš„åŸºäº KNN åˆ†ç±»å™¨çš„æ‰‹å†™æ•°å­—è¯†åˆ«ç³»ç»Ÿã€‚

éœ€è¦è¯†åˆ«çš„æ•°å­—æ˜¯å­˜å‚¨åœ¨æ–‡æœ¬æ–‡ä»¶ä¸­çš„å…·æœ‰ç›¸åŒçš„è‰²å½©å’Œå¤§å°: å®½é«˜æ˜¯ 32 åƒç´  * 32 åƒç´ çš„é»‘ç™½å›¾åƒã€‚

**å¼€å‘æµç¨‹ï¼š**

- æ”¶é›†æ•°æ®: æä¾›æ–‡æœ¬æ–‡ä»¶ã€‚
- å‡†å¤‡æ•°æ®: ç¼–å†™å‡½æ•° `img2vector()`, å°†å›¾åƒæ ¼å¼è½¬æ¢ä¸ºåˆ†ç±»å™¨ä½¿ç”¨çš„å‘é‡æ ¼å¼
- åˆ†ææ•°æ®: æ£€æŸ¥æ•°æ®ï¼Œç¡®ä¿å®ƒç¬¦åˆè¦æ±‚
- è®­ç»ƒç®—æ³•: æ­¤æ­¥éª¤ä¸é€‚ç”¨äº KNN
- æµ‹è¯•ç®—æ³•: ç¼–å†™å‡½æ•°ä½¿ç”¨æä¾›çš„éƒ¨åˆ†æ•°æ®é›†ä½œä¸ºæµ‹è¯•æ ·æœ¬ï¼Œæµ‹è¯•æ ·æœ¬ä¸éæµ‹è¯•æ ·æœ¬çš„åŒºåˆ«åœ¨äºæµ‹è¯•æ ·æœ¬æ˜¯å·²ç»å®Œæˆåˆ†ç±»çš„æ•°æ®ï¼Œå¦‚æœé¢„æµ‹åˆ†ç±»ä¸å®é™…ç±»åˆ«ä¸åŒï¼Œåˆ™æ ‡è®°ä¸ºä¸€ä¸ªé”™è¯¯
- ä½¿ç”¨ç®—æ³•: æœ¬ä¾‹æ²¡æœ‰å®Œæˆæ­¤æ­¥éª¤ï¼Œè‹¥ä½ æ„Ÿå…´è¶£å¯ä»¥æ„å»ºå®Œæ•´çš„åº”ç”¨ç¨‹åºï¼Œä»å›¾åƒä¸­æå–æ•°å­—ï¼Œå¹¶å®Œæˆæ•°å­—è¯†åˆ«ï¼Œç¾å›½çš„é‚®ä»¶åˆ†æ‹£ç³»ç»Ÿå°±æ˜¯ä¸€ä¸ªå®é™…è¿è¡Œçš„ç±»ä¼¼ç³»ç»Ÿ

### â‘  å‡†å¤‡æ•°æ®ï¼šå°†å›¾åƒè½¬ä¸ºæµ‹è¯•å‘é‡

ç›®å½• [trainingDigits](https://github.com/apachecn/AiLearning/blob/master/data/2.KNN/trainingDigits) ä¸­åŒ…å«äº†å¤§çº¦ 2000 ä¸ªä¾‹å­ï¼Œæ¯ä¸ªä¾‹å­å†…å®¹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¯ä¸ªæ•°å­—å¤§çº¦æœ‰ 200 ä¸ªæ ·æœ¬ï¼›ç›®å½• [testDigits](https://github.com/apachecn/AiLearning/blob/master/data/2.KNN/testDigits) ä¸­åŒ…å«äº†å¤§çº¦ 900 ä¸ªæµ‹è¯•æ•°æ®ã€‚

**å‰ç¼€ 0 å°±è¡¨ç¤ºè¿™ä¸ªæ•°å­—æ˜¯ 0ï¼Œå¯ä»¥ä½œä¸ºæˆ‘ä»¬çš„æ ‡ç­¾** ~

![](https://gitee.com/veal98/images/raw/master/img/20200704154833.png)

<img src="https://gitee.com/veal98/images/raw/master/img/20200704153347.png" style="zoom: 50%;" />

ä¸ºäº†ä½¿ç”¨å‰é¢ä¸¤ä¸ªä¾‹å­çš„åˆ†ç±»å™¨ï¼Œæˆ‘ä»¬å¿…é¡»å°†å›¾åƒæ ¼å¼åŒ–å¤„ç†ä¸ºä¸€ä¸ªå‘é‡ï¼Œæˆ‘ä»¬å°†æŠŠä¸€ä¸ª 32 x 32 çš„äºŒè¿›åˆ¶å›¾åƒçŸ©é˜µè½¬åŒ–ä¸º 1 x 1024 çš„ å‘é‡ï¼Œè¿™æ ·å‰ä¸¤èŠ‚ä½¿ç”¨çš„åˆ†ç±»å™¨å°±å¯ä»¥å¤„ç†æ•°å­—å›¾åƒä¿¡æ¯äº†ã€‚

é¦–å…ˆç¼–å†™ä¸€æ®µå‡½æ•° `img2vector` å°†å›¾åƒè½¬åŒ–ä¸ºå‘é‡ï¼šè¯¥å‡½æ•°åˆ›å»º 1 x 1024 çš„ Numpy æ•°ç»„ï¼Œç„¶åæ‰“å¼€ç»™å®šçš„æ–‡ä»¶ï¼Œå¾ªç¯è¯»å‡ºæ–‡ä»¶çš„å‰ 32 è¡Œï¼Œå¹¶å°†æ¯è¡Œçš„å¤´ 32 ä¸ªå­—ç¬¦å€¼å­˜å‚¨åœ¨ Numpy æ•°ç»„ä¸­ï¼Œæœ€åè¿”å›æ•°ç»„ã€‚

```python
def img2vector(filename):
    returnVect = np.zeros((1, 1024)) # åˆå§‹åŒ–çŸ©é˜µ
    fr = open(filename)
    for i in range(32):
        lineStr = fr.readline() # è¯»å–è¡Œ
        for j in range(32): # è¯»å–åˆ— 
            returnVect[0, 32*i+j] = int(lineStr[j]) # å­˜å…¥æ•°ç»„
    return returnVect
```

![](https://gitee.com/veal98/images/raw/master/img/20200704154126.png)

### â‘¡ æµ‹è¯•ç®—æ³•ï¼šä½¿ç”¨ k-è¿‘é‚»ç®—æ³•è¯†åˆ«æ‰‹å†™æ•°å­—

ä¸ŠèŠ‚æˆ‘ä»¬å·²ç»å°†æ•°æ®å¤„ç†æˆåˆ†ç±»å™¨å¯ä»¥è¯†åˆ«çš„æ ¼å¼ï¼Œæœ¬èŠ‚ä¸­æˆ‘ä»¬å°†è¿™äº›æ•°æ®è¾“å…¥åˆ°åˆ†ç±»å™¨ï¼Œæ£€æµ‹åˆ†ç±»å™¨çš„æ‰§è¡Œæ•ˆæœã€‚

```python
from os import listdir

# æ‰‹å†™æ•°å­—è¯†åˆ«ç³»ç»Ÿçš„æµ‹è¯•ä»£ç 
def handwritingClassTest():
    hwLabels = [] # æ ‡ç­¾
    
    # è·å–ç›®å½•å†…å®¹
    trainingFileList = listdir('trainingDigits') # listdir åˆ—å‡ºç»™å®šç›®å½•ï¼ˆè®­ç»ƒé›†ï¼‰çš„æ–‡ä»¶å
    m = len(trainingFileList) # è®­ç»ƒé›†ä¸ªæ•°
    trainingMat = np.zeros((m,1024)) # åˆå§‹åŒ–è®­ç»ƒé›†çŸ©é˜µ
    
    # ä»æ–‡ä»¶åè§£æåˆ†ç±»æ•°å­—
    for i in range(m):
        fileNameStr = trainingFileList[i] # æ–‡ä»¶å
        fileStr = fileNameStr.split('.')[0] # ä»¥ . ä¸ºåˆ†å‰²ç¬¦
        classNumStr = int(fileStr.split('_')[0]) # åˆ†ç¦»å‡ºå‰ç¼€ï¼ˆæ ‡ç­¾ï¼‰
        hwLabels.append(classNumStr)
        trainingMat[i, :] = img2vector('trainingDigits/%s' %fileNameStr) # è®­ç»ƒé›†å›¾åƒè½¬åŒ–æˆå‘é‡
        
    testFileList = listdir('testDigits') # åˆ—å‡ºæµ‹è¯•é›†çš„æ–‡ä»¶å
    errorCount = 0.0 # åˆ¤æ–­é”™è¯¯çš„ä¸ªæ•°
    mTest = len(testFileList) # æµ‹è¯•é›†ä¸ªæ•°
    
    for i in range(mTest):
        fileNameStr = testFileList[i] # æ–‡ä»¶å
        fileStr = fileNameStr.split('.')[0] # ä»¥ . ä¸ºåˆ†å‰²ç¬¦
        classNumStr = int(fileStr.split('_')[0]) # åˆ†ç¦»å‡ºå‰ç¼€ï¼ˆæ ‡ç­¾ï¼‰
        vectorUnderTest = img2vector('testDigits/%s' %fileNameStr) # æµ‹è¯•é›†å›¾åƒè½¬åŒ–æˆå‘é‡
        classifierResult = classify0(vectorUnderTest, trainingMat, hwLabels, 3) # kNN ç®—æ³•è¿›è¡Œåˆ†ç±»
        print("åˆ†ç±»å™¨åˆ¤æ–­çš„æ ‡ç­¾ä¸º:  %d, çœŸå®æ ‡ç­¾ä¸º:  %d" % (classifierResult, classNumStr))
        if (classifierResult != classNumStr): 
            errorCount += 1.0
    print("\næ€»å…±åˆ¤æ–­é”™è¯¯çš„ä¸ªæ•°ä¸º:  %d" % errorCount)
    print("\né”™è¯¯ç‡ä¸º:  %f" % (errorCount/float(mTest)))
```

![](https://gitee.com/veal98/images/raw/master/img/20200704155832.png)

## 4. å°ç»“

kNN ç®—æ³•æ˜¯åˆ†ç±»æ•°æ®æœ€ç®€å•æœ€æœ‰æ•ˆçš„ç®—æ³•ã€‚ä½†æ˜¯ kNN ç®—æ³•å¿…é¡»ä¿å­˜å…¨éƒ¨æ•°æ®é›†ï¼Œå¦‚ä½•è®­ç»ƒæ•°æ®é›†å¾ˆå¤§ï¼Œå¿…é¡»ä½¿ç”¨å¤§é‡çš„å­˜å‚¨ç©ºé—´ã€‚æ­¤å¤–ï¼Œç”±äºå¿…é¡»å¯¹æ•°æ®é›†ä¸­çš„æ¯ä¸ªæ•°æ®è®¡ç®—è·ç¦»å€¼ï¼Œå®é™…ä½¿ç”¨æ—¶å¯èƒ½éå¸¸è€—æ—¶ã€‚

kNN ç®—æ³•çš„å¦ä¸€ä¸ªç¼ºé™·æ˜¯å®ƒæ— æ³•ç»™å‡ºä»»ä½•æ•°æ®çš„åŸºç¡€ç»“æ„ä¿¡æ¯ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿæ— æ³•çŸ¥é“å¹³å‡å®ä¾‹æ ·æœ¬å’Œå…¸å‹å®ä¾‹æ ·æœ¬å…·æœ‰ä»€ä¹ˆç‰¹å¾ã€‚ä¸‹ä¸€ç« æˆ‘ä»¬å°†ä½¿ç”¨æ¦‚ç‡æµ‹é‡æ–¹æ³•å¤„ç†åˆ†ç±»é—®é¢˜ï¼Œè¯¥ç®—æ³•å¯ä»¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚

## ğŸ“š References

- ã€ŠMachine Learning in Actionã€‹

  <img src="https://gitee.com/veal98/images/raw/master/img/20200804111716.png" style="zoom:80%;" />

- [Github - AiLearning](https://github.com/apachecn/AiLearning/)

- [Kè¿‘é‚»ç®—æ³•ä»£ç æ³¨é‡ŠåŠè¯¦è§£](https://www.cnblogs.com/EvilAnne/p/9740111.html)

- [ã€Pythonã€‘get()å‡½æ•°ä½œç”¨](https://blog.csdn.net/weixin_38705903/article/details/79231551)

- [np.tile()å‡½æ•°çš„ä½œç”¨](https://blog.csdn.net/qq_39072607/article/details/89364254)