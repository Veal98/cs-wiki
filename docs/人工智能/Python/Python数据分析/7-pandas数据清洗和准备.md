# ğŸ›¸ ç¬¬ 7 ç«  æ•°æ®æ¸…æ´—å’Œå‡†å¤‡

---

> åœ¨æ•°æ®åˆ†æå’Œå»ºæ¨¡çš„è¿‡ç¨‹ä¸­ï¼Œç›¸å½“å¤šçš„æ—¶é—´è¦ç”¨åœ¨æ•°æ®å‡†å¤‡ä¸Šï¼šåŠ è½½ã€æ¸…ç†ã€è½¬æ¢ä»¥åŠé‡å¡‘ã€‚è¿™äº›å·¥ä½œä¼šå åˆ°åˆ†æå¸ˆæ—¶é—´çš„80%æˆ–æ›´å¤šã€‚æœ‰æ—¶ï¼Œå­˜å‚¨åœ¨æ–‡ä»¶å’Œæ•°æ®åº“ä¸­çš„æ•°æ®çš„æ ¼å¼ä¸é€‚åˆæŸä¸ªç‰¹å®šçš„ä»»åŠ¡ã€‚è®¸å¤šç ”ç©¶è€…éƒ½é€‰æ‹©ä½¿ç”¨é€šç”¨ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚Pythonã€Perlã€Ræˆ–Javaï¼‰æˆ–UNIXæ–‡æœ¬å¤„ç†å·¥å…·ï¼ˆå¦‚sedæˆ–awkï¼‰å¯¹æ•°æ®æ ¼å¼è¿›è¡Œä¸“é—¨å¤„ç†ã€‚å¹¸è¿çš„æ˜¯ï¼Œ**pandas å’Œå†…ç½®çš„ Python æ ‡å‡†åº“æä¾›äº†ä¸€ç»„é«˜çº§çš„ã€çµæ´»çš„ã€å¿«é€Ÿçš„å·¥å…·ï¼Œå¯ä»¥è®©ä½ è½»æ¾åœ°å°†æ•°æ®è§„æ•´ä¸ºæƒ³è¦çš„æ ¼å¼ã€‚**
>
> åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä¼šè®¨è®ºå¤„ç†ç¼ºå¤±æ•°æ®ã€é‡å¤æ•°æ®ã€å­—ç¬¦ä¸²æ“ä½œå’Œå…¶å®ƒåˆ†ææ•°æ®è½¬æ¢çš„å·¥å…·ã€‚ä¸‹ä¸€ç« ï¼Œæˆ‘ä¼šå…³æ³¨äºç”¨å¤šç§æ–¹æ³•åˆå¹¶ã€é‡å¡‘æ•°æ®é›†ã€‚

## 7.1 å¤„ç†ç¼ºå¤±æ•°æ®
åœ¨è®¸å¤šæ•°æ®åˆ†æå·¥ä½œä¸­ï¼Œç¼ºå¤±æ•°æ®æ˜¯ç»å¸¸å‘ç”Ÿçš„ã€‚pandasçš„ç›®æ ‡ä¹‹ä¸€å°±æ˜¯å°½é‡è½»æ¾åœ°å¤„ç†ç¼ºå¤±æ•°æ®ã€‚ä¾‹å¦‚ï¼Œpandaså¯¹è±¡çš„æ‰€æœ‰æè¿°æ€§ç»Ÿè®¡é»˜è®¤éƒ½ä¸åŒ…æ‹¬ç¼ºå¤±æ•°æ®ã€‚

### 1. æ£€æµ‹ç¼ºå¤±æ•°æ® isnull

ç¼ºå¤±æ•°æ®åœ¨pandasä¸­å‘ˆç°çš„æ–¹å¼æœ‰äº›ä¸å®Œç¾ï¼Œä½†å¯¹äºå¤§å¤šæ•°ç”¨æˆ·å¯ä»¥ä¿è¯åŠŸèƒ½æ­£å¸¸ã€‚å¯¹äºæ•°å€¼æ•°æ®ï¼Œ**pandasä½¿ç”¨æµ®ç‚¹å€¼NaNï¼ˆNot a Numberï¼‰è¡¨ç¤ºç¼ºå¤±æ•°æ®**ã€‚<u>æˆ‘ä»¬ç§°å…¶ä¸ºå“¨å…µå€¼ï¼Œå¯ä»¥æ–¹ä¾¿çš„æ£€æµ‹å‡ºæ¥</u>ï¼š
```python
In [10]: string_data = pd.Series(['aardvark', 'artichoke', np.nan, 'avocado'])

In [11]: string_data
Out[11]:
0     aardvark
1    artichoke
2          NaN
3      avocado
dtype: object

In [12]: string_data.isnull()
Out[12]: 
0    False
1    False
2     True
3    False
dtype: bool
```

åœ¨pandasä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†Rè¯­è¨€ä¸­çš„æƒ¯ç”¨æ³•ï¼Œå³å°†ç¼ºå¤±å€¼è¡¨ç¤ºä¸ºNAï¼Œå®ƒè¡¨ç¤ºä¸å¯ç”¨not availableã€‚åœ¨ç»Ÿè®¡åº”ç”¨ä¸­ï¼ŒNAæ•°æ®å¯èƒ½æ˜¯ä¸å­˜åœ¨çš„æ•°æ®æˆ–è€…è™½ç„¶å­˜åœ¨ï¼Œä½†æ˜¯æ²¡æœ‰è§‚å¯Ÿåˆ°ï¼ˆä¾‹å¦‚ï¼Œæ•°æ®é‡‡é›†ä¸­å‘ç”Ÿäº†é—®é¢˜ï¼‰ã€‚å½“è¿›è¡Œæ•°æ®æ¸…æ´—ä»¥è¿›è¡Œåˆ†ææ—¶ï¼Œæœ€å¥½ç›´æ¥å¯¹ç¼ºå¤±æ•°æ®è¿›è¡Œåˆ†æï¼Œä»¥åˆ¤æ–­æ•°æ®é‡‡é›†çš„é—®é¢˜æˆ–ç¼ºå¤±æ•°æ®å¯èƒ½å¯¼è‡´çš„åå·®ã€‚

ğŸš© **Pythonå†…ç½®çš„Noneå€¼åœ¨å¯¹è±¡æ•°ç»„ä¸­ä¹Ÿå¯ä»¥ä½œä¸ºNA**ï¼š
```python
In [13]: string_data[0] = None

In [14]: string_data.isnull()
Out[14]: 
0     True
1    False
2     True
3    False
dtype: bool
```

pandasé¡¹ç›®ä¸­è¿˜åœ¨ä¸æ–­ä¼˜åŒ–å†…éƒ¨ç»†èŠ‚ä»¥æ›´å¥½å¤„ç†ç¼ºå¤±æ•°æ®ï¼Œåƒç”¨æˆ·APIåŠŸèƒ½ï¼Œä¾‹å¦‚ `pandas.isnull`ï¼Œå»é™¤äº†è®¸å¤šæ¼äººçš„ç»†èŠ‚ã€‚ä¸‹è¡¨åˆ—å‡ºäº†ä¸€äº›å…³äºç¼ºå¤±æ•°æ®å¤„ç†çš„å‡½æ•°ã€‚

![](https://gitee.com/veal98/images/raw/master/img/20200614212554.png)

### 2. æ»¤é™¤ç¼ºå¤±æ•°æ® dropna

#### â‘  Series

è¿‡æ»¤æ‰ç¼ºå¤±æ•°æ®çš„åŠæ³•æœ‰å¾ˆå¤šç§ã€‚ä½ å¯ä»¥é€šè¿‡pandas.isnullæˆ–å¸ƒå°”ç´¢å¼•çš„æ‰‹å·¥æ–¹æ³•ï¼Œä½† `dropna` å¯èƒ½ä¼šæ›´å®ç”¨ä¸€äº›ã€‚å¯¹äºä¸€ä¸ªSeriesï¼Œdropnaè¿”å›ä¸€ä¸ªä»…å«éç©ºæ•°æ®å’Œç´¢å¼•å€¼çš„Seriesï¼š
```python
In [15]: from numpy import nan as NA

In [16]: data = pd.Series([1, NA, 3.5, NA, 7])

In [17]: data.dropna()
Out[17]: 
0    1.0
2    3.5
4    7.0
dtype: float64
```

è¿™ç­‰ä»·äºï¼š
```python
In [18]: data[data.notnull()]
Out[18]: 
0    1.0
2    3.5
4    7.0
dtype: float64
```

#### â‘¡ DataFrame

è€Œå¯¹äºDataFrameå¯¹è±¡ï¼Œäº‹æƒ…å°±æœ‰ç‚¹å¤æ‚äº†ã€‚ä½ å¯èƒ½å¸Œæœ›ä¸¢å¼ƒå…¨NAæˆ–å«æœ‰NAçš„è¡Œæˆ–åˆ—ã€‚**dropna é»˜è®¤ä¸¢å¼ƒä»»ä½•å«æœ‰ç¼ºå¤±å€¼çš„è¡Œ**ï¼š

```python
In [19]: data = pd.DataFrame([[1., 6.5, 3.], [1., NA, NA],
   ....:                      [NA, NA, NA], [NA, 6.5, 3.]])

In [20]: cleaned = data.dropna()

In [21]: data
Out[21]: 
     0    1    2
0  1.0  6.5  3.0
1  1.0  NaN  NaN
2  NaN  NaN  NaN
3  NaN  6.5  3.0

In [22]: cleaned
Out[22]: 
     0    1    2
0  1.0  6.5  3.0
```

**ä¼ å…¥ `how='all'` å°†åªä¸¢å¼ƒå…¨ä¸ºNAçš„é‚£äº›è¡Œ**ï¼š

```python
In [23]: data.dropna(how='all')
Out[23]: 
     0    1    2
0  1.0  6.5  3.0
1  1.0  NaN  NaN
3  NaN  6.5  3.0
```

ç”¨è¿™ç§æ–¹å¼**ä¸¢å¼ƒåˆ—ï¼Œåªéœ€ä¼ å…¥ `axis=1` å³å¯**ï¼š
```python
In [24]: data[4] = NA

In [25]: data
Out[25]: 
     0    1    2   4
0  1.0  6.5  3.0 NaN
1  1.0  NaN  NaN NaN
2  NaN  NaN  NaN NaN
3  NaN  6.5  3.0 NaN

In [26]: data.dropna(axis=1, how='all')
Out[26]: 
     0    1    2
0  1.0  6.5  3.0
1  1.0  NaN  NaN
2  NaN  NaN  NaN
3  NaN  6.5  3.0
```

å¦ä¸€ä¸ªæ»¤é™¤DataFrameè¡Œçš„é—®é¢˜æ¶‰åŠæ—¶é—´åºåˆ—æ•°æ®ã€‚å‡è®¾ä½ åªæƒ³ç•™ä¸‹ä¸€éƒ¨åˆ†è§‚æµ‹æ•°æ®ï¼Œå¯ä»¥ç”¨ `thresh` å‚æ•°å®ç°æ­¤ç›®çš„ï¼š
```python
In [27]: df = pd.DataFrame(np.random.randn(7, 3))

In [28]: df.iloc[:4, 1] = NA # å–å‰å››è¡Œæ•°æ®çš„ç¬¬ä¸€åˆ— èµ‹å€¼ NA

In [29]: df.iloc[:2, 2] = NA # å–å‰ä¸¤è¡Œæ•°æ®çš„ç¬¬äºŒåˆ— èµ‹å€¼ NA

In [30]: df
Out[30]: 
          0         1         2
0 -0.204708       NaN       NaN
1 -0.555730       NaN       NaN
2  0.092908       NaN  0.769023
3  1.246435       NaN -1.296221
4  0.274992  0.228913  1.352917
5  0.886429 -2.001637 -0.371843
6  1.669025 -0.438570 -0.539741

In [31]: df.dropna()
Out[31]: 
          0         1         2
4  0.274992  0.228913  1.352917
5  0.886429 -2.001637 -0.371843
6  1.669025 -0.438570 -0.539741

In [32]: df.dropna(thresh=2) # ç•™ä¸‹åˆ—ç´¢å¼• 2 ä¹‹åçš„æ•°æ®
Out[32]: 
          0         1         2
2  0.092908       NaN  0.769023
3  1.246435       NaN -1.296221
4  0.274992  0.228913  1.352917
5  0.886429 -2.001637 -0.371843
6  1.669025 -0.438570 -0.539741
```

### 3. å¡«å……ç¼ºå¤±æ•°æ® fillna
ä½ å¯èƒ½ä¸æƒ³æ»¤é™¤ç¼ºå¤±æ•°æ®ï¼ˆæœ‰å¯èƒ½ä¼šä¸¢å¼ƒè·Ÿå®ƒæœ‰å…³çš„å…¶ä»–æ•°æ®ï¼‰ï¼Œè€Œæ˜¯å¸Œæœ›é€šè¿‡å…¶ä»–æ–¹å¼å¡«è¡¥é‚£äº›â€œç©ºæ´â€ã€‚å¯¹äºå¤§å¤šæ•°æƒ…å†µè€Œè¨€ï¼Œ`fillna` æ–¹æ³•æ˜¯æœ€ä¸»è¦çš„å‡½æ•°ã€‚**é€šè¿‡ä¸€ä¸ªå¸¸æ•°è°ƒç”¨ `fillna` å°±ä¼šå°†ç¼ºå¤±å€¼æ›¿æ¢ä¸ºé‚£ä¸ªå¸¸æ•°å€¼ï¼š**
```python
In [33]: df.fillna(0)
Out[33]: 
          0         1         2
0 -0.204708  0.000000  0.000000
1 -0.555730  0.000000  0.000000
2  0.092908  0.000000  0.769023
3  1.246435  0.000000 -1.296221
4  0.274992  0.228913  1.352917
5  0.886429 -2.001637 -0.371843
6  1.669025 -0.438570 -0.539741
```

è‹¥æ˜¯é€šè¿‡ä¸€ä¸ªå­—å…¸è°ƒç”¨ fillnaï¼Œå°±å¯ä»¥å®ç°å¯¹ä¸åŒçš„åˆ—å¡«å……ä¸åŒçš„å€¼ï¼š
```python
In [34]: df.fillna({1: 0.5, 2: 0})
Out[34]: 
          0         1         2
0 -0.204708  0.500000  0.000000
1 -0.555730  0.500000  0.000000
2  0.092908  0.500000  0.769023
3  1.246435  0.500000 -1.296221
4  0.274992  0.228913  1.352917
5  0.886429 -2.001637 -0.371843
6  1.669025 -0.438570 -0.539741
```

**fillna é»˜è®¤ä¼šè¿”å›æ–°å¯¹è±¡ï¼Œä½†ä¹Ÿå¯ä»¥å¯¹ç°æœ‰å¯¹è±¡è¿›è¡Œå°±åœ°ä¿®æ”¹**ï¼š

```python
In [35]: _ = df.fillna(0, inplace=True)

In [36]: df
Out[36]: 
          0         1         2
0 -0.204708  0.000000  0.000000
1 -0.555730  0.000000  0.000000
2  0.092908  0.000000  0.769023
3  1.246435  0.000000 -1.296221
4  0.274992  0.228913  1.352917
5  0.886429 -2.001637 -0.371843
6  1.669025 -0.438570 -0.539741
```

å¯¹ reindexing æœ‰æ•ˆçš„é‚£äº›æ’å€¼æ–¹æ³•ä¹Ÿå¯ç”¨äº fillnaï¼š
```python
In [37]: df = pd.DataFrame(np.random.randn(6, 3))

In [38]: df.iloc[2:, 1] = NA

In [39]: df.iloc[4:, 2] = NA

In [40]: df
Out[40]: 
          0         1         2
0  0.476985  3.248944 -1.021228
1 -0.577087  0.124121  0.302614
2  0.523772       NaN  1.343810
3 -0.713544       NaN -2.370232
4 -1.860761       NaN       NaN
5 -1.265934       NaN       NaN

In [41]: df.fillna(method='ffill')
Out[41]: 
          0         1         2
0  0.476985  3.248944 -1.021228
1 -0.577087  0.124121  0.302614
2  0.523772  0.124121  1.343810
3 -0.713544  0.124121 -2.370232
4 -1.860761  0.124121 -2.370232
5 -1.265934  0.124121 -2.370232

In [42]: df.fillna(method='ffill', limit=2)
Out[42]: 
          0         1         2
0  0.476985  3.248944 -1.021228
1 -0.577087  0.124121  0.302614
2  0.523772  0.124121  1.343810
3 -0.713544  0.124121 -2.370232
4 -1.860761       NaN -2.370232
5 -1.265934       NaN -2.370232
```

åªè¦æœ‰äº›åˆ›æ–°ï¼Œä½ å°±å¯ä»¥åˆ©ç”¨fillnaå®ç°è®¸å¤šåˆ«çš„åŠŸèƒ½ã€‚æ¯”å¦‚è¯´ï¼Œä½ å¯ä»¥ä¼ å…¥Seriesçš„å¹³å‡å€¼æˆ–ä¸­ä½æ•°ï¼š
```python
In [43]: data = pd.Series([1., NA, 3.5, NA, 7])

In [44]: data.fillna(data.mean())
Out[44]: 
0    1.000000
1    3.833333
2    3.500000
3    3.833333
4    7.000000
dtype: float64
```
ä¸‹è¡¨åˆ—å‡ºäº†fillnaçš„å‚æ•°ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200614214201.png)

## 7.2 æ•°æ®è½¬æ¢
æœ¬ç« åˆ°ç›®å‰ä¸ºæ­¢ä»‹ç»çš„éƒ½æ˜¯æ•°æ®çš„é‡æ’ã€‚å¦ä¸€ç±»é‡è¦æ“ä½œåˆ™æ˜¯è¿‡æ»¤ã€æ¸…ç†ä»¥åŠå…¶ä»–çš„è½¬æ¢å·¥ä½œã€‚

### 1. ç§»é™¤é‡å¤æ•°æ® drop_duplicates

DataFrame ä¸­å‡ºç°é‡å¤è¡Œæœ‰å¤šç§åŸå› ã€‚ä¸‹é¢å°±æ˜¯ä¸€ä¸ªä¾‹å­ï¼š
```python
In [45]: data = pd.DataFrame({'k1': ['one', 'two'] * 3 + ['two'],
   ....:                      'k2': [1, 1, 2, 3, 3, 4, 4]})

In [46]: data
Out[46]: 
    k1  k2
0  one   1
1  two   1
2  one   2
3  two   3
4  one   3
5  two   4
6  two   4
```

DataFrame çš„ `duplicated` æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å‹ Seriesï¼Œè¡¨ç¤ºå„è¡Œæ˜¯å¦æ˜¯é‡å¤è¡Œï¼ˆå‰é¢å‡ºç°è¿‡çš„è¡Œï¼‰ï¼š
```python
In [47]: data.duplicated()
Out[47]: 
0    False
1    False
2    False
3    False
4    False
5    False
6     True
dtype: bool
```

è¿˜æœ‰ä¸€ä¸ªä¸æ­¤ç›¸å…³çš„ `drop_duplicates` æ–¹æ³•ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªDataFrameï¼Œé‡å¤çš„æ•°ç»„ä¼šæ ‡ä¸ºFalseï¼š
```python
In [48]: data.drop_duplicates()
Out[48]: 
    k1  k2
0  one   1
1  two   1
2  one   2
3  two   3
4  one   3
5  two   4
```

è¿™ä¸¤ä¸ªæ–¹æ³•é»˜è®¤ä¼šåˆ¤æ–­å…¨éƒ¨åˆ—ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‡å®šéƒ¨åˆ†åˆ—è¿›è¡Œé‡å¤é¡¹åˆ¤æ–­ã€‚å‡è®¾æˆ‘ä»¬è¿˜æœ‰ä¸€åˆ—å€¼ï¼Œä¸”åªå¸Œæœ›æ ¹æ®k1åˆ—è¿‡æ»¤é‡å¤é¡¹ï¼š
```python
In [49]: data['v1'] = range(7)

In [50]: data.drop_duplicates(['k1'])
Out[50]: 
    k1  k2  v1
0  one   1   0
1  two   1   1
```

duplicatedå’Œdrop_duplicatesé»˜è®¤ä¿ç•™çš„æ˜¯ç¬¬ä¸€ä¸ªå‡ºç°çš„å€¼ç»„åˆã€‚ä¼ å…¥`keep='last'`åˆ™ä¿ç•™æœ€åä¸€ä¸ªï¼š
```python
In [51]: data.drop_duplicates(['k1', 'k2'], keep='last')
Out[51]: 
    k1  k2  v1
0  one   1   0
1  two   1   1
2  one   2   2
3  two   3   3
4  one   3   4
6  two   4   6
```

### 2. åˆ©ç”¨å‡½æ•°æˆ–æ˜ å°„è¿›è¡Œæ•°æ®è½¬æ¢ map
å¯¹äºè®¸å¤šæ•°æ®é›†ï¼Œä½ å¯èƒ½å¸Œæœ›æ ¹æ®æ•°ç»„ã€Seriesæˆ–DataFrameåˆ—ä¸­çš„å€¼æ¥å®ç°è½¬æ¢å·¥ä½œã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢è¿™ç»„æœ‰å…³è‚‰ç±»çš„æ•°æ®ï¼š
```python
In [52]: data = pd.DataFrame({'food': ['bacon', 'pulled pork', 'bacon',
   ....:                               'Pastrami', 'corned beef', 'Bacon',
   ....:                               'pastrami', 'honey ham', 'nova lox'],
   ....:                      'ounces': [4, 3, 12, 6, 7.5, 8, 3, 5, 6]})

In [53]: data
Out[53]: 
          food  ounces
0        bacon     4.0
1  pulled pork     3.0
2        bacon    12.0
3     Pastrami     6.0
4  corned beef     7.5
5        Bacon     8.0
6     pastrami     3.0
7    honey ham     5.0
8     nova lox     6.0
```

å‡è®¾ä½ æƒ³è¦æ·»åŠ ä¸€åˆ—è¡¨ç¤ºè¯¥è‚‰ç±»é£Ÿç‰©æ¥æºçš„åŠ¨ç‰©ç±»å‹ã€‚æˆ‘ä»¬å…ˆç¼–å†™ä¸€ä¸ªä¸åŒè‚‰ç±»åˆ°åŠ¨ç‰©çš„æ˜ å°„ï¼š
```python
meat_to_animal = {
  'bacon': 'pig',
  'pulled pork': 'pig',
  'pastrami': 'cow',
  'corned beef': 'cow',
  'honey ham': 'pig',
  'nova lox': 'salmon'
}
```

**Seriesçš„ `map` æ–¹æ³•å¯ä»¥æ¥å—ä¸€ä¸ªå‡½æ•°æˆ–å«æœ‰æ˜ å°„å…³ç³»çš„å­—å…¸å‹å¯¹è±¡**ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œå³æœ‰äº›è‚‰ç±»çš„é¦–å­—æ¯å¤§å†™äº†ï¼Œè€Œå¦ä¸€äº›åˆ™æ²¡æœ‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨Seriesçš„str.loweræ–¹æ³•ï¼Œå°†å„ä¸ªå€¼è½¬æ¢ä¸ºå°å†™ï¼š

```python
In [55]: lowercased = data['food'].str.lower()

In [56]: lowercased
Out[56]: 
0          bacon
1    pulled pork
2          bacon
3       pastrami
4    corned beef
5          bacon
6       pastrami
7      honey ham
8       nova lox
Name: food, dtype: object

In [57]: data['animal'] = lowercased.map(meat_to_animal)

In [58]: data
Out[58]: 
          food  ounces  animal
0        bacon     4.0     pig
1  pulled pork     3.0     pig
2        bacon    12.0     pig
3     Pastrami     6.0     cow
4  corned beef     7.5     cow
5        Bacon     8.0     pig
6     pastrami     3.0     cow
7    honey ham     5.0     pig
8     nova lox     6.0  salmon
```

æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¼ å…¥ä¸€ä¸ªèƒ½å¤Ÿå®Œæˆå…¨éƒ¨è¿™äº›å·¥ä½œçš„å‡½æ•°ï¼š
```python
In [59]: data['food'].map(lambda x: meat_to_animal[x.lower()])
Out[59]: 
0       pig
1       pig
2       pig
3       cow
4       cow
5       pig
6       cow
7       pig
8    salmon
Name: food, dtype: object
```

**ä½¿ç”¨ `map` æ˜¯ä¸€ç§å®ç°å…ƒç´ çº§è½¬æ¢ä»¥åŠå…¶ä»–æ•°æ®æ¸…ç†å·¥ä½œçš„ä¾¿æ·æ–¹å¼**ã€‚

### 3. æ›¿æ¢å€¼ replace
åˆ©ç”¨ fillna æ–¹æ³•å¡«å……ç¼ºå¤±æ•°æ®å¯ä»¥çœ‹åšå€¼æ›¿æ¢çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚å‰é¢å·²ç»çœ‹åˆ°ï¼Œmap å¯ç”¨äºä¿®æ”¹å¯¹è±¡çš„æ•°æ®å­é›†ï¼Œè€Œ replace åˆ™æä¾›äº†ä¸€ç§å®ç°è¯¥åŠŸèƒ½çš„æ›´ç®€å•ã€æ›´çµæ´»çš„æ–¹å¼ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ª Seriesï¼š
```python
In [60]: data = pd.Series([1., -999., 2., -999., -1000., 3.])

In [61]: data
Out[61]: 
0       1.0
1    -999.0
2       2.0
3    -999.0
4   -1000.0
5       3.0
```

-999 è¿™ä¸ªå€¼å¯èƒ½æ˜¯ä¸€ä¸ªè¡¨ç¤ºç¼ºå¤±æ•°æ®çš„æ ‡è®°å€¼ã€‚è¦å°†å…¶æ›¿æ¢ä¸ºpandasèƒ½å¤Ÿç†è§£çš„NAå€¼ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨replaceæ¥äº§ç”Ÿä¸€ä¸ªæ–°çš„Seriesï¼ˆé™¤éä¼ å…¥inplace=Trueï¼‰ï¼š

```python
In [62]: data.replace(-999, np.nan)
Out[62]: 
0       1.0
1       NaN
2       2.0
3       NaN
4   -1000.0
5       3.0
dtype: float64
```

**å¦‚æœä½ å¸Œæœ›ä¸€æ¬¡æ€§æ›¿æ¢å¤šä¸ªå€¼ï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªç”±å¾…æ›¿æ¢å€¼ç»„æˆçš„åˆ—è¡¨ä»¥åŠä¸€ä¸ªæ›¿æ¢å€¼**ï¼š

```python
In [63]: data.replace([-999, -1000], np.nan)
Out[63]: 
0    1.0
1    NaN
2    2.0
3    NaN
4    NaN
5    3.0
dtype: float64
```

**è¦è®©æ¯ä¸ªå€¼æœ‰ä¸åŒçš„æ›¿æ¢å€¼ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªæ›¿æ¢åˆ—è¡¨**ï¼š

```python
In [64]: data.replace([-999, -1000], [np.nan, 0])
Out[64]: 
0    1.0
1    NaN
2    2.0
3    NaN
4    0.0
5    3.0
dtype: float64
```

**ä¼ å…¥çš„å‚æ•°ä¹Ÿå¯ä»¥æ˜¯å­—å…¸**ï¼š

```python
In [65]: data.replace({-999: np.nan, -1000: 0})
Out[65]: 
0    1.0
1    NaN
2    2.0
3    NaN
4    0.0
5    3.0
dtype: float64
```

>ğŸ”Š `data.replace` æ–¹æ³•ä¸ `data.str.replace` ä¸åŒï¼Œåè€…åšçš„æ˜¯å­—ç¬¦ä¸²çš„å…ƒç´ çº§æ›¿æ¢ã€‚æˆ‘ä»¬ä¼šåœ¨åé¢å­¦ä¹  Series çš„å­—ç¬¦ä¸²æ–¹æ³•ã€‚

### 4. é‡å‘½åè½´ç´¢å¼• map / rename

#### â‘  map

è·ŸSeriesä¸­çš„å€¼ä¸€æ ·ï¼Œè½´æ ‡ç­¾ä¹Ÿå¯ä»¥é€šè¿‡å‡½æ•°æˆ–æ˜ å°„è¿›è¡Œè½¬æ¢ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªæ–°çš„ä¸åŒæ ‡ç­¾çš„å¯¹è±¡ã€‚<u>è½´è¿˜å¯ä»¥è¢«å°±åœ°ä¿®æ”¹ï¼Œè€Œæ— éœ€æ–°å»ºä¸€ä¸ªæ•°æ®ç»“æ„</u>ã€‚æ¥ä¸‹æ¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ªç®€å•çš„ä¾‹å­ï¼š
```python
In [66]: data = pd.DataFrame(np.arange(12).reshape((3, 4)),
   ....:                     index=['Ohio', 'Colorado', 'New York'],
   ....:                     columns=['one', 'two', 'three', 'four'])
```

è·ŸSeriesä¸€æ ·ï¼Œè½´ç´¢å¼•ä¹Ÿæœ‰ä¸€ä¸ª `map` æ–¹æ³•ï¼š
```python
In [67]: transform = lambda x: x[:4].upper()

In [68]: data.index.map(transform)
Out[68]: Index(['OHIO', 'COLO', 'NEW '], dtype='object')
```

ä½ å¯ä»¥å°†å…¶èµ‹å€¼ç»™indexï¼Œè¿™æ ·å°±å¯ä»¥å¯¹DataFrameè¿›è¡Œå°±åœ°ä¿®æ”¹ï¼š
```python
In [69]: data.index = data.index.map(transform)

In [70]: data
Out[70]:
one  two  three  four
OHIO    0    1      2     3
COLO    4    5      6     7
NEW     8    9     10    11
```

#### â‘¡ rename

å¦‚æœæƒ³è¦åˆ›å»ºæ•°æ®é›†çš„è½¬æ¢ç‰ˆï¼ˆè€Œä¸æ˜¯ä¿®æ”¹åŸå§‹æ•°æ®ï¼‰ï¼Œæ¯”è¾ƒå®ç”¨çš„æ–¹æ³•æ˜¯ `rename`ï¼š

```python
In [71]: data.rename(index=str.title, columns=str.upper)
Out[71]: 
      ONE  TWO  THREE  FOUR
Ohio    0    1      2     3
Colo    4    5      6     7
New     8    9     10    11
```

ç‰¹åˆ«è¯´æ˜ä¸€ä¸‹ï¼Œrename å¯ä»¥ç»“åˆå­—å…¸å‹å¯¹è±¡å®ç°å¯¹éƒ¨åˆ†è½´æ ‡ç­¾çš„æ›´æ–°ï¼š
```python
In [72]: data.rename(index={'OHIO': 'INDIANA'},
   ....:             columns={'three': 'peekaboo'})
Out[72]:
		 one  two  peekaboo  four
INDIANA    0    1         2     3
COLO       4    5         6     7
NEW        8    9        10    11
```

rename å¯ä»¥å®ç°å¤åˆ¶DataFrameå¹¶å¯¹å…¶ç´¢å¼•å’Œåˆ—æ ‡ç­¾è¿›è¡Œèµ‹å€¼ã€‚å¦‚æœå¸Œæœ›å°±åœ°ä¿®æ”¹æŸä¸ªæ•°æ®é›†ï¼Œä¼ å…¥`inplace=True` å³å¯ï¼š
```python
In [73]: data.rename(index={'OHIO': 'INDIANA'}, inplace=True)

In [74]: data
Out[74]: 
         one  two  three  four
INDIANA    0    1      2     3
COLO       4    5      6     7
NEW        8    9     10    11
```

### 5. ç¦»æ•£åŒ–å’Œé¢å…ƒåˆ’åˆ† cut / qcut

#### â‘  cut

ğŸš© **ä¸ºäº†ä¾¿äºåˆ†æï¼Œè¿ç»­æ•°æ®å¸¸å¸¸è¢«ç¦»æ•£åŒ–æˆ–æ‹†åˆ†ä¸ºâ€œé¢å…ƒâ€ï¼ˆbinï¼‰**ã€‚å‡è®¾æœ‰ä¸€ç»„äººå‘˜æ•°æ®ï¼Œè€Œä½ å¸Œæœ›å°†å®ƒä»¬åˆ’åˆ†ä¸ºä¸åŒçš„å¹´é¾„ç»„ï¼š
```python
In [75]: ages = [20, 22, 25, 27, 21, 23, 37, 31, 61, 45, 41, 32]
```

æ¥ä¸‹æ¥å°†è¿™äº›æ•°æ®åˆ’åˆ†ä¸ºâ€œ18åˆ°25â€ã€â€œ26åˆ°35â€ã€â€œ35åˆ°60â€ä»¥åŠâ€œ60ä»¥ä¸Šâ€å‡ ä¸ªé¢å…ƒã€‚è¦å®ç°è¯¥åŠŸèƒ½ï¼Œä½ éœ€è¦ä½¿ç”¨pandasçš„ `cut` å‡½æ•°ï¼š
```python
In [76]: bins = [18, 25, 35, 60, 100]

In [77]: cats = pd.cut(ages, bins)

In [78]: cats
Out[78]: 
[(18, 25], (18, 25], (18, 25], (25, 35], (18, 25], ..., (25, 35], (60, 100], (35,60], (35, 60], (25, 35]]
Length: 12
Categories (4, interval[int64]): [(18, 25] < (25, 35] < (35, 60] < (60, 100]]
```

pandasè¿”å›çš„æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„Categoricalå¯¹è±¡ã€‚ç»“æœå±•ç¤ºäº†pandas.cutåˆ’åˆ†çš„é¢å…ƒã€‚ä½ å¯ä»¥å°†å…¶çœ‹åšä¸€ç»„è¡¨ç¤ºé¢å…ƒåç§°çš„å­—ç¬¦ä¸²ã€‚å®ƒçš„åº•å±‚å«æœ‰ä¸€ä¸ªè¡¨ç¤ºä¸åŒåˆ†ç±»åç§°çš„ç±»å‹æ•°ç»„ï¼Œä»¥åŠä¸€ä¸ªcodeså±æ€§ä¸­çš„å¹´é¾„æ•°æ®çš„æ ‡ç­¾ï¼š
```python
In [79]: cats.codes
Out[79]: array([0, 0, 0, 1, 0, 0, 2, 1, 3, 2, 2, 1], dtype=int8)

In [80]: cats.categories
Out[80]: 
IntervalIndex([(18, 25], (25, 35], (35, 60], (60, 100]]
              closed='right',
              dtype='interval[int64]')

In [81]: pd.value_counts(cats)
Out[81]: 
(18, 25]     5
(35, 60]     3
(25, 35]     3
(60, 100]    1
dtype: int64
```

`pd.value_counts(cats)` æ˜¯ `pandas.cut` ç»“æœçš„é¢å…ƒè®¡æ•°ã€‚

è·Ÿâ€œåŒºé—´â€çš„æ•°å­¦ç¬¦å·ä¸€æ ·ï¼Œåœ†æ‹¬å·è¡¨ç¤ºå¼€ç«¯ï¼Œè€Œæ–¹æ‹¬å·åˆ™è¡¨ç¤ºé—­ç«¯ï¼ˆåŒ…æ‹¬ï¼‰ã€‚é»˜è®¤å·¦å¼€å³é—­ï¼Œå¯ä»¥é€šè¿‡right=False è¿›è¡Œä¿®æ”¹ä¸ºå·¦é—­å³å¼€ï¼š
```python
In [82]: pd.cut(ages, [18, 26, 36, 61, 100], right=False)
Out[82]: 
[[18, 26), [18, 26), [18, 26), [26, 36), [18, 26), ..., [26, 36), [61, 100), [36,
 61), [36, 61), [26, 36)]
Length: 12
Categories (4, interval[int64]): [[18, 26) < [26, 36) < [36, 61) < [61, 100)]
```

**ä½ å¯ä»¥é€šè¿‡ä¼ é€’ä¸€ä¸ªåˆ—è¡¨æˆ–æ•°ç»„åˆ° `labels`ï¼Œè®¾ç½®è‡ªå·±çš„é¢å…ƒåç§°**ï¼š

```python
In [83]: group_names = ['Youth', 'YoungAdult', 'MiddleAged', 'Senior']

In [84]: pd.cut(ages, bins, labels=group_names)
Out[84]: 
[Youth, Youth, Youth, YoungAdult, Youth, ..., YoungAdult, Senior, MiddleAged, Mid
dleAged, YoungAdult]
Length: 12
Categories (4, object): [Youth < YoungAdult < MiddleAged < Senior]
```

**å¦‚æœå‘cutä¼ å…¥çš„æ˜¯é¢å…ƒçš„æ•°é‡è€Œä¸æ˜¯ç¡®åˆ‡çš„é¢å…ƒè¾¹ç•Œï¼Œåˆ™å®ƒä¼šæ ¹æ®æ•°æ®çš„æœ€å°å€¼å’Œæœ€å¤§å€¼è®¡ç®—ç­‰é•¿é¢å…ƒã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä¸€äº›å‡åŒ€åˆ†å¸ƒçš„æ•°æ®åˆ†æˆå››ç»„ï¼š**

```python
In [85]: data = np.random.rand(20)

In [86]: pd.cut(data, 4, precision=2)
Out[86]: 
[(0.34, 0.55], (0.34, 0.55], (0.76, 0.97], (0.76, 0.97], (0.34, 0.55], ..., (0.34
, 0.55], (0.34, 0.55], (0.55, 0.76], (0.34, 0.55], (0.12, 0.34]]
Length: 20
Categories (4, interval[float64]): [(0.12, 0.34] < (0.34, 0.55] < (0.55, 0.76] < 
(0.76, 0.97]]
```

é€‰é¡¹ `precision=2`ï¼Œé™å®šå°æ•°åªæœ‰ä¸¤ä½ã€‚

#### â‘¡ qcut

ğŸš© <u>`qcut` æ˜¯ä¸€ä¸ªéå¸¸ç±»ä¼¼äºcutçš„å‡½æ•°ï¼Œå®ƒå¯ä»¥æ ¹æ®æ ·æœ¬**åˆ†ä½æ•°**ï¼ˆå°†ä¸€ä¸ªéšæœºå˜é‡çš„æ¦‚ç‡åˆ†å¸ƒèŒƒå›´åˆ†æˆå‡ ä¸ªç­‰ä»½çš„æ•°å€¼ç‚¹ï¼Œæ¯”å¦‚ä¸­ä½æ•°ï¼‰å¯¹æ•°æ®è¿›è¡Œé¢å…ƒåˆ’åˆ†ã€‚æ ¹æ®æ•°æ®çš„åˆ†å¸ƒæƒ…å†µï¼Œcutå¯èƒ½æ— æ³•ä½¿å„ä¸ªé¢å…ƒä¸­å«æœ‰ç›¸åŒæ•°é‡çš„æ•°æ®ç‚¹ã€‚è€Œqcutç”±äºä½¿ç”¨çš„æ˜¯æ ·æœ¬åˆ†ä½æ•°ï¼Œå› æ­¤å¯ä»¥å¾—åˆ°å¤§å°åŸºæœ¬ç›¸ç­‰çš„é¢å…ƒ</u>ï¼š

```python
In [87]: data = np.random.randn(1000)  # Normally distributed

In [88]: cats = pd.qcut(data, 4)  # Cut into quartiles

In [89]: cats
Out[89]: 
[(-0.0265, 0.62], (0.62, 3.928], (-0.68, -0.0265], (0.62, 3.928], (-0.0265, 0.62]
, ..., (-0.68, -0.0265], (-0.68, -0.0265], (-2.95, -0.68], (0.62, 3.928], (-0.68,
 -0.0265]]
Length: 1000
Categories (4, interval[float64]): [(-2.95, -0.68] < (-0.68, -0.0265] < (-0.0265,
 0.62] <
                                    (0.62, 3.928]]

In [90]: pd.value_counts(cats)
Out[90]:
(0.62, 3.928]       250
(-0.0265, 0.62]     250
(-0.68, -0.0265]    250
(-2.95, -0.68]      250
dtype: int64
```

ä¸cutç±»ä¼¼ï¼Œä½ ä¹Ÿå¯ä»¥ä¼ é€’è‡ªå®šä¹‰çš„åˆ†ä½æ•°ï¼ˆ0åˆ°1ä¹‹é—´çš„æ•°å€¼ï¼ŒåŒ…å«ç«¯ç‚¹ï¼‰ï¼š
```python
In [91]: pd.qcut(data, [0, 0.1, 0.5, 0.9, 1.])
Out[91]: 
[(-0.0265, 1.286], (-0.0265, 1.286], (-1.187, -0.0265], (-0.0265, 1.286], (-0.026
5, 1.286], ..., (-1.187, -0.0265], (-1.187, -0.0265], (-2.95, -1.187], (-0.0265, 
1.286], (-1.187, -0.0265]]
Length: 1000
Categories (4, interval[float64]): [(-2.95, -1.187] < (-1.187, -0.0265] < (-0.026
5, 1.286] <
                                    (1.286, 3.928]]
```

æœ¬ç« ç¨ååœ¨è®²è§£èšåˆå’Œåˆ†ç»„è¿ç®—æ—¶ä¼šå†æ¬¡ç”¨åˆ°cutå’Œqcutï¼Œå› ä¸ºè¿™ä¸¤ä¸ªç¦»æ•£åŒ–å‡½æ•°å¯¹åˆ†ä½å’Œåˆ†ç»„åˆ†æéå¸¸é‡è¦ã€‚

### 6. æ£€æµ‹å’Œè¿‡æ»¤å¼‚å¸¸å€¼
è¿‡æ»¤æˆ–å˜æ¢å¼‚å¸¸å€¼ï¼ˆoutlierï¼‰åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå°±æ˜¯è¿ç”¨æ•°ç»„è¿ç®—ã€‚æ¥çœ‹ä¸€ä¸ªå«æœ‰æ­£æ€åˆ†å¸ƒæ•°æ®çš„DataFrameï¼š
```python
In [92]: data = pd.DataFrame(np.random.randn(1000, 4))

In [93]: data.describe()
Out[93]: 
                 0            1            2            3
count  1000.000000  1000.000000  1000.000000  1000.000000
mean      0.049091     0.026112    -0.002544    -0.051827
std       0.996947     1.007458     0.995232     0.998311
min      -3.645860    -3.184377    -3.745356    -3.428254
25%      -0.599807    -0.612162    -0.687373    -0.747478
50%       0.047101    -0.013609    -0.022158    -0.088274
75%       0.756646     0.695298     0.699046     0.623331
max       2.653656     3.525865     2.735527     3.366626
```

å‡è®¾ä½ æƒ³è¦æ‰¾å‡ºæŸåˆ—ä¸­ç»å¯¹å€¼å¤§å°è¶…è¿‡3çš„å€¼ï¼š
```python
In [94]: col = data[2]

In [95]: col[np.abs(col) > 3]
Out[95]: 
41    -3.399312
136   -3.745356
Name: 2, dtype: float64
```

è¦é€‰å‡ºå…¨éƒ¨å«æœ‰â€œè¶…è¿‡3æˆ–ï¼3çš„å€¼â€çš„è¡Œï¼Œä½ å¯ä»¥åœ¨å¸ƒå°”å‹DataFrameä¸­ä½¿ç”¨anyæ–¹æ³•ï¼š
```python
In [96]: data[(np.abs(data) > 3).any(1)]
Out[96]: 
            0         1         2         3
41   0.457246 -0.025907 -3.399312 -0.974657
60   1.951312  3.260383  0.963301  1.201206
136  0.508391 -0.196713 -3.745356 -1.520113
235 -0.242459 -3.056990  1.918403 -0.578828
258  0.682841  0.326045  0.425384 -3.428254
322  1.179227 -3.184377  1.369891 -1.074833
544 -3.548824  1.553205 -2.186301  1.277104
635 -0.578093  0.193299  1.397822  3.366626
782 -0.207434  3.525865  0.283070  0.544635
803 -3.645860  0.255475 -0.549574 -1.907459
```

æ ¹æ®è¿™äº›æ¡ä»¶ï¼Œå°±å¯ä»¥å¯¹å€¼è¿›è¡Œè®¾ç½®ã€‚ä¸‹é¢çš„ä»£ç å¯ä»¥å°†å€¼é™åˆ¶åœ¨åŒºé—´ï¼3åˆ°3ä»¥å†…ï¼š
```python
In [97]: data[np.abs(data) > 3] = np.sign(data) * 3

In [98]: data.describe()
Out[98]: 
                 0            1            2            3
count  1000.000000  1000.000000  1000.000000  1000.000000
mean      0.050286     0.025567    -0.001399    -0.051765
std       0.992920     1.004214     0.991414     0.995761
min      -3.000000    -3.000000    -3.000000    -3.000000
25%      -0.599807    -0.612162    -0.687373    -0.747478
50%       0.047101    -0.013609    -0.022158    -0.088274
75%       0.756646     0.695298     0.699046     0.623331
max       2.653656     3.000000     2.735527     3.000000
```

æ ¹æ®æ•°æ®çš„å€¼æ˜¯æ­£è¿˜æ˜¯è´Ÿï¼Œnp.sign(data)å¯ä»¥ç”Ÿæˆ1å’Œ-1ï¼š
```python
In [99]: np.sign(data).head()
Out[99]: 
     0    1    2    3
0 -1.0  1.0 -1.0  1.0
1  1.0 -1.0  1.0 -1.0
2  1.0  1.0  1.0 -1.0
3 -1.0 -1.0  1.0 -1.0
4 -1.0  1.0 -1.0 -1.0
```

### 7. æ’åˆ— permutation å’Œ éšæœºé‡‡æ · smaple
åˆ©ç”¨ `numpy.random.permutation` å‡½æ•°å¯ä»¥è½»æ¾å®ç°å¯¹Seriesæˆ–DataFrameçš„åˆ—çš„æ’åˆ—å·¥ä½œï¼ˆpermutingï¼Œéšæœºé‡æ’åºï¼‰ã€‚é€šè¿‡éœ€è¦æ’åˆ—çš„è½´çš„é•¿åº¦è°ƒ**ç”¨ permutationï¼Œå¯äº§ç”Ÿä¸€ä¸ªè¡¨ç¤ºæ–°é¡ºåºçš„æ•´æ•°æ•°ç»„**ï¼š
```python
In [100]: df = pd.DataFrame(np.arange(5 * 4).reshape((5, 4)))

In [101]: sampler = np.random.permutation(5)

In [102]: sampler
Out[102]: array([3, 1, 4, 2, 0])
```

ç„¶åå°±å¯ä»¥åœ¨åŸºäº `iloc` çš„ç´¢å¼•æ“ä½œæˆ– `take` å‡½æ•°ï¼ˆç”¨æ¥è¿›è¡Œéšæœºé‡æ’ï¼‰ä¸­ä½¿ç”¨è¯¥æ•°ç»„äº†ï¼š
```python
In [103]: df
Out[103]: 
    0   1   2   3
0   0   1   2   3
1   4   5   6   7
2   8   9  10  11
3  12  13  14  15
4  16  17  18  19

In [104]: df.take(sampler)
Out[104]: 
    0   1   2   3
3  12  13  14  15
1   4   5   6   7
4  16  17  18  19
2   8   9  10  11
0   0   1   2   3
```

å¦‚æœä¸æƒ³ç”¨æ›¿æ¢çš„æ–¹å¼é€‰å–éšæœºå­é›†ï¼Œå¯ä»¥åœ¨Serieså’ŒDataFrameä¸Šä½¿ç”¨ `sample` æ–¹æ³•ï¼š
```python
In [105]: df.sample(n=3)
Out[105]: 
    0   1   2   3
3  12  13  14  15
4  16  17  18  19
2   8   9  10  11
```

è¦é€šè¿‡æ›¿æ¢çš„æ–¹å¼äº§ç”Ÿæ ·æœ¬ï¼ˆå…è®¸é‡å¤é€‰æ‹©ï¼‰ï¼Œå¯ä»¥ä¼ é€’replace=Trueåˆ°sampleï¼š
```python
In [106]: choices = pd.Series([5, 7, -1, 6, 4])

In [107]: draws = choices.sample(n=10, replace=True)

In [108]: draws
Out[108]: 
4    4
1    7
4    4
2   -1
0    5
3    6
1    7
4    4
0    5
4    4
dtype: int64
```

### 8. è®¡ç®—æŒ‡æ ‡/å“‘å˜é‡ get_dummies
å¦ä¸€ç§å¸¸ç”¨äºç»Ÿè®¡å»ºæ¨¡æˆ–æœºå™¨å­¦ä¹ çš„è½¬æ¢æ–¹å¼æ˜¯ï¼š**å°†åˆ†ç±»å˜é‡ï¼ˆcategorical variableï¼‰è½¬æ¢ä¸ºâ€œå“‘å˜é‡â€æˆ–â€œæŒ‡æ ‡çŸ©é˜µâ€ã€‚**

å¦‚<u>æœDataFrameçš„æŸä¸€åˆ—ä¸­å«æœ‰kä¸ªä¸åŒçš„å€¼ï¼Œåˆ™å¯ä»¥æ´¾ç”Ÿå‡ºä¸€ä¸ªkåˆ—çŸ©é˜µæˆ–DataFrameï¼ˆå…¶å€¼å…¨ä¸º1å’Œ0ï¼‰ã€‚</u>pandasæœ‰ä¸€ä¸ª `get_dummies` å‡½æ•°å¯ä»¥å®ç°è¯¥åŠŸèƒ½ï¼ˆå…¶å®è‡ªå·±åŠ¨æ‰‹åšä¸€ä¸ªä¹Ÿä¸éš¾ï¼‰ã€‚ä½¿ç”¨ä¹‹å‰çš„ä¸€ä¸ªDataFrame ä¾‹å­ï¼š
```python
In [109]: df = pd.DataFrame({'key': ['b', 'b', 'a', 'c', 'a', 'b'],
   .....:                    'data1': range(6)})
In [110] : df
Out[110]:
    key	data1
0	b	0
1	b	1
2	a	2
3	c	3
4	a	4
5	b	5

In [111]: pd.get_dummies(df['key'])
Out[111]: 
   a  b  c
0  0  1  0
1  0  1  0
2  1  0  0
3  0  0  1
4  1  0  0
5  0  1  0
```

æœ‰æ—¶å€™ï¼Œä½ å¯èƒ½æƒ³ç»™æŒ‡æ ‡DataFrameçš„åˆ—åŠ ä¸Šä¸€ä¸ªå‰ç¼€ï¼Œä»¥ä¾¿èƒ½å¤Ÿè·Ÿå…¶ä»–æ•°æ®è¿›è¡Œåˆå¹¶ã€‚get_dummies çš„`prefix` å‚æ•°å¯ä»¥å®ç°è¯¥åŠŸèƒ½ï¼š
```python
In [111]: dummies = pd.get_dummies(df['key'], prefix='key')

In [112]: df_with_dummy = df[['data1']].join(dummies)

In [113]: df_with_dummy
Out[113]: 
   data1  key_a  key_b  key_c
0      0      0      1      0
1      1      0      1      0
2      2      1      0      0
3      3      0      0      1
4      4      1      0      0
5      5      0      1      0
```

å¦‚æœDataFrameä¸­çš„æŸè¡ŒåŒå±äºå¤šä¸ªåˆ†ç±»ï¼Œåˆ™äº‹æƒ…å°±ä¼šæœ‰ç‚¹å¤æ‚ã€‚çœ‹ä¸€ä¸‹MovieLens 1Mæ•°æ®é›†ï¼Œ14ç« ä¼šæ›´æ·±å…¥åœ°ç ”ç©¶å®ƒï¼š
```python
In [114]: mnames = ['movie_id', 'title', 'genres']

In [115]: movies = pd.read_table('datasets/movielens/movies.dat', sep='::',
   .....:                        header=None, names=mnames)

In [116]: movies[:10]
Out[116]: 
   movie_id                               title                        genres
0         1                    Toy Story (1995)   Animation|Children's|Comedy
1         2                      Jumanji (1995)  Adventure|Children's|Fantasy
2         3             Grumpier Old Men (1995)                Comedy|Romance
3         4            Waiting to Exhale (1995)                  Comedy|Drama
4         5  Father of the Bride Part II (1995)                        Comedy
5         6                         Heat (1995)         Action|Crime|Thriller
6         7                      Sabrina (1995)                Comedy|Romance
7         8                 Tom and Huck (1995)          Adventure|Children's
8         9                 Sudden Death (1995)
Action
9        10                    GoldenEye (1995)     Action|Adventure|Thriller
```

è¦ä¸ºæ¯ä¸ªgenreæ·»åŠ æŒ‡æ ‡å˜é‡å°±éœ€è¦åšä¸€äº›æ•°æ®è§„æ•´æ“ä½œã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä»æ•°æ®é›†ä¸­æŠ½å–å‡ºä¸åŒçš„genreå€¼ï¼š
```python
In [117]: all_genres = []

In [118]: for x in movies.genres:
   .....:     all_genres.extend(x.split('|'))

In [119]: genres = pd.unique(all_genres)
```

ç°åœ¨æœ‰ï¼š
```python
In [120]: genres
Out[120]: 
array(['Animation', "Children's", 'Comedy', 'Adventure', 'Fantasy',
       'Romance', 'Drama', 'Action', 'Crime', 'Thriller','Horror',
       'Sci-Fi', 'Documentary', 'War', 'Musical', 'Mystery', 'Film-Noir',
       'Western'], dtype=object)
```

æ„å»ºæŒ‡æ ‡DataFrameçš„æ–¹æ³•ä¹‹ä¸€æ˜¯ä»ä¸€ä¸ªå…¨é›¶DataFrameå¼€å§‹ï¼š
```python
In [121]: zero_matrix = np.zeros((len(movies), len(genres)))

In [122]: dummies = pd.DataFrame(zero_matrix, columns=genres)
```

ç°åœ¨ï¼Œè¿­ä»£æ¯ä¸€éƒ¨ç”µå½±ï¼Œå¹¶å°†dummieså„è¡Œçš„æ¡ç›®è®¾ä¸º1ã€‚è¦è¿™ä¹ˆåšï¼Œæˆ‘ä»¬ä½¿ç”¨dummies.columnsæ¥è®¡ç®—æ¯ä¸ªç±»å‹çš„åˆ—ç´¢å¼•ï¼š
```python
In [123]: gen = movies.genres[0]

In [124]: gen.split('|')
Out[124]: ['Animation', "Children's", 'Comedy']

In [125]: dummies.columns.get_indexer(gen.split('|'))
Out[125]: array([0, 1, 2])
```

ç„¶åï¼Œæ ¹æ®ç´¢å¼•ï¼Œä½¿ç”¨.ilocè®¾å®šå€¼ï¼š
```python
In [126]: for i, gen in enumerate(movies.genres):
   .....:     indices = dummies.columns.get_indexer(gen.split('|'))
   .....:     dummies.iloc[i, indices] = 1
   .....:
```

ç„¶åï¼Œå’Œä»¥å‰ä¸€æ ·ï¼Œå†å°†å…¶ä¸moviesåˆå¹¶èµ·æ¥ï¼š
```python
In [127]: movies_windic = movies.join(dummies.add_prefix('Genre_'))

In [128]: movies_windic.iloc[0]
Out[128]: 
movie_id                                       1
title                           Toy Story (1995)
genres               Animation|Children's|Comedy
Genre_Animation                                1
Genre_Children's                               1
Genre_Comedy                                   1
Genre_Adventure                                0
Genre_Fantasy                                  0
Genre_Romance                                  0
Genre_Drama                                    0
                                ...             
Genre_Crime                                    0
Genre_Thriller                                 0
Genre_Horror                                   0
Genre_Sci-Fi                                   0
Genre_Documentary                              0
Genre_War                                      0
Genre_Musical                                  0
Genre_Mystery                                  0
Genre_Film-Noir                                0
Genre_Western                                  0
Name: 0, Length: 21, dtype: object
```

>ğŸš© å¯¹äºå¾ˆå¤§çš„æ•°æ®ï¼Œç”¨è¿™ç§æ–¹å¼æ„å»ºå¤šæˆå‘˜æŒ‡æ ‡å˜é‡å°±ä¼šå˜å¾—éå¸¸æ…¢ã€‚æœ€å¥½ä½¿ç”¨æ›´ä½çº§çš„å‡½æ•°ï¼Œå°†å…¶å†™å…¥NumPyæ•°ç»„ï¼Œç„¶åç»“æœåŒ…è£…åœ¨DataFrameä¸­ã€‚

â­ **ä¸€ä¸ªå¯¹ç»Ÿè®¡åº”ç”¨æœ‰ç”¨çš„ç§˜è¯€æ˜¯ï¼šç»“åˆget_dummieså’Œè¯¸å¦‚cutä¹‹ç±»çš„ç¦»æ•£åŒ–å‡½æ•°**ï¼š
```python
In [129]: np.random.seed(12345)

In [130]: values = np.random.rand(10)

In [131]: values
Out[131]: 
array([ 0.9296,  0.3164,  0.1839,  0.2046,  0.5677,  0.5955,  0.9645,
        0.6532,  0.7489,  0.6536])

In [132]: bins = [0, 0.2, 0.4, 0.6, 0.8, 1]

In [133]: pd.get_dummies(pd.cut(values, bins))
Out[133]: 
   (0.0, 0.2]  (0.2, 0.4]  (0.4, 0.6]  (0.6, 0.8]  (0.8, 1.0]
0           0           0           0           0           1
1           0           1           0           0           0
2           1           0           0           0           0
3           0           1           0           0           0
4           0           0           1           0           0
5           0           0           1           0           0
6           0           0           0           0           1
7           0           0           0           1           0
8           0           0           0           1           0
9           0           0           0           1           0
```

æˆ‘ä»¬ç”¨ numpy.random.seedï¼Œä½¿è¿™ä¸ªä¾‹å­å…·æœ‰ç¡®å®šæ€§ã€‚æœ¬ä¹¦åé¢ä¼šä»‹ç» pandas.get_dummiesã€‚

## 7.3 å­—ç¬¦ä¸²æ“ä½œ

Pythonèƒ½å¤Ÿæˆä¸ºæµè¡Œçš„æ•°æ®å¤„ç†è¯­è¨€ï¼Œéƒ¨åˆ†åŸå› æ˜¯å…¶ç®€å•æ˜“ç”¨çš„å­—ç¬¦ä¸²å’Œæ–‡æœ¬å¤„ç†åŠŸèƒ½ã€‚å¤§éƒ¨åˆ†æ–‡æœ¬è¿ç®—éƒ½ç›´æ¥åšæˆäº†å­—ç¬¦ä¸²å¯¹è±¡çš„å†…ç½®æ–¹æ³•ã€‚å¯¹äºæ›´ä¸ºå¤æ‚çš„æ¨¡å¼åŒ¹é…å’Œæ–‡æœ¬æ“ä½œï¼Œåˆ™å¯èƒ½éœ€è¦ç”¨åˆ°æ­£åˆ™è¡¨è¾¾å¼ã€‚pandaså¯¹æ­¤è¿›è¡Œäº†åŠ å¼ºï¼Œå®ƒä½¿ä½ èƒ½å¤Ÿå¯¹æ•´ç»„æ•°æ®åº”ç”¨å­—ç¬¦ä¸²è¡¨è¾¾å¼å’Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œè€Œä¸”èƒ½å¤„ç†çƒ¦äººçš„ç¼ºå¤±æ•°æ®ã€‚

### 1. å­—ç¬¦ä¸²å¯¹è±¡æ–¹æ³•

å¯¹äºè®¸å¤šå­—ç¬¦ä¸²å¤„ç†å’Œè„šæœ¬åº”ç”¨ï¼Œå†…ç½®çš„å­—ç¬¦ä¸²æ–¹æ³•å·²ç»èƒ½å¤Ÿæ»¡è¶³è¦æ±‚äº†ã€‚ä¾‹å¦‚ï¼Œä»¥é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²å¯ä»¥ç”¨ `split` æ‹†åˆ†æˆæ•°æ®µï¼š
```python
In [134]: val = 'a,b,  guido'
In [135]: val.split(',')
Out[135]: ['a', 'b', '  guido']
```

`split` å¸¸å¸¸ä¸ `strip` ä¸€èµ·ä½¿ç”¨ï¼Œä»¥å»é™¤ç©ºç™½ç¬¦ï¼ˆåŒ…æ‹¬æ¢è¡Œç¬¦ï¼‰ï¼š

```python
In [136]: pieces = [x.strip() for x in val.split(',')]

In [137]: pieces
Out[137]: ['a', 'b', 'guido']
```

åˆ©ç”¨åŠ æ³•ï¼Œå¯ä»¥å°†è¿™äº›å­å­—ç¬¦ä¸²ä»¥åŒå†’å·åˆ†éš”ç¬¦çš„å½¢å¼è¿æ¥èµ·æ¥ï¼š
```python
In [138]: first, second, third = pieces

In [139]: first + '::' + second + '::' + third
Out[139]: 'a::b::guido'
```

ä½†è¿™ç§æ–¹å¼å¹¶ä¸æ˜¯å¾ˆå®ç”¨ã€‚ä¸€ç§æ›´å¿«æ›´ç¬¦åˆPythoné£æ ¼çš„æ–¹å¼æ˜¯ï¼Œå‘å­—ç¬¦ä¸² `"::"` çš„` join` æ–¹æ³•ä¼ å…¥ä¸€ä¸ªåˆ—è¡¨æˆ–å…ƒç»„ï¼š
```python
In [140]: '::'.join(pieces)
Out[140]: 'a::b::guido'
```

å…¶å®ƒæ–¹æ³•å…³æ³¨çš„æ˜¯å­ä¸²å®šä½ã€‚æ£€æµ‹å­ä¸²çš„æœ€ä½³æ–¹å¼æ˜¯åˆ©ç”¨Pythonçš„`in`å…³é”®å­—ï¼Œè¿˜å¯ä»¥ä½¿ç”¨`index`å’Œ`find`ï¼š
```python
In [141]: 'guido' in val
Out[141]: True

In [142]: val.index(',')
Out[142]: 1

In [143]: val.find(':')
Out[143]: -1
```

æ³¨æ„findå’Œindexçš„åŒºåˆ«ï¼šå¦‚æœæ‰¾ä¸åˆ°å­—ç¬¦ä¸²ï¼Œindexå°†ä¼šå¼•å‘ä¸€ä¸ªå¼‚å¸¸ï¼ˆè€Œä¸æ˜¯è¿”å›ï¼1ï¼‰ï¼š
```python
In [144]: val.index(':')
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-144-280f8b2856ce> in <module>()
----> 1 val.index(':')
ValueError: substring not found
```

ä¸æ­¤ç›¸å…³ï¼Œ`count`å¯ä»¥è¿”å›æŒ‡å®šå­ä¸²çš„å‡ºç°æ¬¡æ•°ï¼š
```python
In [145]: val.count(',')
Out[145]: 2
```

`replace`ç”¨äºå°†æŒ‡å®šå­—ç¬¦ä¸²æ›¿æ¢ä¸ºå¦ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚é€šè¿‡ä¼ å…¥ç©ºå­—ç¬¦ä¸²ï¼Œå®ƒä¹Ÿå¸¸å¸¸ç”¨äºåˆ é™¤æ¨¡å¼ï¼š

```python
In [146]: val.replace(',', '::')
Out[146]: 'a::b::  guido'

In [147]: val.replace(',', '')
Out[147]: 'ab  guido'
```

è¡¨7-3åˆ—å‡ºäº†Pythonå†…ç½®çš„å­—ç¬¦ä¸²æ–¹æ³•ã€‚è¿™äº›è¿ç®—å¤§éƒ¨åˆ†éƒ½èƒ½ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å®ç°ã€‚

![](https://gitee.com/veal98/images/raw/master/img/20200614223506.png)

### 2. æ­£åˆ™è¡¨è¾¾å¼

æ­£åˆ™è¡¨è¾¾å¼æä¾›äº†ä¸€ç§çµæ´»çš„åœ¨æ–‡æœ¬ä¸­æœç´¢æˆ–åŒ¹é…ï¼ˆé€šå¸¸æ¯”å‰è€…å¤æ‚ï¼‰å­—ç¬¦ä¸²æ¨¡å¼çš„æ–¹å¼ã€‚æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¸¸ç§°ä½œ regexï¼Œæ˜¯æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼è¯­è¨€ç¼–å†™çš„å­—ç¬¦ä¸²ã€‚Pythonå†…ç½®çš„ re æ¨¡å—è´Ÿè´£å¯¹å­—ç¬¦ä¸²åº”ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚æˆ‘å°†é€šè¿‡ä¸€äº›ä¾‹å­è¯´æ˜å…¶ä½¿ç”¨æ–¹æ³•ã€‚

reæ¨¡å—çš„å‡½æ•°å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªå¤§ç±»ï¼šæ¨¡å¼åŒ¹é…ã€æ›¿æ¢ä»¥åŠæ‹†åˆ†ã€‚å½“ç„¶ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯ç›¸è¾…ç›¸æˆçš„ã€‚ä¸€ä¸ªregexæè¿°äº†éœ€è¦åœ¨æ–‡æœ¬ä¸­å®šä½çš„ä¸€ä¸ªæ¨¡å¼ï¼Œå®ƒå¯ä»¥ç”¨äºè®¸å¤šç›®çš„ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼šå‡è®¾æˆ‘æƒ³è¦æ‹†åˆ†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ†éš”ç¬¦ä¸ºæ•°é‡ä¸å®šçš„ä¸€ç»„ç©ºç™½ç¬¦ï¼ˆåˆ¶è¡¨ç¬¦ã€ç©ºæ ¼ã€æ¢è¡Œç¬¦ç­‰ï¼‰ã€‚æè¿°ä¸€ä¸ªæˆ–å¤šä¸ªç©ºç™½ç¬¦çš„ regexæ˜¯\s+ï¼š
```python
In [148]: import re

In [149]: text = "foo    bar\t baz  \tqux"

In [150]: re.split('\s+', text)
Out[150]: ['foo', 'bar', 'baz', 'qux']
```

è°ƒç”¨ `re.split('\s+',text)` æ—¶ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¼šå…ˆè¢«ç¼–è¯‘ï¼Œç„¶åå†åœ¨textä¸Šè°ƒç”¨å…¶splitæ–¹æ³•ã€‚ä½ å¯ä»¥ç”¨re.compileè‡ªå·±ç¼–è¯‘regexä»¥å¾—åˆ°ä¸€ä¸ªå¯é‡ç”¨çš„regexå¯¹è±¡ï¼š
```python
In [151]: regex = re.compile('\s+')

In [152]: regex.split(text)
Out[152]: ['foo', 'bar', 'baz', 'qux']
```

å¦‚æœåªå¸Œæœ›å¾—åˆ°åŒ¹é…regexçš„æ‰€æœ‰æ¨¡å¼ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ `findall` æ–¹æ³•ï¼š
```python
In [153]: regex.findall(text)
Out[153]: ['    ', '\t ', '  \t']
```

>å¦‚æœæƒ³é¿å…æ­£åˆ™è¡¨è¾¾å¼ä¸­ä¸éœ€è¦çš„è½¬ä¹‰ï¼ˆ\ï¼‰ï¼Œåˆ™å¯ä»¥ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢é‡å¦‚ `r'C:\x'`ï¼ˆä¹Ÿå¯ä»¥ç¼–å†™å…¶ç­‰ä»·å¼  `'C:\\x'`ï¼‰ã€‚

å¦‚æœæ‰“ç®—å¯¹è®¸å¤šå­—ç¬¦ä¸²åº”ç”¨åŒä¸€æ¡æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¼ºçƒˆå»ºè®®é€šè¿‡re.compileåˆ›å»ºregexå¯¹è±¡ã€‚è¿™æ ·å°†å¯ä»¥èŠ‚çœå¤§é‡çš„CPUæ—¶é—´ã€‚

matchå’Œsearchè·ŸfindallåŠŸèƒ½ç±»ä¼¼ã€‚**findallè¿”å›çš„æ˜¯å­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„åŒ¹é…é¡¹ï¼Œè€Œsearchåˆ™åªè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ã€‚matchæ›´åŠ ä¸¥æ ¼ï¼Œå®ƒåªåŒ¹é…å­—ç¬¦ä¸²çš„é¦–éƒ¨**ã€‚æ¥çœ‹ä¸€ä¸ªå°ä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€æ®µæ–‡æœ¬ä»¥åŠä¸€æ¡èƒ½å¤Ÿè¯†åˆ«å¤§éƒ¨åˆ†ç”µå­é‚®ä»¶åœ°å€çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š
```python
text = """Dave dave@google.com
Steve steve@gmail.com
Rob rob@gmail.com
Ryan ryan@yahoo.com
"""
pattern = r'[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}'

# re.IGNORECASE makes the regex case-insensitive
regex = re.compile(pattern, flags=re.IGNORECASE)
```

å¯¹textä½¿ç”¨findallå°†å¾—åˆ°ä¸€ç»„ç”µå­é‚®ä»¶åœ°å€ï¼š
```python
In [155]: regex.findall(text)
Out[155]: 
['dave@google.com',
 'steve@gmail.com',
 'rob@gmail.com',
 'ryan@yahoo.com']
```

searchè¿”å›çš„æ˜¯æ–‡æœ¬ä¸­ç¬¬ä¸€ä¸ªç”µå­é‚®ä»¶åœ°å€ï¼ˆä»¥ç‰¹æ®Šçš„åŒ¹é…é¡¹å¯¹è±¡å½¢å¼è¿”å›ï¼‰ã€‚å¯¹äºä¸Šé¢é‚£ä¸ªregexï¼ŒåŒ¹é…é¡¹å¯¹è±¡åªèƒ½å‘Šè¯‰æˆ‘ä»¬æ¨¡å¼åœ¨åŸå­—ç¬¦ä¸²ä¸­çš„èµ·å§‹å’Œç»“æŸä½ç½®ï¼š
```python
In [156]: m = regex.search(text)

In [157]: m
Out[157]: <_sre.SRE_Match object; span=(5, 20), match='dave@google.com'>

In [158]: text[m.start():m.end()]
Out[158]: 'dave@google.com'
```

regex.matchåˆ™å°†è¿”å›Noneï¼Œå› ä¸ºå®ƒåªåŒ¹é…å‡ºç°åœ¨å­—ç¬¦ä¸²å¼€å¤´çš„æ¨¡å¼ï¼š
```python
In [159]: print(regex.match(text))
None
```

ç›¸å…³çš„ï¼Œ`sub`æ–¹æ³•å¯ä»¥å°†åŒ¹é…åˆ°çš„æ¨¡å¼æ›¿æ¢ä¸ºæŒ‡å®šå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›æ‰€å¾—åˆ°çš„æ–°å­—ç¬¦ä¸²ï¼š
```python
In [160]: print(regex.sub('REDACTED', text))
Dave REDACTED
Steve REDACTED
Rob REDACTED
Ryan REDACTED
```

å‡è®¾ä½ ä¸ä»…æƒ³è¦æ‰¾å‡ºç”µå­é‚®ä»¶åœ°å€ï¼Œè¿˜æƒ³å°†å„ä¸ªåœ°å€åˆ†æˆ3ä¸ªéƒ¨åˆ†ï¼šç”¨æˆ·åã€åŸŸåä»¥åŠåŸŸåç¼€ã€‚è¦å®ç°æ­¤åŠŸèƒ½ï¼Œåªéœ€å°†å¾…åˆ†æ®µçš„æ¨¡å¼çš„å„éƒ¨åˆ†ç”¨åœ†æ‹¬å·åŒ…èµ·æ¥å³å¯ï¼š
```python
In [161]: pattern = r'([A-Z0-9._%+-]+)@([A-Z0-9.-]+)\.([A-Z]{2,4})'

In [162]: regex = re.compile(pattern, flags=re.IGNORECASE)
```

ç”±è¿™ç§ä¿®æ”¹è¿‡çš„æ­£åˆ™è¡¨è¾¾å¼æ‰€äº§ç”Ÿçš„åŒ¹é…é¡¹å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡å…¶groupsæ–¹æ³•è¿”å›ä¸€ä¸ªç”±æ¨¡å¼å„æ®µç»„æˆçš„å…ƒç»„ï¼š
```python
In [163]: m = regex.match('wesm@bright.net')

In [164]: m.groups()
Out[164]: ('wesm', 'bright', 'net')
```

å¯¹äºå¸¦æœ‰åˆ†ç»„åŠŸèƒ½çš„æ¨¡å¼ï¼Œfindallä¼šè¿”å›ä¸€ä¸ªå…ƒç»„åˆ—è¡¨ï¼š
```python
In [165]: regex.findall(text)
Out[165]:
[('dave', 'google', 'com'),
 ('steve', 'gmail', 'com'),
 ('rob', 'gmail', 'com'),
 ('ryan', 'yahoo', 'com')]
```

subè¿˜èƒ½é€šè¿‡è¯¸å¦‚ `\1ã€\2` ä¹‹ç±»çš„ç‰¹æ®Šç¬¦å·è®¿é—®å„åŒ¹é…é¡¹ä¸­çš„åˆ†ç»„ã€‚ç¬¦å·` \1`å¯¹åº”ç¬¬ä¸€ä¸ªåŒ¹é…çš„ç»„ï¼Œ`\2`å¯¹åº”ç¬¬äºŒä¸ªåŒ¹é…çš„ç»„ï¼Œä»¥æ­¤ç±»æ¨ï¼š
```python
In [166]: print(regex.sub(r'Username: \1, Domain: \2, Suffix: \3', text))
Dave Username: dave, Domain: google, Suffix: com
Steve Username: steve, Domain: gmail, Suffix: com
Rob Username: rob, Domain: gmail, Suffix: com
Ryan Username: ryan, Domain: yahoo, Suffix: com
```

Pythonä¸­è¿˜æœ‰è®¸å¤šçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½†å¤§éƒ¨åˆ†éƒ½è¶…å‡ºäº†æœ¬ä¹¦çš„èŒƒå›´ã€‚è¡¨7-4æ˜¯ä¸€ä¸ªç®€è¦æ¦‚æ‹¬ã€‚

![](https://gitee.com/veal98/images/raw/master/img/20200614225204.png)

### 3. pandasçš„çŸ¢é‡åŒ–å­—ç¬¦ä¸²å‡½æ•°

æ¸…ç†å¾…åˆ†æçš„æ•£ä¹±æ•°æ®æ—¶ï¼Œå¸¸å¸¸éœ€è¦åšä¸€äº›å­—ç¬¦ä¸²è§„æ•´åŒ–å·¥ä½œã€‚æ›´ä¸ºå¤æ‚çš„æƒ…å†µæ˜¯ï¼Œå«æœ‰å­—ç¬¦ä¸²çš„åˆ—æœ‰æ—¶è¿˜å«æœ‰ç¼ºå¤±æ•°æ®ï¼š
```python
In [167]: data = {'Dave': 'dave@google.com', 'Steve': 'steve@gmail.com',
   .....:         'Rob': 'rob@gmail.com', 'Wes': np.nan}

In [168]: data = pd.Series(data)

In [169]: data
Out[169]: 
Dave     dave@google.com
Rob        rob@gmail.com
Steve    steve@gmail.com
Wes                  NaN
dtype: object

In [170]: data.isnull()
Out[170]: 
Dave     False
Rob      False
Steve    False
Wes       True
dtype: bool
```

é€šè¿‡data.mapï¼Œæ‰€æœ‰å­—ç¬¦ä¸²å’Œæ­£åˆ™è¡¨è¾¾å¼æ–¹æ³•éƒ½èƒ½è¢«åº”ç”¨äºï¼ˆä¼ å…¥lambdaè¡¨è¾¾å¼æˆ–å…¶ä»–å‡½æ•°ï¼‰å„ä¸ªå€¼ï¼Œä½†æ˜¯å¦‚æœå­˜åœ¨NAï¼ˆnullï¼‰å°±ä¼šæŠ¥é”™ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ**Seriesæœ‰ä¸€äº›èƒ½å¤Ÿè·³è¿‡NAå€¼çš„é¢å‘æ•°ç»„æ–¹æ³•ï¼Œè¿›è¡Œå­—ç¬¦ä¸²æ“ä½œ**ã€‚é€šè¿‡Seriesçš„strå±æ€§å³å¯è®¿é—®è¿™äº›æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`str.contains`æ£€æŸ¥å„ä¸ªç”µå­é‚®ä»¶åœ°å€æ˜¯å¦å«æœ‰"gmail"ï¼š
```python
In [171]: data.str.contains('gmail')
Out[171]: 
Dave     False
Rob       True
Steve     True
Wes        NaN
dtype: object
```

ä¹Ÿå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿˜å¯ä»¥åŠ ä¸Šä»»æ„reé€‰é¡¹ï¼ˆå¦‚IGNORECASEï¼‰ï¼š
```python
In [172]: pattern
Out[172]: '([A-Z0-9._%+-]+)@([A-Z0-9.-]+)\\.([A-Z]{2,4})'

In [173]: data.str.findall(pattern, flags=re.IGNORECASE)
Out[173]: 
Dave     [(dave, google, com)]
Rob        [(rob, gmail, com)]
Steve    [(steve, gmail, com)]
Wes                        NaN
dtype: object
```

â­ **æœ‰ä¸¤ä¸ªåŠæ³•å¯ä»¥å®ç°çŸ¢é‡åŒ–çš„å…ƒç´ è·å–æ“ä½œï¼šè¦ä¹ˆä½¿ç”¨`str.get`ï¼Œè¦ä¹ˆåœ¨strå±æ€§ä¸Šä½¿ç”¨ç´¢å¼•**ï¼š
```python
In [174]: matches = data.str.match(pattern, flags=re.IGNORECASE)

In [175]: matches
Out[175]: 
Dave     True
Rob      True
Steve    True
Wes       NaN
dtype: object
```

è¦è®¿é—®åµŒå…¥åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ é€’ç´¢å¼•åˆ°è¿™ä¸¤ä¸ªå‡½æ•°ä¸­ï¼š
```python
In [176]: matches.str.get(1)
Out[176]: 
Dave    NaN
Rob     NaN
Steve   NaN
Wes     NaN
dtype: float64

In [177]: matches.str[0]
Out[177]: 
Dave    NaN
Rob     NaN
Steve   NaN
Wes     NaN
dtype: float64
```

ä½ å¯ä»¥åˆ©ç”¨è¿™ç§æ–¹æ³•å¯¹å­—ç¬¦ä¸²è¿›è¡Œæˆªå–ï¼š
```python
In [178]: data.str[:5]
Out[178]: 
Dave     dave@
Rob      rob@g
Steve    steve
Wes        NaN
dtype: object
```

ä¸‹è¡¨ä»‹ç»äº†æ›´å¤šçš„pandaså­—ç¬¦ä¸²æ–¹æ³•ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200614225504.png)


 ## âœ… End

é«˜æ•ˆçš„æ•°æ®å‡†å¤‡å¯ä»¥è®©ä½ å°†æ›´å¤šçš„æ—¶é—´ç”¨äºæ•°æ®åˆ†æï¼ŒèŠ±è¾ƒå°‘çš„æ—¶é—´ç”¨äºå‡†å¤‡å·¥ä½œï¼Œè¿™æ ·å°±å¯ä»¥æå¤§åœ°æé«˜ç”Ÿäº§åŠ›ã€‚æˆ‘ä»¬åœ¨æœ¬ç« ä¸­å­¦ä¹ äº†è®¸å¤šå·¥å…·ï¼Œä½†è¦†ç›–å¹¶ä¸å…¨é¢ã€‚ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬ä¼šå­¦ä¹  pandas çš„èšåˆä¸åˆ†ç»„ã€‚

---

# ğŸ“š References

- ğŸ“•  [ã€Šåˆ©ç”¨Pythonè¿›è¡Œæ•°æ®åˆ†æ-ç¬¬2ç‰ˆ-ä¸­æ–‡è¯‘ç‰ˆã€‹](https://www.jianshu.com/p/04d180d90a3f)

  <img src="https://gitee.com/veal98/images/raw/master/img/20200607091609.png" style="zoom:50%;" />

- ğŸš [Gihubã€ŠPythonæ•°æ®åˆ†æã€‹é…å¥—æºç ](https://github.com/wesm/pydata-book)