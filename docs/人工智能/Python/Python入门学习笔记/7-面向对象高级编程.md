# ğŸ‘  é¢å‘å¯¹è±¡é«˜çº§ç¼–ç¨‹

---



æ•°æ®å°è£…ã€ç»§æ‰¿å’Œå¤šæ€åªæ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­æœ€åŸºç¡€çš„3ä¸ªæ¦‚å¿µã€‚åœ¨Pythonä¸­ï¼Œé¢å‘å¯¹è±¡è¿˜æœ‰å¾ˆå¤šé«˜çº§ç‰¹æ€§ï¼Œå…è®¸æˆ‘ä»¬å†™å‡ºéå¸¸å¼ºå¤§çš„åŠŸèƒ½ã€‚

æˆ‘ä»¬ä¼šè®¨è®ºå¤šé‡ç»§æ‰¿ã€å®šåˆ¶ç±»ã€å…ƒç±»ç­‰æ¦‚å¿µã€‚

## 1. ä½¿ç”¨ `__slots__`

### â‘  åŠ¨æ€ç»‘å®š

æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªclassï¼Œåˆ›å»ºäº†ä¸€ä¸ªclassçš„å®ä¾‹åï¼Œæˆ‘ä»¬å¯ä»¥ç»™è¯¥å®ä¾‹ç»‘å®šä»»ä½•å±æ€§å’Œæ–¹æ³•ï¼Œè¿™å°±æ˜¯åŠ¨æ€è¯­è¨€çš„çµæ´»æ€§ã€‚å…ˆå®šä¹‰classï¼š

```python
class Student(object):
    pass
```

ç„¶åï¼Œå°è¯•ç»™å®ä¾‹ç»‘å®šä¸€ä¸ªå±æ€§ï¼š

```python
s = Student()
s.name = 'Michael' # åŠ¨æ€ç»™å®ä¾‹ç»‘å®šä¸€ä¸ªå±æ€§
print(s.name) # Michael
```

è¿˜å¯ä»¥å°è¯•ç»™å®ä¾‹ç»‘å®šä¸€ä¸ªæ–¹æ³•ï¼š

```python
def set_age(self, age): # å®šä¹‰ä¸€ä¸ªå‡½æ•°ä½œä¸ºå®ä¾‹æ–¹æ³•
     self.age = age

from types import MethodType
s.set_age = MethodType(set_age, s) # ç»™å®ä¾‹ç»‘å®šä¸€ä¸ªæ–¹æ³•
s.set_age(25) # è°ƒç”¨å®ä¾‹æ–¹æ³•
print(s.age) # æµ‹è¯•ç»“æœ 25
```

ä½†æ˜¯ï¼Œç»™ä¸€ä¸ªå®ä¾‹ç»‘å®šçš„æ–¹æ³•ï¼Œå¯¹å¦ä¸€ä¸ªå®ä¾‹æ˜¯ä¸èµ·ä½œç”¨çš„ï¼š

```python
s2 = Student() # åˆ›å»ºæ–°çš„å®ä¾‹
s2.set_age(25) # å°è¯•è°ƒç”¨æ–¹æ³•
# Traceback (most recent call last):
#   File "<stdin>", line 1, in <module>
# AttributeError: 'Student' object has no attribute 'set_age'
```

ä¸ºäº†ç»™æ‰€æœ‰å®ä¾‹éƒ½ç»‘å®šæ–¹æ³•ï¼Œ**å¯ä»¥ç»™ class ç»‘å®šæ–¹æ³•**ï¼š

```python
def set_score(self, score):
     self.score = score

Student.set_score = set_score
```

ç»™classç»‘å®šæ–¹æ³•åï¼Œæ‰€æœ‰å®ä¾‹å‡å¯è°ƒç”¨ï¼š

```python
s.set_score(100)
print(s.score) # 100
s2.set_score(99)
print(s2.score) # 99
```

é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸Šé¢çš„`set_score`æ–¹æ³•å¯ä»¥ç›´æ¥å®šä¹‰åœ¨classä¸­ï¼Œä½†åŠ¨æ€ç»‘å®šå…è®¸æˆ‘ä»¬åœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­åŠ¨æ€ç»™classåŠ ä¸ŠåŠŸèƒ½ï¼Œè¿™åœ¨é™æ€è¯­è¨€ä¸­å¾ˆéš¾å®ç°ã€‚

### â‘¡ ä½¿ç”¨ `__slots__`é™åˆ¶å®ä¾‹å±æ€§

ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦é™åˆ¶å®ä¾‹çš„å±æ€§æ€ä¹ˆåŠï¼Ÿæ¯”å¦‚ï¼Œåªå…è®¸å¯¹Studentå®ä¾‹æ·»åŠ `name`å’Œ`age`å±æ€§ã€‚

ä¸ºäº†è¾¾åˆ°é™åˆ¶çš„ç›®çš„ï¼ŒPythonå…è®¸åœ¨å®šä¹‰classçš„æ—¶å€™ï¼Œå®šä¹‰ä¸€ä¸ªç‰¹æ®Šçš„`__slots__`å˜é‡ï¼Œæ¥é™åˆ¶è¯¥classå®ä¾‹èƒ½æ·»åŠ çš„å±æ€§ï¼š

```python
class Student(object):
    __slots__ = ('name', 'age') # ç”¨tupleå®šä¹‰å…è®¸ç»‘å®šçš„å±æ€§åç§°
```

ç„¶åï¼Œæˆ‘ä»¬è¯•è¯•ï¼š

```python
s = Student() # åˆ›å»ºæ–°çš„å®ä¾‹
s.name = 'Michael' # ç»‘å®šå±æ€§'name'
s.age = 25 # ç»‘å®šå±æ€§'age'
s.score = 99 # ç»‘å®šå±æ€§'score'
# Traceback (most recent call last):
#   File "<stdin>", line 1, in <module>
# AttributeError: 'Student' object has no attribute 'score'
```

ç”±äº`'score'`æ²¡æœ‰è¢«æ”¾åˆ°`__slots__`ä¸­ï¼Œæ‰€ä»¥ä¸èƒ½ç»‘å®š`score`å±æ€§ï¼Œè¯•å›¾ç»‘å®š`score`å°†å¾—åˆ°`AttributeError`çš„é”™è¯¯ã€‚

ä½¿ç”¨`__slots__`è¦æ³¨æ„ï¼Œ`__slots__`å®šä¹‰çš„å±æ€§ä»…å¯¹å½“å‰ç±»å®ä¾‹èµ·ä½œç”¨ï¼Œå¯¹ç»§æ‰¿çš„å­ç±»æ˜¯ä¸èµ·ä½œç”¨çš„ï¼š

```python
class GraduateStudent(Student):
     pass

g = GraduateStudent()
g.score = 9999
```

é™¤éåœ¨å­ç±»ä¸­ä¹Ÿå®šä¹‰`__slots__`ï¼Œè¿™æ ·ï¼Œå­ç±»å®ä¾‹å…è®¸å®šä¹‰çš„å±æ€§å°±æ˜¯è‡ªèº«çš„`__slots__`åŠ ä¸Šçˆ¶ç±»çš„`__slots__`ã€‚

## 2. ä½¿ç”¨ @property

åœ¨ç»‘å®šå±æ€§æ—¶ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥æŠŠå±æ€§æš´éœ²å‡ºå»ï¼Œè™½ç„¶å†™èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯ï¼Œæ²¡åŠæ³•æ£€æŸ¥å‚æ•°ï¼Œå¯¼è‡´å¯ä»¥æŠŠæˆç»©éšä¾¿æ”¹ï¼š

```python
s = Student()
s.score = 9999
```

è¿™æ˜¾ç„¶ä¸åˆé€»è¾‘ã€‚ä¸ºäº†é™åˆ¶scoreçš„èŒƒå›´ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ª`set_score()`æ–¹æ³•æ¥è®¾ç½®æˆç»©ï¼Œå†é€šè¿‡ä¸€ä¸ª`get_score()`æ¥è·å–æˆç»©ï¼Œè¿™æ ·ï¼Œåœ¨`set_score()`æ–¹æ³•é‡Œï¼Œå°±å¯ä»¥æ£€æŸ¥å‚æ•°ï¼š

```python
class Student(object):

    def get_score(self):
         return self._score

    def set_score(self, value):
        if not isinstance(value, int):
            raise ValueError('score must be an integer!')
        if value < 0 or value > 100:
            raise ValueError('score must between 0 ~ 100!')
        self._score = value
```

ç°åœ¨ï¼Œå¯¹ä»»æ„çš„Studentå®ä¾‹è¿›è¡Œæ“ä½œï¼Œå°±ä¸èƒ½éšå¿ƒæ‰€æ¬²åœ°è®¾ç½®scoreäº†ï¼š

```python
s = Student()
s.set_score(60) # ok!
s.get_score() # 60
s.set_score(9999)
# Traceback (most recent call last):
#   ...
# ValueError: score must between 0 ~ 100!
```

ä½†æ˜¯ï¼Œä¸Šé¢çš„è°ƒç”¨æ–¹æ³•åˆç•¥æ˜¾å¤æ‚ï¼Œæ²¡æœ‰ç›´æ¥ç”¨å±æ€§è¿™ä¹ˆç›´æ¥ç®€å•ã€‚

â“ <u>æœ‰æ²¡æœ‰æ—¢èƒ½æ£€æŸ¥å‚æ•°ï¼Œåˆå¯ä»¥ç”¨ç±»ä¼¼å±æ€§è¿™æ ·ç®€å•çš„æ–¹å¼æ¥è®¿é—®ç±»çš„å˜é‡å‘¢ï¼Ÿ</u>

è¿˜è®°å¾—è£…é¥°å™¨ï¼ˆdecoratorï¼‰å¯ä»¥ç»™å‡½æ•°åŠ¨æ€åŠ ä¸ŠåŠŸèƒ½å—ï¼Ÿå¯¹äºç±»çš„æ–¹æ³•ï¼Œè£…é¥°å™¨ä¸€æ ·èµ·ä½œç”¨**ã€‚Pythonå†…ç½®çš„`@property`è£…é¥°å™¨å°±æ˜¯è´Ÿè´£æŠŠä¸€ä¸ªæ–¹æ³•å˜æˆå±æ€§è°ƒç”¨çš„**ï¼š

```python
class Student(object):

    @property
    def score(self):
        return self._score

    @score.setter
    def score(self, value):
        if not isinstance(value, int):
            raise ValueError('score must be an integer!')
        if value < 0 or value > 100:
            raise ValueError('score must between 0 ~ 100!')
        self._score = value
```

`@property`çš„å®ç°æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬å…ˆè€ƒå¯Ÿå¦‚ä½•ä½¿ç”¨ã€‚æŠŠä¸€ä¸ªgetteræ–¹æ³•å˜æˆå±æ€§ï¼Œåªéœ€è¦åŠ ä¸Š`@property`å°±å¯ä»¥äº†ï¼Œæ­¤æ—¶ï¼Œ`@property`æœ¬èº«åˆåˆ›å»ºäº†å¦ä¸€ä¸ªè£…é¥°å™¨`@score.setter`ï¼Œè´Ÿè´£æŠŠä¸€ä¸ªsetteræ–¹æ³•å˜æˆå±æ€§èµ‹å€¼ï¼Œäºæ˜¯ï¼Œæˆ‘ä»¬å°±æ‹¥æœ‰ä¸€ä¸ªå¯æ§çš„å±æ€§æ“ä½œï¼š

```python
s = Student()
s.score = 60 # OKï¼Œå®é™…è½¬åŒ–ä¸ºs.set_score(60)
s.score # OKï¼Œå®é™…è½¬åŒ–ä¸ºs.get_score() 60
s.score = 9999
# Traceback (most recent call last):
#   ...
# ValueError: score must between 0 ~ 100!
```

æ³¨æ„åˆ°è¿™ä¸ªç¥å¥‡çš„`@property`ï¼Œæˆ‘ä»¬åœ¨å¯¹å®ä¾‹å±æ€§æ“ä½œçš„æ—¶å€™ï¼Œå°±çŸ¥é“è¯¥å±æ€§å¾ˆå¯èƒ½ä¸æ˜¯ç›´æ¥æš´éœ²çš„ï¼Œè€Œæ˜¯é€šè¿‡getterå’Œsetteræ–¹æ³•æ¥å®ç°çš„ã€‚

è¿˜å¯ä»¥å®šä¹‰åªè¯»å±æ€§ï¼Œåªå®šä¹‰getteræ–¹æ³•ï¼Œä¸å®šä¹‰setteræ–¹æ³•å°±æ˜¯ä¸€ä¸ªåªè¯»å±æ€§ï¼š

```python
class Student(object):

    @property
    def birth(self):
        return self._birth

    @birth.setter
    def birth(self, value):
        self._birth = value

    @property
    def age(self):
        return 2015 - self._birth
```

ä¸Šé¢çš„`birth`æ˜¯å¯è¯»å†™å±æ€§ï¼Œè€Œ`age`å°±æ˜¯ä¸€ä¸ª*åªè¯»*å±æ€§ï¼Œå› ä¸º`age`å¯ä»¥æ ¹æ®`birth`å’Œå½“å‰æ—¶é—´è®¡ç®—å‡ºæ¥ã€‚

<br>

`@property` ä»£ç å®ä¾‹ï¼š

è¯·åˆ©ç”¨`@property`ç»™ä¸€ä¸ª`Screen`å¯¹è±¡åŠ ä¸Š`width`å’Œ`height`å±æ€§ï¼Œä»¥åŠä¸€ä¸ªåªè¯»å±æ€§`resolution`ï¼š

```python
class Screen(object):
    @property
    def width(self):
        return self._width

    @width.setter
    def width(self,width):
        self._width = width
    
    @property
    def height(self):
        return self._height

    @height.setter
    def height(self,height):
        self._height = height

    @property
    def resolution(self):
        return self._width * self._height

# æµ‹è¯•:
s = Screen()
s.width = 1024
s.height = 768
print('resolution =', s.resolution)
if s.resolution == 786432:
    print('æµ‹è¯•é€šè¿‡!')
else:
    print('æµ‹è¯•å¤±è´¥!')
```



## 3. å¤šé‡ç»§æ‰¿

### â‘  å¤šé‡ç»§æ‰¿

ğŸ”´ **å¤šé‡ç»§æ‰¿ï¼šå³ä¸€ä¸ªå­ç±»ç»§æ‰¿å¤šä¸ªçˆ¶ç±»**

ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```python
class Animal(object):
    pass

# å“ºä¹³ç±»:
class Mammal(Animal):
    pass
# é¸Ÿç±»
class Bird(Animal):
    pass

# å„ç§åŠ¨ç‰©:
class Dog(Mammal):
    pass

class Bat(Mammal):
    pass
```

ç°åœ¨ï¼Œæˆ‘ä»¬è¦ç»™åŠ¨ç‰©å†åŠ ä¸Š`Runnable`å’Œ`Flyable`çš„åŠŸèƒ½ï¼Œåªéœ€è¦å…ˆå®šä¹‰å¥½`Runnable`å’Œ`Flyable`çš„ç±»ï¼š

```python
class Runnable(object):
    def run(self):
        print('Running...')

class Flyable(object):
    def fly(self):
        print('Flying...')
```

å¯¹äºéœ€è¦`Runnable`åŠŸèƒ½çš„åŠ¨ç‰©ï¼Œå°±å¤šç»§æ‰¿ä¸€ä¸ª`Runnable`ï¼Œä¾‹å¦‚`Dog`ï¼š

```python
class Dog(Mammal, Runnable):
    pass
```

å¯¹äºéœ€è¦`Flyable`åŠŸèƒ½çš„åŠ¨ç‰©ï¼Œå°±å¤šç»§æ‰¿ä¸€ä¸ª`Flyable`ï¼Œä¾‹å¦‚`Bat`ï¼š

```python
class Bat(Mammal, Flyable):
    pass
```

### â‘¡ MixIn

åœ¨è®¾è®¡ç±»çš„ç»§æ‰¿å…³ç³»æ—¶ï¼Œé€šå¸¸ï¼Œä¸»çº¿éƒ½æ˜¯å•ä¸€ç»§æ‰¿ä¸‹æ¥çš„ï¼Œä¾‹å¦‚ï¼Œ`Ostrich`ç»§æ‰¿è‡ª`Bird`ã€‚ä½†æ˜¯ï¼Œå¦‚æœéœ€è¦â€œæ··å…¥â€é¢å¤–çš„åŠŸèƒ½ï¼Œé€šè¿‡å¤šé‡ç»§æ‰¿å°±å¯ä»¥å®ç°ï¼Œæ¯”å¦‚ï¼Œè®©`Ostrich`é™¤äº†ç»§æ‰¿è‡ª`Bird`å¤–ï¼Œå†åŒæ—¶ç»§æ‰¿`Runnable`ã€‚**è¿™ç§è®¾è®¡é€šå¸¸ç§°ä¹‹ä¸º MixInã€‚**

ä¸ºäº†æ›´å¥½åœ°çœ‹å‡ºç»§æ‰¿å…³ç³»ï¼Œæˆ‘ä»¬æŠŠ`Runnable`å’Œ`Flyable`æ”¹ä¸º`RunnableMixIn`å’Œ`FlyableMixIn`ã€‚ç±»ä¼¼çš„ï¼Œä½ è¿˜å¯ä»¥å®šä¹‰å‡ºè‚‰é£ŸåŠ¨ç‰©`CarnivorousMixIn`å’Œæ¤é£ŸåŠ¨ç‰©`HerbivoresMixIn`ï¼Œè®©æŸä¸ªåŠ¨ç‰©åŒæ—¶æ‹¥æœ‰å¥½å‡ ä¸ªMixInï¼š

```python
class Dog(Mammal, RunnableMixIn, CarnivorousMixIn):
    pass
```

MixIn çš„ç›®çš„å°±æ˜¯ç»™ä¸€ä¸ªç±»å¢åŠ å¤šä¸ªåŠŸèƒ½ï¼Œè¿™æ ·ï¼Œåœ¨è®¾è®¡ç±»çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼˜å…ˆè€ƒè™‘é€šè¿‡å¤šé‡ç»§æ‰¿æ¥ç»„åˆå¤šä¸ª MixIn çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯è®¾è®¡å¤šå±‚æ¬¡çš„å¤æ‚çš„ç»§æ‰¿å…³ç³»ã€‚

## 4. å®šåˆ¶ç±»

çœ‹åˆ°ç±»ä¼¼`__slots__`è¿™ç§å½¢å¦‚`__xxx__`çš„å˜é‡æˆ–è€…å‡½æ•°åå°±è¦æ³¨æ„ï¼Œè¿™äº›åœ¨Pythonä¸­æ˜¯æœ‰ç‰¹æ®Šç”¨é€”çš„ã€‚

`__slots__`æˆ‘ä»¬å·²ç»çŸ¥é“æ€ä¹ˆç”¨äº†ï¼Œ`__len__()`æ–¹æ³•æˆ‘ä»¬ä¹ŸçŸ¥é“æ˜¯ä¸ºäº†èƒ½è®©classä½œç”¨äº`len()`å‡½æ•°ã€‚

é™¤æ­¤ä¹‹å¤–ï¼ŒPythonçš„classä¸­è¿˜æœ‰è®¸å¤šè¿™æ ·æœ‰ç‰¹æ®Šç”¨é€”çš„å‡½æ•°ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®šåˆ¶ç±»ã€‚

### â‘  `__str__`

æˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ª`Student`ç±»ï¼Œæ‰“å°ä¸€ä¸ªå®ä¾‹ï¼š

```python
class Student(object):
     def __init__(self, name):
         self.name = name

print(Student('Michael'))
# <__main__.Student object at 0x109afb190>
```

æ‰“å°å‡ºä¸€å †`<__main__.Student object at 0x109afb190>`ï¼Œä¸å¥½çœ‹ã€‚

æ€ä¹ˆæ‰èƒ½æ‰“å°å¾—å¥½çœ‹å‘¢ï¼Ÿåªéœ€è¦å®šä¹‰å¥½`__str__()`æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªå¥½çœ‹çš„å­—ç¬¦ä¸²å°±å¯ä»¥äº†ï¼š

```python
class Student(object):
     def __init__(self, name):
         self.name = name
     def __str__(self):
         return 'Student object (name: %s)' % self.name

print(Student('Michael'))
# Student object (name: Michael)
```

è¿™æ ·æ‰“å°å‡ºæ¥çš„å®ä¾‹ï¼Œä¸ä½†å¥½çœ‹ï¼Œè€Œä¸”å®¹æ˜“çœ‹å‡ºå®ä¾‹å†…éƒ¨é‡è¦çš„æ•°æ®ã€‚

ä½†æ˜¯ç»†å¿ƒçš„æœ‹å‹ä¼šå‘ç°ç›´æ¥æ•²å˜é‡ä¸ç”¨`print`ï¼Œæ‰“å°å‡ºæ¥çš„å®ä¾‹è¿˜æ˜¯ä¸å¥½çœ‹ï¼š

```python
s = Student('Michael')
s
# <__main__.Student object at 0x109afb310>
```

è¿™æ˜¯å› ä¸ºç›´æ¥æ˜¾ç¤ºå˜é‡è°ƒç”¨çš„ä¸æ˜¯`__str__()`ï¼Œè€Œæ˜¯`__repr__()`ï¼Œä¸¤è€…çš„åŒºåˆ«æ˜¯`__str__()`è¿”å›ç”¨æˆ·çœ‹åˆ°çš„å­—ç¬¦ä¸²ï¼Œè€Œ`__repr__()`è¿”å›ç¨‹åºå¼€å‘è€…çœ‹åˆ°çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ`__repr__()`æ˜¯ä¸ºè°ƒè¯•æœåŠ¡çš„ã€‚

è§£å†³åŠæ³•æ˜¯å†å®šä¹‰ä¸€ä¸ª`__repr__()`ã€‚ä½†æ˜¯é€šå¸¸`__str__()`å’Œ`__repr__()`ä»£ç éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ï¼Œæœ‰ä¸ªå·æ‡’çš„å†™æ³•ï¼š

```python
class Student(object):
    def __init__(self, name):
        self.name = name
    def __str__(self):
        return 'Student object (name=%s)' % self.name
    __repr__ = __str__
```

### â‘¡ `__iter__`

å¦‚æœä¸€ä¸ªç±»æƒ³è¢«ç”¨äº`for ... in`å¾ªç¯ï¼Œç±»ä¼¼ list æˆ– tuple é‚£æ ·ï¼Œå°±å¿…é¡»å®ç°ä¸€ä¸ª`__iter__()`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªè¿­ä»£å¯¹è±¡ï¼Œç„¶åï¼ŒPython çš„ for å¾ªç¯å°±ä¼šä¸æ–­è°ƒç”¨è¯¥è¿­ä»£å¯¹è±¡çš„`__next__()`æ–¹æ³•æ‹¿åˆ°å¾ªç¯çš„ä¸‹ä¸€ä¸ªå€¼ï¼Œç›´åˆ°é‡åˆ°`StopIteration`é”™è¯¯æ—¶é€€å‡ºå¾ªç¯ã€‚

æˆ‘ä»¬ä»¥æ–æ³¢é‚£å¥‘æ•°åˆ—ä¸ºä¾‹ï¼Œå†™ä¸€ä¸ªFibç±»ï¼Œå¯ä»¥ä½œç”¨äºforå¾ªç¯ï¼š

```python
class Fib(object):
    def __init__(self):
        self.a, self.b = 0, 1

    def __iter__(self):
        return self

    def __next__(self):
        self.a , self.b = self.b, self.a + self.b
        if self.a > 10:
            raise StopIteration()
        return self.a # è¿”å›ä¸‹ä¸€ä¸ªå€¼

for n in Fib():
    print(n)
```

> è¾“å‡ºï¼š
>
> 1
> 1
> 2
> 3
> 5
> 8

### â‘¢ `__getitem__`

Fibå®ä¾‹è™½ç„¶èƒ½ä½œç”¨äºforå¾ªç¯ï¼Œçœ‹èµ·æ¥å’Œlistæœ‰ç‚¹åƒï¼Œä½†æ˜¯ï¼ŒæŠŠå®ƒå½“æˆlistæ¥ä½¿ç”¨è¿˜æ˜¯ä¸è¡Œï¼Œæ¯”å¦‚ï¼Œå–ç¬¬5ä¸ªå…ƒç´ ï¼š

```python
Fib()[5]
# Traceback (most recent call last):
#   File "<stdin>", line 1, in <module>
# TypeError: 'Fib' object does not support indexing
```

è¦è¡¨ç°å¾—åƒlisté‚£æ ·æŒ‰ç…§ä¸‹æ ‡å–å‡ºå…ƒç´ ï¼Œéœ€è¦å®ç°`__getitem__()`æ–¹æ³•ï¼š

```python
class Fib(object):
    def __getitem__(self, n):
        a, b = 1, 1
        for x in range(n):
            a, b = b, a + b
        return a
```

ç°åœ¨ï¼Œå°±å¯ä»¥æŒ‰ä¸‹æ ‡è®¿é—®æ•°åˆ—çš„ä»»æ„ä¸€é¡¹äº†ï¼š

```python
f = Fib()
f[0] # 1
f[1] # 1
f[2] # 2
f[3] # 3
```

ä½†æ˜¯listæœ‰ä¸ªç¥å¥‡çš„åˆ‡ç‰‡æ–¹æ³•ï¼š

```python
list(range(100))[5:10] # [5, 6, 7, 8, 9]
```

å¯¹äºFibå´æŠ¥é”™ã€‚åŸå› æ˜¯`__getitem__()`ä¼ å…¥çš„å‚æ•°å¯èƒ½æ˜¯ä¸€ä¸ªintï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªåˆ‡ç‰‡å¯¹è±¡`slice`ï¼Œæ‰€ä»¥è¦åšåˆ¤æ–­ï¼š

```python
class Fib(object):
    def __getitem__(self, n):
        if isinstance(n, int): # næ˜¯ç´¢å¼•
            a, b = 1, 1
            for x in range(n):
                a, b = b, a + b
            return a
        if isinstance(n, slice): # næ˜¯åˆ‡ç‰‡
            start = n.start
            stop = n.stop
            if start is None:
                start = 0
            a, b = 1, 1
            L = []
            for x in range(stop):
                if x >= start:
                    L.append(a)
                a, b = b, a + b
            return L
```

ç°åœ¨è¯•è¯•Fibçš„åˆ‡ç‰‡ï¼š

```python
f = Fib()
f[0:5] # [1, 1, 2, 3, 5]
f[:10] # [1, 1, 2, 3, 5, 8, 13, 21, 34, 55]
```

ä½†æ˜¯æ²¡æœ‰å¯¹stepå‚æ•°ä½œå¤„ç†ï¼š

```python
f[:10:2] # [1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89]
```

ä¹Ÿæ²¡æœ‰å¯¹è´Ÿæ•°ä½œå¤„ç†ï¼Œæ‰€ä»¥ï¼Œè¦æ­£ç¡®å®ç°ä¸€ä¸ª`__getitem__()`è¿˜æ˜¯æœ‰å¾ˆå¤šå·¥ä½œè¦åšçš„ã€‚

æ­¤å¤–ï¼Œå¦‚æœæŠŠå¯¹è±¡çœ‹æˆ`dict`ï¼Œ`__getitem__()`çš„å‚æ•°ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªå¯ä»¥ä½œkeyçš„objectï¼Œä¾‹å¦‚`str`ã€‚

ä¸ä¹‹å¯¹åº”çš„æ˜¯`__setitem__()`æ–¹æ³•ï¼ŒæŠŠå¯¹è±¡è§†ä½œlistæˆ–dictæ¥å¯¹é›†åˆèµ‹å€¼ã€‚æœ€åï¼Œè¿˜æœ‰ä¸€ä¸ª`__delitem__()`æ–¹æ³•ï¼Œç”¨äºåˆ é™¤æŸä¸ªå…ƒç´ ã€‚

æ€»ä¹‹ï¼Œé€šè¿‡ä¸Šé¢çš„æ–¹æ³•ï¼Œæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç±»è¡¨ç°å¾—å’ŒPythonè‡ªå¸¦çš„listã€tupleã€dictæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œè¿™å®Œå…¨å½’åŠŸäºåŠ¨æ€è¯­è¨€çš„â€œé¸­å­ç±»å‹â€ï¼Œä¸éœ€è¦å¼ºåˆ¶ç»§æ‰¿æŸä¸ªæ¥å£ã€‚

### â‘£ `__getattr__`

æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ç±»çš„æ–¹æ³•æˆ–å±æ€§æ—¶ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±ä¼šæŠ¥é”™ã€‚æ¯”å¦‚å®šä¹‰`Student`ç±»ï¼š

```python
class Student(object):
    
    def __init__(self):
        self.name = 'Michael'
```

è°ƒç”¨`name`å±æ€§ï¼Œæ²¡é—®é¢˜ï¼Œä½†æ˜¯ï¼Œè°ƒç”¨ä¸å­˜åœ¨çš„`score`å±æ€§ï¼Œå°±æœ‰é—®é¢˜äº†ï¼š

```python
s = Student()
print(s.name) # Michael
print(s.score)
# Traceback (most recent call last):
#   ...
# AttributeError: 'Student' object has no attribute 'score'
```

é”™è¯¯ä¿¡æ¯å¾ˆæ¸…æ¥šåœ°å‘Šè¯‰æˆ‘ä»¬ï¼Œæ²¡æœ‰æ‰¾åˆ°`score`è¿™ä¸ªattributeã€‚

è¦é¿å…è¿™ä¸ªé”™è¯¯ï¼Œé™¤äº†å¯ä»¥åŠ ä¸Šä¸€ä¸ª`score`å±æ€§å¤–ï¼ŒPythonè¿˜æœ‰å¦ä¸€ä¸ªæœºåˆ¶ï¼Œé‚£å°±æ˜¯å†™ä¸€ä¸ª`__getattr__()`æ–¹æ³•ï¼ŒåŠ¨æ€è¿”å›ä¸€ä¸ªå±æ€§ã€‚ä¿®æ”¹å¦‚ä¸‹ï¼š

```python
class Student(object):

    def __init__(self):
        self.name = 'Michael'

    def __getattr__(self, attr):
        if attr=='score':
            return 99
```

å½“è°ƒç”¨ä¸å­˜åœ¨çš„å±æ€§æ—¶ï¼Œæ¯”å¦‚`score`ï¼ŒPythonè§£é‡Šå™¨ä¼šè¯•å›¾è°ƒç”¨`__getattr__(self, 'score')`æ¥å°è¯•è·å¾—å±æ€§ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±æœ‰æœºä¼šè¿”å›`score`çš„å€¼ï¼š

```python
s = Student()
s.name # 'Michael'
s.score # 99
```

è¿”å›å‡½æ•°ä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„ï¼š

```python
class Student(object):

    def __getattr__(self, attr):
        if attr=='age':
            return lambda: 25
```

åªæ˜¯è°ƒç”¨æ–¹å¼è¦å˜ä¸ºï¼š

```python
s.age() # 25
```

æ³¨æ„ï¼Œåªæœ‰åœ¨æ²¡æœ‰æ‰¾åˆ°å±æ€§çš„æƒ…å†µä¸‹ï¼Œæ‰è°ƒç”¨`__getattr__`ï¼Œå·²æœ‰çš„å±æ€§ï¼Œæ¯”å¦‚`name`ï¼Œä¸ä¼šåœ¨`__getattr__`ä¸­æŸ¥æ‰¾ã€‚

æ­¤å¤–ï¼Œæ³¨æ„åˆ°ä»»æ„è°ƒç”¨å¦‚`s.abc`éƒ½ä¼šè¿”å›`None`ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬å®šä¹‰çš„`__getattr__`é»˜è®¤è¿”å›å°±æ˜¯`None`ã€‚è¦è®©classåªå“åº”ç‰¹å®šçš„å‡ ä¸ªå±æ€§ï¼Œæˆ‘ä»¬å°±è¦æŒ‰ç…§çº¦å®šï¼ŒæŠ›å‡º`AttributeError`çš„é”™è¯¯ï¼š

```python
class Student(object):

    def __getattr__(self, attr):
        if attr=='age':
            return lambda: 25
        raise AttributeError('\'Student\' object has no attribute \'%s\'' % attr)
```

è¿™å®é™…ä¸Šå¯ä»¥æŠŠä¸€ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•è°ƒç”¨å…¨éƒ¨åŠ¨æ€åŒ–å¤„ç†äº†ï¼Œä¸éœ€è¦ä»»ä½•ç‰¹æ®Šæ‰‹æ®µã€‚

è¿™ç§å®Œå…¨åŠ¨æ€è°ƒç”¨çš„ç‰¹æ€§æœ‰ä»€ä¹ˆå®é™…ä½œç”¨å‘¢ï¼Ÿä½œç”¨å°±æ˜¯ï¼Œå¯ä»¥é’ˆå¯¹å®Œå…¨åŠ¨æ€çš„æƒ…å†µä½œè°ƒç”¨ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

ç°åœ¨å¾ˆå¤šç½‘ç«™éƒ½æREST APIï¼Œæ¯”å¦‚æ–°æµªå¾®åšã€è±†ç“£å•¥çš„ï¼Œè°ƒç”¨APIçš„URLç±»ä¼¼ï¼š

- http://api.server/user/friends
- http://api.server/user/timeline/list

å¦‚æœè¦å†™SDKï¼Œç»™æ¯ä¸ªURLå¯¹åº”çš„APIéƒ½å†™ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£å¾—ç´¯æ­»ï¼Œè€Œä¸”ï¼ŒAPIä¸€æ—¦æ”¹åŠ¨ï¼ŒSDKä¹Ÿè¦æ”¹ã€‚

åˆ©ç”¨å®Œå…¨åŠ¨æ€çš„`__getattr__`ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºä¸€ä¸ªé“¾å¼è°ƒç”¨ï¼š

```python
class Chain(object):

    def __init__(self, path=''):
        self._path = path

    def __getattr__(self, path):
        return Chain('%s/%s' % (self._path, path))

    def __str__(self):
        return self._path

    __repr__ = __str__
```

è¯•è¯•ï¼š

```python
Chain().status.user.timeline.list # '/status/user/timeline/list'
```

è¿™æ ·ï¼Œæ— è®ºAPIæ€ä¹ˆå˜ï¼ŒSDKéƒ½å¯ä»¥æ ¹æ®URLå®ç°å®Œå…¨åŠ¨æ€çš„è°ƒç”¨ï¼Œè€Œä¸”ï¼Œä¸éšAPIçš„å¢åŠ è€Œæ”¹å˜ï¼

### â‘¤  `__call__`

ä¸€ä¸ªå¯¹è±¡å®ä¾‹å¯ä»¥æœ‰è‡ªå·±çš„å±æ€§å’Œæ–¹æ³•ï¼Œå½“æˆ‘ä»¬è°ƒç”¨å®ä¾‹æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬ç”¨`instance.method()`æ¥è°ƒç”¨ã€‚èƒ½ä¸èƒ½ç›´æ¥åœ¨å®ä¾‹æœ¬èº«ä¸Šè°ƒç”¨å‘¢ï¼Ÿåœ¨Pythonä¸­ï¼Œç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚

**ä»»ä½•ç±»ï¼Œåªéœ€è¦å®šä¹‰ä¸€ä¸ª`__call__()`æ–¹æ³•ï¼Œå°±å¯ä»¥ç›´æ¥å¯¹å®ä¾‹è¿›è¡Œè°ƒç”¨**ã€‚è¯·çœ‹ç¤ºä¾‹ï¼š

```python
class Student(object):
    def __init__(self, name):
        self.name = name

    def __call__(self):
        print('My name is %s.' % self.name)
```

è°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼š

```python
s = Student('Michael')
s() # selfå‚æ•°ä¸è¦ä¼ å…¥
# My name is Michael.
```

`__call__()`è¿˜å¯ä»¥å®šä¹‰å‚æ•°ã€‚å¯¹å®ä¾‹è¿›è¡Œç›´æ¥è°ƒç”¨å°±å¥½æ¯”å¯¹ä¸€ä¸ªå‡½æ•°è¿›è¡Œè°ƒç”¨ä¸€æ ·ï¼Œæ‰€ä»¥ä½ å®Œå…¨å¯ä»¥æŠŠå¯¹è±¡çœ‹æˆå‡½æ•°ï¼ŒæŠŠå‡½æ•°çœ‹æˆå¯¹è±¡ï¼Œå› ä¸ºè¿™ä¸¤è€…ä¹‹é—´æœ¬æ¥å°±æ²¡å•¥æ ¹æœ¬çš„åŒºåˆ«ã€‚

å¦‚æœä½ æŠŠå¯¹è±¡çœ‹æˆå‡½æ•°ï¼Œé‚£ä¹ˆå‡½æ•°æœ¬èº«å…¶å®ä¹Ÿå¯ä»¥åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºå‡ºæ¥ï¼Œå› ä¸ºç±»çš„å®ä¾‹éƒ½æ˜¯è¿è¡ŒæœŸåˆ›å»ºå‡ºæ¥çš„ï¼Œè¿™ä¹ˆä¸€æ¥ï¼Œæˆ‘ä»¬å°±æ¨¡ç³Šäº†å¯¹è±¡å’Œå‡½æ•°çš„ç•Œé™ã€‚

é‚£ä¹ˆï¼Œæ€ä¹ˆåˆ¤æ–­ä¸€ä¸ªå˜é‡æ˜¯å¯¹è±¡è¿˜æ˜¯å‡½æ•°å‘¢ï¼Ÿå…¶å®ï¼Œæ›´å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦èƒ½è¢«è°ƒç”¨ï¼Œèƒ½è¢«è°ƒç”¨çš„å¯¹è±¡å°±æ˜¯ä¸€ä¸ª`Callable`å¯¹è±¡ï¼Œæ¯”å¦‚å‡½æ•°å’Œæˆ‘ä»¬ä¸Šé¢å®šä¹‰çš„å¸¦æœ‰`__call__()`çš„ç±»å®ä¾‹ï¼š

```python
callable(Student())
# True

callable(max)
# True

callable([1, 2, 3])
# False

callable(None)
# False

callable('str')
# False
```

é€šè¿‡`callable()`å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯â€œå¯è°ƒç”¨â€å¯¹è±¡ã€‚

## 5. ä½¿ç”¨æšä¸¾ç±» Enum

å½“æˆ‘ä»¬éœ€è¦å®šä¹‰å¸¸é‡æ—¶ï¼Œä¸€ä¸ªåŠæ³•æ˜¯ç”¨å¤§å†™å˜é‡é€šè¿‡æ•´æ•°æ¥å®šä¹‰ï¼Œä¾‹å¦‚æœˆä»½ï¼š

```python
JAN = 1
FEB = 2
MAR = 3
...
NOV = 11
DEC = 12
```

å¥½å¤„æ˜¯ç®€å•ï¼Œç¼ºç‚¹æ˜¯ç±»å‹æ˜¯`int`ï¼Œå¹¶ä¸”ä»ç„¶æ˜¯å˜é‡ã€‚

æ›´å¥½çš„æ–¹æ³•æ˜¯ä¸ºè¿™æ ·çš„æšä¸¾ç±»å‹å®šä¹‰ä¸€ä¸ªclassç±»å‹ï¼Œç„¶åï¼Œæ¯ä¸ªå¸¸é‡éƒ½æ˜¯classçš„ä¸€ä¸ªå”¯ä¸€å®ä¾‹ã€‚Pythonæä¾›äº†`Enum`ç±»æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼š

```python
from enum import Enum

Month = Enum('Month', ('Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'))
```

è¿™æ ·æˆ‘ä»¬å°±è·å¾—äº†`Month`ç±»å‹çš„æšä¸¾ç±»ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨`Month.Jan`æ¥å¼•ç”¨ä¸€ä¸ªå¸¸é‡ï¼Œæˆ–è€…æšä¸¾å®ƒçš„æ‰€æœ‰æˆå‘˜ï¼š

```python
for name, member in Month.__members__.items():
    print(name, '=>', member, ',', member.value)
```

<img src="https://gitee.com/veal98/images/raw/master/img/20200604155158.png" style="zoom:80%;" />

å¦‚æœéœ€è¦æ›´ç²¾ç¡®åœ°æ§åˆ¶æšä¸¾ç±»å‹ï¼Œå¯ä»¥ä»`Enum`æ´¾ç”Ÿå‡ºè‡ªå®šä¹‰ç±»ï¼š

```python
from enum import Enum, unique

@unique
class Weekday(Enum):
    Sun = 0 # Sunçš„valueè¢«è®¾å®šä¸º0
    Mon = 1
    Tue = 2
    Wed = 3
    Thu = 4
    Fri = 5
    Sat = 6
```

`@unique`è£…é¥°å™¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ£€æŸ¥ä¿è¯æ²¡æœ‰é‡å¤å€¼ã€‚

è®¿é—®è¿™äº›æšä¸¾ç±»å‹å¯ä»¥æœ‰è‹¥å¹²ç§æ–¹æ³•ï¼š

```python
day1 = Weekday.Mon
print(day1) # Weekday.Mon

print(Weekday['Tue']) # Weekday.Tue
print(Weekday.Tue.value) # 2
print(Weekday(1)) # Weekday.Mon
```

å¯è§ï¼Œæ—¢å¯ä»¥ç”¨æˆå‘˜åç§°å¼•ç”¨æšä¸¾å¸¸é‡ï¼Œåˆå¯ä»¥ç›´æ¥æ ¹æ®valueçš„å€¼è·å¾—æšä¸¾å¸¸é‡ã€‚

## 6. ä½¿ç”¨å…ƒç±»

### â‘  type() åŠ¨æ€åˆ›å»ºç±»

åŠ¨æ€è¯­è¨€å’Œé™æ€è¯­è¨€æœ€å¤§çš„ä¸åŒï¼Œå°±æ˜¯å‡½æ•°å’Œç±»çš„å®šä¹‰ï¼Œä¸æ˜¯ç¼–è¯‘æ—¶å®šä¹‰çš„ï¼Œè€Œæ˜¯è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºçš„ã€‚

æ¯”æ–¹è¯´æˆ‘ä»¬è¦å®šä¹‰ä¸€ä¸ª`Hello`çš„classï¼Œå°±å†™ä¸€ä¸ª`hello.py`æ¨¡å—ï¼š

```python
class Hello(object):
    def hello(self, name='world'):
        print('Hello, %s.' % name)
```

å½“Pythonè§£é‡Šå™¨è½½å…¥`hello`æ¨¡å—æ—¶ï¼Œå°±ä¼šä¾æ¬¡æ‰§è¡Œè¯¥æ¨¡å—çš„æ‰€æœ‰è¯­å¥ï¼Œæ‰§è¡Œç»“æœå°±æ˜¯åŠ¨æ€åˆ›å»ºå‡ºä¸€ä¸ª`Hello`çš„classå¯¹è±¡ï¼Œæµ‹è¯•å¦‚ä¸‹ï¼š

```python
from hello import Hello
h = Hello()
h.hello() # Hello, world.

print(type(Hello))
# <class 'type'>

print(type(h))
# <class 'hello.Hello'>
```

`type()`å‡½æ•°å¯ä»¥æŸ¥çœ‹ä¸€ä¸ªç±»å‹æˆ–å˜é‡çš„ç±»å‹ï¼Œ`Hello`æ˜¯ä¸€ä¸ª classï¼Œå®ƒçš„ç±»å‹å°±æ˜¯`type`ï¼Œè€Œ`h`æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œå®ƒçš„ç±»å‹å°±æ˜¯class `Hello`ã€‚

ğŸš© **æˆ‘ä»¬è¯´ class çš„å®šä¹‰æ˜¯è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºçš„ï¼Œè€Œåˆ›å»º class çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨`type()`å‡½æ•°ã€‚**

`type()`å‡½æ•°æ—¢å¯ä»¥è¿”å›ä¸€ä¸ªå¯¹è±¡çš„ç±»å‹ï¼Œåˆå¯ä»¥åˆ›å»ºå‡ºæ–°çš„ç±»å‹ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`type()`å‡½æ•°åˆ›å»ºå‡º`Hello`ç±»ï¼Œè€Œæ— éœ€é€šè¿‡`class Hello(object)...`çš„å®šä¹‰ï¼š

```python
def fn(self, name='world'): # å…ˆå®šä¹‰å‡½æ•°
     print('Hello, %s.' % name)

Hello = type('Hello', (object,), dict(hello=fn)) # åˆ›å»ºHello class

h = Hello()
h.hello() # Hello, world.

print(type(Hello)) # <class 'type'>
print(type(h)) # <class '__main__.Hello'>
```

âšª `type(ç±»å, çˆ¶ç±»çš„å…ƒç»„ï¼ˆé’ˆå¯¹ç»§æ‰¿çš„æƒ…å†µï¼Œå¯ä»¥ä¸ºç©ºï¼‰ï¼ŒåŒ…å«å±æ€§çš„å­—å…¸ï¼ˆåç§°å’Œå€¼ï¼‰)`

è¦åˆ›å»ºä¸€ä¸ªclasså¯¹è±¡ï¼Œ`type()`å‡½æ•°ä¾æ¬¡ä¼ å…¥3ä¸ªå‚æ•°ï¼š

- classçš„åç§°ï¼›

- ç»§æ‰¿çš„çˆ¶ç±»é›†åˆï¼Œæ³¨æ„Pythonæ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªçˆ¶ç±»ï¼Œåˆ«å¿˜äº†tupleçš„å•å…ƒç´ å†™æ³•ï¼›

- classçš„æ–¹æ³•åç§°ä¸å‡½æ•°ç»‘å®šï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠå‡½æ•°`fn`ç»‘å®šåˆ°æ–¹æ³•å`hello`ä¸Šã€‚

é€šè¿‡`type()`å‡½æ•°åˆ›å»ºçš„ç±»å’Œç›´æ¥å†™classæ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œå› ä¸ºPythonè§£é‡Šå™¨é‡åˆ°classå®šä¹‰æ—¶ï¼Œä»…ä»…æ˜¯æ‰«æä¸€ä¸‹classå®šä¹‰çš„è¯­æ³•ï¼Œç„¶åè°ƒç”¨`type()`å‡½æ•°åˆ›å»ºå‡ºclassã€‚

æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½ç”¨`class Xxx...`æ¥å®šä¹‰ç±»ï¼Œä½†æ˜¯ï¼Œ`type()`å‡½æ•°ä¹Ÿå…è®¸æˆ‘ä»¬åŠ¨æ€åˆ›å»ºå‡ºç±»æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŠ¨æ€è¯­è¨€æœ¬èº«æ”¯æŒè¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºç±»ï¼Œè¿™å’Œé™æ€è¯­è¨€æœ‰éå¸¸å¤§çš„ä¸åŒï¼Œè¦åœ¨é™æ€è¯­è¨€è¿è¡ŒæœŸåˆ›å»ºç±»ï¼Œå¿…é¡»æ„é€ æºä»£ç å­—ç¬¦ä¸²å†è°ƒç”¨ç¼–è¯‘å™¨ï¼Œæˆ–è€…å€ŸåŠ©ä¸€äº›å·¥å…·ç”Ÿæˆå­—èŠ‚ç å®ç°ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯åŠ¨æ€ç¼–è¯‘ï¼Œä¼šéå¸¸å¤æ‚ã€‚

### â‘¡ metaclass å…ƒç±»

é™¤äº†ä½¿ç”¨`type()`åŠ¨æ€åˆ›å»ºç±»ä»¥å¤–ï¼Œè¦æ§åˆ¶ç±»çš„åˆ›å»ºè¡Œä¸ºï¼Œè¿˜å¯ä»¥ä½¿ç”¨metaclassã€‚

metaclassï¼Œç›´è¯‘ä¸ºå…ƒç±»ï¼Œç®€å•çš„è§£é‡Šå°±æ˜¯ï¼š

å½“æˆ‘ä»¬å®šä¹‰äº†ç±»ä»¥åï¼Œå°±å¯ä»¥æ ¹æ®è¿™ä¸ªç±»åˆ›å»ºå‡ºå®ä¾‹ï¼Œæ‰€ä»¥ï¼šå…ˆå®šä¹‰ç±»ï¼Œç„¶ååˆ›å»ºå®ä¾‹ã€‚

ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³åˆ›å»ºå‡ºç±»å‘¢ï¼Ÿé‚£å°±å¿…é¡»æ ¹æ®metaclassåˆ›å»ºå‡ºç±»ï¼Œæ‰€ä»¥ï¼šå…ˆå®šä¹‰metaclassï¼Œç„¶ååˆ›å»ºç±»ã€‚

è¿æ¥èµ·æ¥å°±æ˜¯ï¼š**å…ˆå®šä¹‰metaclassï¼Œå°±å¯ä»¥åˆ›å»ºç±»ï¼Œæœ€ååˆ›å»ºå®ä¾‹**ã€‚

æ‰€ä»¥ï¼Œmetaclasså…è®¸ä½ åˆ›å»ºç±»æˆ–è€…ä¿®æ”¹ç±»ã€‚æ¢å¥è¯è¯´ï¼Œâ­ ä½ **å¯ä»¥æŠŠç±»çœ‹æˆæ˜¯metaclassåˆ›å»ºå‡ºæ¥çš„â€œå®ä¾‹â€ã€‚**

æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¿™ä¸ªmetaclasså¯ä»¥ç»™æˆ‘ä»¬è‡ªå®šä¹‰çš„MyListå¢åŠ ä¸€ä¸ª`add`æ–¹æ³•ï¼š

å®šä¹‰`ListMetaclass`ï¼ŒæŒ‰ç…§é»˜è®¤ä¹ æƒ¯ï¼Œmetaclassçš„ç±»åæ€»æ˜¯ä»¥Metaclassç»“å°¾ï¼Œä»¥ä¾¿æ¸…æ¥šåœ°è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªmetaclassï¼š

```python
# metaclassæ˜¯ç±»çš„æ¨¡æ¿ï¼Œæ‰€ä»¥å¿…é¡»ä»`type`ç±»å‹æ´¾ç”Ÿï¼š
class ListMetaclass(type):
    def __new__(cls,name,bases,attrs):
        attrs['add'] = lambda self, value: self.append(value)
        return type.__new__(cls,name,bases,attrs)
```

`__new__()`æ–¹æ³•æ¥æ”¶åˆ°çš„å‚æ•°ä¾æ¬¡æ˜¯ï¼š

- å½“å‰å‡†å¤‡åˆ›å»ºçš„ç±»çš„å¯¹è±¡ï¼›

- ç±»çš„åå­—ï¼›

- ç±»ç»§æ‰¿çš„çˆ¶ç±»é›†åˆï¼›

- ç±»çš„æ–¹æ³•é›†åˆã€‚

æœ‰äº†ListMetaclassï¼Œæˆ‘ä»¬åœ¨å®šä¹‰ç±»çš„æ—¶å€™è¿˜è¦æŒ‡ç¤ºä½¿ç”¨ListMetaclassæ¥å®šåˆ¶ç±»ï¼Œä¼ å…¥å…³é”®å­—å‚æ•°`metaclass`ï¼š

```python
class MyList(list, metaclass = ListMetaclass):
    pass
```

å½“æˆ‘ä»¬ä¼ å…¥å…³é”®å­—å‚æ•°`metaclass`æ—¶ï¼Œé­”æœ¯å°±ç”Ÿæ•ˆäº†ï¼Œå®ƒæŒ‡ç¤º**Pythonè§£é‡Šå™¨åœ¨åˆ›å»º`MyList`æ—¶ï¼Œè¦é€šè¿‡`ListMetaclass.__new__()`æ¥åˆ›å»º**ï¼Œåœ¨æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ç±»çš„å®šä¹‰ï¼Œæ¯”å¦‚ï¼ŒåŠ ä¸Šæ–°çš„æ–¹æ³•ï¼Œç„¶åï¼Œè¿”å›ä¿®æ”¹åçš„å®šä¹‰ã€‚

æµ‹è¯•ä¸€ä¸‹`MyList`æ˜¯å¦å¯ä»¥è°ƒç”¨`add()`æ–¹æ³•ï¼š

```python
L = MyList()
L.add(1)
print(L) # [1]
```

è€Œæ™®é€šçš„`list`æ²¡æœ‰`add()`æ–¹æ³•ï¼š

```python
L2 = list()
L2.add(1)
# Traceback (most recent call last):
#   File "<stdin>", line 1, in <module>
# AttributeError: 'list' object has no attribute 'add'
```

åŠ¨æ€ä¿®æ”¹æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿç›´æ¥åœ¨`MyList`å®šä¹‰ä¸­å†™ä¸Š`add()`æ–¹æ³•ä¸æ˜¯æ›´ç®€å•å—ï¼Ÿæ­£å¸¸æƒ…å†µä¸‹ï¼Œç¡®å®åº”è¯¥ç›´æ¥å†™ï¼Œé€šè¿‡metaclassä¿®æ”¹çº¯å±å˜æ€ã€‚

ä½†æ˜¯ï¼Œæ€»ä¼šé‡åˆ°éœ€è¦é€šè¿‡metaclassä¿®æ”¹ç±»å®šä¹‰çš„ã€‚ORM å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ã€‚

---



# ğŸ“š References

<br>

- [å»–é›ªå³° - Python3.x æ•™ç¨‹](https://www.liaoxuefeng.com/wiki/1016959663602400/1016966022717728)