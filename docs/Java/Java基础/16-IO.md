# ğŸ”Š Java I/O ç³»ç»Ÿ

---

## 1. æ¦‚è¿°

**I/O æˆ–è€…è¾“å…¥/è¾“å‡ºæŒ‡çš„æ˜¯è®¡ç®—æœºä¸å¤–éƒ¨ä¸–ç•Œæˆ–è€…ä¸€ä¸ªç¨‹åºä¸è®¡ç®—æœºçš„å…¶ä½™éƒ¨åˆ†çš„ä¹‹é—´çš„æ¥å£**ã€‚å®ƒå¯¹äºä»»ä½•è®¡ç®—æœºç³»ç»Ÿéƒ½éå¸¸å…³é”®ï¼Œå› è€Œæ‰€æœ‰ I/O çš„ä¸»ä½“å®é™…ä¸Šæ˜¯å†…ç½®åœ¨æ“ä½œç³»ç»Ÿä¸­çš„ã€‚å•ç‹¬çš„ç¨‹åºä¸€èˆ¬æ˜¯è®©ç³»ç»Ÿä¸ºå®ƒä»¬å®Œæˆå¤§éƒ¨åˆ†çš„å·¥ä½œã€‚

Java çš„ I/O å¤§æ¦‚å¯ä»¥åˆ†æˆä»¥ä¸‹å‡ ç±»ï¼š

- ç£ç›˜æ“ä½œï¼š`File`
- å­—èŠ‚æ“ä½œï¼š`InputStream `å’Œ `OutputStream`
- å­—ç¬¦æ“ä½œï¼š`Reader ` å’Œ `Writer`
- å¯¹è±¡æ“ä½œï¼š`Serializable`
- ç½‘ç»œæ“ä½œ
- æ–°çš„è¾“å…¥/è¾“å‡ºï¼š`NIO`

åœ¨ Java ç¼–ç¨‹ä¸­ï¼Œä¸€ç›´ä½¿ç”¨**æµ**çš„æ–¹å¼å®Œæˆ I/Oã€‚æ‰€æœ‰ I/O éƒ½è¢«è§†ä¸ºå•ä¸ªçš„å­—èŠ‚çš„ç§»åŠ¨ï¼Œé€šè¿‡ä¸€ä¸ªç§°ä¸º `Stream` çš„å¯¹è±¡ä¸€æ¬¡ç§»åŠ¨ä¸€ä¸ªå­—èŠ‚ã€‚æµ I/O ç”¨äºä¸å¤–éƒ¨ä¸–ç•Œæ¥è§¦ã€‚å®ƒä¹Ÿåœ¨å†…éƒ¨ä½¿ç”¨ï¼Œç”¨äºå°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚ï¼Œç„¶åå†è½¬æ¢å›å¯¹è±¡ã€‚

`NIO` ä¸åŸæ¥çš„ I/O æœ‰åŒæ ·çš„ä½œç”¨å’Œç›®çš„ï¼Œä½†æ˜¯å®ƒä½¿ç”¨ä¸åŒçš„æ–¹å¼**å— I/O**ï¼Œ<u>å— I/O çš„æ•ˆç‡å¯ä»¥æ¯”æµ I/O é«˜è®¸å¤š</u>ã€‚

## 2. ç£ç›˜æ“ä½œ `File`

`File ` ç±»å¯ä»¥ç”¨äºè¡¨ç¤ºæ–‡ä»¶å’Œç›®å½•çš„ä¿¡æ¯ï¼Œä½†æ˜¯å®ƒä¸è¡¨ç¤ºæ–‡ä»¶çš„å†…å®¹ã€‚

ğŸ“£ ä» Java7 å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨ `Paths `å’Œ `Files `ä»£æ›¿ `File`ã€‚

### â‘  æ„é€ å‡½æ•°

- `public File(String pathname)`ï¼šæ ¹æ®ä¸€ä¸ªè·¯å¾„å¾—åˆ° `File `å¯¹è±¡

  ```java
  // æ–‡ä»¶å¤¹
  public class FileConstructor {
      public static void main(String[] args){
          File file = new File("F://Code");
          System.out.println(file);
      }
  }
  ```

- `public File(String parent,String child)`ï¼šæ ¹æ®ä¸€ä¸ªç›®å½•å’Œä¸€ä¸ªå­æ–‡ä»¶/ç›®å½•å¾—åˆ° `File` å¯¹è±¡

  ```java
  File file = new File("F:", "Code");
  ```

- `public File(File parent,String child)`ï¼šæ ¹æ®ä¸€ä¸ªçˆ¶ `File` å¯¹è±¡å’Œä¸€ä¸ªå­æ–‡ä»¶/ç›®å½•å¾—åˆ° `File` å¯¹è±¡

  ```java
  File parent = new File("F:");
  File file = new File(parent, "Code");
  ```

### â‘¡ å¸¸ç”¨æ–¹æ³•

#### createNewFile

`boolean createNewFile()` æ–¹æ³•ï¼šç”¨äºåˆ›å»ºæ–‡ä»¶

ğŸš¨ æ³¨æ„ï¼š**åªèƒ½ç”¨æ¥åˆ›å»ºæ–‡ä»¶ï¼Œè€Œæ— æ³•åˆ›å»ºæ–‡ä»¶å¤¹**ã€‚

```java
// åˆ›å»ºçš„æ–‡ä»¶åå’Œæ–‡ä»¶è·¯å¾„ï¼Œåœ¨Fileçš„æ„é€ æ–¹æ³•ä¸­ç»™å‡º
File file = new File("F:\\123.txt");
boolean b = file.createNewFile();
System.out.println(b);
```

æ³¨ï¼šå½“åœ¨ F ç›˜ä¸‹ä¸å­˜åœ¨ 123.txt æ–‡ä»¶æ—¶ï¼Œè°ƒç”¨ `createNewFile()` å°†ä¼šåˆ›å»º 123.txtï¼Œå¹¶è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼štrueï¼›å½“Fç›˜ä¸‹å·²ç»å­˜åœ¨ 123.txt æ–‡ä»¶æ—¶ï¼Œè°ƒç”¨ `createNewFile()` æ–¹æ³•å°†ä¼šè¿”å› falseã€‚

 #### mkdir

`boolean mkdir()` æ–¹æ³•ï¼šç”¨äºåˆ›å»ºæ–‡ä»¶å¤¹

åˆ›å»ºçš„è·¯å¾„åœ¨ File çš„æ„é€ æ–¹æ³•ä¸­ç»™å‡ºï¼Œå¦‚æœæ–‡ä»¶å¤¹å·²å­˜åœ¨ï¼Œåˆ™ä¸å†åˆ›å»ºã€‚**åªèƒ½åˆ›å»ºä¸€å±‚æ–‡ä»¶å¤¹**

```java
File file = new File("F:\\123");
boolean b = file.mkdir();
System.out.println(b);
```

æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼šè¾“å‡ºç»“æœä¸º true
æ–‡ä»¶å¤¹å·²å­˜åœ¨ï¼šè¾“å‡ºç»“æœä¸º false

#### mkdirs

`boolean mkdirs()` : ç”¨äºåˆ›å»ºæ–‡ä»¶å¤¹

åŒ `mkdir()` ç±»ä¼¼ï¼Œåªæ˜¯è¯¥æ–¹æ³•å¯ä»¥**åˆ›å»ºå¤šå±‚æ–‡ä»¶å¤¹**ï¼Œæ¨èä½¿ç”¨è¯¥æ–¹æ³•

```java
File file = new File("F:\\123\\a\\b\\c");
boolean b = file.mkdirs();
System.out.println(b);
```

#### delete

`boolean delete()` : ç”¨äºåˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹

åˆ é™¤çš„æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹ï¼Œåœ¨ `File `ç±»çš„æ„é€ å‡½æ•°ä¸­ç»™å‡ºï¼Œåˆ é™¤æˆåŠŸè¿”å› trueï¼Œåˆ é™¤å¤±è´¥è¿”å›false

è¯¥æ–¹æ³•ä¸èµ°å›æ”¶ç«™ï¼Œç›´æ¥ä»ç¡¬ç›˜ä¸­åˆ é™¤

```java
File file = new File("F:\\123\\a.txt");
boolean newFile = file.delete();
System.out.println(newFile);
```

#### getName

`String getName()`ï¼šè¿”å›è·¯å¾„ä¸­è¡¨ç¤ºçš„æ–‡ä»¶åæˆ–è€…æ–‡ä»¶å¤¹å

è·å–è·¯å¾„ä¸­æœ€åéƒ¨åˆ†çš„åå­—ï¼š

```java
File file = new File("F:\\123\\a.txt");
System.out.println(file.getName()); // a.txt
```

#### length

`long length()`ï¼šè¿”å›è·¯å¾„ä¸­è¡¨ç¤ºçš„æ–‡ä»¶çš„å­—èŠ‚æ•°

```java
File file = new File("F:\\123\\123.txt");
System.out.println(file.length()); // è¾“å‡ºæ–‡ä»¶123.txtçš„å­—èŠ‚æ•°
```

#### getAbsolutePath

`String getAbsolutePath()`ï¼šè·å–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œè¿”å› String å¯¹è±¡

```java
File file = new File("123.txt"); // ç›¸å¯¹è·¯å¾„
System.out.println(file.getAbsolutePath()); // è¾“å‡ºç»å¯¹è·¯å¾„
```

#### getAbsoluteFile

`File getAbsoluteFile()`ï¼šè·å–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œè¿”å› `File` å¯¹è±¡

```java
File file = new File("F:\\123.txt");
System.out.println(file.getAbsoluteFile());
```

#### getParent

`String getParent()`ï¼šè·å–çˆ¶è·¯å¾„ï¼Œè¿”å› `String` å¯¹è±¡

```java
File file = new File("F:\\123.txt");
System.out.println(file.getParent()); // F:\
```

#### getParentFile

`File getParentFile()`ï¼šè·å–çˆ¶è·¯å¾„ï¼Œè¿”å› `File` å¯¹è±¡

```java
File file = new File("F:\\123.txt");
System.out.println(file.getParentFile());
```

#### exists

`boolean exists()`ï¼šåˆ¤æ–­ `File` æ„é€ æ–¹æ³•ä¸­å°è£…è·¯å¾„æ˜¯å¦å­˜åœ¨

```java
File file = new File("src");
System.out.println(file.exists());
```

#### isDirectory

`boolean isDirectory()`ï¼šåˆ¤æ–­ File æ„é€ æ–¹æ³•ä¸­å°è£…çš„è·¯å¾„æ˜¯ä¸æ˜¯æ–‡ä»¶å¤¹

```java
File file = new File("src");
System.out.println(file.isDirectory());
```

#### isFile

`isFile()`ï¼šåˆ¤æ–­Fileæ„é€ æ–¹æ³•ä¸­å°è£…çš„è·¯å¾„æ˜¯ä¸æ˜¯æ–‡ä»¶

```java
File file = new File("src");
System.out.println(file.isFile());
```

#### list

`String[] list()`ï¼šè·å–Fileæ„é€ æ–¹æ³•ä¸­å°è£…è·¯å¾„ä¸­çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹åï¼ˆéå†ä¸€ä¸ªç›®å½•ï¼‰ï¼Œè¿”å›å€¼åªæœ‰æ–‡ä»¶åæˆ–æ–‡ä»¶å¤¹å

```java
File file = new File("E:\\ideaIU-2018.3.5.win");
String[] fileNames = file.list();
for(String fileName : fileNames) {
    System.out.println(fileName);
}
```

#### listFiles

`File[] listFiles()`ï¼šè·å–Fileæ„é€ æ–¹æ³•ä¸­å°è£…è·¯å¾„ä¸­çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹åï¼ˆéå†ä¸€ä¸ªç›®å½•ï¼‰ï¼Œè¿”å›çš„æ˜¯ç›®å½•æˆ–æ–‡ä»¶çš„**å…¨è·¯å¾„**

```java
File file = new File("E:\\ideaIU-2018.3.5.win");
File[] files = file.listFiles();
for(File f : files) {
	System.out.println(f);
}
```

## ğŸ“š References

- [CS-Notes â€” Github](http://cyc2018.gitee.io/cs-notes/#/notes/Java%20IO?id=%e4%b8%80%e3%80%81%e6%a6%82%e8%a7%88)
- [Java API --- Fileç±»](https://www.cnblogs.com/peng19920430/p/11312449.html)

## 3. å­—èŠ‚æ“ä½œ `InputStream ` /  `OutputStream`

### â‘  æ¦‚è¿°

- `InputStream`ï¼šè¾“å…¥æµ

  ![](https://gitee.com/veal98/images/raw/master/img/20200909122541.png)

- `OutputStream`ï¼šè¾“å‡ºæµ

  ![](https://gitee.com/veal98/images/raw/master/img/20200909122620.png)

### â‘¡ è£…é¥°å™¨

Java I/O ç±»åº“éœ€è¦å¤šç§ä¸åŒåŠŸèƒ½çš„ç»„åˆï¼Œè¿™æ­£æ˜¯ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼çš„ç†ç”±æ‰€åœ¨ï¼Œä¹Ÿæ˜¯ Java I/O ç±»åº“é‡Œå­˜åœ¨ `filter`ï¼ˆè¿‡æ»¤å™¨ï¼‰ï¼ŒæŠ½è±¡ç±» `filter` æ˜¯æ‰€æœ‰è£…é¥°å™¨ç±»çš„åŸºç±»ã€‚**è£…é¥°å™¨å¿…é¡»å…·æœ‰ä¸å®ƒæ‰€è£…é¥°çš„å¯¹è±¡ç›¸åŒçš„æ¥å£ï¼ˆä¹Ÿå¯ä»¥æ‰©å±•æ¥å£ï¼‰**ã€‚

ä»¥ `InputStream `ä¸ºä¾‹ï¼Œ

- `InputStream `æ˜¯æŠ½è±¡ç»„ä»¶ï¼›
- `FileInputStream `æ˜¯ `InputStream `çš„å­ç±»ï¼Œå±äºå…·ä½“ç»„ä»¶ï¼Œæä¾›äº†å­—èŠ‚æµçš„è¾“å…¥æ“ä½œï¼›
- `FilterInputStream `å±äºæŠ½è±¡è£…é¥°è€…ï¼Œè£…é¥°è€…ç”¨äºè£…é¥°ç»„ä»¶ï¼Œä¸ºç»„ä»¶æä¾›é¢å¤–çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ `BufferedInputStream `ä¸º `FileInputStream `æä¾›ç¼“å­˜çš„åŠŸèƒ½ã€‚

<img src="https://gitee.com/veal98/images/raw/master/img/20200909211819.png" style="zoom: 70%;" />

ä¸‹é¢è¯¦ç»†è®²è§£ä¸¤ä¸ªæŠ½è±¡è£…é¥°è€… `FilterInputStream` å’Œ `FilterOutputStream`  ğŸ‘‡

#### â…  é€šè¿‡ FilterInputStream ä» InputStream è¯»å–æ•°æ®

<img src="https://gitee.com/veal98/images/raw/master/img/20200909210054.png" style="zoom: 50%;" />

`FilterInputStream `èƒ½å¤Ÿå®Œæˆä¸¤ä»¶å®Œå…¨ä¸åŒçš„äº‹æƒ…ï¼š

- `DataInputStream` å…è®¸æˆ‘ä»¬è¯»å–ä¸åŒçš„åŸºæœ¬ç±»å‹æ•°æ®ä»¥åŠ `String `å¯¹è±¡ï¼ˆæ‰€æœ‰æ–¹æ³•éƒ½ä»¥ `read `å¼€å¤´ï¼Œæ¯”å¦‚ `readByte()`, `readFloat()` ç­‰ï¼‰

- å…¶ä»– `FilterInputStream `ç±»åˆ™åœ¨å†…éƒ¨ä¿®æ”¹ `InputStream `çš„è¡Œä¸ºæ–¹å¼ï¼šæ˜¯å¦ç¼“å†²ï¼Œæ˜¯å¦ä¿ç•™å®ƒæ‰€åº¦è¿‡çš„è¡Œï¼ˆå…è®¸æˆ‘ä»¬æŸ¥è¯¢æˆ–è®¾ç½®è¡Œæ•°ï¼‰ï¼Œä»¥åŠæ˜¯å¦æŠŠå•ä¸€å­—ç¬¦é€€ä¼šè¾“å…¥æµç­‰ç­‰ã€‚

  ğŸ’¬ æ¯”å¦‚è¯´å®ä¾‹åŒ–ä¸€ä¸ªå…·æœ‰ç¼“å­˜åŠŸèƒ½çš„å­—èŠ‚æµå¯¹è±¡æ—¶ï¼Œåªéœ€è¦åœ¨ `FileInputStream `å¯¹è±¡ä¸Šå†å¥—ä¸€å±‚ `BufferedInputStream ` å¯¹è±¡å³å¯ï¼š

  ```java
  FileInputStream fileInputStream = new FileInputStream(filePath);
  BufferedInputStream bufferedInputStream = new BufferedInputStream(fileInputStream);
  ```

#### â…¡ é€šè¿‡ FilterOutputStreamä» OutputStream è¯»å–æ•°æ®

<img src="https://gitee.com/veal98/images/raw/master/img/20200909211507.png" style="zoom:50%;" />

ä¸ `DataInputStream` å¯¹åº”çš„æ˜¯ `DataOutputStream` ï¼Œå®ƒå¯ä»¥å°†å„ç§åŸºæœ¬ç±»å‹æ•°æ®ç±»å‹ä»¥åŠ String å¯¹è±¡æ ¼å¼åŒ–è¾“å‡ºåˆ° â€œæµâ€ ä¸­ï¼Œè¿™æ ·ä»»ä½•æœºå™¨çš„ `DataInputStream` éƒ½èƒ½å¤Ÿè¯»å–åˆ°å®ƒä»¬ã€‚æ‰€æœ‰æ–¹æ³•éƒ½ä»¥ `write` å¼€å¤´ï¼ˆ`writeByte()`ï¼Œ`writeFloat()` ç­‰ç­‰ï¼‰

`BufferedOutputStream` å¯¹æ•°æ®æµä½¿ç”¨ç¼“å†²æŠ€æœ¯ï¼Œå› æ­¤å‘æµå†™å…¥æ—¶ï¼Œä¸å¿…æ¯æ¬¡éƒ½è¿›è¡Œå®é™…çš„ç‰©ç†å†™æ“ä½œã€‚æ‰€ä»¥åœ¨è¾“å‡ºæ—¶ï¼Œæˆ‘ä»¬å¯èƒ½æ›´ç»å¸¸çš„ä½¿ç”¨å®ƒã€‚

## 4. å­—ç¬¦æ“ä½œ `Reader ` / `Writer`

`Reader` å’Œ `Writer` æä¾›å…¼å®¹ Unicode ä¸é¢å‘å­—ç¬¦çš„ I/O åŠŸèƒ½ã€‚

å…·ä½“ç±»çš„åŠŸèƒ½å’Œ `In/OutputStream` ç±»çš„åŠŸèƒ½åŸºæœ¬ç›¸åŒï¼š

<img src="https://gitee.com/veal98/images/raw/master/img/20200909214526.png" style="zoom: 50%;" />

ğŸš¨ éœ€è¦æ³¨æ„çš„æ˜¯ï¼š**åªè¦æˆ‘ä»¬ä½¿ç”¨äº† `readLine()`ï¼Œéƒ½ä¸åº”è¯¥ä½¿ç”¨ `DataInputStream`ï¼Œè€Œåº”è¯¥ä½¿ç”¨ `BufferedReader`**

```java
public static void readFileContent(String filePath) throws IOException {

    FileReader fileReader = new FileReader(filePath);
    BufferedReader bufferedReader = new BufferedReader(fileReader);

    String line;
    while ((line = bufferedReader.readLine()) != null) {
        System.out.println(line);
    }

    // è£…é¥°è€…æ¨¡å¼ä½¿å¾— BufferedReader ç»„åˆäº†ä¸€ä¸ª Reader å¯¹è±¡
    // åœ¨è°ƒç”¨ BufferedReader çš„ close() æ–¹æ³•æ—¶ä¼šå»è°ƒç”¨ Reader çš„ close() æ–¹æ³•
    // å› æ­¤åªè¦ä¸€ä¸ª close() è°ƒç”¨å³å¯
    bufferedReader.close();
}
```

## 5. I/O æµçš„å…¸å‹ä½¿ç”¨æ–¹å¼

### â‘  ç¼“å†²è¾“å…¥æ–‡ä»¶

ä¸ºäº†æé«˜æ–‡ä»¶çš„è¯»å–é€Ÿåº¦ï¼Œæˆ‘ä»¬å¯¹æ–‡ä»¶è¿›è¡Œç¼“å†²ï¼ˆ`BufferedReader`ï¼‰ï¼š

```java
public class Main {

    // ç¼“å†²è¯»å–æ–‡ä»¶
    public static String bufferRead(String filename) throws IOException {
        BufferedReader in = new BufferedReader(new FileReader(filename));
        String s;
        StringBuilder stringBuilder = new StringBuilder();
        while( (s = in.readLine()) != null){
            stringBuilder.append(s + "\n");
        }
        in.close();
        return stringBuilder.toString();
    }

    public static void main(String[] args) throws IOException {
        System.out.println(bufferRead("E:\\MyCodes\\Java\\src\\com\\smallbeef\\Main.java"));


    }
}

```

ğŸƒâ€ è¿è¡Œç»“æœï¼š

<img src="https://gitee.com/veal98/images/raw/master/img/20200911112717.png" style="zoom:50%;" />

### â‘¡ ä»å†…å­˜è¾“å…¥

å¦‚ä¸‹ç¤ºä¾‹ï¼Œ`bufferRead()` è¯»å…¥çš„ String ç»“æœè¢«ç”¨æ¥åˆ›å»ºä¸€ä¸ª `StringReader`ï¼Œç„¶åè°ƒç”¨ `StringReader.read()` æ¯æ¬¡è¯»å–ä¸€ä¸ªå­—ç¬¦ï¼Œå¹¶æŠŠå®ƒå‘é€åˆ°æ§åˆ¶å°ï¼š

```java
public class Main {

    // ç¼“å†²è¯»å–æ–‡ä»¶
    public static String bufferRead(String filename) throws IOException {
        BufferedReader in = new BufferedReader(new FileReader(filename));
        String s;
        StringBuilder stringBuilder = new StringBuilder();
        while( (s = in.readLine()) != null){
            stringBuilder.append(s + "\n");
        }
        in.close();
        return stringBuilder.toString();
    }

    public static void main(String[] args) throws IOException {
        StringReader in = new StringReader(bufferRead("E:\\MyCodes\\Java\\src\\com\\smallbeef\\Main.java"));
        int c;
        // StringReader.read() æ˜¯ä»¥ int å½¢å¼è¿”å›ä¸‹ä¸€å­—èŠ‚
        while( (c = in.read()) != -1) {
            // è¾“å‡ºæ¯ä¸ªå­—ç¬¦
            System.out.println((char)c);
        }
    }
}
```

### â‘¢ åŸºæœ¬çš„æ–‡ä»¶è¾“å‡º

`FileWriter` å¯¹è±¡å¯ä»¥å‘æ–‡ä»¶å†™å…¥æ•°æ®ã€‚æˆ‘ä»¬ä»ä¸€ä¸ªæ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œç„¶åå°†è¯¥æ•°æ®å†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶å¹¶æ·»åŠ è¡Œå·ï¼š

```java
public class Main {

    // ç¼“å†²è¯»å–æ–‡ä»¶
    public static String bufferRead(String filename) throws IOException {
        BufferedReader in = new BufferedReader(new FileReader(filename));
        String s;
        StringBuilder stringBuilder = new StringBuilder();
        while( (s = in.readLine()) != null){
            stringBuilder.append(s + "\n");
        }
        in.close();
        return stringBuilder.toString();
    }

    public static void main(String[] args) throws IOException {
        // è¯»å–æ–‡ä»¶
        BufferedReader in = new BufferedReader(
                new StringReader(
                        bufferRead("E:\\MyCodes\\Java\\src\\com\\smallbeef\\Main.java"))
        );

        // å†™å…¥æ–‡ä»¶
        PrintWriter printWriter = new PrintWriter(new BufferedWriter(new FileWriter("outFile.txt")));
        int lineCount = 1; // è¡Œå·
        String s;
        while((s = in.readLine()) != null)
            printWriter.println(lineCount ++ + ": " + s);
        printWriter.close();
        System.out.println(bufferRead("outFile.txt"));

    }
}
```

ğŸƒâ€ è¿è¡Œç»“æœï¼š

<img src="https://gitee.com/veal98/images/raw/master/img/20200911114706.png" style="zoom:50%;" />

## 6. æ ‡å‡† I/O

<u>æ ‡å‡† I/O çš„æ„ä¹‰åœ¨äºï¼šæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„æŠŠç¨‹åºä¸²è”èµ·æ¥ï¼Œä¸€ä¸ªç¨‹åºçš„æ ‡å‡†è¾“å‡ºå¯ä»¥æˆä¸ºå¦ä¸€ç¨‹åºçš„æ ‡å‡†è¾“å…¥ã€‚</u>

â­ æŒ‰ç…§æ ‡å‡† I/O æ¨¡å‹ï¼ŒJava æä¾›äº† `System.in`, `System.out`, `System.err`ã€‚

å…¶ä¸­ï¼Œ`System.out` å’Œ `System.err` å·²ç»è¢«åŒ…è£…æˆäº† `PrintStream` å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ä½† `System.in` å´æ˜¯ä¸€ä¸ªæœªç»åŒ…è£…çš„ `InputStream` ï¼Œåœ¨è¯»å– `System.in` ä¹‹å‰æˆ‘ä»¬å¿…é¡»å¯¹å…¶åŒ…è£…ï¼š

```java
BufferedReader stdin = new BufferedReader(new InputStreamReader(System.in));
String s;
// å›æ˜¾è¾“å…¥çš„æ¯ä¸€è¡Œ
while((s = stdin.readLine()) != null && s.length() != 0)
    System.out.println(s);
```

## 7. æ–° I/O `NIO`

### â‘  BIO å¸¦æ¥çš„æŒ‘æˆ˜

**BIO å³é˜»å¡ I/Oï¼Œä¸ç®¡æ˜¯ç£ç›˜ I/O è¿˜æ˜¯ç½‘ç»œ I/Oï¼Œæ•°æ®åœ¨å†™å…¥ `OutputStream` æˆ–è€…ä» `InputStream` è¯»å–æ—¶éƒ½æœ‰å¯èƒ½ä¼šé˜»å¡ã€‚**ä¸€æ—¦æœ‰çº¿ç¨‹é˜»å¡å°†ä¼šå¤±å» CPU çš„ä½¿ç”¨æƒï¼Œè¿™åœ¨å½“å‰çš„å¤§è§„æ¨¡è®¿é—®é‡å’Œæœ‰æ€§èƒ½è¦æ±‚æƒ…å†µä¸‹æ˜¯ä¸èƒ½æ¥å—çš„ã€‚

è™½ç„¶å½“å‰çš„ç½‘ç»œ I/O æœ‰ä¸€äº›è§£å†³åŠæ³•ï¼Œå¦‚ä¸€ä¸ªå®¢æˆ·ç«¯ä¸€ä¸ªå¤„ç†çº¿ç¨‹ï¼Œå‡ºç°é˜»å¡æ—¶åªæ˜¯ä¸€ä¸ªçº¿ç¨‹é˜»å¡è€Œä¸ä¼šå½±å“å…¶å®ƒçº¿ç¨‹å·¥ä½œï¼Œè¿˜æœ‰ä¸ºäº†å‡å°‘ç³»ç»Ÿçº¿ç¨‹çš„å¼€é”€ï¼Œé‡‡ç”¨çº¿ç¨‹æ± çš„åŠæ³•æ¥å‡å°‘çº¿ç¨‹åˆ›å»ºå’Œå›æ”¶çš„æˆæœ¬ï¼Œä½†æ˜¯æœ‰ä¸€äº›ä½¿ç”¨åœºæ™¯ä»ç„¶æ˜¯æ— æ³•è§£å†³çš„ã€‚å¦‚å½“å‰ä¸€äº›éœ€è¦å¤§é‡ HTTP é•¿è¿æ¥çš„æƒ…å†µï¼Œåƒæ·˜å®ç°åœ¨ä½¿ç”¨çš„ Web æ—ºæ—ºé¡¹ç›®ï¼ŒæœåŠ¡ç«¯éœ€è¦åŒæ—¶ä¿æŒå‡ ç™¾ä¸‡çš„ HTTP è¿æ¥ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ¯æ—¶æ¯åˆ»è¿™äº›è¿æ¥éƒ½åœ¨ä¼ è¾“æ•°æ®ï¼Œè¿™ç§æƒ…å†µä¸‹ä¸å¯èƒ½åŒæ—¶åˆ›å»ºè¿™ä¹ˆå¤šçº¿ç¨‹æ¥ä¿æŒè¿æ¥ã€‚å³ä½¿çº¿ç¨‹çš„æ•°é‡ä¸æ˜¯é—®é¢˜ï¼Œä»ç„¶æœ‰ä¸€äº›é—®é¢˜è¿˜æ˜¯æ— æ³•é¿å…çš„ã€‚

å¦‚è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬æƒ³ç»™æŸäº›å®¢æˆ·ç«¯æ›´é«˜çš„æœåŠ¡ä¼˜å…ˆçº§ï¼Œå¾ˆéš¾é€šè¿‡è®¾è®¡çº¿ç¨‹çš„ä¼˜å…ˆçº§æ¥å®Œæˆï¼Œå¦å¤–ä¸€ç§æƒ…å†µæ˜¯ï¼Œæˆ‘ä»¬éœ€è¦è®©æ¯ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚åœ¨æœåŠ¡ç«¯å¯èƒ½éœ€è¦è®¿é—®ä¸€äº›ç«äº‰èµ„æºï¼Œç”±äºè¿™äº›å®¢æˆ·ç«¯æ˜¯åœ¨ä¸åŒçº¿ç¨‹ä¸­ï¼Œå› æ­¤éœ€è¦åŒæ­¥ï¼Œè€Œå¾€å¾€è¦å®ç°è¿™äº›åŒæ­¥æ“ä½œè¦è¿œè¿œæ¯”ç”¨å•çº¿ç¨‹å¤æ‚å¾ˆå¤šã€‚ä»¥ä¸Šè¿™äº›æƒ…å†µéƒ½è¯´æ˜ï¼Œæˆ‘ä»¬éœ€è¦å¦å¤–ä¸€ç§æ–°çš„ I/O æ“ä½œæ–¹å¼ã€‚

æ–°çš„è¾“å…¥/è¾“å‡º (**NIOï¼ŒNon-Blocking I/Oï¼Œéé˜»å¡ I/O**) åº“æ˜¯åœ¨ JDK 1.4 ä¸­å¼•å…¥çš„ï¼Œå¼¥è¡¥äº†åŸæ¥çš„ I/O çš„ä¸è¶³ï¼Œæä¾›äº†é«˜é€Ÿçš„ã€é¢å‘å—çš„ I/Oã€‚

NIO çš„ä¸‰ä¸ªå…³é”®ç±»ï¼š

- `Channel` é€šé“
- `Buffer` ç¼“å†²åŒº
- `Selector `é€‰æ‹©å™¨

### â‘¡ æµä¸å—çš„æ¯”è¾ƒ

åŸæ¥çš„ I/O åº“(åœ¨ `java.io.*`ä¸­) ä¸ NIO æœ€é‡è¦çš„åŒºåˆ«æ˜¯æ•°æ®æ‰“åŒ…å’Œä¼ è¾“çš„æ–¹å¼ã€‚æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œ**åŸæ¥çš„ I/O ä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œ NIO ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚**

*é¢å‘æµ* çš„ I/O ç³»ç»Ÿä¸€æ¬¡ä¸€ä¸ªå­—èŠ‚åœ°å¤„ç†æ•°æ®ã€‚ä¸€ä¸ªè¾“å…¥æµäº§ç”Ÿä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œä¸€ä¸ªè¾“å‡ºæµæ¶ˆè´¹ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚ä¸ºæµå¼æ•°æ®åˆ›å»ºè¿‡æ»¤å™¨éå¸¸å®¹æ˜“ã€‚é“¾æ¥å‡ ä¸ªè¿‡æ»¤å™¨ï¼Œä»¥ä¾¿æ¯ä¸ªè¿‡æ»¤å™¨åªè´Ÿè´£å•ä¸ªå¤æ‚å¤„ç†æœºåˆ¶çš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ ·ä¹Ÿæ˜¯ç›¸å¯¹ç®€å•çš„ã€‚ä¸åˆ©çš„ä¸€é¢æ˜¯ï¼Œé¢å‘æµçš„ I/O é€šå¸¸ç›¸å½“æ…¢ã€‚

ä¸€ä¸ª *é¢å‘å—* çš„ I/O ç³»ç»Ÿä»¥å—çš„å½¢å¼å¤„ç†æ•°æ®ã€‚æ¯ä¸€ä¸ªæ“ä½œéƒ½åœ¨ä¸€æ­¥ä¸­äº§ç”Ÿæˆ–è€…æ¶ˆè´¹ä¸€ä¸ªæ•°æ®å—ã€‚æŒ‰å—å¤„ç†æ•°æ®æ¯”æŒ‰(æµå¼çš„)å­—èŠ‚å¤„ç†æ•°æ®è¦å¿«å¾—å¤šã€‚ä½†æ˜¯é¢å‘å—çš„ I/O ç¼ºå°‘ä¸€äº›é¢å‘æµçš„ I/O æ‰€å…·æœ‰çš„ä¼˜é›…æ€§å’Œç®€å•æ€§ã€‚

### â‘¢ é€šé“å’Œç¼“å†²åŒº

#### â…  æ¦‚è¿°

`é€šé“ Channel ` å’Œ `ç¼“å†²åŒº Buffer `æ˜¯ NIO ä¸­çš„æ ¸å¿ƒå¯¹è±¡ï¼Œå‡ ä¹åœ¨æ¯ä¸€ä¸ª I/O æ“ä½œä¸­éƒ½è¦ä½¿ç”¨å®ƒä»¬ã€‚

é€šé“æ˜¯å¯¹åŸ I/O åŒ…ä¸­çš„æµçš„æ¨¡æ‹Ÿã€‚åˆ°ä»»ä½•ç›®çš„åœ°(æˆ–æ¥è‡ªä»»ä½•åœ°æ–¹)çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»é€šè¿‡ä¸€ä¸ª Channel å¯¹è±¡ã€‚ä¸€ä¸ª Buffer å®è´¨ä¸Šæ˜¯ä¸€ä¸ªå®¹å™¨å¯¹è±¡ã€‚**å‘é€ç»™ä¸€ä¸ªé€šé“çš„æ‰€æœ‰å¯¹è±¡éƒ½å¿…é¡»é¦–å…ˆæ”¾åˆ°ç¼“å†²åŒºä¸­ï¼›åŒæ ·åœ°ï¼Œä»é€šé“ä¸­è¯»å–çš„ä»»ä½•æ•°æ®éƒ½è¦è¯»åˆ°ç¼“å†²åŒºä¸­ã€‚**

#### â…¡ ä»€ä¹ˆæ˜¯ç¼“å†²åŒº

`Buffer` æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œ å®ƒåŒ…å«ä¸€äº›è¦å†™å…¥æˆ–è€…åˆšè¯»å‡ºçš„æ•°æ®ã€‚ åœ¨ NIO ä¸­åŠ å…¥ `Buffer` å¯¹è±¡ï¼Œä½“ç°äº†æ–°åº“ä¸åŸ I/O çš„ä¸€ä¸ªé‡è¦åŒºåˆ«ã€‚åœ¨é¢å‘æµçš„ I/O ä¸­ï¼Œæ‚¨å°†æ•°æ®ç›´æ¥å†™å…¥æˆ–è€…å°†æ•°æ®ç›´æ¥è¯»åˆ° `Stream` å¯¹è±¡ä¸­ã€‚

â­ **åœ¨ NIO åº“ä¸­ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ˜¯ç”¨ç¼“å†²åŒºå¤„ç†çš„ã€‚åœ¨è¯»å–æ•°æ®æ—¶ï¼Œå®ƒæ˜¯ç›´æ¥è¯»åˆ°ç¼“å†²åŒºä¸­çš„ã€‚åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œå®ƒæ˜¯å†™å…¥åˆ°ç¼“å†²åŒºä¸­çš„ã€‚ä»»ä½•æ—¶å€™è®¿é—® NIO ä¸­çš„æ•°æ®ï¼Œæ‚¨éƒ½æ˜¯å°†å®ƒæ”¾åˆ°ç¼“å†²åŒºä¸­ã€‚**

ç¼“å†²åŒºå®è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ã€‚é€šå¸¸å®ƒæ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ç§ç±»çš„æ•°ç»„ã€‚ä½†æ˜¯ä¸€ä¸ªç¼“å†²åŒºä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ç¼“å†²åŒºæä¾›äº†å¯¹æ•°æ®çš„ç»“æ„åŒ–è®¿é—®ï¼Œè€Œä¸”è¿˜å¯ä»¥è·Ÿè¸ªç³»ç»Ÿçš„è¯»/å†™è¿›ç¨‹ã€‚

#### â…¢ ç¼“å†²åŒºç±»å‹

æœ€å¸¸ç”¨çš„ç¼“å†²åŒºç±»å‹æ˜¯ `ByteBuffer`ã€‚ä¸€ä¸ª `ByteBuffer` å¯ä»¥åœ¨å…¶åº•å±‚å­—èŠ‚æ•°ç»„ä¸Šè¿›è¡Œ `get/set` æ“ä½œ(å³å­—èŠ‚çš„è·å–å’Œè®¾ç½®)ã€‚

`ByteBuffer` ä¸æ˜¯ NIO ä¸­å”¯ä¸€çš„ç¼“å†²åŒºç±»å‹ã€‚äº‹å®ä¸Šï¼Œå¯¹äºæ¯ä¸€ç§åŸºæœ¬ Java ç±»å‹éƒ½æœ‰ä¸€ç§ç¼“å†²åŒºç±»å‹ï¼š

- `ByteBuffer`
- `CharBuffer`
- `ShortBuffer`
- `IntBuffer`
- `LongBuffer`
- `FloatBuffer`
- `DoubleBuffer`

æ¯ä¸€ä¸ª `Buffer` ç±»éƒ½æ˜¯ `Buffer` æ¥å£çš„ä¸€ä¸ªå®ä¾‹ã€‚ é™¤äº† `ByteBuffer`ï¼Œæ¯ä¸€ä¸ª Buffer ç±»éƒ½æœ‰å®Œå…¨ä¸€æ ·çš„æ“ä½œï¼Œåªæ˜¯å®ƒä»¬æ‰€å¤„ç†çš„æ•°æ®ç±»å‹ä¸ä¸€æ ·ã€‚å› ä¸ºå¤§å¤šæ•°æ ‡å‡† I/O æ“ä½œéƒ½ä½¿ç”¨ `ByteBuffer`ï¼Œæ‰€ä»¥å®ƒå…·æœ‰æ‰€æœ‰å…±äº«çš„ç¼“å†²åŒºæ“ä½œä»¥åŠä¸€äº›ç‰¹æœ‰çš„æ“ä½œã€‚

#### â…£ ä»€ä¹ˆæ˜¯é€šé“

**`Channel`æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡å®ƒè¯»å–å’Œå†™å…¥æ•°æ®**ã€‚æ‹¿ NIO ä¸åŸæ¥çš„ I/O åšä¸ªæ¯”è¾ƒï¼Œé€šé“å°±åƒæ˜¯æµã€‚

æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œæ‰€æœ‰æ•°æ®éƒ½é€šè¿‡ `Buffer` å¯¹è±¡æ¥å¤„ç†ã€‚**æ‚¨æ°¸è¿œä¸ä¼šå°†å­—èŠ‚ç›´æ¥å†™å…¥é€šé“ä¸­**ï¼Œç›¸åï¼Œæ‚¨æ˜¯å°†æ•°æ®å†™å…¥åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªå­—èŠ‚çš„ç¼“å†²åŒºã€‚åŒæ ·ï¼Œ**æ‚¨ä¸ä¼šç›´æ¥ä»é€šé“ä¸­è¯»å–å­—èŠ‚**ï¼Œè€Œæ˜¯å°†æ•°æ®ä»é€šé“è¯»å…¥ç¼“å†²åŒºï¼Œå†ä»ç¼“å†²åŒºè·å–è¿™ä¸ªå­—èŠ‚ã€‚

#### â…¤ é€šé“ç±»å‹

é€šé“ä¸æµçš„ä¸åŒä¹‹å¤„åœ¨äº**é€šé“æ˜¯åŒå‘çš„ã€‚è€Œæµåªæ˜¯åœ¨ä¸€ä¸ªæ–¹å‘ä¸Šç§»åŠ¨**(ä¸€ä¸ªæµå¿…é¡»æ˜¯ `InputStream` æˆ–è€… `OutputStream` çš„å­ç±»)ï¼Œ <u>é€šé“ å¯ä»¥ç”¨äºè¯»ã€å†™æˆ–è€…åŒæ—¶ç”¨äºè¯»å†™</u>ã€‚

å› ä¸ºå®ƒä»¬æ˜¯åŒå‘çš„ï¼Œæ‰€ä»¥é€šé“å¯ä»¥æ¯”æµæ›´å¥½åœ°åæ˜ åº•å±‚æ“ä½œç³»ç»Ÿçš„çœŸå®æƒ…å†µã€‚ç‰¹åˆ«æ˜¯åœ¨ UNIX æ¨¡å‹ä¸­ï¼Œåº•å±‚æ“ä½œç³»ç»Ÿé€šé“æ˜¯åŒå‘çš„ã€‚

é€šé“åŒ…æ‹¬ä»¥ä¸‹ç±»å‹ï¼š

- `FileChannel`ï¼šä»æ–‡ä»¶ä¸­è¯»å†™æ•°æ®ï¼›
- `DatagramChannel`ï¼šé€šè¿‡ UDP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼›
- `SocketChannel`ï¼šé€šè¿‡ TCP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼›
- `ServerSocketChannel`ï¼šå¯ä»¥ç›‘å¬æ–°è¿›æ¥çš„ TCP è¿æ¥ï¼Œå¯¹æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„è¿æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ª `SocketChannel`ã€‚

### â‘£ NIO ä¸­çš„è¯»å’Œå†™

#### â…  æ¦‚è¿°

è¯»å’Œå†™æ˜¯ I/O çš„åŸºæœ¬è¿‡ç¨‹ã€‚ä»ä¸€ä¸ªé€šé“ä¸­è¯»å–å¾ˆç®€å•ï¼šåªéœ€åˆ›å»ºä¸€ä¸ªç¼“å†²åŒºï¼Œç„¶åè®©é€šé“å°†æ•°æ®è¯»åˆ°è¿™ä¸ªç¼“å†²åŒºä¸­ã€‚å†™å…¥ä¹Ÿç›¸å½“ç®€å•ï¼šåˆ›å»ºä¸€ä¸ªç¼“å†²åŒºï¼Œç”¨æ•°æ®å¡«å……å®ƒï¼Œç„¶åè®©é€šé“ç”¨è¿™äº›æ•°æ®æ¥æ‰§è¡Œå†™å…¥æ“ä½œã€‚

#### â…¡ ä»æ–‡ä»¶ä¸­è¯»å–

åœ¨æˆ‘ä»¬ç¬¬ä¸€ä¸ªç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬å°†ä»ä¸€ä¸ªæ–‡ä»¶ä¸­è¯»å–ä¸€äº›æ•°æ®ã€‚å¦‚æœä½¿ç”¨åŸæ¥çš„ I/Oï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€åˆ›å»ºä¸€ä¸ª `FileInputStream` å¹¶ä»å®ƒé‚£é‡Œè¯»å–ã€‚è€Œåœ¨ NIO ä¸­ï¼Œæƒ…å†µç¨æœ‰ä¸åŒï¼šæˆ‘ä»¬é¦–å…ˆä» `FileInputStream` è·å–ä¸€ä¸ª `Channel` å¯¹è±¡ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªé€šé“æ¥è¯»å–æ•°æ®ã€‚

åœ¨ NIO ç³»ç»Ÿä¸­ï¼Œä»»ä½•æ—¶å€™æ‰§è¡Œä¸€ä¸ªè¯»æ“ä½œï¼Œæ‚¨éƒ½æ˜¯ä»é€šé“ä¸­è¯»å–ï¼Œä½†æ˜¯æ‚¨ä¸æ˜¯ *ç›´æ¥* ä»é€šé“è¯»å–ã€‚å› ä¸ºæ‰€æœ‰æ•°æ®æœ€ç»ˆéƒ½é©»ç•™åœ¨ç¼“å†²åŒºä¸­ï¼Œæ‰€ä»¥æ‚¨æ˜¯ä»é€šé“è¯»åˆ°ç¼“å†²åŒºä¸­ã€‚

å› æ­¤è¯»å–æ–‡ä»¶æ¶‰åŠä¸‰ä¸ªæ­¥éª¤ï¼š(1) ä» `FileInputStream` è·å– `Channel`ï¼Œ(2) åˆ›å»º `Buffer`ï¼Œ(3) å°†æ•°æ®ä» `Channel` è¯»åˆ° `Buffer `ä¸­ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ã€‚

- ç¬¬ä¸€æ­¥æ˜¯è·å–é€šé“ã€‚æˆ‘ä»¬ä» `FileInputStream` è·å–é€šé“ï¼š

    ```java
    FileInputStream fin = new FileInputStream( "readandshow.txt" );
    FileChannel fc = fin.getChannel();
    ```

- ä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºç¼“å†²åŒºï¼š

    ```java
    ByteBuffer buffer = ByteBuffer.allocate( 1024 );
    ```

- æœ€åï¼Œéœ€è¦å°†æ•°æ®ä»é€šé“è¯»åˆ°ç¼“å†²åŒºä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

    ```java
    fc.read( buffer );
    ```

æˆ‘ä»¬ä¸éœ€è¦å‘Šè¯‰é€šé“è¦è¯»å¤šå°‘æ•°æ®åˆ°ç¼“å†²åŒºä¸­ã€‚æ¯ä¸€ä¸ªç¼“å†²åŒºéƒ½æœ‰å¤æ‚çš„**å†…éƒ¨ç»Ÿè®¡æœºåˆ¶**ï¼Œå®ƒä¼šè·Ÿè¸ªå·²ç»è¯»äº†å¤šå°‘æ•°æ®ä»¥åŠè¿˜æœ‰å¤šå°‘ç©ºé—´å¯ä»¥å®¹çº³æ›´å¤šçš„æ•°æ®ã€‚

#### â…¢ å†™å…¥æ–‡ä»¶

åœ¨ NIO ä¸­å†™å…¥æ–‡ä»¶ç±»ä¼¼äºä»æ–‡ä»¶ä¸­è¯»å–ã€‚é¦–å…ˆä» `FileOutputStream` è·å–ä¸€ä¸ªé€šé“ï¼š

```java
FileOutputStream fout = new FileOutputStream( "writesomebytes.txt" );
FileChannel fc = fout.getChannel();
```

ä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªç¼“å†²åŒºå¹¶åœ¨å…¶ä¸­æ”¾å…¥ä¸€äº›æ•°æ® - åœ¨è¿™é‡Œï¼Œæ•°æ®å°†ä»ä¸€ä¸ªåä¸º `message` çš„æ•°ç»„ä¸­å–å‡ºï¼Œè¿™ä¸ªæ•°ç»„åŒ…å«å­—ç¬¦ä¸² "Some bytes" çš„ ASCII å­—èŠ‚(åé¢å°†ä¼šè§£é‡Š `buffer.flip()` å’Œ `buffer.put()` è°ƒç”¨)ã€‚

```java
ByteBuffer buffer = ByteBuffer.allocate( 1024 );
for (int i=0; i < message.length; i++)
	buffer.put( message[i] );
buffer.flip(); // åˆ‡æ¢è¯»å†™
```

æœ€åä¸€æ­¥æ˜¯å†™å…¥ç¼“å†²åŒºä¸­ï¼š

```java
fc.write( buffer );
```

æ³¨æ„åœ¨è¿™é‡ŒåŒæ ·ä¸éœ€è¦å‘Šè¯‰é€šé“è¦å†™å…¥å¤šæ•°æ®ã€‚ç¼“å†²åŒºçš„å†…éƒ¨ç»Ÿè®¡æœºåˆ¶ä¼šè·Ÿè¸ªå®ƒåŒ…å«å¤šå°‘æ•°æ®ä»¥åŠè¿˜æœ‰å¤šå°‘æ•°æ®è¦å†™å…¥ã€‚

#### â…£ è¯»å†™ç»“åˆ

ä»¥ä¸‹å±•ç¤ºäº†ä½¿ç”¨ NIO å¿«é€Ÿå¤åˆ¶æ–‡ä»¶çš„å®ä¾‹ï¼š

```java
public static void fastCopy(String src, String dist) throws IOException {

    /* è·å¾—æºæ–‡ä»¶çš„è¾“å…¥å­—èŠ‚æµ */
    FileInputStream fin = new FileInputStream(src);

    /* è·å–è¾“å…¥å­—èŠ‚æµçš„æ–‡ä»¶é€šé“ */
    FileChannel fcin = fin.getChannel();

    /* è·å–ç›®æ ‡æ–‡ä»¶çš„è¾“å‡ºå­—èŠ‚æµ */
    FileOutputStream fout = new FileOutputStream(dist);

    /* è·å–è¾“å‡ºå­—èŠ‚æµçš„æ–‡ä»¶é€šé“ */
    FileChannel fcout = fout.getChannel();

    /* ä¸ºç¼“å†²åŒºåˆ†é… 1024 ä¸ªå­—èŠ‚ */
    ByteBuffer buffer = ByteBuffer.allocateDirect(1024);

    while (true) {

        /* ä»è¾“å…¥é€šé“ä¸­è¯»å–æ•°æ®åˆ°ç¼“å†²åŒºä¸­ */
        int r = fcin.read(buffer);

        /* read() è¿”å› -1 è¡¨ç¤º EOF */
        if (r == -1) {
            break;
        }

        /* åˆ‡æ¢è¯»å†™ */
        buffer.flip();

        /* æŠŠç¼“å†²åŒºçš„å†…å®¹å†™å…¥è¾“å‡ºæ–‡ä»¶ä¸­ */
        fcout.write(buffer);

        /* æ¸…ç©ºç¼“å†²åŒº */
        buffer.clear();
    }
}
```

### â‘¤ ç¼“å†²åŒºå†…éƒ¨ç»†èŠ‚

æœ¬èŠ‚å°†ä»‹ç» NIO ä¸­ä¸¤ä¸ªé‡è¦çš„ç¼“å†²åŒºç»„ä»¶ï¼š**çŠ¶æ€å˜é‡**å’Œ**è®¿é—®æ–¹æ³•** (accessor)ã€‚

çŠ¶æ€å˜é‡æ˜¯"å†…éƒ¨ç»Ÿè®¡æœºåˆ¶"çš„å…³é”®ã€‚æ¯ä¸€ä¸ªè¯»/å†™æ“ä½œéƒ½ä¼šæ”¹å˜ç¼“å†²åŒºçš„çŠ¶æ€ã€‚é€šè¿‡è®°å½•å’Œè·Ÿè¸ªè¿™äº›å˜åŒ–ï¼Œç¼“å†²åŒºå°±å¯èƒ½å¤Ÿå†…éƒ¨åœ°ç®¡ç†è‡ªå·±çš„èµ„æºã€‚

åœ¨ä»é€šé“è¯»å–æ•°æ®æ—¶ï¼Œæ•°æ®è¢«æ”¾å…¥åˆ°ç¼“å†²åŒºã€‚åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œå¯ä»¥å°†è¿™ä¸ªç¼“å†²åŒºç›´æ¥å†™å…¥å¦ä¸€ä¸ªé€šé“ï¼Œä½†æ˜¯åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ‚¨è¿˜éœ€è¦æŸ¥çœ‹æ•°æ®ã€‚è¿™æ˜¯ä½¿ç”¨ *è®¿é—®æ–¹æ³•* `get()` æ¥å®Œæˆçš„ã€‚åŒæ ·ï¼Œå¦‚æœè¦å°†åŸå§‹æ•°æ®æ”¾å…¥ç¼“å†²åŒºä¸­ï¼Œå°±è¦ä½¿ç”¨è®¿é—®æ–¹æ³• `put()`ã€‚

#### â…  çŠ¶æ€å˜é‡

å¯ä»¥ç”¨ä¸‰ä¸ªå€¼æŒ‡å®šç¼“å†²åŒºåœ¨ä»»æ„æ—¶åˆ»çš„çŠ¶æ€ï¼š

- `position`
- `limit`
- `capacity`

##### Position

æ‚¨å¯ä»¥å›æƒ³ä¸€ä¸‹ï¼Œç¼“å†²åŒºå®é™…ä¸Šå°±æ˜¯ç¾åŒ–äº†çš„æ•°ç»„ã€‚åœ¨ä»é€šé“è¯»å–æ—¶ï¼Œæ‚¨å°†æ‰€è¯»å–çš„æ•°æ®æ”¾åˆ°åº•å±‚çš„æ•°ç»„ä¸­ã€‚ `position` å˜é‡è·Ÿè¸ªå·²ç»å†™äº†å¤šå°‘æ•°æ®ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œå®ƒ**æŒ‡å®šä¸‹ä¸€ä¸ªå­—èŠ‚å°†æ”¾åˆ°æ•°ç»„çš„å“ªä¸€ä¸ªå…ƒç´ ä¸­**ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨ä»é€šé“ä¸­è¯»ä¸‰ä¸ªå­—èŠ‚åˆ°ç¼“å†²åŒºä¸­ï¼Œé‚£ä¹ˆç¼“å†²åŒºçš„ `position` å°†ä¼šè®¾ç½®ä¸º 3ï¼ŒæŒ‡å‘æ•°ç»„ä¸­ç¬¬å››ä¸ªå…ƒç´ ã€‚

åŒæ ·ï¼Œåœ¨å†™å…¥é€šé“æ—¶ï¼Œæ‚¨æ˜¯ä»ç¼“å†²åŒºä¸­è·å–æ•°æ®ã€‚ `position` å€¼è·Ÿè¸ªä»ç¼“å†²åŒºä¸­è·å–äº†å¤šå°‘æ•°æ®ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œå®ƒæŒ‡å®šä¸‹ä¸€ä¸ªå­—èŠ‚æ¥è‡ªæ•°ç»„çš„å“ªä¸€ä¸ªå…ƒç´ ã€‚å› æ­¤å¦‚æœä»ç¼“å†²åŒºå†™äº†5ä¸ªå­—èŠ‚åˆ°é€šé“ä¸­ï¼Œé‚£ä¹ˆç¼“å†²åŒºçš„ `position` å°†è¢«è®¾ç½®ä¸º5ï¼ŒæŒ‡å‘æ•°ç»„çš„ç¬¬å…­ä¸ªå…ƒç´ ã€‚

##### Limit

**`limit` å˜é‡è¡¨æ˜è¿˜æœ‰å¤šå°‘æ•°æ®éœ€è¦å–å‡º(åœ¨ä»ç¼“å†²åŒºå†™å…¥é€šé“æ—¶)ï¼Œæˆ–è€…è¿˜æœ‰å¤šå°‘ç©ºé—´å¯ä»¥æ”¾å…¥æ•°æ®(åœ¨ä»é€šé“è¯»å…¥ç¼“å†²åŒºæ—¶)ã€‚**

`position` æ€»æ˜¯å°äºæˆ–è€…ç­‰äº `limit`ã€‚

##### Capacity

ç¼“å†²åŒºçš„ `capacity` è¡¨æ˜å¯ä»¥å‚¨å­˜åœ¨ç¼“å†²åŒºä¸­çš„æœ€å¤§æ•°æ®å®¹é‡ã€‚å®é™…ä¸Šï¼Œå®ƒæŒ‡å®šäº†åº•å±‚æ•°ç»„çš„å¤§å° â€• æˆ–è€…è‡³å°‘æ˜¯æŒ‡å®šäº†å‡†è®¸æˆ‘ä»¬ä½¿ç”¨çš„åº•å±‚æ•°ç»„çš„å®¹é‡ã€‚

`limit` å†³ä¸èƒ½å¤§äº `capacity`ã€‚

##### è§‚å¯Ÿå˜é‡

â‘  æ–°å»ºä¸€ä¸ªå¤§å°ä¸º 8 ä¸ªå­—èŠ‚çš„ç¼“å†²åŒºï¼Œæ­¤æ—¶ position ä¸º 0ï¼Œè€Œ limit = capacity = 8ã€‚capacity å˜é‡ä¸ä¼šæ”¹å˜ï¼Œä¸‹é¢çš„è®¨è®ºä¼šå¿½ç•¥å®ƒã€‚

![](https://gitee.com/veal98/images/raw/master/img/20200911213459.png)

â‘¡ ä»è¾“å…¥é€šé“ä¸­è¯»å– 5 ä¸ªå­—èŠ‚æ•°æ®å†™å…¥ç¼“å†²åŒºä¸­ï¼Œæ­¤æ—¶ position ä¸º 5ï¼Œlimit ä¿æŒä¸å˜ã€‚

![](https://gitee.com/veal98/images/raw/master/img/20200911213530.png)

â‘¢ åœ¨å°†ç¼“å†²åŒºçš„æ•°æ®å†™åˆ°è¾“å‡ºé€šé“ä¹‹å‰ï¼Œéœ€è¦å…ˆè°ƒç”¨ **`flip()` æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°† limit è®¾ç½®ä¸ºå½“å‰ positionï¼Œå¹¶å°† position è®¾ç½®ä¸º 0**ã€‚

![](https://gitee.com/veal98/images/raw/master/img/20200911213628.png)

â‘£ ä»ç¼“å†²åŒºä¸­å– 4 ä¸ªå­—èŠ‚åˆ°è¾“å‡ºç¼“å†²ä¸­ï¼Œæ­¤æ—¶ position è®¾ä¸º 4ã€‚

![](https://gitee.com/veal98/images/raw/master/img/20200911213643.png)

â‘¤ æœ€åéœ€è¦è°ƒç”¨ `clear()` æ–¹æ³•æ¥æ¸…ç©ºç¼“å†²åŒºï¼Œæ­¤æ—¶ position å’Œ limit éƒ½è¢«è®¾ç½®ä¸ºæœ€åˆä½ç½®ã€‚

![](https://gitee.com/veal98/images/raw/master/img/20200911213658.png)

#### â…¡ è®¿é—®æ–¹æ³•

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªæ˜¯ä½¿ç”¨ç¼“å†²åŒºå°†æ•°æ®ä»ä¸€ä¸ªé€šé“è½¬ç§»åˆ°å¦ä¸€ä¸ªé€šé“ã€‚ç„¶è€Œï¼Œç¨‹åºç»å¸¸éœ€è¦ç›´æ¥å¤„ç†æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½éœ€è¦å°†ç”¨æˆ·æ•°æ®ä¿å­˜åˆ°ç£ç›˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¿…é¡»å°†è¿™äº›æ•°æ®ç›´æ¥æ”¾å…¥ç¼“å†²åŒºï¼Œç„¶åç”¨é€šé“å°†ç¼“å†²åŒºå†™å…¥ç£ç›˜ã€‚

æˆ–è€…ï¼Œæ‚¨å¯èƒ½æƒ³è¦ä»ç£ç›˜è¯»å–ç”¨æˆ·æ•°æ®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨è¦å°†æ•°æ®ä»é€šé“è¯»åˆ°ç¼“å†²åŒºä¸­ï¼Œç„¶åæ£€æŸ¥ç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚

åœ¨æœ¬èŠ‚çš„æœ€åï¼Œæˆ‘ä»¬å°†è¯¦ç»†åˆ†æå¦‚ä½•ä½¿ç”¨ `ByteBuffer` ç±»çš„ `get()` å’Œ `put()` æ–¹æ³•ç›´æ¥è®¿é—®ç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚

##### get() æ–¹æ³•

`ByteBuffer` ç±»ä¸­æœ‰å››ä¸ª `get()` æ–¹æ³•ï¼š

1. `byte get();`
2. `ByteBuffer get( byte dst[] );`
3. `ByteBuffer get( byte dst[], int offset, int length );`
4. `byte get( int index );`

ç¬¬ä¸€ä¸ªæ–¹æ³•è·å–å•ä¸ªå­—èŠ‚ã€‚ç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªæ–¹æ³•å°†ä¸€ç»„å­—èŠ‚è¯»åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚ç¬¬å››ä¸ªæ–¹æ³•ä»ç¼“å†²åŒºä¸­çš„ç‰¹å®šä½ç½®è·å–å­—èŠ‚ã€‚é‚£äº›è¿”å› `ByteBuffer` çš„æ–¹æ³•åªæ˜¯è¿”å›è°ƒç”¨å®ƒä»¬çš„ç¼“å†²åŒºçš„ `this` å€¼ã€‚

æ­¤å¤–ï¼Œå‰ä¸‰ä¸ª `get()` æ–¹æ³•æ˜¯ç›¸å¯¹çš„ï¼Œè€Œæœ€åä¸€ä¸ªæ–¹æ³•æ˜¯ç»å¯¹çš„ã€‚ *ç›¸å¯¹* æ„å‘³ç€ `get()` æ“ä½œæœä» `limit` å’Œ `position` å€¼ â€• æ›´æ˜ç¡®åœ°è¯´ï¼Œå­—èŠ‚æ˜¯ä»å½“å‰ `position` è¯»å–çš„ï¼Œè€Œ `position` åœ¨ `get` ä¹‹åä¼šå¢åŠ ã€‚

ä¸Šé¢åˆ—å‡ºçš„æ–¹æ³•å¯¹åº”äº `ByteBuffer` ç±»ã€‚å…¶ä»–ç±»æœ‰ç­‰ä»·çš„ `get()` æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•é™¤äº†ä¸æ˜¯å¤„ç†å­—èŠ‚å¤–ï¼Œå…¶å®ƒæ–¹é¢æ˜¯æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œå®ƒä»¬å¤„ç†çš„æ˜¯ä¸è¯¥ç¼“å†²åŒºç±»ç›¸é€‚åº”çš„ç±»å‹ã€‚

##### put()æ–¹æ³•

`ByteBuffer` ç±»ä¸­æœ‰äº”ä¸ª `put()` æ–¹æ³•ï¼š

1. `ByteBuffer put( byte b );`
2. `ByteBuffer put( byte src[] );`
3. `ByteBuffer put( byte src[], int offset, int length );`
4. `ByteBuffer put( ByteBuffer src );`
5. `ByteBuffer put( int index, byte b );`

ç¬¬ä¸€ä¸ªæ–¹æ³• `å†™å…¥ï¼ˆputï¼‰ `å•ä¸ªå­—èŠ‚ã€‚ç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªæ–¹æ³•å†™å…¥æ¥è‡ªä¸€ä¸ªæ•°ç»„çš„ä¸€ç»„å­—èŠ‚ã€‚ç¬¬å››ä¸ªæ–¹æ³•å°†æ•°æ®ä»ä¸€ä¸ªç»™å®šçš„æº `ByteBuffer` å†™å…¥è¿™ä¸ª `ByteBuffer`ã€‚ç¬¬äº”ä¸ªæ–¹æ³•å°†å­—èŠ‚å†™å…¥ç¼“å†²åŒºä¸­ç‰¹å®šçš„ `ä½ç½® `ã€‚é‚£äº›è¿”å› `ByteBuffer` çš„æ–¹æ³•åªæ˜¯è¿”å›è°ƒç”¨å®ƒä»¬çš„ç¼“å†²åŒºçš„ `this` å€¼ã€‚

ä¸ `get()` æ–¹æ³•ä¸€æ ·ï¼Œæˆ‘ä»¬å°†æŠŠ `put()` æ–¹æ³•åˆ’åˆ†ä¸º *ç›¸å¯¹* æˆ–è€… *ç»å¯¹* çš„ã€‚å‰å››ä¸ªæ–¹æ³•æ˜¯ç›¸å¯¹çš„ï¼Œè€Œç¬¬äº”ä¸ªæ–¹æ³•æ˜¯ç»å¯¹çš„ã€‚

ä¸Šé¢æ˜¾ç¤ºçš„æ–¹æ³•å¯¹åº”äº `ByteBuffer` ç±»ã€‚å…¶ä»–ç±»æœ‰ç­‰ä»·çš„ `put()` æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•é™¤äº†ä¸æ˜¯å¤„ç†å­—èŠ‚ä¹‹å¤–ï¼Œå…¶å®ƒæ–¹é¢æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚å®ƒä»¬å¤„ç†çš„æ˜¯ä¸è¯¥ç¼“å†²åŒºç±»ç›¸é€‚åº”çš„ç±»å‹ã€‚

##### ç±»å‹åŒ–çš„ get() å’Œ put() æ–¹æ³•

é™¤äº†å‰äº›å°èŠ‚ä¸­æè¿°çš„ `get()` å’Œ `put()` æ–¹æ³•ï¼Œ `ByteBuffer` è¿˜æœ‰ç”¨äºè¯»å†™ä¸åŒç±»å‹çš„å€¼çš„å…¶ä»–æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

- `getByte()`
- `getChar()`
- `getShort()`
- `getInt()`
- `getLong()`
- `getFloat()`
- `getDouble()`
- `putByte()`
- `putChar()`
- `putShort()`
- `putInt()`
- `putLong()`
- `putFloat()`
- `putDouble()`

äº‹å®ä¸Šï¼Œè¿™å…¶ä¸­çš„æ¯ä¸ªæ–¹æ³•éƒ½æœ‰ä¸¤ç§ç±»å‹ â€• ä¸€ç§æ˜¯ç›¸å¯¹çš„ï¼Œå¦ä¸€ç§æ˜¯ç»å¯¹çš„ã€‚å®ƒä»¬å¯¹äºè¯»å–æ ¼å¼åŒ–çš„äºŒè¿›åˆ¶æ•°æ®ï¼ˆå¦‚å›¾åƒæ–‡ä»¶çš„å¤´éƒ¨ï¼‰å¾ˆæœ‰ç”¨ã€‚

### â‘¥ é€‰æ‹©å™¨

NIO å¸¸å¸¸è¢«å«åšéé˜»å¡ IOï¼Œä¸»è¦æ˜¯å› ä¸º NIO åœ¨ç½‘ç»œé€šä¿¡ä¸­çš„éé˜»å¡ç‰¹æ€§è¢«å¹¿æ³›ä½¿ç”¨ã€‚

NIO å®ç°äº† IO å¤šè·¯å¤ç”¨ä¸­çš„ Reactor æ¨¡å‹ï¼Œä¸€ä¸ªçº¿ç¨‹ Thread ä½¿ç”¨ä¸€ä¸ªé€‰æ‹©å™¨ Selector é€šè¿‡è½®è¯¢çš„æ–¹å¼å»ç›‘å¬å¤šä¸ªé€šé“ Channel ä¸Šçš„äº‹ä»¶ï¼Œä»è€Œè®©ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å¤„ç†å¤šä¸ªäº‹ä»¶ã€‚

é€šè¿‡é…ç½®ç›‘å¬çš„é€šé“ Channel ä¸ºéé˜»å¡ï¼Œé‚£ä¹ˆå½“ Channel ä¸Šçš„ IO äº‹ä»¶è¿˜æœªåˆ°è¾¾æ—¶ï¼Œå°±ä¸ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ä¸€ç›´ç­‰å¾…ï¼Œè€Œæ˜¯ç»§ç»­è½®è¯¢å…¶å®ƒ Channelï¼Œæ‰¾åˆ° IO äº‹ä»¶å·²ç»åˆ°è¾¾çš„ Channel æ‰§è¡Œã€‚

å› ä¸ºåˆ›å»ºå’Œåˆ‡æ¢çº¿ç¨‹çš„å¼€é”€å¾ˆå¤§ï¼Œå› æ­¤ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªäº‹ä»¶è€Œä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªäº‹ä»¶ï¼Œå¯¹äº IO å¯†é›†å‹çš„åº”ç”¨å…·æœ‰å¾ˆå¥½åœ°æ€§èƒ½ã€‚

åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰å¥—æ¥å­— Channel æ‰èƒ½é…ç½®ä¸ºéé˜»å¡ï¼Œè€Œ FileChannel ä¸èƒ½ï¼Œä¸º FileChannel é…ç½®éé˜»å¡ä¹Ÿæ²¡æœ‰æ„ä¹‰ã€‚

<img src="https://gitee.com/veal98/images/raw/master/img/20200911220632.png" style="zoom:50%;" />

#### â‘  åˆ›å»ºé€‰æ‹©å™¨

```java
Selector selector = Selector.open();
```

#### â‘¡ å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š

```java
ServerSocketChannel ssChannel = ServerSocketChannel.open();
ssChannel.configureBlocking(false);
ssChannel.register(selector, SelectionKey.OP_ACCEPT);
```

é€šé“å¿…é¡»é…ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œå¦åˆ™ä½¿ç”¨é€‰æ‹©å™¨å°±æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ï¼Œå› ä¸ºå¦‚æœé€šé“åœ¨æŸä¸ªäº‹ä»¶ä¸Šè¢«é˜»å¡ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¸èƒ½å“åº”å…¶å®ƒäº‹ä»¶ï¼Œå¿…é¡»ç­‰å¾…è¿™ä¸ªäº‹ä»¶å¤„ç†å®Œæ¯•æ‰èƒ½å»å¤„ç†å…¶å®ƒäº‹ä»¶ï¼Œæ˜¾ç„¶è¿™å’Œé€‰æ‹©å™¨çš„ä½œç”¨èƒŒé“è€Œé©°ã€‚

åœ¨å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šæ—¶ï¼Œè¿˜éœ€è¦æŒ‡å®šè¦æ³¨å†Œçš„å…·ä½“äº‹ä»¶ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç±»ï¼š

- SelectionKey.OP_CONNECT
- SelectionKey.OP_ACCEPT
- SelectionKey.OP_READ
- SelectionKey.OP_WRITE

å®ƒä»¬åœ¨ SelectionKey çš„å®šä¹‰å¦‚ä¸‹ï¼š

```java
public static final int OP_READ = 1 << 0;
public static final int OP_WRITE = 1 << 2;
public static final int OP_CONNECT = 1 << 3;
public static final int OP_ACCEPT = 1 << 4;
```

å¯ä»¥çœ‹å‡ºæ¯ä¸ªäº‹ä»¶å¯ä»¥è¢«å½“æˆä¸€ä¸ªä½åŸŸï¼Œä»è€Œç»„æˆäº‹ä»¶é›†æ•´æ•°ã€‚ä¾‹å¦‚ï¼š

```java
int interestSet = SelectionKey.OP_READ | SelectionKey.OP_WRITE;
```

#### â‘¢ ç›‘å¬äº‹ä»¶

```java
int num = selector.select();
```

ä½¿ç”¨ select() æ¥ç›‘å¬åˆ°è¾¾çš„äº‹ä»¶ï¼Œå®ƒä¼šä¸€ç›´é˜»å¡ç›´åˆ°æœ‰è‡³å°‘ä¸€ä¸ªäº‹ä»¶åˆ°è¾¾ã€‚

#### â‘£ è·å–åˆ°è¾¾çš„äº‹ä»¶

```java
Set<SelectionKey> keys = selector.selectedKeys();
Iterator<SelectionKey> keyIterator = keys.iterator();
while (keyIterator.hasNext()) {
    SelectionKey key = keyIterator.next();
    if (key.isAcceptable()) {
        // ...
    } else if (key.isReadable()) {
        // ...
    }
    keyIterator.remove();
}
```

#### â‘¤ äº‹ä»¶å¾ªç¯

å› ä¸ºä¸€æ¬¡ select() è°ƒç”¨ä¸èƒ½å¤„ç†å®Œæ‰€æœ‰çš„äº‹ä»¶ï¼Œå¹¶ä¸”æœåŠ¡å™¨ç«¯æœ‰å¯èƒ½éœ€è¦ä¸€ç›´ç›‘å¬äº‹ä»¶ï¼Œå› æ­¤æœåŠ¡å™¨ç«¯å¤„ç†äº‹ä»¶çš„ä»£ç ä¸€èˆ¬ä¼šæ”¾åœ¨ä¸€ä¸ªæ­»å¾ªç¯å†…ã€‚

```java
while (true) {
    int num = selector.select();
    Set<SelectionKey> keys = selector.selectedKeys();
    Iterator<SelectionKey> keyIterator = keys.iterator();
    while (keyIterator.hasNext()) {
        SelectionKey key = keyIterator.next();
        if (key.isAcceptable()) {
            // ...
        } else if (key.isReadable()) {
            // ...
        }
        keyIterator.remove();
    }
}
```

## 8. å¯¹è±¡æ“ä½œ `Serializable`

### â‘  åºåˆ—åŒ–

**åºåˆ—åŒ–å°±æ˜¯å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆå­—èŠ‚åºåˆ—ï¼Œæ–¹ä¾¿å­˜å‚¨å’Œä¼ è¾“ã€‚**

- åºåˆ—åŒ–ï¼š`ObjectOutputStream.writeObject()`
- ååºåˆ—åŒ–ï¼š`ObjectInputStream.readObject()`

ä¸ä¼šå¯¹é™æ€å˜é‡è¿›è¡Œåºåˆ—åŒ–ï¼Œå› ä¸ºåºåˆ—åŒ–åªæ˜¯ä¿å­˜å¯¹è±¡çš„çŠ¶æ€ï¼Œé™æ€å˜é‡å±äºç±»çš„çŠ¶æ€ã€‚

### â‘¡ Serializable

**åºåˆ—åŒ–çš„ç±»éœ€è¦å®ç° `Serializable `æ¥å£ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ ‡å‡†ï¼Œæ²¡æœ‰ä»»ä½•æ–¹æ³•éœ€è¦å®ç°ï¼Œä½†æ˜¯å¦‚æœä¸å»å®ç°å®ƒçš„è¯è€Œè¿›è¡Œåºåˆ—åŒ–ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚**

```java
public static void main(String[] args) throws IOException, ClassNotFoundException {

    A a1 = new A(123, "abc");
    String objectFile = "file/a1";

    ObjectOutputStream objectOutputStream = new ObjectOutputStream(new FileOutputStream(objectFile));
    objectOutputStream.writeObject(a1);
    objectOutputStream.close();

    ObjectInputStream objectInputStream = new ObjectInputStream(new FileInputStream(objectFile));
    A a2 = (A) objectInputStream.readObject();
    objectInputStream.close();
    System.out.println(a2);
}

// åºåˆ—åŒ– A
private static class A implements Serializable {

    private int x;
    private String y;

    A(int x, String y) {
        this.x = x;
        this.y = y;
    }

    @Override
    public String toString() {
        return "x = " + x + "  " + "y = " + y;
    }
}
```

### â‘¢ transient

`transient `å…³é”®å­—å¯ä»¥ä½¿ä¸€äº›å±æ€§ä¸ä¼šè¢«åºåˆ—åŒ–ã€‚

`ArrayList` ä¸­å­˜å‚¨æ•°æ®çš„æ•°ç»„ `elementData ` æ˜¯ç”¨ `transient` ä¿®é¥°çš„ï¼Œå› ä¸ºè¿™ä¸ªæ•°ç»„æ˜¯åŠ¨æ€æ‰©å±•çš„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç©ºé—´éƒ½è¢«ä½¿ç”¨ï¼Œå› æ­¤å°±ä¸éœ€è¦æ‰€æœ‰çš„å†…å®¹éƒ½è¢«åºåˆ—åŒ–ã€‚é€šè¿‡é‡å†™åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹æ³•ï¼Œä½¿å¾—å¯ä»¥åªåºåˆ—åŒ–æ•°ç»„ä¸­æœ‰å†…å®¹çš„é‚£éƒ¨åˆ†æ•°æ®ã€‚

```java
private transient Object[] elementData;
```

## ğŸ“š References

- ã€ŠJava æ ¸å¿ƒæŠ€æœ¯ - å· 1 åŸºç¡€çŸ¥è¯† - ç¬¬ 10 ç‰ˆã€‹
- [IBM â€” NIO å…¥é—¨](https://www.ibm.com/developerworks/cn/education/java/j-nio/j-nio.html)
- [æ·±å…¥åˆ†æ Java I/O çš„å·¥ä½œæœºåˆ¶](https://developer.ibm.com/zh/articles/j-lo-javaio/)