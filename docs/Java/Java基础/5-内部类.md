# ğŸ® å†…éƒ¨ç±» inner class

---

å†…éƒ¨ç±»ï¼ˆinner class) æ˜¯å®šä¹‰åœ¨å¦ä¸€ä¸ªç±»ä¸­çš„ç±»ã€‚ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨å†…éƒ¨ç±»å‘¢ï¼Ÿ å…¶ä¸»è¦åŸå› æœ‰ä»¥ä¸‹ä¸‰ç‚¹ï¼š 

- â­ å†…éƒ¨ç±»æ–¹æ³•å¯ä»¥è®¿é—®è¯¥ç±»å®šä¹‰æ‰€åœ¨çš„ä½œç”¨åŸŸä¸­çš„æ•°æ®ï¼Œ åŒ…æ‹¬ç§æœ‰çš„æ•°æ®ã€‚ 
- å†…éƒ¨ç±»å¯ä»¥å¯¹åŒä¸€ä¸ªåŒ…ä¸­çš„å…¶ä»–ç±»éšè—èµ·æ¥ã€‚ 
- **å½“æƒ³è¦å®šä¹‰ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸”ä¸æƒ³ç¼–å†™å¤§é‡ä»£ç æ—¶ï¼Œä½¿ç”¨åŒ¿å ï¼ˆanonymous) å†…éƒ¨ç±»æ¯”è¾ƒä¾¿æ·**ã€‚

## 1. åˆ›å»ºå†…éƒ¨ç±»

åˆ›å»ºå†…éƒ¨ç±»çš„æ–¹å¼å°±å¦‚åŒä½ æƒ³çš„ä¸€æ ·â€”â€”æŠŠç±»çš„å®šä¹‰ç½®äºå¤–éƒ¨ç±»çš„é‡Œé¢ï¼š

```java
// Creating inner classes
public class Parcel1 {
    class Contents {
        private int i = 11;

        public int value() { return i; }
    }

    class Destination {
        private String label;

        Destination(String whereTo) {
            label = whereTo;
        }

        String readLabel() { return label; }
    }
    // Using inner classes looks just like
    // using any other class, within Parcel1:
    public void ship(String dest) {
        Contents c = new Contents();
        Destination d = new Destination(dest);
        System.out.println(d.readLabel());
    }

    public static void main(String[] args) {
        Parcel1 p = new Parcel1();
        p.ship("Tasmania"); // è¾“å‡º Tasmania
    }
}
```

å½“æˆ‘ä»¬åœ¨ `ship()` æ–¹æ³•é‡Œé¢ä½¿ç”¨å†…éƒ¨ç±»çš„æ—¶å€™ï¼Œä¸ä½¿ç”¨æ™®é€šç±»æ²¡ä»€ä¹ˆä¸åŒã€‚åœ¨è¿™é‡Œï¼Œæ˜æ˜¾çš„åŒºåˆ«åªæ˜¯å†…éƒ¨ç±»çš„åå­—æ˜¯åµŒå¥—åœ¨ `Parcel1` é‡Œé¢çš„ã€‚

æ›´å…¸å‹çš„æƒ…å†µæ˜¯ï¼Œ**å¤–éƒ¨ç±»å°†æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªæŒ‡å‘å†…éƒ¨ç±»çš„å¼•ç”¨**ï¼Œå°±åƒåœ¨ `to()` å’Œ `contents()` æ–¹æ³•ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼š

```java
// Returning a reference to an inner class
public class Parcel2 {
    class Contents {
        private int i = 11;

        public int value() { return i; }
    }

    class Destination {
        private String label;

        Destination(String whereTo) {
            label = whereTo;
        }

        String readLabel() { return label; }
    }

    public Destination to(String s) {
        return new Destination(s);
    }

    public Contents contents() {
        return new Contents();
    }

    public void ship(String dest) {
        Contents c = contents();
        Destination d = to(dest);
        System.out.println(d.readLabel());
    }

    public static void main(String[] args) {
        Parcel2 p = new Parcel2();
        p.ship("Tasmania");
        Parcel2 q = new Parcel2();
        // Defining references to inner classes:
        Parcel2.Contents c = q.contents();
        Parcel2.Destination d = q.to("Borneo");
    }
}
```

å¦‚æœæƒ³ä»å¤–éƒ¨ç±»çš„éé™æ€æ–¹æ³•ä¹‹å¤–çš„ä»»æ„ä½ç½®åˆ›å»ºæŸä¸ªå†…éƒ¨ç±»çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå¿…é¡»åƒåœ¨ `main()` æ–¹æ³•ä¸­é‚£æ ·ï¼Œå…·ä½“åœ°æŒ‡æ˜è¿™ä¸ªå¯¹è±¡çš„ç±»å‹ï¼š`OuterClassName.InnerClassName`ã€‚(åœ¨å¤–éƒ¨ç±»çš„é™æ€æ–¹æ³•ä¸­å¯ä»¥ç›´æ¥æŒ‡æ˜ç±»å‹ `InnerClassName`ï¼Œåœ¨å…¶ä»–ç±»ä¸­éœ€è¦æŒ‡æ˜` OuterClassName.InnerClassName`ã€‚)

## 2. ä½¿ç”¨å†…éƒ¨ç±»è®¿é—®å¤–éƒ¨ç±»æ‰€æœ‰å…ƒç´ 

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå†…éƒ¨ç±»ä¼¼ä¹è¿˜åªæ˜¯ä¸€ç§åå­—éšè—å’Œç»„ç»‡ä»£ç çš„æ¨¡å¼ã€‚è¿™äº›æ˜¯å¾ˆæœ‰ç”¨ï¼Œä½†è¿˜ä¸æ˜¯æœ€å¼•äººæ³¨ç›®çš„ï¼Œå®ƒè¿˜æœ‰å…¶ä»–çš„ç”¨é€”ã€‚å½“ç”Ÿæˆä¸€ä¸ªå†…éƒ¨ç±»çš„å¯¹è±¡æ—¶ï¼Œæ­¤å¯¹è±¡ä¸åˆ¶é€ å®ƒçš„å¤–éƒ¨å¯¹è±¡ï¼ˆenclosing objectï¼‰ä¹‹é—´å°±æœ‰äº†ä¸€ç§è”ç³»ï¼Œæ‰€ä»¥**å†…éƒ¨ç±»èƒ½è®¿é—®å…¶å¤–éƒ¨å¯¹è±¡çš„æ‰€æœ‰æˆå‘˜ï¼Œè€Œä¸éœ€è¦ä»»ä½•ç‰¹æ®Šæ¡ä»¶ã€‚**

```java
// Holds a sequence of Objects
interface Selector {
    boolean end();
    Object current();
    void next();
}
public class Sequence {
    private Object[] items;
    private int next = 0;
    public Sequence(int size) {
        items = new Object[size];
    }
    public void add(Object x) {
        if(next < items.length)
            items[next++] = x;
    }
    public class SequenceSelector implements Selector {
        private int i = 0;
        @Override
        public boolean end() { return i == items.length; }
        @Override
        public Object current() { return items[i]; }
        @Override
        public void next() { if(i < items.length) i++; }
    }
    public Selector selector() {
        return new SequenceSelector();
    }
    public static void main(String[] args) {
        Sequence sequence = new Sequence(10);
        for(int i = 0; i < 10; i++)
            sequence.add(Integer.toString(i));
        Selector selector = sequence.selector();
        while(!selector.end()) {
            System.out.print(selector.current() + " ");
            selector.next();
        }
    }
}
```

è¾“å‡ºä¸ºï¼š

> 0 1 2 3 4 5 6 7 8 9

â­ **æ³¨æ„å†…éƒ¨ç±» `SequenceSelector `çš„æ–¹æ³• `end()`ï¼Œ`current()` å’Œ `next()` éƒ½ç”¨åˆ°äº† `items`ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œå®ƒå¹¶ä¸æ˜¯ `SequenceSelector `çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯å¤–éƒ¨ç±»ä¸­çš„ä¸€ä¸ª `private `å­—æ®µã€‚ç„¶è€Œå†…éƒ¨ç±»å¯ä»¥è®¿é—®å…¶å¤–éƒ¨ç±»çš„æ–¹æ³•å’Œå­—æ®µï¼Œå°±åƒè‡ªå·±æ‹¥æœ‰å®ƒä»¬ä¼¼çš„ï¼Œè¿™å¸¦æ¥äº†å¾ˆå¤§çš„æ–¹ä¾¿ã€‚**

â“ <u>æ‰€ä»¥å†…éƒ¨ç±»è‡ªåŠ¨æ‹¥æœ‰å¯¹å…¶å¤–éƒ¨ç±»æ‰€æœ‰æˆå‘˜çš„è®¿é—®æƒã€‚è¿™æ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿ</u>

**å½“æŸä¸ªå¤–éƒ¨ç±»çš„å¯¹è±¡åˆ›å»ºäº†ä¸€ä¸ªå†…éƒ¨ç±»å¯¹è±¡æ—¶ï¼Œæ­¤å†…éƒ¨ç±»å¯¹è±¡å¿…å®šä¼šæ•è·ä¸€ä¸ªæŒ‡å‘é‚£ä¸ªå¤–éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ã€‚ç„¶åï¼Œåœ¨ä½ è®¿é—®æ­¤å¤–éƒ¨ç±»çš„æˆå‘˜æ—¶ï¼Œå°±æ˜¯ç”¨é‚£ä¸ªå¼•ç”¨æ¥é€‰æ‹©å¤–éƒ¨ç±»çš„æˆå‘˜ã€‚**

## 2. å†…éƒ¨ç±»çš„ç‰¹æ®Šè¯­æ³•è§„åˆ™

å¯ä»¥ä½¿ç”¨ `OuterClass.this` æ›´æ¸…æ™°çš„è¡¨ç¤ºå¤–å›´ç±»çš„å¼•ç”¨ï¼Œä¾‹å¦‚ï¼š

```java
public class TalkingClock{
    ...
    private boolean beep;
    ...
    public class TimePrinter implements ActionListener{ 
        public void actionPerformed(ActionEvent event){
            System.out.println("At the tone, the time is " + new Date);
            if (TalkingClock.this.beep) 
                Toolkit.getDefaultToolkit().beep();
        }
    }
}
```

ä½¿ç”¨ `OuterObject.new InnerClass(construction parameters)` æ›´æ¸…æ™°çš„ç¼–å†™å†…éƒ¨å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```java
TalkingClock jabberer = new TalkingClock(1000,true);
TalkingClock.TimePrinter listener = jabberer.new TimePrinter();

// ç­‰åŒäº ActionListener listener = new TimePrinter();
```

åœ¨å¤–å›´ç±»çš„ä½œç”¨åŸŸä¹‹å¤–ï¼Œå¯ä»¥è¿™æ ·å¼•ç”¨å†…éƒ¨ç±»ï¼š `OuterClass.InnerClass`

> ğŸ“œ **å†…éƒ¨ç±»ä¸­å£°æ˜çš„æ‰€æœ‰é™æ€åŸŸéƒ½å¿…é¡»æ˜¯ `final`**ã€‚åŸå› å¾ˆç®€å•ã€‚æˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªé™æ€åŸŸåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œ ä¸è¿‡å¯¹äºæ¯ä¸ªå¤–éƒ¨å¯¹è±¡ï¼Œ ä¼šåˆ†åˆ«æœ‰ä¸€ä¸ªå•ç‹¬çš„å†…éƒ¨ç±»å®ä¾‹ã€‚å¦‚æœè¿™ä¸ªåŸŸä¸æ˜¯ `final `, å®ƒå¯èƒ½å°±ä¸æ˜¯å”¯ä¸€çš„ã€‚ 
>
> **å†…éƒ¨ç±»ä¸èƒ½æœ‰ `static `æ–¹æ³•**ã€‚Java è¯­è¨€è§„èŒƒå¯¹è¿™ä¸ªé™åˆ¶æ²¡æœ‰åšä»»ä½•è§£é‡Šã€‚ä¹Ÿå¯ä»¥å…è®¸æœ‰é™æ€æ–¹æ³•ï¼Œä½†åªèƒ½è®¿é—®å¤–å›´ç±»çš„é™æ€åŸŸå’Œæ–¹æ³•ã€‚æ˜¾ç„¶ï¼ŒJava è®¾è®¡è€…è®¤ä¸ºç›¸å¯¹äºè¿™ç§å¤æ‚æ€§æ¥è¯´ï¼Œ å®ƒå¸¦æ¥çš„å¥½å¤„æœ‰äº›å¾—ä¸å¿å¤±ã€‚

## 3. å±€éƒ¨å†…éƒ¨ç±»

### â‘  åˆ›å»ºå±€éƒ¨å†…éƒ¨ç±»

å¯ä»¥åœ¨ä»£ç å—é‡Œåˆ›å»ºå†…éƒ¨ç±»ï¼Œå…¸å‹çš„æ–¹å¼æ˜¯åœ¨ä¸€ä¸ªæ–¹æ³•ä½“çš„é‡Œé¢åˆ›å»ºã€‚**å±€éƒ¨å†…éƒ¨ç±»ä¸èƒ½æœ‰è®¿é—®è¯´æ˜ç¬¦ï¼Œå› ä¸ºå®ƒä¸æ˜¯å¤–éƒ¨ç±»çš„ä¸€éƒ¨åˆ†ï¼›ä½†æ˜¯å®ƒå¯ä»¥è®¿é—®å½“å‰ä»£ç å—å†…çš„ `final `å¸¸é‡ï¼Œä»¥åŠæ­¤å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜**ã€‚

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š`TimePrinter` è¿™ä¸ªç±»åªèƒ½åœ¨ `start `æ–¹æ³•ä¸­ä½¿ç”¨

```java
public class TalkingClock{
    private int interval:
    private boolean beep;
    
    public TalkingClock(int interval, boolean beep) {}
    
    public void start(){
        class TimePrinter implements ActionListener{
            public void actionPerformed(ActionEvent event){
                System.out.println("At the tone, the time is " + new Date);
                if (beep) // è®¿é—® TalkingClock çš„ beep å˜é‡
                    Toolkit.getDefaultToolkit().beep();
            }
        }

        ActionListener listener = new TimePrinter();
        Timer t = new Timer(interval, listener);
        t.start();
    }
}
```

**å±€éƒ¨ç±»ä¸èƒ½ç”¨ `public `æˆ– `private `è®¿é—®è¯´æ˜ç¬¦è¿›è¡Œå£°æ˜ã€‚å®ƒçš„ä½œç”¨åŸŸè¢«é™å®šåœ¨å£°æ˜è¿™ä¸ªå±€éƒ¨ç±»çš„å—ä¸­ã€‚** 

ğŸ”º å±€éƒ¨ç±»æœ‰ä¸€ä¸ªä¼˜åŠ¿ï¼Œ å³å¯¹å¤–éƒ¨ä¸–ç•Œå¯ä»¥å®Œå…¨åœ°éšè—èµ·æ¥ã€‚ å³ä½¿ `TalkingClock `ç±»ä¸­çš„å…¶ä»– ä»£ç ä¹Ÿä¸èƒ½è®¿é—®å®ƒã€‚é™¤ `start `æ–¹æ³•ä¹‹å¤–ï¼Œ æ²¡æœ‰ä»»ä½•æ–¹æ³•çŸ¥é“ `TimePrinter `ç±»çš„å­˜åœ¨ã€‚

### â‘¡ è®¿é—®å¤–éƒ¨ final å¸¸é‡

ä¸å…¶ä»–å†…éƒ¨ç±»ç›¸æ¯”è¾ƒï¼Œå±€éƒ¨ç±»è¿˜æœ‰ä¸€ä¸ªä¼˜ç‚¹ã€‚**å®ƒä»¬ä¸ä»…èƒ½å¤Ÿè®¿é—®åŒ…å«å®ƒä»¬çš„å¤–éƒ¨ç±»ï¼Œ è¿˜å¯ä»¥è®¿é—®å¤–éƒ¨çš„ final å¸¸é‡ï¼ˆå½¢å‚ï¼‰**ã€‚è¿™è¯´æ˜ï¼Œ å®ƒä»¬ä¸€æ—¦èµ‹å€¼å°±ç»ä¸ä¼šæ”¹å˜ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„ç¤ºä¾‹ã€‚è¿™é‡Œï¼Œ å°† `TalkingClock `æ„é€ å™¨çš„å‚æ•° `interval `å’Œ `beep `ç§»è‡³ `start `æ–¹æ³•ä¸­ï¼š

```java
public class TalkingClock{
    private int interval:
    private final boolean beep; 
    
    public TalkingClock(int interval, boolean beep) {}
    
    public void start(int interval, final boolean beep){
        class TimePrinter implements ActionListener{
            public void actionPerformed(ActionEvent event){
                System.out.println("At the tone, the time is " + new Date);
                if (beep)  // è®¿é—® start å½¢å‚ final boolean beep
                    Toolkit.getDefaultToolkit().beep();
            }
        }

        ActionListener listener = new TimePrinter();
        Timer t = new Timer(interval, listener);
        t.start();
    }
}
```

`TalkingClock `ç±»ä¸å†éœ€è¦å­˜å‚¨å®ä¾‹å˜é‡ `beep `äº†ï¼Œå®ƒåªæ˜¯å¼•ç”¨ `start `æ–¹æ³•ä¸­çš„ `beep `å‚æ•°å˜é‡ã€‚

> ğŸ“œ **åœ¨ JavaSE 8 ä¹‹å‰**ï¼Œ å¿…é¡»æŠŠä»å±€éƒ¨ç±»è®¿é—®çš„å±€éƒ¨å˜é‡ (å½¢å‚) å£°æ˜ä¸º `final`ã€‚ **JavaSE 8 ä¹‹å**å¯ä»¥çœç•¥ `final`ï¼š
>
> ```java
> public void start(int interval, boolean beep)
> ```

ğŸ’¡ æœ‰æ—¶ï¼Œ`final `é™åˆ¶æ˜¾å¾—å¹¶ä¸å¤ªæ–¹ä¾¿ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æƒ³æ›´æ–°åœ¨ä¸€ä¸ªå°é—­ä½œç”¨åŸŸå†…çš„è®¡æ•°å™¨ã€‚è¿™é‡Œæƒ³è¦ç»Ÿè®¡ä¸€ä¸‹åœ¨æ’åºè¿‡ç¨‹ä¸­è°ƒç”¨ `compareTo `æ–¹æ³•çš„æ¬¡æ•°ã€‚

```java
int counter = 0; // Not final
Date[] dates = new Date[100];
for(int i = 0; i < dates.length; i++){
    datesp[i] = new Date(){
        public int compareTo(Date other){
            counter ++; // Errorï¼Œå› ä¸º counter ä¸æ˜¯ final å¸¸é‡, å±€éƒ¨å†…éƒ¨ç±»æ— æ³•è®¿é—®
            return super.compareTo(other);
        }
    };
}
Arrays.sort(dates);
System.out.println(counter + " comparisons.")
```

ç”±äº `counter `éœ€è¦æ›´æ–°ï¼Œ æ‰€ä»¥ä¸èƒ½å°† `counter `å£°æ˜ä¸º `final`ã€‚ `Integer `å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œ æ‰€ä»¥ä¹Ÿä¸èƒ½ç”¨ `Integer `ä»£æ›¿å®ƒã€‚ğŸ’¡ **è¡¥æ•‘çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªé•¿åº¦ä¸º 1 çš„æ•°ç»„**ï¼š

```java
int[] counter = new int[1];
Date[] dates = new Date[100];
for(int i = 0; i < dates.length; i++){
    datesp[i] = new Date(){
        public int compareTo(Date other){
            counter[0] ++; 
            return super.compareTo(other);
        }
    };
}
Arrays.sort(dates);
System.out.println(counter + " comparisons.")
```

## 5. åŒ¿åå†…éƒ¨ç±» anonymous inner class

### â‘  åˆ›å»ºåŒ¿åå†…éƒ¨ç±»ï¼šä½¿ç”¨åŸºç±»æ— å‚æ„é€ å™¨

å°†å±€éƒ¨å†…éƒ¨ç±»çš„ä½¿ç”¨å†æ·±å…¥ä¸€æ­¥ã€‚ **å‡å¦‚åªåˆ›å»ºè¿™ä¸ªç±»çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå°±ä¸å¿…å‘½åäº†ã€‚è¿™ç§ç±»è¢«ç§°ä¸ºåŒ¿åå†…éƒ¨ç±»ï¼ˆanonymous inner class)**ã€‚

```java
public interface Contents {
    int value();
}
```

```java
// Returning an instance of an anonymous inner class
public class Demo {
    public Contents contents() {
        return new Contents() { // Insert class definition
            private int i = 11;

            @Override
            public int value() { return i; }
        }; // Semicolon required
    }

    public static void main(String[] args) {
        Parcel7 p = new Parcel7();
        Contents c = p.contents();
    }
}
```

`contents()` æ–¹æ³•å°†è¿”å›å€¼çš„ç”Ÿæˆä¸è¡¨ç¤ºè¿™ä¸ªè¿”å›å€¼çš„ç±»çš„å®šä¹‰ç»“åˆåœ¨ä¸€èµ·ï¼å¦å¤–ï¼Œè¿™ä¸ªç±»æ˜¯åŒ¿åçš„ï¼Œå®ƒæ²¡æœ‰åå­—ã€‚æ›´ç³Ÿçš„æ˜¯ï¼Œçœ‹èµ·æ¥ä¼¼ä¹æ˜¯ä½ æ­£è¦åˆ›å»ºä¸€ä¸ª `Contents `å¯¹è±¡ã€‚ä½†æ˜¯ç„¶åï¼ˆåœ¨åˆ°è¾¾è¯­å¥ç»“æŸçš„åˆ†å·ä¹‹å‰ï¼‰ä½ å´è¯´ï¼šâ€œç­‰ä¸€ç­‰ï¼Œæˆ‘æƒ³åœ¨è¿™é‡Œæ’å…¥ä¸€ä¸ªç±»çš„å®šä¹‰ã€‚â€

è¿™ç§å¥‡æ€ªçš„è¯­æ³•æŒ‡çš„æ˜¯ï¼šâ€œåˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª `Contents `çš„åŒ¿åç±»çš„å¯¹è±¡ã€‚â€é€šè¿‡ `new `è¡¨è¾¾å¼è¿”å›çš„å¼•ç”¨è¢«è‡ªåŠ¨å‘ä¸Šè½¬å‹ä¸ºå¯¹ `Contents `çš„å¼•ç”¨ã€‚ä¸Šè¿°åŒ¿åå†…éƒ¨ç±»çš„è¯­æ³•æ˜¯ä¸‹è¿°å½¢å¼çš„ç®€åŒ–å½¢å¼ï¼š

```java
// innerclasses/Parcel7b.java
public class Demo {
    class MyContents implements Contents {
        private int i = 11;
        @Override
        public int value() { return i; }
    }

    public Contents contents() {
        return new MyContents();
    }

    public static void main(String[] args) {
        Parcel7b p = new Parcel7b();
        Contents c = p.contents();
    }
}

```

åœ¨è¿™ä¸ªåŒ¿åå†…éƒ¨ç±»ä¸­ï¼Œä½¿ç”¨äº†é»˜è®¤çš„æ„é€ å™¨æ¥ç”Ÿæˆ `Contents`ã€‚

### â‘¡ åˆ›å»ºåŒ¿åå†…éƒ¨ç±»ï¼šä½¿ç”¨åŸºç±»æœ‰å‚æ„é€ å™¨

ä¸‹é¢çš„ä»£ç å±•ç¤ºçš„æ˜¯ï¼Œå¦‚æœä½ çš„åŸºç±»éœ€è¦ä¸€ä¸ªæœ‰å‚æ•°çš„æ„é€ å™¨ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼š

```java
public class Wrapping {
    private int i;
    public Wrapping(int x) { i = x; }
    public int value() { return i; }
}
```
`Wrapping `æ‹¥æœ‰ä¸€ä¸ªè¦æ±‚ä¼ é€’ä¸€ä¸ªå‚æ•°çš„æ„é€ å™¨ã€‚å°½ç®¡ `Wrapping `åªæ˜¯ä¸€ä¸ªå…·æœ‰å…·ä½“å®ç°çš„æ™®é€šç±»ï¼Œä½†å®ƒè¿˜æ˜¯è¢«å¯¼å‡ºç±»å½“ä½œå…¬å…±â€œæ¥å£â€æ¥ä½¿ç”¨ï¼š

```java
// Calling the base-class constructor
public class Parcel8 {
    public Wrapping wrapping(int x) {
        // Base constructor call:
        return new Wrapping(x) { // å°†åˆé€‚çš„å‚æ•°ä¼ é€’ç»™åŸºç±»çš„æ„é€ å™¨
            @Override
            public int value() {
                return super.value() * 47;
            }
        }; // [1]
    }
    public static void main(String[] args) {
        Parcel8 p = new Parcel8();
        Wrapping w = p.wrapping(10);
    }
}
```

- ğŸš¨ [1] åœ¨åŒ¿åå†…éƒ¨ç±»æœ«å°¾çš„åˆ†å·ï¼Œå¹¶ä¸æ˜¯ç”¨æ¥æ ‡è®°æ­¤å†…éƒ¨ç±»ç»“æŸçš„ã€‚å®é™…ä¸Šï¼Œå®ƒæ ‡è®°çš„æ˜¯è¡¨è¾¾å¼çš„ç»“æŸï¼Œåªä¸è¿‡è¿™ä¸ªè¡¨è¾¾å¼æ­£å·§åŒ…å«äº†åŒ¿åå†…éƒ¨ç±»ç½¢äº†ã€‚å› æ­¤ï¼Œè¿™ä¸åˆ«çš„åœ°æ–¹ä½¿ç”¨çš„åˆ†å·æ˜¯ä¸€è‡´çš„ã€‚

### â‘¢ è®¿é—®å¤–éƒ¨ final å¸¸é‡

**åœ¨åŒ¿åç±»ä¸­å®šä¹‰å­—æ®µæ—¶ï¼Œè¿˜èƒ½å¤Ÿå¯¹å…¶æ‰§è¡Œåˆå§‹åŒ–æ“ä½œ**ï¼š

```java
public interface Destination {
    String readLabel();
}
```

```java
public class Parcel9 {
    // Argument must be final or "effectively final"
    // to use within the anonymous inner class:
    public Destination destination(final String dest) {
        return new Destination() {
            private String label = dest;
            @Override
            public String readLabel() { return label; }
        };
    }
    public static void main(String[] args) {
        Parcel9 p = new Parcel9();
        Destination d = p.destination("Tasmania");
    }
}
```

å’Œå±€éƒ¨å†…éƒ¨ç±»ä¸€æ ·ï¼Œå¦‚æœå®šä¹‰ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ï¼Œå¹¶ä¸”å¸Œæœ›å®ƒä½¿ç”¨ä¸€ä¸ªåœ¨å…¶å¤–éƒ¨å®šä¹‰çš„å¯¹è±¡ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šè¦æ±‚å…¶å‚æ•°å¼•ç”¨æ˜¯ `final ` çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒåœ¨åˆå§‹åŒ–åä¸ä¼šæ”¹å˜ï¼‰ï¼Œå°±åƒä½ åœ¨ `destination()` çš„å‚æ•°ä¸­çœ‹åˆ°çš„é‚£æ ·ã€‚<u>è¿™é‡Œçœç•¥æ‰ `final `ä¹Ÿæ²¡é—®é¢˜ï¼Œä½†æ˜¯é€šå¸¸æœ€å¥½åŠ ä¸Š `final` ä½œä¸ºä¸€ç§æš—ç¤ºã€‚</u>

### â‘£ å®ä¾‹åˆå§‹åŒ– â€” æ¨¡æ‹Ÿæ„é€ å™¨

å¦‚æœåªæ˜¯ç®€å•åœ°ç»™ä¸€ä¸ªå­—æ®µèµ‹å€¼ï¼Œé‚£ä¹ˆæ­¤ä¾‹ä¸­çš„æ–¹æ³•æ˜¯å¾ˆå¥½çš„ã€‚ä½†æ˜¯ï¼Œâ“ <u>å¦‚æœæƒ³åšä¸€äº›ç±»ä¼¼æ„é€ å™¨çš„è¡Œä¸ºï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</u> **åœ¨åŒ¿åç±»ä¸­ä¸å¯èƒ½æœ‰å‘½åæ„é€ å™¨ï¼ˆå› ä¸ºå®ƒæ ¹æœ¬æ²¡åå­—ï¼‰ï¼Œä½†é€šè¿‡å®ä¾‹åˆå§‹åŒ–ï¼Œå°±èƒ½å¤Ÿè¾¾åˆ°ä¸ºåŒ¿åå†…éƒ¨ç±»åˆ›å»ºä¸€ä¸ªæ„é€ å™¨çš„æ•ˆæœ**ï¼Œå°±åƒè¿™æ ·ï¼š

```java
// Creating a constructor for an anonymous inner class
abstract class Base {
    Base(int i) {
        System.out.println("Base constructor, i = " + i);
    }
    public abstract void f();
}

public class AnonymousConstructor {
    public static Base getBase(int i) {
        return new Base(i) {
            { System.out.println(
                    "Inside instance initializer"); }
            @Override
            public void f() {
                System.out.println("In anonymous f()");
            }
        };
    }
    public static void main(String[] args) {
        Base base = getBase(47);
        base.f();
    }
}
```

è¾“å‡ºä¸ºï¼š

> Base constructor, i = 47 
>
> Inside instance initializer 
>
> In anonymous f()

ğŸš¨ <u>åœ¨æ­¤ä¾‹ä¸­ï¼Œä¸è¦æ±‚å˜é‡ `i` ä¸€å®šæ˜¯ `final `çš„ã€‚å› ä¸º `i` åªæ˜¯è¢«è¢«ä¼ é€’ç»™åŒ¿åç±»çš„åŸºç±»çš„æ„é€ å™¨ï¼Œå¹¶ä¸ä¼šåœ¨åŒ¿åç±»å†…éƒ¨è¢«ç›´æ¥ä½¿ç”¨ã€‚</u>

ğŸ’¬ ä¸‹ä¾‹æ˜¯å¸¦**å®ä¾‹åˆå§‹åŒ–**çš„å½¢å¼ã€‚æ³¨æ„ `destination()` çš„å‚æ•°å¿…é¡»æ˜¯ `final `çš„ï¼Œå› ä¸ºå®ƒä»¬æ˜¯åœ¨åŒ¿åç±»å†…éƒ¨ä½¿ç”¨çš„ï¼ˆå³ä½¿ä¸åŠ  `final`, Java 8 çš„ç¼–è¯‘å™¨ä¹Ÿä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨åŠ ä¸Š `final`ï¼Œä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼‰ï¼š

```java
public interface Destination {
    String readLabel();
}
```

```java
// Using "instance initialization" to perform
// construction on an anonymous inner class
public class Parcel10 {
    public Destination
    destination(final String dest, final float price) {
        return new Destination() {
            private int cost;
            // Instance initialization for each object:
            {
                cost = Math.round(price);
                if(cost > 100)
                    System.out.println("Over budget!");
            }
            private String label = dest;
            @Override
            public String readLabel() { return label; }
        };
    }
    public static void main(String[] args) {
        Parcel10 p = new Parcel10();
        Destination d = p.destination("Tasmania", 101.395F); // è¾“å‡º Over budget!
    }
}
```

åŒ¿åå†…éƒ¨ç±»ä¸æ­£è§„çš„ç»§æ‰¿ç›¸æ¯”æœ‰äº›å—é™ï¼Œå› ä¸ºåŒ¿åå†…éƒ¨ç±»æ—¢å¯ä»¥æ‰©å±•ç±»ï¼Œä¹Ÿå¯ä»¥å®ç°æ¥å£ï¼Œä½†æ˜¯ä¸èƒ½ä¸¤è€…å…¼å¤‡ã€‚è€Œä¸”å¦‚æœæ˜¯å®ç°æ¥å£ï¼Œä¹Ÿåªèƒ½å®ç°ä¸€ä¸ªæ¥å£ã€‚

## 6. é™æ€å†…éƒ¨ç±»

**æœ‰æ—¶å€™ï¼Œ ä½¿ç”¨å†…éƒ¨ç±»åªæ˜¯ä¸ºäº†æŠŠä¸€ä¸ªç±»éšè—åœ¨å¦å¤–ä¸€ä¸ªç±»çš„å†…éƒ¨ï¼Œå¹¶ä¸éœ€è¦å†…éƒ¨ç±»å¼•ç”¨å¤–å›´ç±»å¯¹è±¡**ã€‚ä¸ºæ­¤ï¼Œå¯ä»¥å°†å†…éƒ¨ç±»å£°æ˜ä¸º `static`, ä»¥ä¾¿å–æ¶ˆäº§ç”Ÿçš„å¼•ç”¨ã€‚

ğŸ’¬ ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨é™æ€å†…éƒ¨ç±»çš„å…¸å‹ä¾‹å­ã€‚è€ƒè™‘ä¸€ä¸‹è®¡ç®—æ•°ç»„ä¸­æœ€å°å€¼å’Œæœ€å¤§å€¼çš„é—®é¢˜ã€‚ å½“ç„¶ï¼Œ å¯ä»¥ç¼–å†™ä¸¤ä¸ªæ–¹æ³•ï¼Œ ä¸€ä¸ªæ–¹æ³•ç”¨äºè®¡ç®—æœ€å°å€¼ï¼Œå¦ä¸€ä¸ªæ–¹æ³•ç”¨äºè®¡ç®—æœ€å¤§å€¼ã€‚**åœ¨è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œæ•°ç»„è¢«éå†ä¸¤æ¬¡ã€‚å¦‚æœåªéå†æ•°ç»„ä¸€æ¬¡ï¼Œ å¹¶èƒ½å¤ŸåŒæ—¶è®¡ç®—å‡ºæœ€å°å€¼å’Œæœ€å¤§å€¼ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¤§å¤§åœ°æé«˜æ•ˆç‡äº†ã€‚**

```java
double min = Double.POSITIVE_INFINITY;
double max = Double.NEGATIVE_INFINITY;
for(double v : values){
	if(min > v) min = v;
	if(max < v) max = v;
}
```

ç„¶è€Œï¼Œ è¿™ä¸ªæ–¹æ³•å¿…é¡»è¿”å†‹ä¸¤ä¸ªæ•°å€¼ï¼Œ ä¸ºæ­¤ï¼Œ **å¯ä»¥å®šä¹‰ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå€¼çš„ç±» Pair**:

```java
class Pair{
    private double first;
    private double second;
	public Pair(double f, double s){
        first = f;
       	second = s;
    }
    public double getFirtst(){
        return first;
    }
    public double getSecond(){
        return second;
    }
}
```

`minmax `æ–¹æ³•å¯ä»¥è¿”å›ä¸€ä¸ª `Pair `ç±»å‹çš„å¯¹è±¡ã€‚

```java
class ArrayAlg{
    public static Pair minmax(double[] values){
        ...
    	return new Pair(min, max);
    }
}
```

è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨è€…å¯ä»¥ä½¿ç”¨ `getFirst `å’Œ `getSecond `æ–¹æ³•è·å¾—ç­”æ¡ˆï¼š 

```java
Pair p = ArrayAlg.minmax(d); 
System.out.println("min = " + p.getFirst()); 
System.out.println("max = " + p.getSecond());
```

å½“ç„¶ï¼Œ `Pair` æ˜¯ä¸€ä¸ªååˆ†å¤§ä¼—åŒ–çš„åå­—ã€‚åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œ é™¤äº†å®šä¹‰åŒ…å«ä¸€å¯¹å­—ç¬¦ä¸²çš„ `Pair `ç±»ä¹‹å¤–ï¼Œ å…¶ä»–ç¨‹åºå‘˜ä¹Ÿå¾ˆå¯èƒ½ä½¿ç”¨è¿™ä¸ªåå­—ã€‚è¿™æ ·å°±ä¼šäº§ç”Ÿåå­—å†²çªã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³• æ˜¯å°† `Pair `å®šä¹‰ä¸º `ArrayAlg `çš„å†…éƒ¨å…¬æœ‰ç±»ã€‚æ­¤åï¼Œ é€šè¿‡ `ArrayAlg.Pair` è®¿é—®å®ƒï¼š

```java
ArrayAlg.Pair p = ArrayAlg.minmax(d);
```

ä¸è¿‡ï¼Œä¸å‰é¢ä¾‹å­ä¸­æ‰€ä½¿ç”¨çš„å†…éƒ¨ç±»ä¸åŒï¼Œ åœ¨ `Pair `å¯¹è±¡ä¸­ä¸éœ€è¦å¼•ç”¨ä»»ä½•å…¶ä»–çš„å¯¹è±¡ï¼Œ ä¸ºæ­¤ï¼Œå¯ä»¥å°†è¿™ä¸ªå†…éƒ¨ç±»å£°æ˜ä¸º `static`:

```java
class ArrayAlg{
	class static Pair{
        private double first;
        private double second;
        public Pair(double f, double s){
            first = f;
            second = s;
        }
        public double getFirtst(){
            return first;
        }
        public double getSecond(){
            return second;
        }
	}
    public static Pair minmax(double[] values){
        ...
    	return new Pair(min, max); 
    }
}
```

å½“ç„¶ï¼Œ åªæœ‰å†…éƒ¨ç±»å¯ä»¥å£°æ˜ä¸º `static`ã€‚é™æ€å†…éƒ¨ç±»çš„å¯¹è±¡é™¤äº†æ²¡æœ‰å¯¹ç”Ÿæˆå®ƒçš„å¤–å›´ç±»å¯¹è±¡çš„å¼•ç”¨ç‰¹æƒå¤–ï¼Œ ä¸å…¶ä»–æ‰€æœ‰å†…éƒ¨ç±»å®Œå…¨ä¸€æ ·ã€‚**åœ¨æˆ‘ä»¬åˆ—ä¸¾çš„ç¤ºä¾‹ä¸­ï¼Œ å¿…é¡»ä½¿ç”¨é™æ€å†…éƒ¨ç±»ï¼Œ è¿™æ˜¯ç”±äºå†…éƒ¨ç±»å¯¹è±¡æ˜¯åœ¨é™æ€æ–¹æ³•ä¸­æ„é€ çš„**ï¼š 

```java
public static Pair minmax(double[] values){
    ...
    return new Pair(min, max); 
}
```

 å¦‚æœæ²¡æœ‰å°† `Pair `ç±»å£°æ˜ä¸º `static`, é‚£ä¹ˆç¼–è¯‘å™¨å°†ä¼šç»™å‡ºé”™è¯¯æŠ¥å‘Šï¼š <u>æ²¡æœ‰å¯ç”¨çš„éšå¼ `ArrayAlg ` ç±»å‹å¯¹è±¡åˆå§‹åŒ–å†…éƒ¨ç±»å¯¹è±¡ã€‚</u>

## 7. private å†…éƒ¨ç±»

æ™®é€šï¼ˆéå†…éƒ¨ï¼‰ç±»çš„è®¿é—®æƒé™ä¸èƒ½è¢«è®¾ä¸º `private `æˆ–è€… `protected`ï¼›ä»–ä»¬åªèƒ½è®¾ç½®ä¸º `public `æˆ– `package `è®¿é—®æƒé™ã€‚

`private `å†…éƒ¨ç±»ç»™ç±»çš„è®¾è®¡è€…æä¾›äº†ä¸€ç§é€”å¾„ï¼Œé€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥å®Œå…¨é˜»æ­¢ä»»ä½•ä¾èµ–äºç±»å‹çš„ç¼–ç ï¼Œå¹¶ä¸”å®Œå…¨éšè—äº†å®ç°çš„ç»†èŠ‚ã€‚æ­¤å¤–ï¼Œä»å®¢æˆ·ç«¯ç¨‹åºå‘˜çš„è§’åº¦æ¥çœ‹ï¼Œç”±äºä¸èƒ½è®¿é—®ä»»ä½•æ–°å¢åŠ çš„ã€åŸæœ¬ä¸å±äºå…¬å…±æ¥å£çš„æ–¹æ³•ï¼Œæ‰€ä»¥æ‰©å±•æ¥å£æ˜¯æ²¡æœ‰ä»·å€¼çš„ã€‚è¿™ä¹Ÿç»™ Java ç¼–è¯‘å™¨æä¾›äº†ç”Ÿæˆé«˜æ•ˆä»£ç çš„æœºä¼šã€‚

å®šä¹‰ä¸¤ä¸ªæ¥å£ï¼š

```java
// innerclasses/Destination.java
public interface Destination {
    String readLabel();
}
```

```java
// innerclasses/Contents.java
public interface Contents {
    int value();
}

```

ç°åœ¨ `Contents `å’Œ `Destination `è¡¨ç¤ºå®¢æˆ·ç«¯ç¨‹åºå‘˜å¯ç”¨çš„æ¥å£ã€‚è®°ä½ï¼Œæ¥å£çš„æ‰€æœ‰æˆå‘˜è‡ªåŠ¨è¢«è®¾ç½®ä¸º `public`ã€‚

å½“å–å¾—äº†ä¸€ä¸ªæŒ‡å‘åŸºç±»æˆ–æ¥å£çš„å¼•ç”¨æ—¶ï¼Œç”šè‡³å¯èƒ½æ— æ³•æ‰¾å‡ºå®ƒç¡®åˆ‡çš„ç±»å‹ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š

```java
// innerclasses/TestParcel.java
class Parcel4 {
    private class PContents implements Contents {
        private int i = 11;
        @Override
        public int value() { return i; }
    }
    protected final class PDestination implements Destination {
        private String label;
        private PDestination(String whereTo) {
            label = whereTo;
        }
        @Override
        public String readLabel() { return label; }
    }
    public Destination destination(String s) {
        return new PDestination(s);
    }
    public Contents contents() {
        return new PContents();
    }
}
public class TestParcel {
    public static void main(String[] args) {
        Parcel4 p = new Parcel4();
        Contents c = p.contents();
        Destination d = p.destination("Tasmania");
        // Parcel4.PContents pc = p.new PContents();  Error: can't access private class:
    }
}
```

**åœ¨ `Parcel4 `ä¸­ï¼Œå†…éƒ¨ç±» `PContents `æ˜¯ `private`ï¼Œæ‰€ä»¥é™¤äº† `Parcel4`ï¼Œæ²¡æœ‰äººèƒ½è®¿é—®å®ƒã€‚**

`PDestination `æ˜¯ `protected`ï¼Œæ‰€ä»¥åªæœ‰ `Parcel4 `åŠå…¶å­ç±»ã€è¿˜æœ‰ä¸ `Parcel4 `åŒä¸€ä¸ªåŒ…ä¸­çš„ç±»ï¼ˆå› ä¸º `protected `ä¹Ÿç»™äºˆäº†åŒ…è®¿é—®æƒï¼‰èƒ½è®¿é—® `PDestination`ï¼Œå…¶ä»–ç±»éƒ½ä¸èƒ½è®¿é—® `PDestination`ã€‚

## 8. ç»§æ‰¿å†…éƒ¨ç±»

å› ä¸ºå†…éƒ¨ç±»çš„æ„é€ å™¨å¿…é¡»è¿æ¥åˆ°æŒ‡å‘å…¶å¤–éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ï¼Œæ‰€ä»¥åœ¨ç»§æ‰¿å†…éƒ¨ç±»çš„æ—¶å€™ï¼Œäº‹æƒ…ä¼šå˜å¾—æœ‰ç‚¹å¤æ‚ã€‚é—®é¢˜åœ¨äºï¼Œé‚£ä¸ªæŒ‡å‘å¤–éƒ¨ç±»å¯¹è±¡çš„â€œç§˜å¯†çš„â€å¼•ç”¨å¿…é¡»è¢«åˆå§‹åŒ–ï¼Œè€Œåœ¨æ´¾ç”Ÿç±»ä¸­ä¸å†å­˜åœ¨å¯è¿æ¥çš„é»˜è®¤å¯¹è±¡ã€‚

è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¿…é¡»ä½¿ç”¨ç‰¹æ®Šçš„è¯­æ³•æ¥æ˜ç¡®è¯´æ¸…å®ƒä»¬ä¹‹é—´çš„å…³è”ï¼š

```java
// Inheriting an inner class
class WithInner {
    class Inner {}
}
public class InheritInner extends WithInner.Inner { // ç»§æ‰¿å†…éƒ¨ç±»
    InheritInner(WithInner wi) {
        wi.super();
    }
    public static void main(String[] args) {
        WithInner wi = new WithInner();
        InheritInner ii = new InheritInner(wi);
    }

```

å¯ä»¥çœ‹åˆ°ï¼Œ`InheritInner `åªç»§æ‰¿è‡ªå†…éƒ¨ç±»ï¼Œè€Œä¸æ˜¯å¤–éƒ¨ç±»ã€‚ä½†æ˜¯å½“è¦ç”Ÿæˆä¸€ä¸ªæ„é€ å™¨æ—¶ï¼Œé»˜è®¤çš„æ„é€ å™¨å¹¶ä¸ç®—å¥½ï¼Œè€Œä¸”ä¸èƒ½åªæ˜¯ä¼ é€’ä¸€ä¸ªæŒ‡å‘å¤–éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ã€‚æ­¤å¤–ï¼Œå¿…é¡»åœ¨æ„é€ å™¨å†…ä½¿ç”¨å¦‚ä¸‹è¯­æ³•ï¼š

```java
çˆ¶ç±»(å†…éƒ¨ç±»).super(); // wi.super();
```

è¿™æ ·æ‰æä¾›äº†å¿…è¦çš„å¼•ç”¨ï¼Œç„¶åç¨‹åºæ‰èƒ½ç¼–è¯‘é€šè¿‡ã€‚

## 9. å†…éƒ¨ç±»å¯ä»¥è¢«è¦†ç›–ä¹ˆï¼Ÿ

å¦‚æœåˆ›å»ºäº†ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œç„¶åç»§æ‰¿å…¶å¤–éƒ¨ç±»å¹¶é‡æ–°å®šä¹‰æ­¤å†…éƒ¨ç±»æ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œå†…éƒ¨ç±»å¯ä»¥è¢«è¦†ç›–å—ï¼Ÿè¿™çœ‹èµ·æ¥ä¼¼ä¹æ˜¯ä¸ªå¾ˆæœ‰ç”¨çš„æ€æƒ³ï¼Œä½†æ˜¯â€œè¦†ç›–â€å†…éƒ¨ç±»å°±å¥½åƒå®ƒæ˜¯å¤–éƒ¨ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå…¶å®å¹¶ä¸èµ·ä»€ä¹ˆä½œç”¨ï¼š

```java
// innerclasses/BigEgg.java
// An inner class cannot be overridden like a method
class Egg {
    private Yolk y;
    protected class Yolk {
        public Yolk() {
            System.out.println("Egg.Yolk()");
        }
    }
    Egg() {
        System.out.println("New Egg()");
        y = new Yolk();
    }
}
public class BigEgg extends Egg {
    public class Yolk {
        public Yolk() {
            System.out.println("BigEgg.Yolk()");
        }
    }
    public static void main(String[] args) {
        new BigEgg();
    }
}å¤åˆ¶ErrorOK!
```

è¾“å‡ºä¸ºï¼š

> New Egg()
>
> Egg.Yolk()

é»˜è®¤çš„æ— å‚æ„é€ å™¨æ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œè¿™é‡Œæ˜¯è°ƒç”¨åŸºç±»çš„é»˜è®¤æ„é€ å™¨ã€‚ä½ å¯èƒ½è®¤ä¸ºæ—¢ç„¶åˆ›å»ºäº† **BigEgg** çš„å¯¹è±¡ï¼Œé‚£ä¹ˆæ‰€ä½¿ç”¨çš„åº”è¯¥æ˜¯â€œè¦†ç›–åâ€çš„ **Yolk** ç‰ˆæœ¬ï¼Œä½†ä»è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°å®é™…æƒ…å†µå¹¶ä¸æ˜¯è¿™æ ·çš„ã€‚

è¿™ä¸ªä¾‹å­è¯´æ˜ï¼Œå½“ç»§æ‰¿äº†æŸä¸ªå¤–éƒ¨ç±»çš„æ—¶å€™ï¼Œå†…éƒ¨ç±»å¹¶æ²¡æœ‰å‘ç”Ÿä»€ä¹ˆç‰¹åˆ«ç¥å¥‡çš„å˜åŒ–ã€‚è¿™ä¸¤ä¸ªå†…éƒ¨ç±»æ˜¯å®Œå…¨ç‹¬ç«‹çš„ä¸¤ä¸ªå®ä½“ï¼Œå„è‡ªåœ¨è‡ªå·±çš„å‘½åç©ºé—´å†…ã€‚å½“ç„¶ï¼Œæ˜ç¡®åœ°ç»§æ‰¿æŸä¸ªå†…éƒ¨ç±»ä¹Ÿæ˜¯å¯ä»¥çš„ï¼š

```java
// Proper inheritance of an inner class
class Egg2 {
    protected class Yolk {
        public Yolk() {
            System.out.println("Egg2.Yolk()");
        }
        public void f() {
            System.out.println("Egg2.Yolk.f()");
        }
    }
    private Yolk y = new Yolk();
    Egg2() { System.out.println("New Egg2()"); }
    public void insertYolk(Yolk yy) { y = yy; }
    public void g() { y.f(); }
}
public class BigEgg2 extends Egg2 {
    public class Yolk extends Egg2.Yolk {
        public Yolk() {
            System.out.println("BigEgg2.Yolk()");
        }
        @Override
        public void f() {
            System.out.println("BigEgg2.Yolk.f()");
        }
    }
    public BigEgg2() { insertYolk(new Yolk()); }
    public static void main(String[] args) {
        Egg2 e2 = new BigEgg2();
        e2.g();
    }
}å¤åˆ¶ErrorOK!
```

è¾“å‡ºä¸ºï¼š

> Egg2.Yolk()
>
> New Egg2()
>
> Egg2.Yolk()
>
> BigEgg2.Yolk()
>
> BigEgg2.Yolk.f()

ç°åœ¨ `BigEgg2.Yolk` é€šè¿‡` extends Egg2.Yolk` æ˜ç¡®åœ°ç»§æ‰¿äº†æ­¤å†…éƒ¨ç±»ï¼Œå¹¶ä¸”è¦†ç›–äº†å…¶ä¸­çš„æ–¹æ³•ã€‚`insertYolk()` æ–¹æ³•å…è®¸ `BigEgg2 `å°†å®ƒè‡ªå·±çš„ `Yolk `å¯¹è±¡å‘ä¸Šè½¬å‹ä¸º `Egg2 `ä¸­çš„å¼•ç”¨ `y`ã€‚æ‰€ä»¥å½“ `g()` è°ƒç”¨ `y.f()` æ—¶ï¼Œè¦†ç›–åçš„æ–°ç‰ˆçš„ `f()` è¢«æ‰§è¡Œã€‚ç¬¬äºŒæ¬¡è°ƒç”¨ `Egg2.Yolk()`ï¼Œç»“æœæ˜¯ `BigEgg2.Yolk` çš„æ„é€ å™¨è°ƒç”¨äº†å…¶åŸºç±»çš„æ„é€ å™¨ã€‚å¯ä»¥çœ‹åˆ°åœ¨è°ƒç”¨ `g()` çš„æ—¶å€™ï¼Œæ–°ç‰ˆçš„ `f()` è¢«è°ƒç”¨äº†ã€‚

## 10. å†…éƒ¨ç±»æ ‡è¯†ç¬¦ $

æ¯ä¸ªç±»éƒ½ä¼šäº§ç”Ÿä¸€ä¸ª `.class` æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†å¦‚ä½•åˆ›å»ºè¯¥ç±»å‹çš„å¯¹è±¡çš„å…¨éƒ¨ä¿¡æ¯ã€‚å†…éƒ¨ç±»ä¹ŸåŒæ ·å¦‚æ­¤ï¼Œå†…éƒ¨ç±»çš„ç±»æ–‡ä»¶å‘½åï¼š**å¤–å›´ç±»çš„åå­— ArrayAlg + `$` + å†…éƒ¨ç±»çš„åå­— Pair**ï¼Œæ¯”å¦‚ï¼š

```
ArrayAlg$Pair.class
```

å¦‚æœå†…éƒ¨ç±»æ˜¯åŒ¿åçš„ï¼Œç¼–è¯‘å™¨ä¼šç®€å•åœ°äº§ç”Ÿä¸€ä¸ªæ•°å­—ä½œä¸º å…¶æ ‡è¯†ç¬¦ï¼Œæ¯”å¦‚ï¼š

```
ArrayAlg$1.class
```

## ğŸ“š References

- ã€ŠJava æ ¸å¿ƒæŠ€æœ¯ - å· 1 åŸºç¡€çŸ¥è¯† - ç¬¬ 10 ç‰ˆã€‹
- ã€ŠThinking In Javaï¼ˆJava ç¼–ç¨‹æ€æƒ³ï¼‰- ç¬¬ 4 ç‰ˆã€‹
- [ã€ŠOn Java 8ã€‹ä¸­æ–‡ç‰ˆï¼ˆã€ŠJava ç¼–ç¨‹æ€æƒ³ã€‹- ç¬¬ 5 ç‰ˆï¼‰](https://lingcoder.gitee.io/onjava8/#/sidebar)