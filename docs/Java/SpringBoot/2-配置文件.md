# ğŸ” é…ç½®æ–‡ä»¶

---

## 1. é…ç½®æ–‡ä»¶

SpringBoot ä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶åæ˜¯å›ºå®šçš„ï¼š

- application`.properties`

  è¯­æ³•ç»“æ„ ï¼š<u>key = value</u>

- application`.yml`

  è¯­æ³•ç»“æ„ ï¼š<u>keyï¼šç©ºæ ¼ value</u>

> ğŸ“œ æ ‡è®°è¯­è¨€ï¼š
>
> - ä»¥å‰çš„é…ç½®æ–‡ä»¶ï¼›å¤§å¤šéƒ½ä½¿ç”¨çš„æ˜¯  **xxxx.xml** æ–‡ä»¶ï¼›
>
> - YAMLï¼š**ä»¥æ•°æ®ä¸ºä¸­å¿ƒ**ï¼Œæ¯” jsonã€xml ç­‰æ›´é€‚åˆåšé…ç½®æ–‡ä»¶ï¼›

ğŸ’¬ æ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ Tomcat é»˜è®¤å¯åŠ¨çš„ç«¯å£å·

YAMLï¼š

```yaml
server:
  port: 8081
```

propertiesï¼š

```properties
server.port=8081
```



## 2. YAML è¯­æ³•

### â‘  åŸºæœ¬è¯­æ³•

`k: v`ï¼šè¡¨ç¤ºä¸€å¯¹é”®å€¼å¯¹ï¼ˆç©ºæ ¼å¿…é¡»æœ‰ï¼‰

ä»¥**ç©ºæ ¼**çš„ç¼©è¿›æ¥æ§åˆ¶å±‚çº§å…³ç³»ï¼Œåªè¦æ˜¯å·¦å¯¹é½çš„ä¸€åˆ—æ•°æ®ï¼Œéƒ½æ˜¯åŒä¸€ä¸ªå±‚çº§çš„

```yaml
server:
    port: 8081
    path: /hello
```

**å±æ€§å’Œå€¼çš„å¤§å°å†™éƒ½æ˜¯ååˆ†æ•æ„Ÿçš„**ã€‚

### â‘¡ å€¼çš„å†™æ³•

#### â…  å­—é¢é‡ï¼šæ™®é€šçš„å€¼ï¼ˆæ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå¸ƒå°”ï¼‰

å­—é¢é‡ç›´æ¥å†™åœ¨åé¢å°±å¯ä»¥ ï¼Œ å­—ç¬¦ä¸²é»˜è®¤ä¸ç”¨åŠ ä¸ŠåŒå¼•å·æˆ–è€…å•å¼•å·ï¼›

```yaml
k: v
```

- `" "`ï¼šåŒå¼•å·ï¼›ä¸ä¼šè½¬ä¹‰å­—ç¬¦ä¸²é‡Œé¢çš„ç‰¹æ®Šå­—ç¬¦ï¼›ç‰¹æ®Šå­—ç¬¦ä¼šä½œä¸ºæœ¬èº«æƒ³è¡¨ç¤ºçš„æ„æ€

  ğŸ’¬ ä¾‹å¦‚ï¼š

  ```yaml
  name: "zhangsan \n lisi"
  ```

  è¾“å‡ºï¼š

  ```
  zhangsan
  lisi
  ```

- `' '`ï¼šå•å¼•å·ï¼›ä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œç‰¹æ®Šå­—ç¬¦æœ€ç»ˆåªæ˜¯ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²æ•°æ®

  ğŸ’¬ ä¾‹å¦‚ï¼š

  ```yaml
  name: â€˜zhangsan \n lisiâ€™
  ```

  è¾“å‡º

  ```
  zhangsan \n lisi
  ```

#### â…¡ Mapï¼ˆå±æ€§å’Œå€¼ï¼‰ï¼ˆé”®å€¼å¯¹ï¼‰

`k: v`ï¼šåœ¨ä¸‹ä¸€è¡Œæ¥å†™å¯¹è±¡çš„å±æ€§å’Œå€¼çš„å…³ç³»ï¼Œæ³¨æ„ç¼©è¿›

```yaml
#å¯¹è±¡ã€Mapæ ¼å¼
k: 
    v1:
    v2:
```

ğŸ’¬ ä¾‹å¦‚ï¼š

```yaml
friends:
	lastName: zhangsan
	age: 20
```

è¡Œå†…å†™æ³•ï¼š

```yaml
friends: {lastName: zhangsan,age: 18}
```

#### â…¢ æ•°ç»„ï¼ˆListã€Setï¼‰

ç”¨ `- å€¼` è¡¨ç¤ºæ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ 

ğŸ’¬ ä¾‹å¦‚ï¼š

```yaml
pets:
  - cat
  - dog
  - pig
```

è¡Œå†…å†™æ³•

```yaml
pets: [cat,dog,pig]
```

## 3. @ConfigurationProperties å…¨å±€é…ç½®æ–‡ä»¶å€¼æ³¨å…¥

### â‘  å…¨å±€é…ç½®æ–‡ä»¶å€¼æ³¨å…¥

> ğŸ“œ éœ€è¦å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨çš„ä¾èµ–ï¼Œé…ç½®æ–‡ä»¶è¿›è¡Œç»‘å®šå°±ä¼šæœ‰æç¤º
>
> ```xml
> <!-- å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨ï¼Œé…ç½®æ–‡ä»¶è¿›è¡Œç»‘å®šå°±ä¼šæœ‰æç¤ºï¼Œéœ€è¦é‡å¯ -->
> <dependency>
>  <groupId>org.springframework.boot</groupId>
>  <artifactId>spring-boot-configuration-processor</artifactId>
>  <optional>true</optional>
> </dependency>
> ```

æ³¨å…¥æ­¥éª¤ï¼š

- åœ¨ springboot é¡¹ç›®ä¸­çš„ resources ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶ `application.yml`
- ç¼–å†™å®ä½“ç±»

é…ç½®æ–‡ä»¶ `yaml` æ ¼å¼

```yaml
person:
    lastName: hello
    age: 18
    boss: false
    birth: 2017/12/12
    maps: {k1: v1,k2: 12}
    lists:
      - lisi
      - zhaoliu
    dog:
      name: å°ç‹—
      age: 12
```

é…ç½®æ–‡ä»¶ `properties` æ ¼å¼

```properties
person.last-name=å¼ ä¸‰
person.age=11
person.birth=2017/12/15
person.boss=false
person.maps.k1=v1
person.maps.k2=14
person.lists=a,b,c
person.dog.name=dog
person.dog.age=15
```

> ğŸš¨ properties é…ç½®æ–‡ä»¶åœ¨ IDEA ä¸­é»˜è®¤ utf-8 å¯èƒ½ä¼šä¹±ç ï¼Œå¦‚å›¾è¿›è¡Œç›¸åº”è®¾ç½®ï¼š
>
> ![](https://gitee.com/veal98/images/raw/master/img/20200529104339.png)

å®ä½“ç±»ï¼š

```java
/**
 * å°†é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ¯ä¸€ä¸ªå±æ€§çš„å€¼ï¼Œæ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­
 */
@Component
@ConfigurationProperties(prefix = "person")
public class Person {

    private String lastName;
    private Integer age;
    private Boolean boss;
    private Date birth;

    private Map<String,Object> maps;
    private List<Object> lists;
    private Dog dog;
	
    // æœ‰å‚æ— å‚æ„é€ ã€getã€setæ–¹æ³•ã€toString()æ–¹æ³•  
```

 * `@ConfigurationProperties`ï¼šå‘Šè¯‰ SpringBoot å°†æœ¬ç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®è¿›è¡Œç»‘å®šï¼›

   â­ **åªæœ‰è¿™ä¸ªç»„ä»¶æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œæ‰èƒ½ä½¿ç”¨å®¹å™¨æä¾›çš„ `@ConfigurationProperties` åŠŸèƒ½**ï¼›

 * `prefix = "person"`ï¼šä¸é…ç½®æ–‡ä»¶ä¸­å“ªä¸ªå±æ€§è¿›è¡Œä¸€ä¸€æ˜ å°„

### â‘¡ @Validatedï¼ˆJSR303 æ•°æ®æ ¡éªŒï¼‰

#### â…  æ¦‚è¿°

JSR303æ•°æ®æ ¡éªŒ ï¼Œ å°±æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨å­—æ®µä¸Šå¢åŠ ä¸€å±‚è¿‡æ»¤å™¨éªŒè¯ ï¼Œ ä¿è¯æ•°æ®çš„åˆæ³•æ€§

<u>ä½¿ç”¨ `@Validated` æ³¨è§£ï¼šè¡¨ç¤ºè¿™ä¸ª JavaBean ä¸­çš„å±æ€§éœ€è¦æ ¡éªŒ</u>

```java
@Component
@ConfigurationProperties(prefix = "person")
@Validated
public class Person {

    //lastNameå¿…é¡»æ˜¯é‚®ç®±æ ¼å¼
    @Email
    private String lastName;
    private Integer age;
    private Boolean boss;

    private Date birth;
    private Map<String,Object> maps;
    private List<Object> lists;
    private Dog dog;
```

#### â…¡ å¸¸è§å‚æ•°

```java
@NotNull(message="åå­—ä¸èƒ½ä¸ºç©º")
private String userName;

@Max(value=120,message="å¹´é¾„æœ€å¤§ä¸èƒ½æŸ¥è¿‡120")
private int age;

@Email(message="é‚®ç®±æ ¼å¼é”™è¯¯")
private String email;

// ç©ºæ£€æŸ¥
@Null       éªŒè¯å¯¹è±¡æ˜¯å¦ä¸ºnull
@NotNull    éªŒè¯å¯¹è±¡æ˜¯å¦ä¸ä¸ºnull, æ— æ³•æŸ¥æ£€é•¿åº¦ä¸º0çš„å­—ç¬¦ä¸²
@NotBlank   æ£€æŸ¥çº¦æŸå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯Nullè¿˜æœ‰è¢«Trimçš„é•¿åº¦æ˜¯å¦å¤§äº0,åªå¯¹å­—ç¬¦ä¸²,ä¸”ä¼šå»æ‰å‰åç©ºæ ¼.
@NotEmpty   æ£€æŸ¥çº¦æŸå…ƒç´ æ˜¯å¦ä¸ºNULLæˆ–è€…æ˜¯EMPTY.
    
// Booelanæ£€æŸ¥
@AssertTrue     éªŒè¯ Boolean å¯¹è±¡æ˜¯å¦ä¸º true  
@AssertFalse    éªŒè¯ Boolean å¯¹è±¡æ˜¯å¦ä¸º false  
    
// é•¿åº¦æ£€æŸ¥
@Size(min=, max=) éªŒè¯å¯¹è±¡ï¼ˆArray,Collection,Map,Stringï¼‰é•¿åº¦æ˜¯å¦åœ¨ç»™å®šçš„èŒƒå›´ä¹‹å†…  
@Length(min=, max=) string is between min and max included.

// æ—¥æœŸæ£€æŸ¥
@Past       éªŒè¯ Date å’Œ Calendar å¯¹è±¡æ˜¯å¦åœ¨å½“å‰æ—¶é—´ä¹‹å‰  
@Future     éªŒè¯ Date å’Œ Calendar å¯¹è±¡æ˜¯å¦åœ¨å½“å‰æ—¶é—´ä¹‹å  
@Pattern    éªŒè¯ String å¯¹è±¡æ˜¯å¦ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„è§„åˆ™
```

## 4. @Value å€¼æ³¨å…¥

`@Value` å€¼æ³¨å…¥æ˜¯ Spring ä¸­çš„æ–¹å¼

### â‘  @Value å€¼æ³¨å…¥ 

å¯ä»¥ä½¿ç”¨ `@Value` æ³¨è§£ä»é…ç½®æ–‡ä»¶ä¸­æ‰‹åŠ¨å–å€¼æˆ–è€…è‡ªç”±èµ‹å€¼ï¼Œæ”¯æŒä¸‰ç§æ–¹å¼ï¼š

- `${key} ` ä»ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ä¸­è·å–å€¼

  ```java
  @Value("${person.last-name}")
  private String lastName;
  ```

- `# {SpEL}`

  ```java
  @Value("#{11*2}")
  private Integer age;
  ```

- `"å­—é¢é‡"`

  ```java
  @Value("true")
  private Boolean boss;
  ```

```java
@Component
public class Person {
    /**
     * <bean class="Person">
     *      <property name="lastName" value="å­—é¢é‡//"></property>
     * <bean/>
     */
    @Value("${person.last-name}")
    private String lastName;
    @Value("#{11*2}")
    private Integer age;
    @Value("true")
    private Boolean boss;

    private Date birth;
    private Map<String,Object> maps;
    private List<Object> lists;
    private Dog dog;
```

### â‘¡ @Value å’Œ @ConfigurationProperties æ³¨å…¥å€¼æ¯”è¾ƒ

|                      | @ConfigurationProperties | @Value     |
| -------------------- | ------------------------ | ---------- |
| åŠŸèƒ½                 | æ‰¹é‡æ³¨å…¥é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§ | ä¸€ä¸ªä¸ªæŒ‡å®š |
| æ¾æ•£ç»‘å®šï¼ˆæ¾æ•£è¯­æ³•ï¼‰ | æ”¯æŒ                     | ä¸æ”¯æŒ     |
| SpEL                 | ä¸æ”¯æŒ                   | æ”¯æŒ       |
| JSR303æ•°æ®æ ¡éªŒ       | æ”¯æŒ                     | ä¸æ”¯æŒ     |
| **å¤æ‚ç±»å‹å°è£…**     | **æ”¯æŒ**                 | **ä¸æ”¯æŒ** |

> ğŸ’¡ **æ¾æ•£ç»‘å®š**ï¼šæ¯”å¦‚ yml ä¸­å†™çš„ `last-name`ï¼Œè¿™ä¸ªå’Œ `lastName` æ˜¯ä¸€æ ·çš„ï¼Œ **`-` åé¢è·Ÿç€çš„å­—æ¯é»˜è®¤æ˜¯å¤§å†™çš„ã€‚è¿™å°±æ˜¯æ¾æ•£ç»‘å®š**ã€‚

æ— è®ºé…ç½®æ–‡ä»¶æ˜¯ `yml `è¿˜æ˜¯ `properties `ä»–ä»¬éƒ½èƒ½è·å–åˆ°å€¼ï¼›

- å¦‚æœåªæ˜¯åœ¨æŸä¸ªä¸šåŠ¡é€»è¾‘ä¸­éœ€è¦è·å–ä¸€ä¸‹é…ç½®æ–‡ä»¶ä¸­çš„æŸé¡¹å€¼ï¼Œä½¿ç”¨ `@Value`ï¼›

  ```java
  @RestController
  public calss HelloController{
      @Value("${person.lastName}")
      private String name;
      
      @RequestMapping("/sayHello")
      public String sayHello(){
          return "Hello" + name;
      }
  }
  ```

- å¦‚æœæˆ‘ä»¬ä¸“é—¨ç¼–å†™äº†ä¸€ä¸ª JavaBean æ¥å’Œé…ç½®æ–‡ä»¶è¿›è¡Œæ˜ å°„ï¼Œå°±ç›´æ¥ä½¿ç”¨`@ConfigurationProperties`

## 5. @PropertySource æŒ‡å®šé…ç½®æ–‡ä»¶å€¼æ³¨å…¥

`@ConfigurationProperties(prefix = "person")` é»˜è®¤ä»å…¨å±€é…ç½®æ–‡ä»¶ä¸­è·å–å€¼ï¼Œå¦‚æœæ‰€æœ‰çš„é…ç½®å…¨å†™åœ¨å…¨å±€é…ç½®æ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å°±å¤ªå¤§äº†ã€‚æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ä½¿ç”¨ `@PropertySource` åŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶

æ¯”å¦‚æˆ‘ä»¬åœ¨ resources ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª `person.properties` æ–‡ä»¶

```java
@PropertySource(value = {"classpath:person.properties"})
@Component
public class Person {
    private String lastName;
    private Integer age;
    private Boolean boss;
```

## 6. @ImportResource / @Bean

`@ImportResource`ï¼šå¯¼å…¥ Spring çš„é…ç½®æ–‡ä»¶ï¼Œè®©é…ç½®æ–‡ä»¶é‡Œé¢çš„å†…å®¹ç”Ÿæ•ˆ

ï¼ˆSpring Boot é‡Œé¢æ²¡æœ‰ Spring çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿä¸èƒ½è‡ªåŠ¨è¯†åˆ«ï¼‰

`@ImportResource` æ ‡æ³¨åœ¨ä¸€ä¸ªé…ç½®ç±»ä¸Šå¯ä»¥è®© Spring çš„é…ç½®æ–‡ä»¶ç”Ÿæ•ˆå¹¶åŠ è½½è¿›æ¥ï¼›

```java
@ImportResource(locations = {"classpath:beans.xml"})
@SpringBootApplication
```

Spring çš„é…ç½®æ–‡ä»¶ `beans.xml`ï¼ˆç¤ºä¾‹ï¼šæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª service.HelloService.java æ–‡ä»¶ï¼‰

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
	
    <bean id="helloService" class="com.smallbeef.springboot.service.HelloService"></bean>
</beans>
```

ğŸŒ æ˜¾ç„¶ï¼Œè¿™æ ·ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶çš„æ–¹æ³•æ¯”è¾ƒéº»çƒ¦ï¼ŒSpringBoot æ¨èç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶çš„æ–¹å¼ï¼š**ä½¿ç”¨å…¨æ³¨è§£çš„æ–¹å¼**ï¼š

- åˆ›å»ºä¸€ä¸ª config.MyAppConfig.java é…ç½®ç±»

  ![](https://gitee.com/veal98/images/raw/master/img/20200529112651.png)

- â­ ä½¿ç”¨**@Bean** ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶

  `@Configuration` è¡¨ç¤ºæ­¤ç±»æ˜¯ Spring çš„é…ç½®ç±»ï¼ˆæ›¿ä»£åŸæ¥çš„ Spring é…ç½®æ–‡ä»¶ï¼‰

  ```java
  /**
   * @Configurationï¼šæŒ‡æ˜å½“å‰ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼›å°±æ˜¯æ¥æ›¿ä»£ä¹‹å‰çš„Springé…ç½®æ–‡ä»¶
   */
  @Configuration
  public class MyAppConfig {
  
      //å°†æ–¹æ³•çš„è¿”å›å€¼æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼›å®¹å™¨ä¸­è¿™ä¸ªç»„ä»¶é»˜è®¤çš„ id å°±æ˜¯æ–¹æ³•å
      @Bean
      public HelloService helloService02(){
          System.out.println("é…ç½®ç±» @Bean ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶äº†...");
          return new HelloService();
      }
  }
  ```

##7. é…ç½®æ–‡ä»¶å ä½ç¬¦

### â‘  éšæœºæ•°

é…ç½®æ–‡ä»¶è¿˜å¯ä»¥ç¼–å†™å ä½ç¬¦ç”Ÿæˆéšæœºæ•°

- `${random.value}`
- `${random.int}`
- `${random.long}`
- `${random.int(10)}`
- `${random.int[1024,65536]}`


### â‘¡ å ä½ç¬¦è·å–ä¹‹å‰é…ç½®çš„å€¼

```properties
person.last-name = å¼ ä¸‰${random.uuid}
person.age = ${random.int}
# åœ¨ person.last-name åé¢ æ·»åŠ  _dog å­—ç¬¦
person.dog.name=${person.last-name}_dog 
```

å¦‚æœæ²¡æœ‰å¯ä»¥æ˜¯ç”¨ `:` æŒ‡å®šé»˜è®¤å€¼

```properties
person.last-name=å¼ ä¸‰${random.uuid}
# person.dog.name = hello_dog
person.dog.name=${person.hello:hello}_dog
```

## 8. Profile å¤šç¯å¢ƒåˆ‡æ¢

profile æ˜¯ Spring å¯¹ä¸åŒç¯å¢ƒæä¾›ä¸åŒé…ç½®åŠŸèƒ½çš„æ”¯æŒï¼Œå¯ä»¥é€šè¿‡æ¿€æ´»ä¸åŒçš„ç¯å¢ƒç‰ˆæœ¬ï¼Œå®ç°å¿«é€Ÿåˆ‡æ¢ç¯å¢ƒ ğŸ‘‡ 

### â‘  å¤šé…ç½®æ–‡ä»¶

æˆ‘ä»¬åœ¨ä¸»é…ç½®æ–‡ä»¶ç¼–å†™çš„æ—¶å€™ï¼Œæ–‡ä»¶åå¯ä»¥æ˜¯ `application-{profile}.properties/yml`

æ¯”å¦‚ï¼š`application-dev.properties` ã€`application-prod.properties`

<u>é»˜è®¤ä½¿ç”¨ `application.properties` çš„é…ç½®</u>

### â‘¡ æ¿€æ´»æŒ‡å®šç¯å¢ƒ

- â­ åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š  

  ```java
  spring.profiles.active=dev
  ```

- å‘½ä»¤è¡Œï¼š

  `java -jar spring-boot-02-config-0.0.1-SNAPSHOT.jar --spring.profiles.active=devï¼›`

  å¯ä»¥ç›´æ¥åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œé…ç½®ä¼ å…¥å‘½ä»¤è¡Œå‚æ•°

- è™šæ‹Ÿæœºå‚æ•°ï¼›

  `-Dspring.profiles.active=dev`

  ![](https://gitee.com/veal98/images/raw/master/img/20200529120620.png)

### â‘¢ yml æ”¯æŒå¤šæ–‡æ¡£å—æ–¹å¼

å’Œ `properties `é…ç½®æ–‡ä»¶ä¸­ä¸€æ ·ï¼Œä½†æ˜¯**ä½¿ç”¨ `yml `å»å®ç°ä¸éœ€è¦åˆ›å»ºå¤šä¸ªé…ç½®æ–‡ä»¶**ï¼Œæ›´åŠ æ–¹ä¾¿äº†~

```yml
server: 
  port: 8081 # é»˜è®¤ç«¯å£
#é€‰æ‹©è¦æ¿€æ´»é‚£ä¸ªç¯å¢ƒå—
spring:
  profiles:
  	# æ¿€æ´»
    active: prod # ä½¿ç”¨ prod ç¯å¢ƒï¼Œ8084ç«¯å£

---
server:
  port: 8083
spring:
  profiles: dev # é…ç½®ç¯å¢ƒçš„åç§°


---
server:
  port: 8084
spring:
  profiles: prod  # é…ç½®ç¯å¢ƒçš„åç§°
```

## 9. é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®

springboot å¯åŠ¨ä¼šæ‰«æä»¥ä¸‹ä½ç½®çš„ `application.properties` æˆ–è€… `application.yml` æ–‡ä»¶ä½œä¸º Spring boot çš„é»˜è®¤é…ç½®æ–‡ä»¶

- `file:./config/` é¡¹ç›®è·¯å¾„ä¸‹çš„ config æ–‡ä»¶å¤¹é…ç½®æ–‡ä»¶

- `file:./` é¡¹ç›®è·¯å¾„ä¸‹é…ç½®æ–‡ä»¶

- `classpath:/config/` èµ„æºè·¯å¾„ä¸‹çš„ config æ–‡ä»¶å¤¹é…ç½®æ–‡ä»¶

- `classpath:/` èµ„æºè·¯å¾„ä¸‹é…ç½®æ–‡ä»¶

**ä¼˜å…ˆçº§ç”±é«˜åˆ°åº•ï¼Œé«˜ä¼˜å…ˆçº§çš„é…ç½®ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§çš„é…ç½®ï¼›**

SpringBoot ä¼šä»è¿™å››ä¸ªä½ç½®å…¨éƒ¨åŠ è½½ä¸»é…ç½®æ–‡ä»¶ï¼Œ**â­ äº’è¡¥é…ç½®**ï¼›

> ğŸ“œ æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ `spring.config.location` æ¥æ”¹å˜é»˜è®¤çš„é…ç½®æ–‡ä»¶ä½ç½®
>
> **é¡¹ç›®æ‰“åŒ…å¥½ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<u>å‘½ä»¤è¡Œ</u>å‚æ•°çš„å½¢å¼ï¼Œå¯åŠ¨é¡¹ç›®çš„æ—¶å€™æ¥æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ–°ä½ç½®ï¼›æŒ‡å®šé…ç½®æ–‡ä»¶å’Œé»˜è®¤åŠ è½½çš„è¿™äº›é…ç½®æ–‡ä»¶å…±åŒèµ·ä½œç”¨å½¢æˆäº’è¡¥é…ç½®ï¼›**
>
> æ¯”å¦‚æˆ‘ä»¬é¡¹ç›®æ‰“åŒ…ååæˆ‘ä»¬æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ–°ä½ç½®ä¸º E:/application.properties
>
> ```powershell
> java -jar spring-boot-02-config-02-0.0.1-SNAPSHOT.jar --spring.config.location=E:/application.properties
> ```

## 10. è‡ªåŠ¨é…ç½®åŸç†

é…ç½®æ–‡ä»¶åˆ°åº•èƒ½å†™ä»€ä¹ˆï¼Ÿæ€ä¹ˆå†™ï¼Ÿ[é…ç½®æ–‡ä»¶èƒ½é…ç½®çš„å±æ€§å‚ç…§](https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#common-application-properties)

### â‘  è‡ªåŠ¨é…ç½®åŸç† â­ 

#### â…  åŠ è½½ä¸»é…ç½®ç±»ï¼Œå¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½

â­ `@SpringBootApplication`ï¼ˆSpring Bootåº”ç”¨ï¼‰ï¼š**æ ‡æ³¨åœ¨æŸä¸ªç±»ä¸Šè¯´æ˜è¿™ä¸ªç±»æ˜¯ SpringBoot çš„ä¸»ç¨‹åºç±»**ï¼ŒSpringBoot å°±åº”è¯¥è¿è¡Œè¿™ä¸ªç±»çš„ `main `æ–¹æ³•æ¥å¯åŠ¨ SpringBoot åº”ç”¨ï¼›

ğŸ“‘ è¯¥æ³¨è§£æºç å¦‚ä¸‹ï¼š

```java
@SpringBootConfiguration
@EnableAutoConfiguration
@ComponentScan(
    excludeFilters = {@Filter(
    type = FilterType.CUSTOM,
    classes = {TypeExcludeFilter.class}
), @Filter(
    type = FilterType.CUSTOM,
    classes = {AutoConfigurationExcludeFilter.class}
)}
)
public @interface SpringBootApplication {
```

åº•å±‚ç”±ä¸‰ä¸ªæ³¨è§£å®ç°ï¼š

- `@SpringBootConfiguration`
- `@EnableAutoConfiguration`
- `@ComponentScan`

> â­ è‡ªåŠ¨é…ç½®ç¬¬ 1 æ­¥ï¼šSpringBoot å¯åŠ¨çš„æ—¶å€™åŠ è½½ä¸»é…ç½®ç±»ï¼ˆç”± `@SpringBootConfiguration` æ ‡è¯†ï¼‰ï¼Œå¹¶å¼€å¯äº†è‡ªåŠ¨é…ç½®åŠŸèƒ½  `@EnableAutoConfiguration`

#### â…¡ å¯¼å…¥ç»„ä»¶ï¼ˆè‡ªåŠ¨é…ç½®ç±»ï¼‰

`@EnableAutoConfiguration`ï¼š**å¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½**ã€‚

ä»¥å‰æˆ‘ä»¬éœ€è¦é…ç½®çš„ä¸œè¥¿ï¼ŒSpring Boot å¸®æˆ‘ä»¬è‡ªåŠ¨é…ç½®ï¼›

`@EnableAutoConfiguration`å‘Šè¯‰ SpringBoot å¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼Œè¿™æ ·è‡ªåŠ¨é…ç½®æ‰èƒ½ç”Ÿæ•ˆï¼›

ğŸ“‘ è¯¥æ³¨è§£çš„æºç å¦‚ä¸‹ï¼š

```java
@AutoConfigurationPackage
@Import({AutoConfigurationImportSelector.class})
public @interface EnableAutoConfiguration {
```

- â­ `@AutoConfigurationPackage`**ï¼šè‡ªåŠ¨é…ç½®åŒ…ï¼Œ**<u>å°†ä¸»é…ç½®ç±»ï¼ˆ`@SpringBootApplication`æ ‡æ³¨çš„ç±»ï¼‰çš„æ‰€åœ¨åŒ…åŠä¸‹é¢æ‰€æœ‰å­åŒ…é‡Œé¢çš„æ‰€æœ‰ç»„ä»¶æ‰«æåˆ° Spring å®¹å™¨ä¸­</u>

  ğŸ“‘ è¯¥æ³¨è§£çš„æºç å¦‚ä¸‹ï¼š

  ```java
  @Import({Registrar.class})
  public @interface AutoConfigurationPackage {
  }
  ```

  - `@Import({Registrar.class})`ï¼š`@import`æ˜¯ Spring ä¸­çš„åº•å±‚æ³¨è§£ï¼Œç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€ä¸ªç»„ä»¶

  - `Registrar.class` ä½œç”¨ï¼šå°†ä¸»å¯åŠ¨ç±»çš„æ‰€åœ¨åŒ…åŠåŒ…ä¸‹é¢æ‰€æœ‰å­åŒ…é‡Œé¢çš„æ‰€æœ‰ç»„ä»¶æ‰«æåˆ° Spring å®¹å™¨ ï¼›

- â­ `@Import({AutoConfigurationImportSelector.class})`ï¼šç»™å®¹å™¨ä¸­å¯¼å…¥ç»„ä»¶ã€‚

  `AutoConfigurationImportSelector`ï¼š**è‡ªåŠ¨é…ç½®å¯¼å…¥é€‰æ‹©å™¨**ã€‚å°†æ‰€æœ‰éœ€è¦å¯¼å…¥çš„ç»„ä»¶ä»¥å…¨ç±»åçš„æ–¹å¼è¿”å›ï¼›è¿™äº›ç»„ä»¶å°±ä¼šè¢«æ·»åŠ åˆ°å®¹å™¨ä¸­ã€‚è¯´ç™½äº†å°±æ˜¯**å¯¼å…¥ç»„ä»¶**

  é‚£ä¹ˆå®ƒä¼šå¯¼å…¥å“ªäº›ç»„ä»¶çš„é€‰æ‹©å™¨å‘¢ï¼ŸğŸ“‘ æˆ‘ä»¬ç‚¹å‡»å»è¿™ä¸ªç±» `AutoConfigurationImportSelector` çœ‹æºç ï¼š

  è¿™ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªè¿™æ ·çš„æ–¹æ³•ï¼š

  ```java
  // è·å¾—å€™é€‰çš„é…ç½®
  protected List<String> getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes) {
      // è¿™é‡Œçš„ getSpringFactoriesLoaderFactoryClass() æ–¹æ³•
      // è¿”å›çš„å°±æ˜¯å¯åŠ¨è‡ªåŠ¨å¯¼å…¥é…ç½®æ–‡ä»¶çš„æ³¨è§£ç±»ï¼›EnableAutoConfiguration
      List<String> configurations = SpringFactoriesLoader.loadFactoryNames(this.getSpringFactoriesLoaderFactoryClass(), this.getBeanClassLoader());
      Assert.notEmpty(configurations, "No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct.");
      return configurations;
  }
  ```

  è¿™ä¸ªæ–¹æ³•åˆè°ƒç”¨äº†  `SpringFactoriesLoader ` ç±»çš„é™æ€æ–¹æ³•ï¼Œæˆ‘ä»¬è¿›å…¥`SpringFactoriesLoader` ç±» `loadFactoryNames()` æ–¹æ³•ï¼š

  ```java
  public static List<String> loadFactoryNames(Class<?> factoryClass, @Nullable ClassLoader classLoader) {
      String factoryClassName = factoryClass.getName();
      // è¿™é‡Œå®ƒåˆè°ƒç”¨äº† loadSpringFactories æ–¹æ³•
      return (List)loadSpringFactories(classLoader).getOrDefault(factoryClassName, Collections.emptyList());
  }
  ```

  æˆ‘ä»¬ç»§ç»­ç‚¹å‡»æŸ¥çœ‹ `loadSpringFactories `æ–¹æ³•ï¼š

  ```java
  private static Map<String, List<String>> loadSpringFactories(@Nullable ClassLoader classLoader) {
      // è·å¾—classLoader ï¼Œ æˆ‘ä»¬è¿”å›å¯ä»¥çœ‹åˆ°è¿™é‡Œå¾—åˆ°çš„å°±æ˜¯EnableAutoConfigurationæ ‡æ³¨çš„ç±»æœ¬èº«
      MultiValueMap<String, String> result = (MultiValueMap)cache.get(classLoader);
      if (result != null) {
          return result;
      } else {
          try {
              //å»è·å–ä¸€ä¸ªèµ„æº "META-INF/spring.factories"
              Enumeration<URL> urls = classLoader != null ? classLoader.getResources("META-INF/spring.factories") : ClassLoader.getSystemResources("META-INF/spring.factories");
              LinkedMultiValueMap result = new LinkedMultiValueMap();
  
              //å°†è¯»å–åˆ°çš„èµ„æºéå†ï¼Œå°è£…æˆä¸ºä¸€ä¸ªProperties
              while(urls.hasMoreElements()) {
                  URL url = (URL)urls.nextElement();
                  UrlResource resource = new UrlResource(url);
                  Properties properties = PropertiesLoaderUtils.loadProperties(resource);
                  Iterator var6 = properties.entrySet().iterator();
  
                  while(var6.hasNext()) {
                      Entry<?, ?> entry = (Entry)var6.next();
                      String factoryClassName = ((String)entry.getKey()).trim();
                      String[] var9 = StringUtils.commaDelimitedListToStringArray((String)entry.getValue());
                      int var10 = var9.length;
  
                      for(int var11 = 0; var11 < var10; ++var11) {
                          String factoryName = var9[var11];
                          result.add(factoryClassName, factoryName.trim());
                      }
                  }
              }
  
              cache.put(classLoader, result);
              return result;
          } catch (IOException var13) {
              throw new IllegalArgumentException("Unable to load factories from location [META-INF/spring.factories]", var13);
          }
      }
  }
  ```

  â­ åœ¨ä¸Šé¢è¿™æ®µæºç ä¸­ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªå¤šæ¬¡å‡ºç°çš„æ–‡ä»¶ `spring.factories`ï¼Œåœ¨ <u>External Libraries</u> ä¸­æ‰¾åˆ°å®ƒï¼š

  <img src="https://gitee.com/veal98/images/raw/master/img/20200701105523.png" style="zoom:80%;" /> 

  å…¶ä¸­åŒ…å«äº†å¾ˆå¤šè‡ªåŠ¨é…ç½®çš„æ–‡ä»¶ï¼ˆè‡ªåŠ¨é…ç½®ç±» `xxxAutoConfiguration`ï¼‰ï¼Œè¿™å°±æ˜¯**è‡ªåŠ¨é…ç½®çš„æ ¹æºæ‰€åœ¨**ï¼

  ![](https://gitee.com/veal98/images/raw/master/img/20200701105548.png)

  æˆ‘ä»¬åœ¨ä¸Šé¢çš„è‡ªåŠ¨é…ç½®ç±»éšä¾¿æ‰¾ä¸€ä¸ªæ‰“å¼€çœ‹çœ‹ï¼Œæ¯”å¦‚ ï¼š`WebMvcAutoConfiguration`

  ![](https://gitee.com/veal98/images/raw/master/img/20200701105838.png)

  å¯ä»¥çœ‹åˆ°è¿™äº›ä¸€ä¸ªä¸ªçš„éƒ½æ˜¯JavaConfig é…ç½®ç±»ï¼Œè€Œä¸”éƒ½æ³¨å…¥äº†ä¸€äº› Beanã€‚

  > â­ è‡ªåŠ¨é…ç½®ç¬¬ 2 æ­¥ï¼šåˆ©ç”¨ `AutoConfigurationImportSelector` ç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€äº›ç»„ä»¶ï¼š
  >
  > - æ‰«ææ‰€æœ‰ jar åŒ…ç±»è·¯å¾„ä¸‹  `META-INF/spring.factories`
  >
  > - æŠŠæ‰«æåˆ°çš„è¿™äº›æ–‡ä»¶çš„å†…å®¹åŒ…è£…æˆ `properties `å¯¹è±¡
  >
  > - ä» `properties` ä¸­è·å–åˆ° `EnableAutoConfiguration.class` ç±»ï¼ˆç±»åï¼‰å¯¹åº”çš„å€¼ï¼Œç„¶åæŠŠä»–ä»¬æ·»åŠ åœ¨å®¹å™¨ä¸­
  >
  > æ€»ç»“æ¥è¯´ï¼Œå°±æ˜¯**åˆ©ç”¨ `SpringFactoriesLoader.loadFactoryNames()` å°†ç±»è·¯å¾„ä¸‹ `META-INF/spring.factories` é‡Œé¢é…ç½®çš„æ‰€æœ‰ `EnableAutoConfiguration` çš„å€¼åŠ å…¥åˆ°äº†å®¹å™¨ä¸­**ã€‚æ¯ä¸€ä¸ªè¿™æ ·çš„  `xxxAutoConfiguration` è‡ªåŠ¨é…ç½®ç±»éƒ½æ˜¯å®¹å™¨ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼Œéƒ½åŠ å…¥åˆ°å®¹å™¨ä¸­ï¼Œç”¨ä»–ä»¬æ¥åšè‡ªåŠ¨é…ç½®ï¼›

#### â…¢ ä¸¾ä¾‹åˆ†æè‡ªåŠ¨é…ç½®åŸç†

ğŸ“‘ ä»¥ `HttpEncodingAutoConfiguration`ï¼ˆHttp ç¼–ç è‡ªåŠ¨é…ç½®ï¼‰ä¸ºä¾‹è§£é‡Šè‡ªåŠ¨é…ç½®åŸç†ï¼š

```java
// è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œä»¥å‰ç¼–å†™çš„é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶
@Configuration   

// å¯åŠ¨æŒ‡å®šç±»çš„ConfigurationPropertiesåŠŸèƒ½ï¼›
// å°†é…ç½®æ–‡ä»¶ä¸­å¯¹åº”çš„å€¼å’Œ HttpEncodingProperties ç»‘å®šèµ·æ¥ï¼›
// å¹¶æŠŠHttpEncodingPropertiesåŠ å…¥åˆ°iocå®¹å™¨ä¸­
@EnableConfigurationProperties(HttpEncodingProperties.class)  

// Springåº•å±‚ @Conditional æ³¨è§£ï¼Œæ ¹æ®ä¸åŒçš„æ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³æŒ‡å®šçš„æ¡ä»¶ï¼Œæ•´ä¸ªé…ç½®ç±»é‡Œé¢çš„é…ç½®å°±ä¼šç”Ÿæ•ˆï¼›
// @ConditionalOnWebApplication åˆ¤æ–­å½“å‰åº”ç”¨æ˜¯å¦æ˜¯ web åº”ç”¨ï¼Œå¦‚æœæ˜¯ï¼Œå½“å‰é…ç½®ç±»ç”Ÿæ•ˆ
@ConditionalOnWebApplication

// åˆ¤æ–­å½“å‰é¡¹ç›®æœ‰æ²¡æœ‰è¿™ä¸ªç±» CharacterEncodingFilterï¼šSpringMVC ä¸­è¿›è¡Œä¹±ç è§£å†³çš„è¿‡æ»¤å™¨ï¼›
@ConditionalOnClass(CharacterEncodingFilter.class)  

// åˆ¤æ–­é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªé…ç½®  spring.http.encoding.enabledï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ¤æ–­ä¹Ÿæ˜¯æˆç«‹çš„
// å³ä½¿æˆ‘ä»¬é…ç½®æ–‡ä»¶ä¸­ä¸é…ç½® spring.http.encoding.enabled=trueï¼Œä¹Ÿæ˜¯é»˜è®¤ç”Ÿæ•ˆçš„ï¼›
@ConditionalOnProperty(prefix = "spring.http.encoding", value = "enabled", matchIfMissing = true)  

public class HttpEncodingAutoConfiguration {
  
  	//ä»–å·²ç»å’Œ SpringBoot çš„é…ç½®æ–‡ä»¶æ˜ å°„äº†
  	private final HttpEncodingProperties properties;
  
   // åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨çš„æƒ…å†µä¸‹ï¼Œå‚æ•°çš„å€¼å°±ä¼šä»å®¹å™¨ä¸­æ‹¿
  	public HttpEncodingAutoConfiguration(HttpEncodingProperties properties) {
		this.properties = properties;
	}
  
    @Bean   //ç»™å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶çš„æŸäº›å€¼éœ€è¦ä» properties ä¸­è·å–
	@ConditionalOnMissingBean(CharacterEncodingFilter.class) // åˆ¤æ–­å®¹å™¨æœ‰æ²¡æœ‰è¿™ä¸ªç»„ä»¶
	public CharacterEncodingFilter characterEncodingFilter() {
		CharacterEncodingFilter filter = new OrderedCharacterEncodingFilter();
		filter.setEncoding(this.properties.getCharset().name());
		filter.setForceRequestEncoding(this.properties.shouldForce(Type.REQUEST));
		filter.setForceResponseEncoding(this.properties.shouldForce(Type.RESPONSE));
		return filter;
	}
```

ğŸš© **è‡ªåŠ¨é…ç½®ç±»**ï¼šæ ¹æ®å½“å‰ä¸åŒçš„æ¡ä»¶åˆ¤æ–­ï¼Œå†³å®šè¿™ä¸ªé…ç½®ç±»æ˜¯å¦ç”Ÿæ•ˆã€‚

- ä¸€ä½†è¿™ä¸ªé…ç½®ç±»ç”Ÿæ•ˆï¼›è¿™ä¸ªé…ç½®ç±»å°±ä¼šç»™å®¹å™¨ä¸­æ·»åŠ å„ç§ç»„ä»¶ï¼›

- è¿™äº›ç»„ä»¶çš„å±æ€§æ˜¯ä»å¯¹åº”çš„ `properties` ç±»ä¸­è·å–çš„ï¼Œè¿™äº›ç±»é‡Œé¢çš„æ¯ä¸€ä¸ªå±æ€§åˆæ˜¯å’Œé…ç½®æ–‡ä»¶ç»‘å®šçš„ï¼›

- **æ‰€æœ‰åœ¨é…ç½®æ–‡ä»¶ä¸­èƒ½é…ç½®çš„å±æ€§éƒ½æ˜¯åœ¨ `xxxxProperties` ç±»ä¸­å°è£…ç€**ï¼Œé…ç½®æ–‡ä»¶èƒ½é…ç½®ä»€ä¹ˆå°±å¯ä»¥å‚ç…§æŸä¸ªåŠŸèƒ½å¯¹åº”çš„è¿™ä¸ªå±æ€§ç±»

  ğŸ“‘ æ¯”å¦‚ `HttpEncodingProperties`ï¼š

  ```java
  //ä»é…ç½®æ–‡ä»¶ä¸­è·å–æŒ‡å®šçš„å€¼å’Œ bean çš„å±æ€§è¿›è¡Œç»‘å®š
  @ConfigurationProperties(prefix = "spring.http.encoding")  
  public class HttpEncodingProperties {
  
     public static final Charset DEFAULT_CHARSET = Charset.forName("UTF-8");
  ```

  æˆ‘ä»¬å»é…ç½®æ–‡ä»¶é‡Œé¢è¯•è¯•å‰ç¼€ï¼Œçœ‹çœ‹æç¤ºï¼š

  ![](https://gitee.com/veal98/images/raw/master/img/20200703112249.png)

â­ **ç²¾é«“ï¼š**

- SpringBoot å¯åŠ¨ä¼šåŠ è½½å¤§é‡çš„è‡ªåŠ¨é…ç½®ç±»

- æˆ‘ä»¬çœ‹æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½æœ‰æ²¡æœ‰ SpringBoot é»˜è®¤å†™å¥½çš„è‡ªåŠ¨é…ç½®ç±»ï¼›

  `xxxxAutoConfigurartion`ï¼šè‡ªåŠ¨é…ç½®ç±»ï¼Œç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶

  `xxxxProperties`ï¼šå°è£…é…ç½®æ–‡ä»¶ä¸­ç›¸å…³å±æ€§

- æˆ‘ä»¬å†æ¥çœ‹è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ä¸­åˆ°åº•é…ç½®äº†å“ªäº›ç»„ä»¶ï¼›ï¼ˆåªè¦æˆ‘ä»¬è¦ç”¨çš„ç»„ä»¶æœ‰ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å†æ¥é…ç½®äº†ï¼‰

- ç»™å®¹å™¨ä¸­è‡ªåŠ¨é…ç½®ç±»æ·»åŠ ç»„ä»¶çš„æ—¶å€™ï¼Œä¼šä» `properties` ç±»ä¸­è·å–æŸäº›å±æ€§ã€‚æˆ‘ä»¬å°±å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šè¿™äº›å±æ€§çš„å€¼ï¼›

### â‘¡ @Conditional æ´¾ç”Ÿæ³¨è§£

ä½œç”¨ï¼šå¿…é¡»æ˜¯ `@Conditional` æŒ‡å®šçš„æ¡ä»¶æˆç«‹ï¼Œæ‰ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ï¼Œé…ç½®æ–‡ä»¶é‡Œé¢çš„æ‰€æœ‰å†…å®¹æ‰ç”Ÿæ•ˆï¼›

| @Conditionalæ‰©å±•æ³¨è§£            | ä½œç”¨ï¼ˆåˆ¤æ–­æ˜¯å¦æ»¡è¶³å½“å‰æŒ‡å®šæ¡ä»¶ï¼‰                 |
| ------------------------------- | ------------------------------------------------ |
| @ConditionalOnJava              | ç³»ç»Ÿçš„javaç‰ˆæœ¬æ˜¯å¦ç¬¦åˆè¦æ±‚                       |
| @ConditionalOnBean              | å®¹å™¨ä¸­å­˜åœ¨æŒ‡å®šBeanï¼›                             |
| @ConditionalOnMissingBean       | å®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šBeanï¼›                           |
| @ConditionalOnExpression        | æ»¡è¶³SpELè¡¨è¾¾å¼æŒ‡å®š                               |
| @ConditionalOnClass             | ç³»ç»Ÿä¸­æœ‰æŒ‡å®šçš„ç±»                                 |
| @ConditionalOnMissingClass      | ç³»ç»Ÿä¸­æ²¡æœ‰æŒ‡å®šçš„ç±»                               |
| @ConditionalOnSingleCandidate   | å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªæŒ‡å®šçš„Beanï¼Œæˆ–è€…è¿™ä¸ªBeanæ˜¯é¦–é€‰Bean |
| @ConditionalOnProperty          | ç³»ç»Ÿä¸­æŒ‡å®šçš„å±æ€§æ˜¯å¦æœ‰æŒ‡å®šçš„å€¼                   |
| @ConditionalOnResource          | ç±»è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨æŒ‡å®šèµ„æºæ–‡ä»¶                     |
| @ConditionalOnWebApplication    | å½“å‰æ˜¯webç¯å¢ƒ                                    |
| @ConditionalOnNotWebApplication | å½“å‰ä¸æ˜¯webç¯å¢ƒ                                  |
| @ConditionalOnJndi              | JNDIå­˜åœ¨æŒ‡å®šé¡¹                                   |

**é‚£ä¹ˆå¤šçš„è‡ªåŠ¨é…ç½®ç±»ï¼Œå¿…é¡»åœ¨ä¸€å®šçš„æ¡ä»¶ä¸‹æ‰èƒ½ç”Ÿæ•ˆï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åŠ è½½äº†è¿™ä¹ˆå¤šçš„é…ç½®ç±»ï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„éƒ½ç”Ÿæ•ˆäº†ã€‚**

â“ æˆ‘ä»¬æ€ä¹ˆçŸ¥é“å“ªäº›è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆï¼Ÿ

**æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨é…ç½®æ–‡ä»¶å¯ç”¨  `debug = true` å±æ€§ï¼Œæ¥è®©æ§åˆ¶å°æ‰“å°è‡ªåŠ¨é…ç½®æŠ¥å‘Š**ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„çŸ¥é“å“ªäº›è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆã€‚

```properties
#å¼€å¯springbootçš„è°ƒè¯•ç±»
debug = true
```

æ§åˆ¶å°æ‰“å°è¾“å‡ºç¤ºä¾‹å¦‚ä¸‹ï¼š

```powershell
=========================
AUTO-CONFIGURATION REPORT
=========================


Positive matches:ï¼ˆè‡ªåŠ¨é…ç½®ç±»å¯ç”¨çš„ï¼‰
-----------------

   DispatcherServletAutoConfiguration matched:
      - @ConditionalOnClass found required class 'org.springframework.web.servlet.DispatcherServlet'; @ConditionalOnMissingClass did not find unwanted class (OnClassCondition)
      - @ConditionalOnWebApplication (required) found StandardServletEnvironment (OnWebApplicationCondition)
        
    
Negative matches:ï¼ˆæ²¡æœ‰å¯åŠ¨ï¼Œæ²¡æœ‰åŒ¹é…æˆåŠŸçš„è‡ªåŠ¨é…ç½®ç±»ï¼‰
-----------------

   ActiveMQAutoConfiguration:
      Did not match:
         - @ConditionalOnClass did not find required classes 'javax.jms.ConnectionFactory', 'org.apache.activemq.ActiveMQConnectionFactory' (OnClassCondition)

   AopAutoConfiguration:
      Did not match:
         - @ConditionalOnClass did not find required classes 'org.aspectj.lang.annotation.Aspect', 'org.aspectj.lang.reflect.Advice' (OnClassCondition)
        
```

- **Positive matches:ï¼ˆè‡ªåŠ¨é…ç½®ç±»å¯ç”¨çš„ï¼šæ­£åŒ¹é…ï¼‰**

- **Negative matches:ï¼ˆæ²¡æœ‰å¯åŠ¨ï¼Œæ²¡æœ‰åŒ¹é…æˆåŠŸçš„è‡ªåŠ¨é…ç½®ç±»ï¼šè´ŸåŒ¹é…ï¼‰**

- **Unconditional classes: ï¼ˆæ²¡æœ‰æ¡ä»¶çš„ç±»ï¼‰**

## ğŸ“š References

- [è§†é¢‘ - SpringBoot_æƒå¨æ•™ç¨‹_é›·ä¸°é˜³_å°šç¡…è°·](https://www.bilibili.com/video/BV1Et411Y7tQ)

- [ç‹‚ç¥è¯´ SpringBoot](https://mp.weixin.qq.com/mp/homepage?__biz=Mzg2NTAzMTExNg==&hid=1&sn=3247dca1433a891523d9e4176c90c499)

