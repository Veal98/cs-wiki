# ğŸ“„ æ—¥å¿—

---

## 1. æ—¥å¿—æ¡†æ¶

å†™äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£å±‚ï¼Œæ—¥å¿—é—¨é¢ï¼ˆæ—¥å¿—çš„ä¸€ä¸ªæŠ½è±¡å±‚ï¼‰

ç»™é¡¹ç›®ä¸­å¯¼å…¥å…·ä½“çš„æ—¥å¿—å®ç°å°±è¡Œäº†ï¼›æˆ‘ä»¬çš„æ—¥å¿—æ¡†æ¶éƒ½æ˜¯å®ç°çš„æŠ½è±¡å±‚ï¼›



**å¸‚é¢ä¸Šçš„æ—¥å¿—æ¡†æ¶ï¼›**

JULã€JCLã€Jboss-loggingã€logbackã€log4jã€log4j2ã€slf4j....

| æ—¥å¿—é—¨é¢  ï¼ˆæ—¥å¿—çš„æŠ½è±¡å±‚ï¼‰                                   | æ—¥å¿—å®ç°                                             |
| ------------------------------------------------------------ | ---------------------------------------------------- |
| ~~JCLï¼ˆJakarta  Commons Loggingï¼‰~~    SLF4jï¼ˆSimple  Logging Facade for Javaï¼‰    **~~jboss-logging~~** | Log4j  JULï¼ˆjava.util.loggingï¼‰  Log4j2  **Logback** |

ğŸ‘‰ å·¦è¾¹é€‰ä¸€ä¸ªé—¨é¢ï¼ˆæŠ½è±¡å±‚ï¼‰ã€å³è¾¹æ¥é€‰ä¸€ä¸ªå®ç°ï¼›

æ—¥å¿—é—¨é¢ï¼š  SLF4J

æ—¥å¿—å®ç°ï¼šLogback



SpringBootï¼šåº•å±‚æ˜¯ Spring æ¡†æ¶ï¼ŒSpring æ¡†æ¶é»˜è®¤æ˜¯ç”¨ JCL

ğŸš© **SpringBoot é€‰ç”¨ SLF4j å’Œ logback**



## 2. SLF4j ä½¿ç”¨

### â‘  å¦‚ä½•åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨ SLF4j

ä»¥åå¼€å‘çš„æ—¶å€™ï¼Œæ—¥å¿—è®°å½•æ–¹æ³•çš„è°ƒç”¨ï¼Œä¸åº”è¯¥æ¥ç›´æ¥è°ƒç”¨æ—¥å¿—çš„å®ç°ç±»ï¼Œè€Œæ˜¯**è°ƒç”¨æ—¥å¿—æŠ½è±¡å±‚é‡Œé¢çš„æ–¹æ³•**ï¼›

ç»™ç³»ç»Ÿé‡Œé¢å¯¼å…¥slf4j çš„ jar åŒ…å’Œ  logback çš„å®ç° jar åŒ…

> [https://www.slf4j.org](https://www.slf4j.org)

```java
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class HelloWorld {
  public static void main(String[] args) {
    Logger logger = LoggerFactory.getLogger(HelloWorld.class);
    logger.info("Hello World");
  }
}
```

å›¾ç¤ºï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200530101749.png)



æ¯ä¸€ä¸ªæ—¥å¿—çš„å®ç°æ¡†æ¶éƒ½æœ‰è‡ªå·±çš„é…ç½®æ–‡ä»¶ã€‚ä½¿ç”¨ slf4j ä»¥åï¼Œ**é…ç½®æ–‡ä»¶è¿˜æ˜¯åšæˆæ—¥å¿—å®ç°æ¡†æ¶è‡ªå·±æœ¬èº«çš„é…ç½®æ–‡ä»¶**

### â‘¡ é—ç•™é—®é¢˜

ğŸ’¬ æ¯”å¦‚ï¼ša ç³»ç»Ÿä½¿ç”¨çš„æ—¥å¿—æ¡†æ¶ï¼ˆslf4j+logbackï¼‰:  Springï¼ˆcommons-loggingï¼‰ã€Hibernateï¼ˆjboss-loggingï¼‰ã€MyBatisã€xxxx

â“ **å¦‚ä½•ç»Ÿä¸€æ—¥å¿—è®°å½•å‘¢ï¼Ÿå³ä½¿æ˜¯åˆ«çš„æ¡†æ¶ä¹Ÿç»Ÿä¸€ä½¿ç”¨ slf4j è¿›è¡Œè¾“å‡º**

- å°†ç³»ç»Ÿä¸­å…¶ä»–æ—¥å¿—æ¡†æ¶å…ˆæ’é™¤å‡ºå»

- ç”¨ä¸­é—´åŒ…æ¥æ›¿æ¢åŸæœ‰çš„æ—¥å¿—æ¡†æ¶

- å¯¼å…¥ slf4j å…¶ä»–çš„å®ç°

â­ **slf4j çš„æ—¥å¿—é€‚é…å›¾**å¦‚ä¸‹ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200530102415.png)



## 3. SpringBootæ—¥å¿—å…³ç³»

SpringBootä½¿ç”¨å®ƒæ¥åšæ—¥å¿—åŠŸèƒ½ï¼›

```xml
	<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-logging</artifactId>
		</dependency>
```

åº•å±‚ä¾èµ–å…³ç³»

> åˆ†æä¾èµ–å…³ç³»ï¼Œå¦‚ä½•åœ¨ IDEA ä¸­æ‰“å¼€ä¸‹å›¾æ‰€ç¤ºçš„ä¾èµ–å…³ç³»å›¾ï¼š
>
> <img src="https://gitee.com/veal98/images/raw/master/img/20200530103743.png" style="zoom:80%;" />

![](https://gitee.com/veal98/images/raw/master/img/20200530103809.png)



æ€»ç»“ï¼š

- SpringBoot åº•å±‚ä½¿ç”¨ slf4j+logback çš„æ–¹å¼è¿›è¡Œæ—¥å¿—è®°å½•

- SpringBoot æŠŠå…¶ä»–çš„æ—¥å¿—éƒ½æ›¿æ¢æˆäº† slf4j

- ä¸­é—´æ›¿æ¢åŒ…ï¼šåº•å±‚æºç ä¸¾ä¾‹å¦‚ä¸‹

    ```java
    @SuppressWarnings("rawtypes")
    public abstract class LogFactory {

        static String UNSUPPORTED_OPERATION_IN_JCL_OVER_SLF4J = "http://www.slf4j.org/codes.html#unsupported_operation_in_jcl_over_slf4j";

        static LogFactory logFactory = new SLF4JLogFactory();
    ```
    
    ![](https://gitee.com/veal98/images/raw/master/img/20200530104011.png)



â­ **å¦‚æœæˆ‘ä»¬è¦å¼•å…¥å…¶ä»–æ¡†æ¶ï¼Œä¸€å®šè¦æŠŠè¿™ä¸ªæ¡†æ¶çš„é»˜è®¤æ—¥å¿—ä¾èµ–ç§»é™¤æ‰**

æ¯”å¦‚ Spring Boot ä¼šæ’é™¤æ‰ Spring æ¡†æ¶ä½¿ç”¨çš„ commons-loggingæ¡†æ¶ï¼š

```xml
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-core</artifactId>
			<exclusions>
				<exclusion>
					<groupId>commons-logging</groupId>
					<artifactId>commons-logging</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
```

**SpringBootèƒ½è‡ªåŠ¨é€‚é…æ‰€æœ‰çš„æ—¥å¿—ï¼Œè€Œä¸”åº•å±‚ä½¿ç”¨ slf4j+logback çš„æ–¹å¼è®°å½•æ—¥å¿—ï¼Œå¼•å…¥å…¶ä»–æ¡†æ¶çš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠè¿™ä¸ªæ¡†æ¶ä¾èµ–çš„æ—¥å¿—æ¡†æ¶æ’é™¤æ‰å³å¯**

## 4. æ—¥å¿—ä½¿ç”¨

### â‘  é»˜è®¤é…ç½®

SpringBooté»˜è®¤å¸®æˆ‘ä»¬é…ç½®å¥½äº†æ—¥å¿—ï¼š

æ—¥å¿—çš„çº§åˆ«ï¼šç”±ä½åˆ°é«˜

trace < debug < info < warn < error

å¯ä»¥è°ƒæ•´è¾“å‡ºçš„æ—¥å¿—çº§åˆ«ï¼Œæ—¥å¿—å°±åªä¼šåœ¨è¿™ä¸ªçº§åˆ«ä»¥ä»¥åçš„é«˜çº§åˆ«ç”Ÿæ•ˆã€‚åœ¨å…¨å±€é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œè°ƒæ•´ï¼Œæ¯”å¦‚ï¼š

```properties
logging.level.com.smallbeef = trace
```

SpringBooté»˜è®¤ç»™æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ info çº§åˆ«çš„ï¼Œæ²¡æœ‰æŒ‡å®šçº§åˆ«çš„å°±ç”¨SpringBooté»˜è®¤è§„å®šçš„çº§åˆ«

ğŸ’¬ ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```java
@SpringBootTest
class DemoApplicationTests {

    //è®°å½•å™¨
    Logger logger = LoggerFactory.getLogger(getClass());
    @Test
    public void contextLoads() {
        //System.out.println();
        logger.trace("è¿™æ˜¯traceæ—¥å¿—...");
        logger.debug("è¿™æ˜¯debugæ—¥å¿—...");
        //SpringBooté»˜è®¤ç»™æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯infoçº§åˆ«çš„ï¼Œæ²¡æœ‰æŒ‡å®šçº§åˆ«çš„å°±ç”¨SpringBooté»˜è®¤è§„å®šçš„çº§åˆ«ï¼›rootçº§åˆ«
        logger.info("è¿™æ˜¯infoæ—¥å¿—...");
        logger.warn("è¿™æ˜¯warnæ—¥å¿—...");
        logger.error("è¿™æ˜¯erroræ—¥å¿—...");
    }
}
```

è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200530110404.png)



âš™ **SpringBoot ä¿®æ”¹æ—¥å¿—çš„é»˜è®¤é…ç½®ï¼š**

- `loggin.path = springboot.log`ï¼šæŒ‡å®šç”Ÿæˆæ—¥å¿—æ–‡ä»¶çš„ä½ç½®ï¼ˆå¯ä»¥æŒ‡å®šå®Œæ•´çš„è·¯å¾„ï¼Œä¸æŒ‡å®šè·¯å¾„åœ¨å½“å‰é¡¹ç›®ä¸‹ç”Ÿæˆæ—¥å¿—ï¼‰

- `logging.file = /spring/log`ï¼šå’Œ path æ˜¯å†²çªè®¾ç½®ï¼ŒåŒæ ·ç”¨äºæŒ‡å®šç”Ÿæˆæ—¥å¿—æ–‡ä»¶çš„ä½ç½®ï¼Œåœ¨å½“å‰ç£ç›˜çš„æ ¹è·¯å¾„ä¸‹åˆ›å»ºspring æ–‡ä»¶å¤¹å’Œ log å­æ–‡ä»¶å¤¹ï¼›ä½¿ç”¨ spring.log ä½œä¸ºé»˜è®¤æ–‡ä»¶

    | logging.file | logging.path | Example  | Description                        |
    | ------------ | ------------ | -------- | ---------------------------------- |
    | (none)       | (none)       |          | åªåœ¨æ§åˆ¶å°è¾“å‡º                     |
    | æŒ‡å®šæ–‡ä»¶å   | (none)       | my.log   | è¾“å‡ºæ—¥å¿—åˆ°my.logæ–‡ä»¶               |
    | (none)       | æŒ‡å®šç›®å½•     | /var/log | è¾“å‡ºåˆ°æŒ‡å®šç›®å½•çš„ spring.log æ–‡ä»¶ä¸­ |
    
- `logging.pattern.console = %d{yyyy-MM-dd} [%thread] %-5level %logger{50} - %msg%n`ï¼šåœ¨æ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—çš„æ ¼å¼

    æ—¥å¿—è¾“å‡ºæ ¼å¼ï¼š
    
    - %d è¡¨ç¤ºæ—¥æœŸæ—¶é—´
    - %thread è¡¨ç¤ºçº¿ç¨‹ IDï¼Œ
    - %-5levelï¼šæ—¥å¿—çº§åˆ«ï¼Œå·¦å¯¹é½æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦
    - %logger{50} è¡¨ç¤º logger åå­—æœ€é•¿50ä¸ªå­—ç¬¦ï¼Œå¦åˆ™æŒ‰ç…§å¥ç‚¹åˆ†å‰²ã€‚ 
    - %msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ
    - %næ˜¯æ¢è¡Œç¬¦
    
- `logging.pattern.file = %d{yyyy-MM-dd} === [%thread] === %-5level === %logger{50} ==== %msg%n`ï¼šæŒ‡å®šæ–‡ä»¶ä¸­æ—¥å¿—è¾“å‡ºçš„æ ¼å¼

    ```properties
    logging.level.com.smallbeef = trace
    
    # ä¸æŒ‡å®šè·¯å¾„åœ¨å½“å‰é¡¹ç›®ä¸‹ç”Ÿæˆspringboot.logæ—¥å¿—
    # å¯ä»¥æŒ‡å®šå®Œæ•´çš„è·¯å¾„ï¼›
    #logging.file=G:/springboot.log
    
    # åœ¨å½“å‰ç£ç›˜çš„æ ¹è·¯å¾„ä¸‹åˆ›å»ºspringæ–‡ä»¶å¤¹å’Œé‡Œé¢çš„logæ–‡ä»¶å¤¹ï¼›ä½¿ç”¨Â spring.log ä½œä¸ºé»˜è®¤æ–‡ä»¶
    logging.path=/spring/log
    
    #  åœ¨æ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—çš„æ ¼å¼
    logging.pattern.console=%d{yyyy-MM-dd} [%thread] %-5level %logger{50} - %msg%n
    # æŒ‡å®šæ–‡ä»¶ä¸­æ—¥å¿—è¾“å‡ºçš„æ ¼å¼
    logging.pattern.file=%d{yyyy-MM-dd} === [%thread] === %-5level === %logger{50} ==== %msg%n
    ```

### â‘¡ æŒ‡å®šé…ç½®

åœ¨ resources æ–‡ä»¶å¤¹ä¸‹æ·»åŠ æ¯ä¸ªæ—¥å¿—æ¡†æ¶è‡ªå·±çš„é…ç½®æ–‡ä»¶å³å¯ï¼ŒSpringBoot å°±ä¸ä¼šä½¿ç”¨é»˜è®¤çš„é…ç½®äº†

| Logging System          | Customization                                                |
| ----------------------- | ------------------------------------------------------------ |
| Logback                 | `logback-spring.xml`, `logback-spring.groovy`, `logback.xml` or `logback.groovy` |
| Log4j2                  | `log4j2-spring.xml` or `log4j2.xml`                          |
| JDK (Java Util Logging) | `logging.properties`                                         |

âœ¨ ç»†èŠ‚ï¼š

- å¦‚æœæ—¥å¿—é…ç½®æ–‡ä»¶åä¸º logback.xmlï¼šç›´æ¥å°±è¢«æ—¥å¿—æ¡†æ¶è¯†åˆ«äº†ï¼Œè·³è¿‡ Spring Boot

- å¦‚æœæ—¥å¿—é…ç½®æ–‡ä»¶åä¸º **logback-spring.xml**ï¼šæ—¥å¿—æ¡†æ¶å°±ä¸ç›´æ¥åŠ è½½æ—¥å¿—çš„é…ç½®é¡¹ï¼Œç”±Spring Bootè§£ææ—¥å¿—é…ç½®ï¼Œ**å¯ä»¥ä½¿ç”¨ Spring Boot çš„é«˜çº§ Profile åŠŸèƒ½ï¼Œå¯ä»¥æŒ‡å®šæŸæ®µé…ç½®åªåœ¨æŸä¸ªç¯å¢ƒä¸‹ç”Ÿæ•ˆ**

    ğŸ’¬ ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š
    
    ```xml
    <appender name="stdout" class="ch.qos.logback.core.ConsoleAppender">
        
            <layout class="ch.qos.logback.classic.PatternLayout">
            
                <springProfile name="dev">
                <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} ----> [%thread] ---> %-5level %logger{50} - %msg%n</pattern>
                </springProfile>
                
                <springProfile name="!dev">
                    <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} ==== [%thread] ==== %-5level %logger{50} - %msg%n</pattern>
                </springProfile>
                
            </layout>
        </appender>
    ```
    
    åœ¨å…¨å±€é…ç½®æ–‡ä»¶ä¸­æ¿€æ´»ç¯å¢ƒ
    
    ```properties
    spring.profiles.aactive = dev
    ```
    
    > å¦‚æœä½¿ç”¨ logback.xml ä½œä¸ºæ—¥å¿—é…ç½®æ–‡ä»¶ï¼Œè¿˜è¦ä½¿ç”¨ profile åŠŸèƒ½ï¼Œä¼šæœ‰ä»¥ä¸‹é”™è¯¯
    >
    > `no applicable action for [springProfile]`

## 5. åˆ‡æ¢æ—¥å¿—æ¡†æ¶

å¯ä»¥æŒ‰ç…§ slf4j çš„æ—¥å¿—é€‚é…å›¾ï¼Œè¿›è¡Œç›¸å…³çš„åˆ‡æ¢

![](https://gitee.com/veal98/images/raw/master/img/20200530102415.png)

æ¯”å¦‚ï¼šslf4j + log4j çš„æ–¹å¼ï¼š

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-web</artifactId>
  <exclusions>
    <exclusion>
      <artifactId>logback-classic</artifactId>
      <groupId>ch.qos.logback</groupId>
    </exclusion>
    <exclusion>
      <artifactId>log4j-over-slf4j</artifactId>
      <groupId>org.slf4j</groupId>
    </exclusion>
  </exclusions>
</dependency>

<dependency>
  <groupId>org.slf4j</groupId>
  <artifactId>slf4j-log4j12</artifactId>
</dependency>

```



åˆ‡æ¢ä¸ºlog4j2

```xml
<dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>  
        <exclusions>
            <exclusion>
                <artifactId>spring-boot-starter-logging</artifactId>
                <groupId>org.springframework.boot</groupId>
            </exclusion>
        </exclusions>
</dependency>

<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-log4j2</artifactId>
</dependency>
```

## ğŸ“š References

- [è§†é¢‘ - SpringBoot_æƒå¨æ•™ç¨‹_é›·ä¸°é˜³_å°šç¡…è°·](https://www.bilibili.com/video/BV1Et411Y7tQ)