# ğŸ‘£ Remember Me è®°ä½æˆ‘

---

## 1. ä»€ä¹ˆæ˜¯ Remember Me

Remember-Me æ˜¯æŒ‡ç½‘ç«™èƒ½å¤Ÿåœ¨ Session ä¹‹é—´è®°ä½ç™»å½•ç”¨æˆ·çš„èº«ä»½ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯æˆåŠŸè®¤è¯ä¸€æ¬¡ä¹‹ååœ¨ä¸€å®šçš„æ—¶é—´å†…å¯ä»¥ä¸ç”¨å†è¾“å…¥ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œç™»å½•äº†ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç™»å½•ã€‚

## 2. Remember Me åŸç†

é€šå¸¸æ˜¯é€šè¿‡æœåŠ¡ç«¯å‘é€ä¸€ä¸ª cookie ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ï¼Œä¸‹æ¬¡æµè§ˆå™¨å†è®¿é—®æœåŠ¡ç«¯æ—¶æœåŠ¡ç«¯èƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹å®¢æˆ·ç«¯çš„ cookieï¼Œæ ¹æ® cookie å€¼è§¦å‘è‡ªåŠ¨ç™»å½•æ“ä½œã€‚å¯¹äº <u>SpringSecurity çš„ cookie çš„é»˜è®¤åç§°æ˜¯ï¼š`remember-me`</u>

## 3. Remember Me çš„ä¸¤ç§å®ç°æ–¹å¼

Spring Security é’ˆå¯¹äº Remember-Me åŠŸèƒ½æœ‰ä¸¤ç§å®ç°ã€‚

- ğŸ”‹ ç®€å•çš„**ä½¿ç”¨åŠ å¯†æ¥ä¿è¯åŸºäº cookie çš„ token çš„å®‰å…¨**

  å½“ç”¨æˆ·é€‰æ‹©äº†è®°ä½æˆ‘æˆåŠŸç™»å½•åï¼ŒSpring Security å°†ä¼šç”Ÿæˆä¸€ä¸ª cookie å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚cookie å€¼ç”±å¦‚ä¸‹æ–¹å¼ç»„æˆï¼š

  ```
  base64(username+":"+expirationTime+":"+md5Hex(username+":"+expirationTime+":"+password+":"+key))
  ```

  - `username`ï¼šç™»å½•çš„ç”¨æˆ·å

  - `password`ï¼šç™»å½•çš„å¯†ç 

  - `expirationTime`ï¼štoken å¤±æ•ˆçš„æ—¥æœŸå’Œæ—¶é—´ï¼Œä»¥æ¯«ç§’è¡¨ç¤º

  - `key`ï¼šç”¨æ¥é˜²æ­¢ä¿®æ”¹ token çš„ä¸€ä¸ª keyã€‚

  **è¿™æ ·ç”¨æ¥å®ç° Remember-Me åŠŸèƒ½çš„ token åªèƒ½åœ¨æŒ‡å®šçš„æ—¶é—´å†…æœ‰æ•ˆï¼Œ ä¸”å¿…é¡»ä¿è¯ token ä¸­æ‰€åŒ…å«çš„ usernameã€password å’Œ key æ²¡æœ‰è¢«æ”¹å˜æ‰è¡Œ**ã€‚

  âš  éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ ·åšå…¶å®æ˜¯å­˜åœ¨å®‰å…¨éšæ‚£çš„ï¼Œé‚£å°±æ˜¯åœ¨ç”¨æˆ·è·å–åˆ°å®ç°è®°ä½æˆ‘åŠŸèƒ½çš„ token åï¼Œ<u>ä¸€æ—¦ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œç”Ÿæˆçš„ token å°†åœ¨å®¢æˆ·ç«¯ä¿å­˜ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœç”¨æˆ·ä¸ç‚¹å‡»é€€å‡ºç™»å½•ï¼Œæˆ–è€…ä¸ä¿®æ”¹å¯†ç ï¼Œé‚£ä¹ˆåœ¨ cookie å¤±æ•ˆä¹‹å‰ï¼Œä»–éƒ½å¯ä»¥ä½¿ç”¨è¯¥ token è¿›è¡Œç™»å½•ï¼Œå“ªæ€•è¯¥ token è¢«åˆ«äººç›—ç”¨äº†ï¼Œç”¨æˆ·ä¸ç›—ç”¨è€…éƒ½åŒæ ·å¯ä»¥è¿›è¡Œç™»å½•</u>ã€‚å¦‚æœå¸Œæœ›æˆ‘ä»¬çš„åº”ç”¨èƒ½å¤Ÿæ›´å®‰å…¨ä¸€ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨æ¥ä¸‹æ¥è¦ä»‹ç»çš„æŒä¹…åŒ– token æ–¹å¼ã€‚

- ğŸ”‹ **é€šè¿‡æ•°æ®åº“æˆ–å…¶å®ƒæŒä¹…åŒ–å­˜å‚¨æœºåˆ¶æ¥ä¿å­˜ç”Ÿæˆçš„ token**

  <u>æŒä¹…åŒ– token çš„æ–¹æ³•è·Ÿç®€å•åŠ å¯† token çš„æ–¹æ³•åœ¨å®ç° Remember-Me åŠŸèƒ½ä¸Šå¤§ä½“ç›¸åŒï¼Œéƒ½æ˜¯åœ¨ç”¨æˆ·é€‰æ‹©äº† â€œè®°ä½æˆ‘â€ æˆåŠŸç™»å½•åï¼Œå°†ç”Ÿæˆçš„ token å­˜å…¥ cookie ä¸­å¹¶å‘é€åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨ï¼Œå¾…åˆ°ä¸‹æ¬¡ç”¨æˆ·è®¿é—®ç³»ç»Ÿæ—¶ï¼Œç³»ç»Ÿå°†ç›´æ¥ä»å®¢æˆ·ç«¯cookie ä¸­è¯»å– token è¿›è¡Œè®¤è¯ã€‚</u>

  åŸºäºæŒä¹…åŒ– token çš„æ–¹æ³•é‡‡ç”¨è¿™æ ·çš„å®ç°é€»è¾‘ï¼š

  - **ç”¨æˆ·é€‰æ‹©äº† â€œè®°ä½æˆ‘â€ æˆåŠŸç™»å½•åï¼Œå°†ä¼šæŠŠ usernameã€éšæœºäº§ç”Ÿçš„åºåˆ—å·ã€ç”Ÿæˆçš„ token å­˜å…¥ä¸€ä¸ªæ•°æ®åº“è¡¨ä¸­ï¼ŒåŒæ—¶å°†å®ƒä»¬çš„ç»„åˆç”Ÿæˆä¸€ä¸ª cookie å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚**

  - å½“ä¸‹ä¸€æ¬¡æ²¡æœ‰ç™»å½•çš„ç”¨æˆ·è®¿é—®ç³»ç»Ÿæ—¶ï¼Œé¦–å…ˆæ£€æŸ¥ cookieï¼Œå¦‚æœå¯¹åº” cookie ä¸­åŒ…å«çš„usernameã€åºåˆ—å·å’Œ token ä¸æ•°æ®åº“ä¸­ä¿å­˜çš„ä¸€è‡´ï¼Œåˆ™è¡¨ç¤ºå…¶é€šè¿‡éªŒè¯ï¼Œç³»ç»Ÿå°†é‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„ token æ›¿æ¢æ•°æ®åº“ä¸­å¯¹åº”ç»„åˆçš„æ—§ tokenï¼Œåºåˆ—å·ä¿æŒä¸å˜ï¼ŒåŒæ—¶åˆ é™¤æ—§çš„ cookieï¼Œé‡æ–°ç”ŸæˆåŒ…å«æ–°ç”Ÿæˆçš„ tokenï¼Œå°±çš„åºåˆ—å·å’Œusername çš„ cookie å‘é€ç»™å®¢æˆ·ç«¯ã€‚

  - å¦‚æœæ£€æŸ¥ cookie æ—¶ï¼Œcookie ä¸­åŒ…å«çš„ username å’Œåºåˆ—å·è·Ÿæ•°æ®åº“ä¸­ä¿å­˜çš„åŒ¹é…ï¼Œä½†æ˜¯ token ä¸åŒ¹é…ã€‚è¿™ç§æƒ…å†µææœ‰å¯èƒ½æ˜¯å› ä¸ºä½ çš„ cookie è¢«äººç›—ç”¨äº†ï¼Œç”±äºç›—ç”¨è€…ä½¿ç”¨ä½ åŸæœ¬é€šè¿‡è®¤è¯çš„ cookieè¿›è¡Œç™»å½•äº†å¯¼è‡´æ—§çš„ token å¤±æ•ˆï¼Œè€Œäº§ç”Ÿäº†æ–°çš„ tokenã€‚è¿™ä¸ªæ—¶å€™Spring Security å°±å¯ä»¥å‘ç° cookie è¢«ç›—ç”¨çš„æƒ…å†µï¼Œå®ƒå°†åˆ é™¤æ•°æ®åº“ä¸­ä¸å½“å‰ç”¨æˆ·ç›¸å…³çš„æ‰€æœ‰ token è®°å½•ï¼Œè¿™æ ·ç›—ç”¨è€…ä½¿ç”¨åŸæœ‰çš„ cookie å°†ä¸èƒ½å†ç™»å½•ï¼ŒåŒæ—¶æé†’ç”¨æˆ·å…¶å¸å·æœ‰è¢«ç›—ç”¨çš„å¯èƒ½æ€§ã€‚

  - å¦‚æœå¯¹åº” cookie ä¸å­˜åœ¨ï¼Œæˆ–è€…åŒ…å«çš„ username å’Œåºåˆ—å·ä¸æ•°æ®åº“ä¸­ä¿å­˜çš„ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆå°†ä¼šå¼•å¯¼ç”¨æˆ·åˆ°ç™»å½•é¡µé¢ã€‚

> ğŸš¨ æ³¨æ„ï¼šä¸¤ç§å®ç°éƒ½éœ€è¦ä¸€ä¸ª `UserDetailsService`

## 4. æ–¹æ¡ˆ  1ï¼šç®€å•åŠ å¯† token

### â‘  ç¼–ç æ€è·¯

å½“ç”¨æˆ·é€‰æ‹©äº†è®°ä½æˆ‘æˆåŠŸç™»å½•åï¼ŒSpring Security å°†ä¼šç”Ÿæˆä¸€ä¸ª cookie å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚cookie å€¼ç”±å¦‚ä¸‹æ–¹å¼ç»„æˆï¼š

```
base64(username+":"+expirationTime+":"+md5Hex(username+":"+expirationTime+":"+password+":"+key))
```

ä»ä¸Šé¢çš„åŠ å¯†ä¸²ï¼Œå¯¹äºç¼–ç æœ‰ä¸€ä¸ªç®€å•çš„åˆ†æï¼š

- éœ€è¦æœ‰ä¸€ä¸ª keyï¼š ç”¨æ¥é˜²æ­¢ token è¢«ä¿®æ”¹çš„
- key æ€ä¹ˆä½¿ç”¨ï¼š`HttpSecurity` åœ¨é…ç½®å¼€å¯ `rememberMe()` çš„æ—¶å€™å¯ä»¥æ‰§è¡Œ `key()`ï¼Œè¿™é‡Œè¿˜éœ€è¦åˆ¶å®š  `rememberMeServices` çš„å…·ä½“å®ç°æ–¹æ³•ï¼Œåœ¨æ­¤æ–¹æ³•ä¸Šå¯ä»¥æŒ‡å®šåŠ å¯†æ–¹å¼ä¸ºã€Œç®€å•åŠ å¯† toke nçš„æ–¹å¼ã€ï¼Œå¦å¤–å¯ä»¥æŒ‡å®š cookie çš„è¿‡æœŸæ—¶é—´ï¼Œå†è€…å°±æ˜¯åœ¨ç½‘é¡µå‰ç«¯è¡¨å•â€œè®°ä½æˆ‘â€çš„å‚æ•°åç§°ã€‚

ğŸš© é€šè¿‡è¿™ä¸ªåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥ç†å‡ºç¼–ç çš„æ€è·¯ï¼š

- éœ€è¦æœ‰ä¸€ä¸ª `rememberMeServices` æ–¹æ³•ï¼ˆå³è®°ä½æˆ‘çš„å…·ä½“çš„å®ç°æ–¹æ³•ï¼‰ï¼šè¿™é‡Œå¯ä»¥ä½¿ç”¨ Spring Security æä¾›çš„ `TokenBasedRememberMeServices` è¿›è¡Œé…ç½®ï¼Œåœ¨è¿™é‡Œè®¾ç½® cookie çš„è¿‡æœŸæ—¶é—´å’Œå‰ç«¯â€œè®°ä½æˆ‘â€œå¤é€‰æ¡†çš„å‚æ•°åï¼Œä¸è®¾ç½®çš„è¯ï¼Œé»˜è®¤ä¸º `remember-me`ã€‚
- åœ¨ Spring Security é…ç½®è®°ä½æˆ‘ï¼šåœ¨ `configure()` æ–¹æ³•ä¸­è¿›è¡Œâ€œè®°ä½æˆ‘â€œçš„é…ç½®ã€‚
- ç¼–å†™å‰ç«¯ä»£ç ï¼šå‰ç«¯ä»£ç åªéœ€è¦æ·»åŠ ä¸€ä¸ªâ€œè®°ä½æˆ‘â€œçš„ checkbox å³å¯ã€‚

### â‘¡ ä»£ç å®ç°

#### â…  å®šä¹‰ key

<u>è¿™ä¸ª key è¿™é‡Œåªæ˜¯åœ¨ `WebSecurityConfig` å®šä¹‰äº†ä¸€ä¸ªå…¨å±€å˜é‡</u>ï¼Œæœ€å¥½çš„æ–¹å¼åº”è¯¥æ˜¯åœ¨ application.properties è¿›è¡Œé…ç½®ï¼Œç„¶ååœ¨ä»£ç ä¸­è¿›è¡Œå¼•ç”¨ï¼Œè¿™é‡Œä¸ºäº†ä»£ç çš„ç†è§£ç®€å•ï¼Œç›´æ¥é…ç½®ï¼š

```java
// ç”¨æ¥é˜²æ­¢ token è¢«ä¿®æ”¹çš„ key
private String rememberMeKey = "key2020";
```

#### â…¡ rembermeServices çš„å®ç°

åœ¨ `WebSecurityConfig` ä¸­å®šä¹‰ `rememberServices` çš„å…·ä½“å®ç°ï¼š

ï¼ˆ1ï¼‰**[å¿…é¡»]** éœ€è¦æŒ‡å®šä¸Šé¢é…ç½®çš„ key å’Œ userDetailServiceã€‚

ï¼ˆ2ï¼‰[å¯é€‰] éœ€è¦é…ç½® cookie çš„è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤è¿‡æ—¶æ—¶é—´ 1209600 ç§’ï¼Œå³ 2 ä¸ªæ˜ŸæœŸã€‚

ï¼ˆ3ï¼‰[å¯é€‰] å‰ç«¯ checkbox çš„å‚æ•°åï¼Œé»˜è®¤ä¸º remember-meã€‚

```java
@Configuration
@EnableWebSecurity // å¼€å¯Spring Securityçš„åŠŸèƒ½
@EnableGlobalMethodSecurity(prePostEnabled=true)
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

    @Autowired
    CustomUserDetailService customUserDetailService;

    // ç”¨æ¥é˜²æ­¢ token è¢«ä¿®æ”¹çš„ key
    private String rememberMeKey = "key2020";

    ......

    // è®°ä½æˆ‘ï¼šç®€å•åŠ å¯†æ–¹æ¡ˆ
    @Bean
    public RememberMeServices rememberMeServices(){
        System.out.println("WebSecurityConfig.tokenBasedRememberMeServices()=" + customUserDetailService);
        TokenBasedRememberMeServices tokenBasedRememberMeServices = new TokenBasedRememberMeServices(rememberMeKey, customUserDetailService);
        tokenBasedRememberMeServices.setTokenValiditySeconds(60*60*24*1); // è®¾ç½® cookie çš„è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æ˜¯ä¸¤ä¸ªæ˜ŸæœŸ
        tokenBasedRememberMeServices.setParameter("rememberMe"); // è®¾ç½®å‰ç«¯ checkbox çš„å‚æ•°åä¸º rememberMe, é»˜è®¤æ˜¯ remember-me
        return tokenBasedRememberMeServices;

    }
}
```

#### â…¢ å¼€å¯remember meåŠŸèƒ½

é…ç½® `WebSecurityConfig` ç±»ä¸­çš„ `configure(HttpSecurity http)` æ–¹æ³•ï¼Œå¼€å¯ remember me åŠŸèƒ½ï¼š

```java
@Override
protected void configure(HttpSecurity http) throws Exception {
    http.authorizeRequests() // å®šä¹‰å“ªäº›URLéœ€è¦è¢«ä¿æŠ¤ã€å“ªäº›ä¸éœ€è¦è¢«ä¿æŠ¤
            .antMatchers("/login").permitAll()// è®¾ç½®æ‰€æœ‰äººéƒ½å¯ä»¥è®¿é—®è·¯å¾„/login
            .antMatchers("/","/index").permitAll()
            .antMatchers("/resources/**/*.{js,html}").permitAll()
            .anyRequest().authenticated()  // ä»»ä½•è¯·æ±‚,ç™»å½•åå¯ä»¥è®¿é—®
            .and()
            .formLogin().loginPage("/login") // è®¾ç½®è‡ªå®šä¹‰ç™»å½•ç•Œé¢è·¯å¾„ /loginï¼ˆå¯¹åº”Controller)
            .and().rememberMe().key(rememberMeKey).rememberMeServices(rememberMeServices()) // è®¾ç½®è®°ä½æˆ‘
    ;
}
```

#### â…£ åœ¨ç™»å½•é¡µæ·»åŠ ç›¸åº”çš„æ§ä»¶

åœ¨ç™»å½•é¡µ `login.html` ä¸Šæ·»åŠ ä¸€ä¸ª CheckBox æ§ä»¶ï¼š

<img src="https://gitee.com/veal98/images/raw/master/img/20200814203951.png" style="zoom:90%;" />

æ³¨æ„è¿™é‡Œçš„ `name` è¦å’Œ é…ç½®ç±» `WebSecurityConfig`  ä¸­è®¾ç½®çš„ä¸€è‡´ã€‚

#### â…¤ æµ‹è¯•

è®¿é—®ç™»å½•é¡µé¢ï¼š

<img src="https://gitee.com/veal98/images/raw/master/img/20200814204203.png" style="zoom:80%;" />

ç™»å½•æˆåŠŸä¹‹åï¼Œå¯ä»¥çœ‹åˆ°æµè§ˆå™¨çš„ cookie ä¸­å¤šäº†ä¸€ä¸ª cookie:

<img src="https://gitee.com/veal98/images/raw/master/img/20200814203310.png" style="zoom:50%;" />

## 5. æ–¹æ¡ˆ  2ï¼šæŒä¹…åŒ– token

### â‘  ç¼–ç æ€è·¯

 æˆ‘ä»¬å…ˆåˆ†æä¸‹éƒ½éœ€è¦åšä»€ä¹ˆäº‹æƒ…ï¼š

- **å¼€å¯æŒä¹…åŒ– token æ–¹å¼**ï¼šå¯ä»¥ä½¿ç”¨ `and().rememberMe()` è¿›è¡Œå¼€å¯è®°ä½æˆ‘ï¼Œç„¶åæŒ‡å®š `tokenRepository()`ï¼Œå³æŒ‡å®šäº† token æŒä¹…åŒ–æ–¹å¼ã€‚

- **å®ç° `tokenRepository`**ï¼šè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Spring Security æä¾›çš„ `JdbcTokenRepositoryImpl` ï¼Œåªéœ€è¦é…ç½®ä¸€ä¸ªæ•°æ®æºå³å¯ã€‚

- **æŒä¹…åŒ– token çš„æ•°æ®ä¿å­˜åœ¨å“ªé‡Œ**ï¼šè¿™é‡Œçš„æ•°æ®æ˜¯ä¿å­˜åœ¨æ•°æ®åº“è¡¨ `persistent_logins` ä¸­ã€‚

- **`persistent_logins` è¡¨ç”Ÿæˆæ–¹å¼**ï¼šæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥ç”Ÿæˆ ğŸ‘‡

  ç¬¬ä¸€ç§å°±æ˜¯æ‰‹åŠ¨æ–¹å¼ï¼Œæ ¹æ®è¡¨ç»“æ„è‡ªå·±åˆ›å»ºè¡¨

  ```sql
  DROP TABLE IF EXISTS `persistent_logins`;
  CREATE TABLE `persistent_logins` (
    `username` varchar(64) NOT NULL,
    `series` varchar(64) NOT NULL,
    `token` varchar(64) NOT NULL,
    `last_used` timestamp NOT NULL,
    PRIMARY KEY (`series`)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
  ```

  ç¬¬äºŒç§æ–¹å¼å°±æ˜¯ä½¿ç”¨ `JdbcTokenRepositoryImpl` é…ç½®ä¸ºè‡ªåŠ¨åˆ›å»ºï¼Œè¿™ç§æ–¹å¼è™½ç„¶ä¼šè‡ªåŠ¨ç”Ÿæˆï¼ŒğŸš¨ ä½†æ˜¯å­˜åœ¨ä¸€ä¸ªå°é—®é¢˜ï¼šå°±æ˜¯ç¬¬äºŒæ¬¡è¿è¡Œç¨‹åºçš„æ—¶å€™å°±ä¼šä¿å­˜ä¹‹å‰å·²ç»è¿è¡Œçš„è¡¨ï¼Œå› ä¸º `persistent_logins` è¡¨å·²ç»å­˜åœ¨äº†ã€‚æ‰€ä»¥<u>æˆ‘çš„ä½¿ç”¨æ–¹å¼å°±æ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œæ‰“å¼€é…ç½®ï¼Œç”Ÿæˆè¡¨ä¹‹åï¼Œæ³¨é‡Šæ‰é…ç½®ã€‚</u>

### â‘¡ ä»£ç å®ç°

#### â…  å®šä¹‰æŒä¹…åŒ–çš„ tokenRepository

åœ¨ `WebSecurityConfig` ä¸­å®šä¹‰ `tokenRepository()` æ–¹æ³•ï¼Œç”±äºåœ¨æ–¹æ³•çš„å®ç°ä¸­éœ€è¦ä½¿ç”¨åˆ°æ•°æ®æºï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ³¨å…¥æ•°æ®æºï¼š

```java
// æ³¨å…¥å…¨å±€é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ•°æ®æº
@Autowired
private DataSource dataSource;
```

`tokenRepository()` çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š

```java
// è®°ä½æˆ‘ï¼šæŒä¹…åŒ–æˆ‘æ–¹æ¡ˆ
@Bean
public PersistentTokenRepository tokenRepository(){
    JdbcTokenRepositoryImpl jdbcTokenRepository = new JdbcTokenRepositoryImpl();
    jdbcTokenRepository.setDataSource(dataSource);
    jdbcTokenRepository.setCreateTableOnStartup(true); //è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“è¡¨:persistent_loginsï¼Œä½¿ç”¨ä¸€æ¬¡åæ³¨é‡Šæ‰ï¼Œä¸ç„¶ä¼šæŠ¥é”™
    return jdbcTokenRepository;
}
```

#### â…¡ å¼€å¯ remember me åŠŸèƒ½

é…ç½® `WebSecurityConfig` ç±»ä¸­çš„ `configure(HttpSecurity http)` æ–¹æ³•ï¼Œå¼€å¯ remember me åŠŸèƒ½ï¼š

```java
@Override
protected void configure(HttpSecurity http) throws Exception {
    http.authorizeRequests() // å®šä¹‰å“ªäº›URLéœ€è¦è¢«ä¿æŠ¤ã€å“ªäº›ä¸éœ€è¦è¢«ä¿æŠ¤
            .antMatchers("/login").permitAll()// è®¾ç½®æ‰€æœ‰äººéƒ½å¯ä»¥è®¿é—®è·¯å¾„/login
            .antMatchers("/","/index").permitAll()
            .antMatchers("/resources/**/*.{js,html}").permitAll()
            .anyRequest().authenticated()  // ä»»ä½•è¯·æ±‚,ç™»å½•åå¯ä»¥è®¿é—®
            .and()
            .formLogin().loginPage("/login") // è®¾ç½®è‡ªå®šä¹‰ç™»å½•ç•Œé¢è·¯å¾„ /loginï¼ˆå¯¹åº”Controller)
            .and().rememberMe().tokenRepository(tokenRepository()).tokenValiditySeconds(1209600).userDetailsService(customUserDetailService)
    ;
}
```

#### â…¢ åœ¨ç™»å½•é¡µæ·»åŠ ç›¸åº”çš„æ§ä»¶

```html
<div><label> <input type="checkbox" name="remember-me"/> è®°ä½æˆ‘</label></div>
```

ğŸš¨ æ­¤å¤„å°† `name` è®¾ç½®ä¸ºé»˜è®¤ `remember-me`

#### â…£ æµ‹è¯•

ç™»å½•æˆåŠŸé€‰æ‹©è®°ä½æˆ‘ä¹‹ååŒæ ·å¯ä»¥çœ‹è§ç½‘ç«™ä¸­å¤šå‡ºäº†ä¸€ä¸ª cookieï¼š

<img src="https://gitee.com/veal98/images/raw/master/img/20200814205721.png" style="zoom: 50%;" />

å¹¶ä¸”æ•°æ®åº“ä¸­æ–°å»ºäº†ä¸€ä¸ªè¡¨ `persistent_logins`ï¼š

<img src="https://gitee.com/veal98/images/raw/master/img/20200814210339.png" style="zoom: 67%;" />

## ğŸ“š References

- [æ—ç¥¥çº¤ - Spring Boot+Spring Security ç³»åˆ—](https://www.iteye.com/blog/412887952-qq-com-2441544)