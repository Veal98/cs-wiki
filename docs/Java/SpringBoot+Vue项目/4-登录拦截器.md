# ğŸ“¡ ç™»å½•æ‹¦æˆªå™¨

---

> ğŸ”Š æœ¬ç¯‡ä¸»è¦å®ç°ç™»å½•æ‹¦æˆªå™¨ï¼Œå¹¶è®²è§£ä¸€ä¸‹å‰ç«¯çš„è·¯ç”±æ¨¡å¼
>
> âœ… ä¹‹åæˆ‘ä»¬ä¼šåˆ©ç”¨ Shiro é‡æ–°ç¼–å†™ç™»å½•æ‹¦æˆªå™¨

## 1. å‰ç«¯è·¯ç”±

å‡è®¾åœ¨ html ä¸­æœ‰è¿™ä¹ˆä¸€æ®µä»£ç ï¼š`<div id="test">This is a test</div>`ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®©é¡µé¢å®šä½åˆ°è¿™ä¸ª div æ‰€åœ¨çš„ä½ç½®ï¼Œå¯ä»¥åŠ ä¸€ä¸ªè¶…é“¾æ¥ `<a herf="#test">Jump to test</a>`ï¼Œè¿™é‡Œçš„ `#` è¢«ç§°ä¸ºâ€œ**é”šç‚¹**â€ï¼Œç‚¹å‡»è¶…é“¾æ¥ï¼Œå¯ä»¥å‘ç°**ç½‘é¡µçš„ URL å‘ç”Ÿäº†å˜åŒ–ï¼Œä½†é¡µé¢å¹¶ä¸ä¼šè·³è½¬**ã€‚

åœ¨äº’è”ç½‘æµé‡å¦‚æ­¤åºå¤§çš„ä»Šå¤©ï¼Œæˆ‘ä»¬éœ€è¦æƒ³åŠæ³•åç«¯æœåŠ¡å™¨çš„å‹åŠ›ï¼Œåˆ©ç”¨ AJAXï¼Œæˆ‘ä»¬å¯ä»¥ä¸é‡è½½é¡µé¢å°±åˆ·æ–°æ•°æ®ï¼Œå¦‚æœå†åŠ ä¸Š `#` å·çš„ç‰¹æ€§ï¼ˆå³æ”¹å˜ URL å´ä¸è¯·æ±‚åç«¯ï¼‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å‰ç«¯å®ç°é¡µé¢çš„æ•´ä½“å˜åŒ–ï¼Œè€Œä¸ç”¨æ¯æ¬¡éƒ½å»è¯·æ±‚åç«¯ã€‚

ä¸ºäº†å®ç°å‰ç«¯è·¯ç”±ï¼Œæˆ‘ä»¬å¯ä»¥ç›‘å¬ `#` å·åé¢å†…å®¹çš„å˜åŒ–ï¼ˆhashChangeï¼‰ï¼Œä»è€ŒåŠ¨æ€æ”¹å˜é¡µé¢å†…å®¹ã€‚URL çš„ `#` å·åé¢çš„åœ°å€è¢«ç§°ä¸º **hash** ã€‚è¿™ç§å®ç°æ–¹å¼æˆ‘ä»¬ç§°ä¹‹ä¸º **Hash æ¨¡å¼**ï¼Œæ˜¯éå¸¸å…¸å‹çš„å‰ç«¯è·¯ç”±æ–¹å¼ã€‚

å¦ä¸€ç§å¸¸ç”¨çš„æ–¹å¼è¢«ç§°ä¸º **History æ¨¡å¼**ï¼Œè¿™ç§æ–¹å¼ä½¿ç”¨äº† **History API**ï¼ŒHistory API é¡¾åæ€ä¹‰å°±æ˜¯é’ˆå¯¹å†å²è®°å½•çš„ API ï¼Œè¿™ç§æ¨¡å¼çš„åŸç†æ˜¯<u>å…ˆæŠŠé¡µé¢çš„çŠ¶æ€ä¿å­˜åˆ°ä¸€ä¸ªå¯¹è±¡ï¼ˆstateï¼‰é‡Œï¼Œå½“é¡µé¢çš„ URL å˜åŒ–æ—¶æ‰¾åˆ°å¯¹åº”çš„å¯¹è±¡ï¼Œä»è€Œè¿˜åŸè¿™ä¸ªé¡µé¢</u>ã€‚ä½¿ç”¨äº†è¿™ç§æ¨¡å¼ï¼Œå°±å¯ä»¥**æ‘†è„± `#` å·å®ç°å‰ç«¯è·¯ç”±**ã€‚

Vue å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†è¿™ä¸¤ç§æ¨¡å¼çš„å‰ç«¯è·¯ç”±ï¼Œæ— éœ€æˆ‘ä»¬è‡ªå·±å»å®ç°ã€‚

## 2. History æ¨¡å¼

å…¶å®æˆ‘ä»¬åˆ©ç”¨ Vue-CLI 3+ åˆ›å»ºçš„é¡¹ç›®é»˜è®¤ä½¿ç”¨çš„æ¨¡å¼å°±æ˜¯ History æ¨¡å¼ï¼š

<img src="https://gitee.com/veal98/images/raw/master/img/20200727154221.png" style="zoom:80%;" />

## 3. VueX ä¸å‰ç«¯ç™»å½•æ‹¦æˆªå™¨

ä¸ºäº†å®Œå–„ç™»å½•åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦é™åˆ¶æœªç™»å½•çŠ¶æ€ä¸‹å¯¹æ ¸å¿ƒåŠŸèƒ½é¡µé¢çš„è®¿é—®ã€‚æ­¤å¤„æˆ‘ä»¬åœ¨å‰ç«¯è¿›è¡Œç™»å½•æ‹¦æˆªï¼š

ğŸ’§ ä¸€ä¸ªç®€å•æ‹¦æˆªå™¨çš„é€»è¾‘å¦‚ä¸‹ï¼š

- ç”¨æˆ·è®¿é—® URLï¼Œæ£€æµ‹æ˜¯å¦ä¸ºç™»å½•é¡µé¢ï¼Œå¦‚æœæ˜¯ç™»å½•é¡µé¢åˆ™ä¸æ‹¦æˆª
- **å¦‚æœç”¨æˆ·è®¿é—®çš„ä¸æ˜¯ç™»å½•é¡µé¢ï¼Œæ£€æµ‹ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼Œå¦‚æœæœªç™»å½•åˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢**

### â‘  å¼•å…¥ VueX

```powershell
npm install vuex --save
```

![](https://gitee.com/veal98/images/raw/master/img/20200727165447.png)

æ‰“å¼€ `store/index.js` ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå·²ç»é»˜è®¤ä½¿ç”¨äº† VueXï¼š

<img src="https://gitee.com/veal98/images/raw/master/img/20200727165531.png" style="zoom:67%;" />

ä¹‹åï¼Œæˆ‘ä»¬åœ¨ `store/index.js` é‡Œè®¾ç½®æˆ‘ä»¬éœ€è¦çš„çŠ¶æ€å˜é‡å’Œæ–¹æ³•ã€‚ä¸ºäº†å®ç°ç™»å½•æ‹¦æˆªå™¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè®°å½•ç”¨æˆ·ä¿¡æ¯çš„å˜é‡ã€‚ä¸ºäº†æ–¹ä¾¿æ—¥åçš„æ‰©å±•ï¼ˆæƒé™è®¤è¯ç­‰ï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç”¨æˆ·å¯¹è±¡è€Œä¸æ˜¯ä»…ä»…ä½¿ç”¨ä¸€ä¸ªå¸ƒå°”å˜é‡ã€‚åŒæ—¶ï¼Œè®¾ç½®ä¸€ä¸ªæ–¹æ³•ï¼Œè§¦å‘è¿™ä¸ªæ–¹æ³•æ—¶å¯ä»¥ä¸ºæˆ‘ä»¬çš„ç”¨æˆ·å¯¹è±¡èµ‹å€¼ã€‚å®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š

```js
import Vue from 'vue'
import Vuex from 'vuex'

Vue.use(Vuex)

export default new Vuex.Store({
  state: {
    // è®°å½•ç”¨æˆ·ä¿¡æ¯
    user: {
      username:
        window.localStorage.getItem("user" || "[]") == null
          ? ""
          : JSON.parse(window.localStorage.getItem("user" || "[]")).username,
    },
  },
  mutations: {
    // è§¦å‘ login æ–¹æ³•æ—¶ä¸ºæˆ‘ä»¬çš„ç”¨æˆ·å¯¹è±¡èµ‹å€¼
    login(state, user) {
      state.user = user;
      window.localStorage.setItem("user", JSON.stringify(user));
    },
  },
  actions: {},
  modules: {},
});

```

è¿™é‡Œæˆ‘ä»¬è¿˜ç”¨åˆ°äº† `localStorage`ï¼Œå³æœ¬åœ°å­˜å‚¨ï¼Œåœ¨é¡¹ç›®æ‰“å¼€çš„æ—¶å€™ä¼šåˆ¤æ–­æœ¬åœ°å­˜å‚¨ä¸­æ˜¯å¦æœ‰ user è¿™ä¸ªå¯¹è±¡å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±å–å‡ºæ¥å¹¶è·å¾— `username` çš„å€¼ï¼Œå¦åˆ™åˆ™æŠŠ `username` è®¾ç½®ä¸ºç©ºã€‚è¿™æ ·æˆ‘ä»¬åªè¦ä¸æ¸…é™¤ç¼“å­˜ï¼Œç™»å½•çš„çŠ¶æ€å°±ä¼šä¸€ç›´ä¿å­˜ã€‚

### â‘¡ ä¿®æ”¹è·¯ç”±é…ç½®

ä¸ºäº†åŒºåˆ†é¡µé¢æ˜¯å¦éœ€è¦æ‹¦æˆªï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹ `src\router\index.js`ï¼Œåœ¨éœ€è¦æ‹¦æˆªçš„è·¯ç”±ä¸­åŠ ä¸€æ¡å…ƒæ•°æ®ï¼Œè®¾ç½®ä¸€ä¸ª `requireAuth `å­—æ®µå¦‚ä¸‹ï¼š

```js
{
    path: "/index",
    name: "Index",
    component: Index,
    meta: {
      requireAuth: true, // è¯¥è·¯å¾„éœ€è¦è¿›è¡Œæ‹¦æˆª
    },
},
```
### â‘¢ ä½¿ç”¨é’©å­å‡½æ•°åˆ¤æ–­æ˜¯å¦æ‹¦æˆª

**é’©å­å‡½æ•°å°±æ˜¯åœ¨æŸäº›æ—¶æœºä¼šè¢«è°ƒç”¨çš„å‡½æ•°**ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ `router.beforeEach()`ï¼Œæ„æ€æ˜¯åœ¨è®¿é—®æ¯ä¸€ä¸ªè·¯ç”±å‰è°ƒç”¨ã€‚

æ‰“å¼€ `src\main.js` æ·»åŠ ä¸‹è¿°ä»£ç ï¼š

```js
......

import store from './store'

......

// router.beforeEach åœ¨è®¿é—®æ¯ä¸€ä¸ªè·¯ç”±å‰è°ƒç”¨
router.beforeEach((to, from, next) => {
  // åˆ¤æ–­è¯¥è·¯å¾„æ˜¯å¦éœ€è¦è¿›è¡Œæ‹¦æˆª
    if (to.meta.requireAuth) {
      if (store.state.user.username) { // åˆ¤æ–­ store é‡Œæœ‰æ²¡æœ‰å­˜å‚¨ user çš„ä¿¡æ¯
        next() // æ”¾è¡Œ
      } 
      else {
        // è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œå¹¶å­˜å‚¨è®¿é—®çš„é¡µé¢è·¯å¾„ï¼ˆä»¥ä¾¿åœ¨ç™»å½•åè·³è½¬åˆ°è®¿é—®é¡µï¼‰
        next({
          path: 'login',
          query: {redirect: to.fullPath}
        })
      }
    } else {
      next()
    }
  }
)
```

è¿™ä¸ªçš„é€»è¾‘å¾ˆç®€å•ï¼Œé¦–å…ˆåˆ¤æ–­è®¿é—®çš„è·¯å¾„æ˜¯å¦éœ€è¦ç™»å½•ï¼Œå¦‚æœéœ€è¦ï¼Œåˆ¤æ–­ `store` é‡Œæœ‰æ²¡æœ‰å­˜å‚¨ `user` çš„ä¿¡æ¯ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ”¾è¡Œï¼Œå¦åˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œå¹¶å­˜å‚¨è®¿é—®çš„é¡µé¢è·¯å¾„ï¼ˆä»¥ä¾¿åœ¨ç™»å½•åè·³è½¬åˆ°è®¿é—®é¡µï¼‰ã€‚

### â‘£ ä¿®æ”¹ Login.Vue

ä¹‹å‰çš„ç™»å½•ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯åˆ¤æ–­åç«¯è¿”å›çš„çŠ¶æ€ç ï¼Œå¦‚æœæ˜¯ 200ï¼Œå°±é‡å®šå‘åˆ°é¦–é¡µã€‚åœ¨ç»è¿‡å‰é¢çš„é…ç½®åï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹ç™»å½•é€»è¾‘ï¼Œä»¥æœ€ç»ˆå®ç°ç™»å½•æ‹¦æˆªã€‚

ä¿®æ”¹åçš„é€»è¾‘å¦‚ä¸‹ï¼š

- ç‚¹å‡»ç™»å½•æŒ‰é’®ï¼Œå‘åç«¯å‘é€æ•°æ®
- æ”¶åˆ°åç«¯è¿”å›çš„æˆåŠŸä»£ç æ—¶ï¼Œè§¦å‘ `store `ä¸­çš„ `login()` æ–¹æ³•ï¼ŒæŠŠ `loginForm `å¯¹è±¡ä¼ é€’ç»™ `store `ä¸­çš„ `user `å¯¹è±¡
- è·å–ç™»å½•å‰é¡µé¢çš„è·¯å¾„å¹¶è·³è½¬ï¼Œå¦‚æœè¯¥è·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™è·³è½¬åˆ°é¦–é¡µ

ä¿®æ”¹åçš„ `login()` æ–¹æ³•å¦‚ä¸‹ï¼š

```js
login () {
  var _this = this
  console.log(this.$store.state)
  this.$axios
    .post('/login', {
      username: this.loginForm.username,
      password: this.loginForm.password
    })
    .then(successResponse => {
      if (successResponse.data.code === 200) {
        // var data = this.loginForm
        _this.$store.commit('login', _this.loginForm)
        var path = this.$route.query.redirect
        this.$router.replace({path: path === '/' || path === undefined ? '/index' : path})
      } else{
          this.$alert('ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯', 'æç¤º', {
            confirmButtonText: 'ç¡®å®š'
          })
        }
    })
    .catch(failResponse => {
    })
}
```

### â‘¤ è¿è¡Œé¡¹ç›®

åŒæ—¶è¿è¡Œå‰åç«¯é¡¹ç›®ï¼Œè®¿é—® [http://localhost:8080/index](http://localhost:8080/index) ï¼Œå‘ç°é¡µé¢ç›´æ¥è·³è½¬åˆ°äº† http://localhost:8080/login?redirect=%2Findexï¼Œè¾“å…¥è´¦å·å¯†ç åç™»å½•ï¼ŒæˆåŠŸè·³è½¬åˆ° [http://localhost:8080/index](http://localhost:8080/index) ï¼Œä¹‹åå†æ¬¡è®¿é—®åˆ™æ— éœ€ç™»å½•ï¼ˆé™¤éæ¸…é™¤ç¼“å­˜ï¼‰ã€‚

## 4. åç«¯ç™»å½•æ‹¦æˆªå™¨

æ­¤å¤„æˆ‘ä»¬å®ç°åç«¯æ‹¦æˆªå™¨çš„å¼€å‘ã€‚ï¼ˆğŸš¨ æ³¨æ„**è¿™ç§æ–¹å¼éœ€è¦æŠŠå‰åç«¯é¡¹ç›®æ•´åˆèµ·æ¥**ï¼Œå¦åˆ™æ— æ³•ç”Ÿæ•ˆï¼‰

æˆ‘ä»¬å…ˆæŠŠä¹‹å‰ç¼–å†™å¥½çš„å‰ç«¯ä¸­çš„è·¯ç”±æ‹¦æˆªæ³¨é‡Šæ‰ï¼š

<img src="https://gitee.com/veal98/images/raw/master/img/20200727172121.png" style="zoom:67%;" />

### â‘  å‰åç«¯é¡¹ç›®æ•´åˆ

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŠŠå‰ç«¯æ‰“åŒ…åéƒ¨ç½²åœ¨åç«¯ã€‚è¿™ä¸æ˜¯å‰åç«¯åˆ†ç¦»é¡¹ç›®æ¨èçš„åšæ³•ï¼Œå…¶å®åº”è¯¥æŠŠå‰åç«¯åˆ†åˆ«éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸­ï¼Œä½†å®é™…ä¸Šä»æœ‰ä¸å°‘é¡¹ç›®ä¼šé€‰æ‹©æŠŠå‰åç«¯æ•´åˆåœ¨ä¸€èµ·ï¼Œåªä½¿ç”¨ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¹ŸæåŠä¸€ä¸‹è¿™ç§æ–¹å¼ï¼Œä½†åœ¨ä¹‹åçš„å¼€å‘ä¸­ä¸ä¼šè¿™æ ·éƒ¨ç½²ã€‚

å…ˆåœ¨é¡¹ç›®ç›®å½•æ‰§è¡Œ `npm run build`ï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹å†…å®¹è¡¨æ˜æ‰§è¡Œå®Œæ¯•ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200727172336.png)

è¿™æ—¶åœ¨é¡¹ç›®çš„ `dist` æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆäº† `static` æ–‡ä»¶å¤¹å’Œ `index.html` æ–‡ä»¶ï¼ŒæŠŠè¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œæ‹·è´åˆ°æˆ‘ä»¬åç«¯é¡¹ç›®çš„ `resources\static` æ–‡ä»¶å¤¹ä¸‹ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200727172659.png)

æ¥ä¸‹æ¥ï¼Œæ‰“å¼€åç«¯é¡¹ç›®å¹¶è¿è¡Œï¼Œè®¿é—® [http://localhost:8082/index.html](http://localhost:8082/index.html) ï¼Œï¼ˆæ³¨æ„è¾“å…¥åç¼€ .htmlï¼‰å‘ç°é¡µé¢æ˜¯ç©ºç™½çš„ï¼Œä½†ç¡®å®å–åˆ°äº†è¿™ä¸ªé¡µé¢ï¼Œå†è®¿é—® [http://localhost:8082/login](http://localhost:8082/login) ,å‘ç°è·³è½¬åˆ°äº†é”™è¯¯é¡µé¢ï¼ˆWhite Error Pageï¼‰ã€‚

![](https://gitee.com/veal98/images/raw/master/img/20200727172737.png)

å› ä¸ºåœ¨æˆ‘ä»¬è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œå…¶å®åªæœ‰ `index.html` è¿™ä¸€ä¸ªé¡µé¢ï¼Œæ‰€æœ‰çš„å…¶å®ƒå†…å®¹éƒ½æ˜¯åœ¨è¿™ä¸ªé¡µé¢é‡ŒåŠ¨æ€æ¸²æŸ“çš„ã€‚å½“æˆ‘ä»¬ç›´æ¥åœ¨åç«¯è®¿é—® `/login` è·¯å¾„æ—¶ï¼Œåç«¯æœåŠ¡å™¨å¹¶æ²¡æœ‰è¿™ä¸ªè·¯å¾„å¯¹åº”çš„å†…å®¹ï¼ˆåç«¯æœåŠ¡å™¨æ˜¯ `/api/login`ï¼‰ï¼Œæ‰€ä»¥è¿”å›äº† Error Pageã€‚

ä¸ºäº†è·å–åˆ°æˆ‘ä»¬éœ€è¦çš„å†…å®¹ï¼Œæˆ‘ä»¬è¦æƒ³åŠæ³•è§¦å‘å‰ç«¯è·¯ç”±ï¼Œå³åœ¨åç«¯æ·»åŠ å¤„ç†å†…å®¹ï¼ŒæŠŠè¿™ä¸ª URL æ¸²æŸ“å‡ºçš„ `index.html` è¿”å›åˆ°æµè§ˆå™¨ã€‚

åœ¨åç«¯é¡¹ç›®ä¸­æ–°å»ºä¸€ä¸ª package åä¸º `error`ï¼Œæ–°å»ºå®ç° `ErrorPageRegistrar `æ¥å£çš„ç±» `ErrorConfig`ï¼Œ**æŠŠé»˜è®¤çš„é”™è¯¯é¡µé¢è®¾ç½®ä¸º `/index.html`**ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
import org.springframework.boot.web.server.ErrorPage;
import org.springframework.boot.web.server.ErrorPageRegistrar;
import org.springframework.boot.web.server.ErrorPageRegistry;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Component;

@Component
public class ErrorConfig implements ErrorPageRegistrar {

    @Override
    public void registerErrorPages(ErrorPageRegistry registry) {
        ErrorPage error404Page = new ErrorPage(HttpStatus.NOT_FOUND, "/index.html");
        registry.addErrorPages(error404Page);
    }

}
```

é‡æ–°å¯åŠ¨é¡¹ç›®ï¼Œè®¿é—® [http://localhost:8082/login](http://localhost:8082/login) ï¼ŒæˆåŠŸè¿›å…¥ç™»å½•é¡µé¢ã€‚

### â‘¡ LoginController

ä¸ºäº†ä¿å­˜ç™»å½•çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥**æŠŠç”¨æˆ·ä¿¡æ¯å­˜åœ¨ `Session` å¯¹è±¡ä¸­**ï¼ˆå½“ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºçš„ Web é¡µä¹‹é—´è·³è½¬æ—¶ï¼Œå­˜å‚¨åœ¨ `Session` å¯¹è±¡ä¸­çš„å˜é‡ä¸ä¼šä¸¢å¤±ï¼‰ï¼Œè¿™æ ·åœ¨è®¿é—®åˆ«çš„é¡µé¢æ—¶ï¼Œå¯ä»¥é€šè¿‡åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç”¨æˆ·å˜é‡æ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼š

```java
@Controller
public class LoginController {

    @Autowired
    UserService userService;

    @CrossOrigin
    @PostMapping(value = "api/login")
    @ResponseBody
    public Result login(@RequestBody User requestUser, HttpSession session) {
        String username = requestUser.getUsername();
        String password = requestUser.getPassword();
        System.out.println("username: " + username);
        System.out.println("password: " + password);

        User user = userService.getByNameAndPwd(username,password);
        if (user == null) {
            System.out.println("è´¦å·å¯†ç é”™è¯¯");
            return new Result(400);
        } else {
            System.out.println("Successful");
            session.setAttribute("user",user); // å­˜å…¥ session
            return new Result(200);
        }
    }
}
```

### â‘¢ LoginInterceptor

æ–°å»ºç±» `interceptor/LoginInterceptor`ï¼š

Interceptor å³æ‹¦æˆªå™¨ï¼Œåœ¨ Springboot æˆ‘ä»¬å¯ä»¥ç›´æ¥ç»§æ‰¿æ‹¦æˆªå™¨ `HandlerIntercepter` çš„æ¥å£ï¼Œç„¶åå®ç° `preHandle` æ–¹æ³•ï¼ˆ`Ctrl + O` å¿«æ·é”®ï¼‰ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200727173824.png)

`preHandle` æ–¹æ³•é‡Œçš„ä»£ç ä¼šåœ¨è®¿é—®éœ€è¦æ‹¦æˆªçš„é¡µé¢æ—¶æ‰§è¡Œï¼š

```java
public class LoginInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle (HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o) throws Exception {
        HttpSession session = httpServletRequest.getSession();
        String contextPath=session.getServletContext().getContextPath();
        // éœ€è¦è¿›è¡Œæ‹¦æˆªçš„è·¯å¾„
        String[] requireAuthPages = new String[]{
                "index",
        };

        String uri = httpServletRequest.getRequestURI();

        uri = StringUtils.remove(uri, contextPath+"/");
        String page = uri; // å½“å‰ url â€œ/â€ åçš„è·¯å¾„åç§°


        if(begingWith(page, requireAuthPages)){
            User user = (User) session.getAttribute("user"); // åˆ¤æ–­ session ä¸­æ˜¯å¦å­˜åœ¨è¯¥ç”¨æˆ·
            if(user==null) {
                httpServletResponse.sendRedirect("login");
                return false;
            }
        }
        return true;
    }

    // åˆ¤æ–­è¯¥è·¯å¾„æ˜¯å¦éœ€è¦è¿›è¡Œæ‹¦æˆª
    private boolean begingWith(String page, String[] requiredAuthPages) {
        boolean result = false;
        for (String requiredAuthPage : requiredAuthPages) {
            if(StringUtils.startsWith(page, requiredAuthPage)) {
                result = true;
                break;
            }
        }
        return result;
    }
}
```

å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‹¦æˆªæ‰€æœ‰è·¯å¾„ï¼Œé‚£æ ·å°±ä¸ç”¨å†™è¿™ä¹ˆå¤šäº†ï¼Œä½†ä¼šæœ‰é€»è¾‘ä¸Šçš„é—®é¢˜ï¼Œå°±æ˜¯ä½ è®¿é—®äº† `/login` é¡µé¢ï¼Œä»ç„¶ä¼šéœ€è¦è·³è½¬ï¼Œè¿™æ ·å°±ä¼šå¼•å‘å¤šæ¬¡é‡å®šå‘é—®é¢˜ã€‚

### â‘£ WebConfigurer

æˆ‘ä»¬å†™å®Œäº†æ‹¦æˆªå™¨ï¼Œä½†æ˜¯å®ƒå´å¹¶ä¸ä¼šç”Ÿæ•ˆï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰æŠŠå®ƒé…ç½®åˆ°é¡¹ç›®ä¸­ã€‚

æ–°å»ºç±» `config/MyWebConfigurer`ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
@SpringBootConfiguration
public class MyWebConfigurer implements WebMvcConfigurer {

    @Bean
    public LoginInterceptor getLoinIntercepter(){
        return new LoginInterceptor();
    }
    @Override
    public void addInterceptors(InterceptorRegistry registry){
        registry.addInterceptor(getLoinIntercepter()).addPathPatterns("/**").excludePathPatterns("/index.html");
    }
}
```

å¯¹æ‰€æœ‰è·¯å¾„åº”ç”¨æ‹¦æˆªå™¨ï¼Œé™¤äº† `/index.html`ã€‚ä¹‹å‰æˆ‘ä»¬åœ¨æ‹¦æˆªå™¨ `LoginInterceptor `ä¸­é…ç½®çš„è·¯å¾„ï¼Œå³ `index`ï¼Œè§¦å‘çš„æ—¶æœºæ˜¯åœ¨æ‹¦æˆªå™¨ç”Ÿæ•ˆä¹‹åã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ**æˆ‘ä»¬è®¿é—®ä¸€ä¸ª URLï¼Œä¼šé¦–å…ˆé€šè¿‡ `Configurer `åˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆªï¼Œå¦‚æœéœ€è¦ï¼Œæ‰ä¼šè§¦å‘æ‹¦æˆªå™¨ `LoginInterceptor`ï¼Œæ ¹æ®æˆ‘ä»¬è‡ªå®šä¹‰çš„è§„åˆ™è¿›è¡Œå†æ¬¡åˆ¤æ–­**ã€‚

**`/index` ä¸ `/index.html` æ˜¯ä¸åŒçš„**ï¼Œä¹Ÿå°±æ˜¯è¯´` /index` ä¼šè§¦å‘æ‹¦æˆªå™¨è€Œ `/index.html` ä¸ä¼šï¼Œä½†æ ¹æ®æ‹¦æˆªå™¨ `LoginInterceptor `ä¸­æˆ‘ä»¬å®šä¹‰çš„åˆ¤æ–­æ¡ä»¶ï¼Œä»¥ `/index` å¼€å¤´çš„è·¯å¾„éƒ½ä¼šè¢«è½¬å‘ï¼ŒåŒ…æ‹¬ `index.html`ã€‚

**å› ä¸ºæˆ‘ä»¬åšçš„æ˜¯å•é¡µé¢åº”ç”¨ï¼Œä¹‹å‰é€šè¿‡é…ç½® `ErrorPage`ï¼Œå®é™…ä¸Šè®¿é—®æ‰€æœ‰è·¯å¾„éƒ½ä¼šé‡å®šå‘åˆ° `/index.html`** ã€‚æˆ‘ä»¬ç›´æ¥åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ `/index` ä¼šè§¦å‘æ‹¦æˆªå™¨ï¼Œç»è¿‡æ‹¦æˆªå™¨é‡å®šå‘åˆ° `/login`ï¼Œç™»å½•åï¼Œ` /login` å†ç»è¿‡ `Configurer `çš„åˆ¤æ–­ï¼Œå†æ¬¡è§¦å‘æ‹¦æˆªå™¨ï¼Œç”±äºå·²ç»ç™»å½•ï¼Œæ‰€ä»¥è¢«æ”¾è¡Œï¼Œé¡µé¢åˆ™é‡æ–°å®šå‘åˆ°äº† `/index.html`ï¼Œå¦‚æœæ²¡æœ‰åœ¨ `Configurer `ä¸­å–æ¶ˆå¯¹ `/index.html` çš„æ‹¦æˆªï¼Œåˆ™ä¼šå†æ¬¡è§¦å‘æ‹¦æˆªå™¨ï¼Œå¯¼è‡´é‡å®šå‘æ¬¡æ•°è¿‡å¤šã€‚

![](https://gitee.com/veal98/images/raw/master/img/20200727175637.png)

### â‘¤ è¿è¡Œé¡¹ç›®

è¿è¡Œåç«¯é¡¹ç›®ï¼Œè®¿é—® [http://localhost:8082/index](http://localhost:8082/index) ï¼Œå‘ç°é¡µé¢è‡ªåŠ¨è·³è½¬åˆ°äº† [http://localhost:8082/login](http://localhost:8082/login) ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ç™»å½•ï¼Œè·³è½¬åˆ° http://localhost:8082/index ï¼Œ è¿™æ—¶å¯ä»¥æŠŠæµè§ˆå™¨æ ‡ç­¾å…³æ‰ï¼Œå†åœ¨ä¸€ä¸ªæ–°æ ‡ç­¾é¡µè¾“å…¥ http://localhost:8082/index ï¼Œå‘ç°ä¸ä¼šè¢«æ‹¦æˆªã€‚

## â›µ Next

ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°†åˆ©ç”¨ Element å®ç°å¯¼èˆªæ å’Œå›¾ä¹¦ç®¡ç†ç•Œé¢

## ğŸ“š References

- [Vue + Spring Boot é¡¹ç›®å®æˆ˜ â€” ç™½å·](https://blog.csdn.net/Neuf_Soleil/article/details/88925013)