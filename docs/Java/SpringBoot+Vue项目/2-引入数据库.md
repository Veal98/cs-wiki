# zÂ·ğŸ“¦ å¼•å…¥æ•°æ®åº“ MySQL

---

> ğŸ”Š æœ¬ç¯‡ä¸»è¦å®ç°å¼•å…¥æ•°æ®åº“ MySQLï¼Œé€šè¿‡ Spring Data JPA æ“ä½œæ•°æ®åº“ï¼Œå®ç°åç«¯è¿æ¥æ•°æ®åº“éªŒè¯ç”¨æˆ·åå’Œå¯†ç ã€‚

## 1. åˆ›å»ºæ•°æ®åº“å’Œè¡¨

```sql
CREATE DATABASE ournote;
USE ournote;

-- ----------------------------
-- Table structure for user
-- ----------------------------
DROP TABLE IF EXISTS `user`;
CREATE TABLE `user` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `username` varchar(255) DEFAULT NULL,
  `password` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of user
-- ----------------------------
INSERT INTO `user` VALUES ('1', 'admin', '123');
```

![](https://gitee.com/veal98/images/raw/master/img/20200726101041.png)

![](https://gitee.com/veal98/images/raw/master/img/20200726101154.png)

> ğŸš¨ çœŸå®çš„é¡¹ç›®ä¸­ï¼Œç”¨æˆ·ä¿¡æ¯å¯ä¸èƒ½è¿™ä¹ˆå­˜ï¼Œç›´æ¥æŠŠè´¦å·å¯†ç å†™ä¸Šå»å¤ªå±é™©äº†ï¼Œä¸€èˆ¬çš„åšæ³•æ˜¯å­˜å‚¨å¯†ç ç­‰ä¿¡æ¯çš„ hash å€¼ã€‚

æˆ‘çš„ MySQL ç‰ˆæœ¬æ˜¯ 5.7.17

![](https://gitee.com/veal98/images/raw/master/img/20200726105309.png)

## 2. ä½¿ç”¨æ•°æ®åº“éªŒè¯ç™»å½•

### â‘  é¡¹ç›®é…ç½®

é¦–å…ˆï¼Œéœ€è¦å¼•å…¥ **MySQL** å’Œ **Spring Data JPA** çš„ä¾èµ–ï¼ˆæˆ‘ä»¬ä½¿ç”¨ JPA æ¥å®ç°å®ä½“ç±»çš„æŒä¹…åŒ–ï¼‰ï¼š

```xml
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <version>5.1.47</version>
</dependency>

<!-- jpa-->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>
```

ç„¶åï¼Œéœ€è¦åœ¨å…¨å±€é…ç½®æ–‡ä»¶ä¸­é…ç½®æ•°æ®åº“ç›¸å…³ä¿¡æ¯ï¼š

```yaml
server:
  port: 8082

spring:
  # é…ç½®æ•°æ®åº“
  datasource:
    url: jdbc:mysql://127.0.0.1:3306/ournote?characterEncoding=UTF-8
    username: root
    password: root
    driver-class-name: com.mysql.jdbc.Driver

  # é…ç½®jpa
  jpa:
    show-sql: true # æ‰“å° sql è¯­å¥
```

### â‘¡ æµ‹è¯•æ•°æ®åº“è¿æ¥

æµ‹è¯•èƒ½å¦æ­£ç¡®è¿æ¥åˆ° MySQL æ•°æ®åº“ï¼š

```java
@SpringBootTest
class OurnoteApplicationTests {

    @Autowired
    DataSource dataSource;

    @Test
    void contextLoads() {
        System.out.println("æµ‹è¯•: " + dataSource.getClass());
    }

}
```

![](https://gitee.com/veal98/images/raw/master/img/20200726123728.png)

### â‘¢ ä¿®æ”¹ User ç±»

æˆ‘ä»¬ä¿®æ”¹ User ç±»ä»£ç å¦‚ä¸‹ï¼Œä»¥å»ºç«‹å¯¹æ•°æ®åº“çš„æ˜ å°„ã€‚

```java
package com.smallbeef.ournote.entity;

import com.fasterxml.jackson.annotation.JsonIgnoreProperties;

import javax.persistence.*;

@Entity // è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå®ä½“ç±»
@Table(name = "user") // è¡¨ç¤ºå¯¹åº”çš„è¡¨åæ˜¯ user
/*
* å› ä¸ºæ˜¯åšå‰åç«¯åˆ†ç¦»ï¼Œè€Œå‰åç«¯æ•°æ®äº¤äº’ç”¨çš„æ˜¯ json æ ¼å¼ã€‚ é‚£ä¹ˆ User å¯¹è±¡å°±ä¼šè¢«è½¬æ¢ä¸º json æ•°æ®ã€‚
* è€Œæœ¬é¡¹ç›®ä½¿ç”¨ jpa æ¥åšå®ä½“ç±»çš„æŒä¹…åŒ–ï¼Œjpa é»˜è®¤ä¼šä½¿ç”¨ hibernate,
* jpa ä¼šåˆ›é€ ä»£ç†ç±»æ¥ç»§æ‰¿ User ï¼Œå¹¶æ·»åŠ  handler å’Œ hibernateLazyInitializer è¿™ä¸¤ä¸ªæ— é¡» json åŒ–çš„å±æ€§ï¼Œ
* æ‰€ä»¥è¿™é‡Œéœ€è¦ç”¨ JsonIgnoreProperties æŠŠè¿™ä¸¤ä¸ªå±æ€§å¿½ç•¥æ‰ã€‚
* */
@JsonIgnoreProperties({"handler","hibernateLazyInitializer"})
public class User {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "id")
    Integer id;
    String username;
    String password;

    ......
}
```

### â‘£ UserDao æ¥å£

â­ æˆ‘ä»¬é€šè¿‡ç»§æ‰¿ `JpaRepository` çš„æ–¹å¼æ„å»º DAOã€‚ç»§æ‰¿åæˆ‘ä»¬å°±è‡ªåŠ¨æ‹¥æœ‰äº†åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½ã€‚

æ–°å»º `dao/UserDao`ï¼š

```java
@Repository
public interface UserDao extends JpaRepository<User,Integer> {

    // é€šè¿‡ç”¨æˆ·åæŸ¥è¯¢
    User findByUsername(String username);

    // é€šè¿‡ç”¨æˆ·ååŠå¯†ç æŸ¥è¯¢
    User getByUsernameAndPassword(String username, String password);
}
```

Spring Data JPA æ”¯æŒå¼€å‘è€…**è‡ªå®šä¹‰æŸ¥è¯¢æ–¹æ³•**ï¼Œå¯¹äºç¬¦åˆä»¥ä¸‹å‘½åè§„åˆ™çš„æ–¹æ³•ï¼ŒSpring Data JPA èƒ½å¤Ÿæ ¹æ®å…¶æ–¹æ³•åä¸ºå…¶è‡ªåŠ¨ç”Ÿæˆ SQLï¼Œæ”¯æŒçš„å…³é”®å­—æœ‰ï¼š`find`ã€`query`ã€`get`ã€`read`ã€`count`ã€`delete` ç­‰ã€‚ 

ä»¥ `find` ä¸ºä¾‹ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200925122225.png)

è¿™é‡Œå…³é”®çš„åœ°æ–¹åœ¨äºæ–¹æ³•çš„åå­—ã€‚åªéœ€è¦æŒ‰ç…§ JPA è§„èŒƒæä¾›æ–¹æ³•çš„åå­—å³å¯è‡ªåŠ¨åˆ›å»º SQL è¯­å¥ï¼Œå®ç°å¯¹æ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥ã€‚

### â‘¤ æµ‹è¯• JPA æ“ä½œæ•°æ®åº“

```java
@SpringBootTest
class OurnoteApplicationTests {

    @Autowired
    UserDao userDao;
    @Autowired
    DataSource dataSource;

    @Test
    void contextLoads() {
        System.out.println(userDao.findByUsername("admin")); // æµ‹è¯•æŸ¥è¯¢ 
        userDao.save(new User(2,"123","123")); // æµ‹è¯•æ·»åŠ 
    }
}
```

![](https://gitee.com/veal98/images/raw/master/img/20200726124010.png)

### â‘¥ UserService

æ–°å»º `service/UserService`ï¼š

```java
@Service
public class UserService {

    @Autowired
    UserDao userDao;

    // æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢
    public User getByName(String username){
        return userDao.findByUsername(username);
    }
    // æ ¹æ®ç”¨æˆ·åå’Œå¯†ç æŸ¥è¯¢
    public User getByNameAndPwd(String username, String password){
        return userDao.getByUsernameAndPassword(username,password);
    }

    // åˆ¤æ–­æ­¤ç”¨æˆ·æ˜¯å¦å­˜åœ¨
    public boolean isExist(String username){
        User user = getByName(username);
        return user != null;
    }

    // æ·»åŠ  User
    public void add(User user){
        userDao.save(user);
    }
}
```

è¿™é‡Œå®é™…ä¸Šæ˜¯å¯¹ `UserDAO `è¿›è¡Œäº†äºŒæ¬¡å°è£…ï¼Œä¸€èˆ¬æ¥è®²ï¼Œæˆ‘ä»¬åœ¨ `DAO `ä¸­åªå®šä¹‰åŸºç¡€çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œè€Œå…·ä½“çš„æ“ä½œï¼Œéœ€è¦ç”± `Service `æ¥å®Œæˆã€‚å½“ç„¶ï¼Œç”±äºæˆ‘ä»¬åšçš„æ“ä½œåŸæœ¬å°±æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥è¿™é‡Œçœ‹èµ·æ¥åªæ˜¯ç®€å•åœ°é‡å‘½åäº†ä¸€ä¸‹ï¼Œæ¯”å¦‚æŠŠ â€œé€šè¿‡ç”¨æˆ·ååŠå¯†ç æŸ¥è¯¢å¹¶è·å¾—å¯¹è±¡â€ è¿™ç§æ–¹æ³•å‘½åä¸º `getByNameAndPwd`ã€‚

### â‘¦ LoginController

ç™»å½•æ§åˆ¶å™¨æ˜¯æˆ‘ä»¬åŠŸèƒ½çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå…·ä½“çš„å®ç°ï¼Œå°±æ˜¯é€šè¿‡ `UserService` æä¾›çš„æ–¹æ³•æŸ¥è¯¢æ•°æ®åº“ï¼Œå¦‚æœè¿”å›çš„å¯¹è±¡ä¸ºç©ºï¼Œåˆ™éªŒè¯å¤±è´¥ï¼Œå¦åˆ™å°±éªŒè¯æˆåŠŸã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
@Controller
public class LoginController {

    @Autowired
    UserService userService;

    @CrossOrigin
    @PostMapping(value = "api/login")
    @ResponseBody
    public Result login(@RequestBody User requestUser) {
        String username = requestUser.getUsername();
        String password = requestUser.getPassword();
        System.out.println("username: " + username);
        System.out.println("password: " + password);

        User user = userService.getByNameAndPwd(username,password);
        if (user == null) {
            System.out.println("è´¦å·å¯†ç é”™è¯¯");
            return new Result(400);
        } else {
            System.out.println("Successful");
            return new Result(200);
        }
    }
}
```

ç®€å•æ€»ç»“ä¸€ä¸‹å„å±‚æ¬¡åˆ†å·¥ï¼š

- `DAO `ç”¨äºä¸æ•°æ®åº“çš„ç›´æ¥äº¤äº’ï¼Œå®šä¹‰å¢åˆ æ”¹æŸ¥ç­‰æ“ä½œ
- `Service `è´Ÿè´£ä¸šåŠ¡é€»è¾‘ï¼Œè·ŸåŠŸèƒ½ç›¸å…³çš„ä»£ç ä¸€èˆ¬å†™åœ¨è¿™é‡Œï¼Œç¼–å†™ã€è°ƒç”¨å„ç§æ–¹æ³•å¯¹ `DAO `å–å¾—çš„æ•°æ®è¿›è¡Œæ“ä½œ
- `Controller `è´Ÿè´£æ•°æ®äº¤äº’ï¼Œå³æ¥æ”¶å‰ç«¯å‘é€çš„æ•°æ®ï¼Œé€šè¿‡è°ƒç”¨ `Service `è·å¾—å¤„ç†åçš„æ•°æ®å¹¶è¿”å›

## 3. è¿è¡Œé¡¹ç›®

åŒæ—¶è¿è¡Œå‰ç«¯é¡¹ç›®ä¸åç«¯é¡¹ç›®ï¼Œè®¿é—® [http://localhost:8080/login](http://localhost:8080/login)ï¼Œè¾“å…¥ç”¨æˆ·å adminï¼Œå¯†ç  123 å³å¯æ­£ç¡®è·³è½¬ã€‚

## â›µ Next

ä¸‹ä¸€ç¯‡å°†å¼•å…¥ ElementUI å¯¹å‰ç«¯ç™»å½•ç•Œé¢è¿›è¡Œç¾åŒ–

## ğŸ“š References

- [Vue + Spring Boot é¡¹ç›®å®æˆ˜ â€” ç™½å·](https://blog.csdn.net/Neuf_Soleil/article/details/88925013)
- [SpringBooté‡ç‚¹è¯¦è§£--ä½¿ç”¨JPAæ“ä½œæ•°æ®åº“](https://blog.csdn.net/pengjunlee/article/details/80038677?)
- [å­¦ä¹ Spring Bootæ—¶ï¼Œæ•´åˆSpring Data JPA ï¼ŒæŠ¥é”™a bean named 'entityManagerFactory' that could not be found](https://blog.csdn.net/qq_20124743/article/details/90635019)