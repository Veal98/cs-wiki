# ğŸ‘¨â€âš•ï¸ æ•°æ®åº“è®¾è®¡ä¸å¢åˆ æ”¹æŸ¥

---

> ğŸ”Š æœ¬èŠ‚ä¸»è¦å®ç°æ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥

## 1. æ•°æ®åº“è®¾è®¡

æˆ‘ä»¬çš„éœ€æ±‚å¤§è‡´å¦‚ä¸‹ï¼š

- å±•ç¤ºä¹¦ç±çš„ä¿¡æ¯ï¼šåŒ…æ‹¬å°é¢ã€æ ‡é¢˜ã€ä½œè€…ã€å‡ºç‰ˆæ—¥æœŸã€å‡ºç‰ˆç¤¾ã€æ‘˜è¦å’Œåˆ†ç±»ã€‚
- ç”¨æˆ·ä¿¡æ¯

è¡¨ç»“æ„å¦‚ä¸‹ï¼š

![](https://gitee.com/veal98/images/raw/master/img/20200730140852.png)

**user ç”¨æˆ·è¡¨** å’Œå®ä½“ç±» User å·²ç»å»ºç«‹è¿‡äº†ã€‚æœ¬èŠ‚æˆ‘ä»¬åªéœ€è¦å®ç°å›¾ä¹¦ç›¸å…³çš„å³å¯ã€‚

**category å›¾ä¹¦åˆ†ç±»ä¿¡æ¯è¡¨** å»ºè¡¨è¯­å¥ï¼š

```sql
DROP TABLE IF EXISTS `category`;
CREATE TABLE `category` (
  `id` int(11) NOT NULL,
  `name` varchar(255) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

```sql
INSERT INTO `category` VALUES ('1', 'æ–‡å­¦');
INSERT INTO `category` VALUES ('2', 'æµè¡Œ');
INSERT INTO `category` VALUES ('3', 'æ–‡åŒ–');
INSERT INTO `category` VALUES ('4', 'ç”Ÿæ´»');
INSERT INTO `category` VALUES ('5', 'ç»ç®¡');
INSERT INTO `category` VALUES ('6', 'ç§‘æŠ€');
```

**book å›¾ä¹¦ä¿¡æ¯è¡¨** å»ºè¡¨è¯­å¥ï¼š

book è¡¨æœ‰ä¸€ä¸ªå¤–é”®ï¼šå³ catrgory è¡¨ä¸Šçš„ idï¼Œæ¯ä¸ªå›¾ä¹¦å¯¹åº”ä¸€ä¸ªåˆ†ç±»ä¿¡æ¯

```sql
DROP TABLE IF EXISTS `book`;
CREATE TABLE `book` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `cover` varchar(255) DEFAULT '',
  `title` varchar(255) NOT NULL DEFAULT '',
  `author` varchar(255) DEFAULT '',
  `date` varchar(20) DEFAULT '',
  `press` varchar(255) DEFAULT '',
  `abs` varchar(255) DEFAULT NULL,
  `cid` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_book_category_on_cid` (`cid`),
  CONSTRAINT `fk_book_category_on_cid` FOREIGN KEY (`cid`) REFERENCES `category` (`id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=109 DEFAULT CHARSET=utf8;
```

```sql
INSERT INTO `book` VALUES ('1', 'https://i.loli.net/2019/04/10/5cadaa0d0759b.jpg', 'ä¸”åœ¨äººé—´', 'ä½™ç§€å', '2019-2-1', 'æ¹–å—æ–‡è‰ºå‡ºç‰ˆç¤¾', 'è¯—äººä½™ç§€åä¸­ç¯‡å°è¯´é¦–æ¬¡ç»“é›†å‡ºç‰ˆã€‚\r\n\r\n        ã€Šä¸”åœ¨äººé—´ã€‹â€”â€”ä»¥ä½™ç§€åä¸ºç”Ÿæ´»åŸå‹ï¼Œè®²è¿°ä¸€ä¸ªæ®‹ç–¾å¥³äººæ‚²è‹¦å€”å¼ºã€å‘æ­»è€Œç”Ÿçš„æ•…äº‹ã€‚\r\n\r\n        å¥³ä¸»äººå…¬å‘¨ç‰ç”Ÿæ´»åœ¨ä¹¡æ‘ï¼Œæ‚£æœ‰â€œè„‘ç˜«â€ï¼Œå¥¹å‡ ä¹è¢«æ‰€æœ‰äººæ¼ è§†ï¼Œç”šè‡³è¢«æ•´ä¸ªç¤¾ä¼šæŠ›å¼ƒï¼Œä½†æ˜¯å¥¹æ¸´æœ›è¢«å½“æˆä¸€ä¸ªæ™®é€šçš„å¥åº·äºº,è€Œä¸æ˜¯å¸¦ç€æ€œæ‚¯æˆ–ä¸å±‘ï¼Œå¥¹åªè¦æ±‚å¹³ç­‰ã€‚çˆ±æƒ…çš„ç¼º å¤±ï¼Œå®¶åº­çš„ä¸å¹¸ï¼Œç”Ÿæ´»çš„ç§ç§é™…é‡è®©å‘¨ç‰ç”¨è¯—æ­Œçš„æ–¹å¼æŠŠ æƒ…æ„ŸæŠ’å‘å‡ºæ¥ï¼Œæœ€ç»ˆå¥¹ç”¨è¯—æ­Œåˆ›ä½œå‡ºäº†ä¸€ä¸ªæ–‡å­¦çš„ä¸–ç•Œï¼Œå¾—åˆ°äº†äººä»¬çš„è®¤å¯ã€‚', '2');

......
```

## 2. æ•°æ®åº“ CRUD

- æŸ¥è¯¢ä¹¦ç±ä¿¡æ¯ï¼ˆæŸ¥ï¼‰
- ä¸Šä¼ ä¹¦ç±ä¿¡æ¯ï¼ˆå¢ï¼‰
- ä¿®æ”¹ä¹¦ç±ä¿¡æ¯ï¼ˆæ”¹ï¼‰
- åˆ é™¤ä¹¦ç±ä¿¡æ¯ï¼ˆåˆ ï¼‰

> ğŸ’¡ æŸ¥è¯¢é‡Œæ¶‰åŠæŒ‰å…³é”®å­—æŸ¥è¯¢ï¼ˆå›¾ä¹¦æ£€ç´¢ï¼‰ï¼Œä¸Šä¼ ä¹¦ç±ä¿¡æ¯é‡Œæ¶‰åŠå›¾ç‰‡ä¸Šä¼ ï¼Œè¿™é‡Œå…ˆä¸å¤šè¯´ã€‚

### â‘  å®ä½“ç±»

æˆ‘ä»¬éœ€è¦æ–°å»ºä¸¤ä¸ª pojoï¼Œåˆ†åˆ«æ˜¯ Category å’Œ Book ã€‚

**Categoryï¼š**

```java
@Entity
@Table(name = "category")
@JsonIgnoreProperties({ "handler","hibernateLazyInitializer" })
public class Category {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "id")
    Integer id;

    String name;

 	// Getter And Setter
}
```

> ğŸ’¡ [è§£å†³æ³¨è§£ä¸­æŠ¥é”™ Can't resolve table 'xxx' é—®é¢˜](https://blog.csdn.net/hs_shengxiaguangnian/article/details/104642962)

**Bookï¼š**

```java
@Entity
@Table(name = "book")
@JsonIgnoreProperties({"handler","hibernateLazyInitializer"})
public class Book {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "id")
    int id;

    String cover;
    String title;
    String author;
    String date;
    String press;
    String abs;

    // å¤–é”®
    @ManyToOne
    @JoinColumn(name="cid")
    private Category category;

    // Getter And Setter
}

```

### â‘¡ Dao å±‚

æˆ‘ä»¬éœ€è¦å†æ·»åŠ ä¸€ä¸ª BookDAO ï¼Œä¸€ä¸ª CategoryDAOã€‚

**BookDAOï¼š**

```java
@Repository
public interface BookDAO extends JpaRepository<Book,Integer> {

    // æŒ‰ç…§åˆ†ç±»ä¿¡æ¯è¿›è¡ŒæŸ¥è¯¢
    // å®é™…ä¸Šæ˜¯æŠŠ category å¯¹è±¡çš„ id å±æ€§ä½œä¸º cid è¿›è¡Œäº†æŸ¥è¯¢ã€‚
    List<Book> findAllByCategory(Category category);

}
```

`findAllByCategory()` ä¹‹æ‰€ä»¥èƒ½å®ç°ï¼Œæ˜¯å› ä¸ºåœ¨ `Book `ç±»ä¸­æœ‰å¦‚ä¸‹æ³¨è§£ï¼š

```java
@ManyToOne
@JoinColumn(name="cid")
private Category category;
```

å®é™…ä¸Šæ˜¯æŠŠ `category `å¯¹è±¡çš„ `id` å±æ€§ä½œä¸º `cid `è¿›è¡Œäº†æŸ¥è¯¢ã€‚

**CategoryDAOï¼š**

```java
public interface CategoryDAO extends JpaRepository<Category,Integer> {

    /*
    * ä¸éœ€è¦é¢å¤–æ„é€ çš„æ–¹æ³•ï¼ŒJPA æä¾›çš„é»˜è®¤æ–¹æ³•å°±å¤Ÿç”¨äº†
    */
}
```

### â‘¢ Service å±‚

**CategoryServiceï¼š**

```java
import org.springframework.data.domain.Sort;

@Service
public class CategoryService {

    @Autowired
    CategoryDAO categoryDAO;

    // æŸ¥è¯¢æ‰€æœ‰åˆ†ç±»ä¿¡æ¯ï¼ˆæŒ‰ç…§åˆ†ç±»çš„idé™åºè¿›è¡Œæ˜¾ç¤ºï¼‰
  public List<Category> list(){
        Sort sort = Sort.by(Sort.Direction.DESC, "id"); // æŒ‰ç…§ id é™åºæ’åº
        return categoryDAO.findAll(sort);
    }

    // æ ¹æ® cid è·å–åˆ†ç±»ä¿¡æ¯
    public Category get(int id){
        Category category = categoryDAO.findById(id).orElse(null); // å¦‚æœæ²¡æ‰¾åˆ°æŒ‡å®šå®ä½“ï¼Œåˆ™è¿”å›é»˜è®¤å€¼ null
        return category;

    }
}
```

**BookServiceï¼š**

```java
@Service
public class BookService {

    @Autowired
    BookDAO bookDAO;

    @Autowired
    CategoryService categoryService;

    // æŸ¥è¯¢æ‰€æœ‰å›¾ä¹¦ä¿¡æ¯ï¼ˆæŒ‰ç…§å›¾ä¹¦çš„idé™åºè¿›è¡Œæ˜¾ç¤ºï¼‰
    public List<Book> list(){
        Sort sort = Sort.by(Sort.Direction.DESC,  "id");
        return bookDAO.findAll(sort);
    }

    // æ·»åŠ æˆ–ä¿®æ”¹å›¾ä¹¦
    public void addOrUpdate(Book book){
        bookDAO.save(book);
    }

    // æŒ‰ç…§å›¾ä¹¦idè¿›è¡Œåˆ é™¤
    public void deleteById(Integer id){
        bookDAO.deleteById(id);
    }

    // æŸ¥è¯¢æŸä¸ªåˆ†ç±»ä¸‹çš„æ‰€æœ‰å›¾ä¹¦
    public List<Book> listByCategory(Integer cid){
        Category category = categoryService.get(cid);
        return bookDAO.findAllByCategory(category);
    }
}
```

è¿™é‡Œæ³¨æ„ä¸€ä¸‹ `save()` æ–¹æ³•çš„ä½œç”¨æ˜¯ï¼Œå½“ä¸»é”®å­˜åœ¨æ—¶æ›´æ–°æ•°æ®ï¼Œå½“ä¸»é”®ä¸å­˜åœ¨æ—¶æ’å…¥æ•°æ®ã€‚æ‰€ä»¥æ—¢å¯ä»¥ä½œä¸ºæ·»åŠ ä¹¦ç±çš„å‡½æ•°ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¿®æ”¹ä¹¦ç±ä¿¡æ¯çš„å‡½æ•°ä½¿ç”¨ã€‚

### â‘£ Controller å±‚

**LibraryControllerï¼š**

```java
@RestController
public class LibraryController {

    @Autowired
    BookService bookService;

    // æŸ¥è¯¢æ‰€æœ‰å›¾ä¹¦ä¿¡æ¯
    @GetMapping("api/books")
    public List<Book> list(){
        return bookService.list();
    }

    // æ·»åŠ æˆ–ä¿®æ”¹å›¾ä¹¦ä¿¡æ¯
    @PostMapping("api/books")
    public Book addOrUpdate(@RequestBody Book book){
        bookService.addOrUpdate(book);
        return book;
    }

    // æ ¹æ® id åˆ é™¤ å›¾ä¹¦
    @PostMapping("api/delete")
    public void delete(@RequestBody Book book){
        bookService.deleteById(book.getId());
    }

    // æŸ¥è¯¢æŸä¸ªåˆ†ç±»ä¸‹çš„æ‰€æœ‰å›¾ä¹¦ä¿¡æ¯ï¼ˆä»å‰ç«¯å°†æŸ¥è¯¢åˆ†ç±»çš„cidæ”¾å…¥ url, é€šè¿‡ @PathVariable ä»åç«¯è·å–ï¼‰
    @GetMapping("api/categories/{cid}/books")
    public List<Book> listByCategory(@PathVariable("cid") Integer cid){
        if(cid != 0){
            return bookService.listByCategory(cid);
        }else{ // å¦‚æœè¯¥åˆ†ç±»ä¸å­˜åœ¨ï¼Œåˆ™æ˜¾ç¤ºæ‰€æœ‰å›¾ä¹¦ä¿¡æ¯
            return list();
        }
    }
}
```

### â‘¤ è¿è¡Œé¡¹ç›®

è¿è¡Œé¡¹ç›®ï¼Œæµ‹è¯•ä¸€ä¸‹åŠŸèƒ½ã€‚

é¦–å…ˆæ˜¯æŸ¥è¯¢æ‰€æœ‰ä¹¦ç±ï¼Œè®¿é—® `http://localhost:8443/api/books`

ç„¶åæµ‹è¯•åˆ†ç±»ï¼Œæ¯”å¦‚æŸ¥çœ‹æ‰€æœ‰åˆ†ç±» id ä¸º 1ï¼Œå³åˆ†ç±»ä¸ºâ€œæ–‡å­¦â€çš„ä¹¦ç±ï¼Œè®¿é—® `http://localhost:8443/api/categories/1/books`ï¼Œ

## â›µ Next

åç«¯å…³äºå›¾ä¹¦ CRUD çš„åŠŸèƒ½å·²ç»å®ç°äº†ï¼Œæ¥ä¸‹æ¥å°†å®Œæˆå‰ç«¯å’Œåç«¯çš„ä¿¡æ¯äº¤äº’ã€‚

## ğŸ“š References

- [Vue + Spring Boot é¡¹ç›®å®æˆ˜ â€” ç™½å·](https://blog.csdn.net/Neuf_Soleil/article/details/88925013)
- [Spring-Data-Jpaçš„Sortæ’åºæ—¶é‡åˆ°çš„é—®é¢˜ has private access in 'org.springframework.data.domain.Sort'](https://blog.csdn.net/qq_35953966/article/details/104061854)
- [SpringBoot2.0 JPAä¸­findByIdç”¨æ³•](https://blog.csdn.net/qq_29653517/article/details/100765488)